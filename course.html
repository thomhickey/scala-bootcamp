<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="generator" content="AsciiDoc 8.6.9">
<title>Scala Bootcamp</title>
<style type="text/css">
/* Shared CSS for AsciiDoc xhtml11 and html5 backends */

/* Default font. */
body {
  font-family: Georgia,serif;
}

/* Title font. */
h1, h2, h3, h4, h5, h6,
div.title, caption.title,
thead, p.table.header,
#toctitle,
#author, #revnumber, #revdate, #revremark,
#footer {
  font-family: Arial,Helvetica,sans-serif;
}

body {
  margin: 1em 5% 1em 5%;
}

a {
  color: blue;
  text-decoration: underline;
}
a:visited {
  color: fuchsia;
}

em {
  font-style: italic;
  color: navy;
}

strong {
  font-weight: bold;
  color: #083194;
}

h1, h2, h3, h4, h5, h6 {
  color: #527bbd;
  margin-top: 1.2em;
  margin-bottom: 0.5em;
  line-height: 1.3;
}

h1, h2, h3 {
  border-bottom: 2px solid silver;
}
h2 {
  padding-top: 0.5em;
}
h3 {
  float: left;
}
h3 + * {
  clear: left;
}
h5 {
  font-size: 1.0em;
}

div.sectionbody {
  margin-left: 0;
}

hr {
  border: 1px solid silver;
}

p {
  margin-top: 0.5em;
  margin-bottom: 0.5em;
}

ul, ol, li > p {
  margin-top: 0;
}
ul > li     { color: #aaa; }
ul > li > * { color: black; }

.monospaced, code, pre {
  font-family: "Courier New", Courier, monospace;
  font-size: inherit;
  color: navy;
  padding: 0;
  margin: 0;
}
pre {
  white-space: pre-wrap;
}

#author {
  color: #527bbd;
  font-weight: bold;
  font-size: 1.1em;
}
#email {
}
#revnumber, #revdate, #revremark {
}

#footer {
  font-size: small;
  border-top: 2px solid silver;
  padding-top: 0.5em;
  margin-top: 4.0em;
}
#footer-text {
  float: left;
  padding-bottom: 0.5em;
}
#footer-badges {
  float: right;
  padding-bottom: 0.5em;
}

#preamble {
  margin-top: 1.5em;
  margin-bottom: 1.5em;
}
div.imageblock, div.exampleblock, div.verseblock,
div.quoteblock, div.literalblock, div.listingblock, div.sidebarblock,
div.admonitionblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.admonitionblock {
  margin-top: 2.0em;
  margin-bottom: 2.0em;
  margin-right: 10%;
  color: #606060;
}

div.content { /* Block element content. */
  padding: 0;
}

/* Block element titles. */
div.title, caption.title {
  color: #527bbd;
  font-weight: bold;
  text-align: left;
  margin-top: 1.0em;
  margin-bottom: 0.5em;
}
div.title + * {
  margin-top: 0;
}

td div.title:first-child {
  margin-top: 0.0em;
}
div.content div.title:first-child {
  margin-top: 0.0em;
}
div.content + div.title {
  margin-top: 0.0em;
}

div.sidebarblock > div.content {
  background: #ffffee;
  border: 1px solid #dddddd;
  border-left: 4px solid #f0f0f0;
  padding: 0.5em;
}

div.listingblock > div.content {
  border: 1px solid #dddddd;
  border-left: 5px solid #f0f0f0;
  background: #f8f8f8;
  padding: 0.5em;
}

div.quoteblock, div.verseblock {
  padding-left: 1.0em;
  margin-left: 1.0em;
  margin-right: 10%;
  border-left: 5px solid #f0f0f0;
  color: #888;
}

div.quoteblock > div.attribution {
  padding-top: 0.5em;
  text-align: right;
}

div.verseblock > pre.content {
  font-family: inherit;
  font-size: inherit;
}
div.verseblock > div.attribution {
  padding-top: 0.75em;
  text-align: left;
}
/* DEPRECATED: Pre version 8.2.7 verse style literal block. */
div.verseblock + div.attribution {
  text-align: left;
}

div.admonitionblock .icon {
  vertical-align: top;
  font-size: 1.1em;
  font-weight: bold;
  text-decoration: underline;
  color: #527bbd;
  padding-right: 0.5em;
}
div.admonitionblock td.content {
  padding-left: 0.5em;
  border-left: 3px solid #dddddd;
}

div.exampleblock > div.content {
  border-left: 3px solid #dddddd;
  padding-left: 0.5em;
}

div.imageblock div.content { padding-left: 0; }
span.image img { border-style: none; vertical-align: text-bottom; }
a.image:visited { color: white; }

dl {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
dt {
  margin-top: 0.5em;
  margin-bottom: 0;
  font-style: normal;
  color: navy;
}
dd > *:first-child {
  margin-top: 0.1em;
}

ul, ol {
    list-style-position: outside;
}
ol.arabic {
  list-style-type: decimal;
}
ol.loweralpha {
  list-style-type: lower-alpha;
}
ol.upperalpha {
  list-style-type: upper-alpha;
}
ol.lowerroman {
  list-style-type: lower-roman;
}
ol.upperroman {
  list-style-type: upper-roman;
}

div.compact ul, div.compact ol,
div.compact p, div.compact p,
div.compact div, div.compact div {
  margin-top: 0.1em;
  margin-bottom: 0.1em;
}

tfoot {
  font-weight: bold;
}
td > div.verse {
  white-space: pre;
}

div.hdlist {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
div.hdlist tr {
  padding-bottom: 15px;
}
dt.hdlist1.strong, td.hdlist1.strong {
  font-weight: bold;
}
td.hdlist1 {
  vertical-align: top;
  font-style: normal;
  padding-right: 0.8em;
  color: navy;
}
td.hdlist2 {
  vertical-align: top;
}
div.hdlist.compact tr {
  margin: 0;
  padding-bottom: 0;
}

.comment {
  background: yellow;
}

.footnote, .footnoteref {
  font-size: 0.8em;
}

span.footnote, span.footnoteref {
  vertical-align: super;
}

#footnotes {
  margin: 20px 0 20px 0;
  padding: 7px 0 0 0;
}

#footnotes div.footnote {
  margin: 0 0 5px 0;
}

#footnotes hr {
  border: none;
  border-top: 1px solid silver;
  height: 1px;
  text-align: left;
  margin-left: 0;
  width: 20%;
  min-width: 100px;
}

div.colist td {
  padding-right: 0.5em;
  padding-bottom: 0.3em;
  vertical-align: top;
}
div.colist td img {
  margin-top: 0.3em;
}

@media print {
  #footer-badges { display: none; }
}

#toc {
  margin-bottom: 2.5em;
}

#toctitle {
  color: #527bbd;
  font-size: 1.1em;
  font-weight: bold;
  margin-top: 1.0em;
  margin-bottom: 0.1em;
}

div.toclevel0, div.toclevel1, div.toclevel2, div.toclevel3, div.toclevel4 {
  margin-top: 0;
  margin-bottom: 0;
}
div.toclevel2 {
  margin-left: 2em;
  font-size: 0.9em;
}
div.toclevel3 {
  margin-left: 4em;
  font-size: 0.9em;
}
div.toclevel4 {
  margin-left: 6em;
  font-size: 0.9em;
}

span.aqua { color: aqua; }
span.black { color: black; }
span.blue { color: blue; }
span.fuchsia { color: fuchsia; }
span.gray { color: gray; }
span.green { color: green; }
span.lime { color: lime; }
span.maroon { color: maroon; }
span.navy { color: navy; }
span.olive { color: olive; }
span.purple { color: purple; }
span.red { color: red; }
span.silver { color: silver; }
span.teal { color: teal; }
span.white { color: white; }
span.yellow { color: yellow; }

span.aqua-background { background: aqua; }
span.black-background { background: black; }
span.blue-background { background: blue; }
span.fuchsia-background { background: fuchsia; }
span.gray-background { background: gray; }
span.green-background { background: green; }
span.lime-background { background: lime; }
span.maroon-background { background: maroon; }
span.navy-background { background: navy; }
span.olive-background { background: olive; }
span.purple-background { background: purple; }
span.red-background { background: red; }
span.silver-background { background: silver; }
span.teal-background { background: teal; }
span.white-background { background: white; }
span.yellow-background { background: yellow; }

span.big { font-size: 2em; }
span.small { font-size: 0.6em; }

span.underline { text-decoration: underline; }
span.overline { text-decoration: overline; }
span.line-through { text-decoration: line-through; }

div.unbreakable { page-break-inside: avoid; }


/*
 * xhtml11 specific
 *
 * */

div.tableblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.tableblock > table {
  border: 3px solid #527bbd;
}
thead, p.table.header {
  font-weight: bold;
  color: #527bbd;
}
p.table {
  margin-top: 0;
}
/* Because the table frame attribute is overriden by CSS in most browsers. */
div.tableblock > table[frame="void"] {
  border-style: none;
}
div.tableblock > table[frame="hsides"] {
  border-left-style: none;
  border-right-style: none;
}
div.tableblock > table[frame="vsides"] {
  border-top-style: none;
  border-bottom-style: none;
}


/*
 * html5 specific
 *
 * */

table.tableblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
thead, p.tableblock.header {
  font-weight: bold;
  color: #527bbd;
}
p.tableblock {
  margin-top: 0;
}
table.tableblock {
  border-width: 3px;
  border-spacing: 0px;
  border-style: solid;
  border-color: #527bbd;
  border-collapse: collapse;
}
th.tableblock, td.tableblock {
  border-width: 1px;
  padding: 4px;
  border-style: solid;
  border-color: #527bbd;
}

table.tableblock.frame-topbot {
  border-left-style: hidden;
  border-right-style: hidden;
}
table.tableblock.frame-sides {
  border-top-style: hidden;
  border-bottom-style: hidden;
}
table.tableblock.frame-none {
  border-style: hidden;
}

th.tableblock.halign-left, td.tableblock.halign-left {
  text-align: left;
}
th.tableblock.halign-center, td.tableblock.halign-center {
  text-align: center;
}
th.tableblock.halign-right, td.tableblock.halign-right {
  text-align: right;
}

th.tableblock.valign-top, td.tableblock.valign-top {
  vertical-align: top;
}
th.tableblock.valign-middle, td.tableblock.valign-middle {
  vertical-align: middle;
}
th.tableblock.valign-bottom, td.tableblock.valign-bottom {
  vertical-align: bottom;
}


/*
 * manpage specific
 *
 * */

body.manpage h1 {
  padding-top: 0.5em;
  padding-bottom: 0.5em;
  border-top: 2px solid silver;
  border-bottom: 2px solid silver;
}
body.manpage h2 {
  border-style: none;
}
body.manpage div.sectionbody {
  margin-left: 3em;
}

@media print {
  body.manpage div#toc { display: none; }
}
.highlight .hll { background-color: #ffffcc }
.highlight  { background: #f8f8f8; }
.highlight .c { color: #408080; font-style: italic } /* Comment */
.highlight .err { border: 1px solid #FF0000 } /* Error */
.highlight .k { color: #008000; font-weight: bold } /* Keyword */
.highlight .o { color: #666666 } /* Operator */
.highlight .cm { color: #408080; font-style: italic } /* Comment.Multiline */
.highlight .cp { color: #BC7A00 } /* Comment.Preproc */
.highlight .c1 { color: #408080; font-style: italic } /* Comment.Single */
.highlight .cs { color: #408080; font-style: italic } /* Comment.Special */
.highlight .gd { color: #A00000 } /* Generic.Deleted */
.highlight .ge { font-style: italic } /* Generic.Emph */
.highlight .gr { color: #FF0000 } /* Generic.Error */
.highlight .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.highlight .gi { color: #00A000 } /* Generic.Inserted */
.highlight .go { color: #808080 } /* Generic.Output */
.highlight .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.highlight .gs { font-weight: bold } /* Generic.Strong */
.highlight .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.highlight .gt { color: #0040D0 } /* Generic.Traceback */
.highlight .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.highlight .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.highlight .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.highlight .kp { color: #008000 } /* Keyword.Pseudo */
.highlight .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.highlight .kt { color: #B00040 } /* Keyword.Type */
.highlight .m { color: #666666 } /* Literal.Number */
.highlight .s { color: #BA2121 } /* Literal.String */
.highlight .na { color: #7D9029 } /* Name.Attribute */
.highlight .nb { color: #008000 } /* Name.Builtin */
.highlight .nc { color: #0000FF; font-weight: bold } /* Name.Class */
.highlight .no { color: #880000 } /* Name.Constant */
.highlight .nd { color: #AA22FF } /* Name.Decorator */
.highlight .ni { color: #999999; font-weight: bold } /* Name.Entity */
.highlight .ne { color: #D2413A; font-weight: bold } /* Name.Exception */
.highlight .nf { color: #0000FF } /* Name.Function */
.highlight .nl { color: #A0A000 } /* Name.Label */
.highlight .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.highlight .nt { color: #008000; font-weight: bold } /* Name.Tag */
.highlight .nv { color: #19177C } /* Name.Variable */
.highlight .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.highlight .w { color: #bbbbbb } /* Text.Whitespace */
.highlight .mf { color: #666666 } /* Literal.Number.Float */
.highlight .mh { color: #666666 } /* Literal.Number.Hex */
.highlight .mi { color: #666666 } /* Literal.Number.Integer */
.highlight .mo { color: #666666 } /* Literal.Number.Oct */
.highlight .sb { color: #BA2121 } /* Literal.String.Backtick */
.highlight .sc { color: #BA2121 } /* Literal.String.Char */
.highlight .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.highlight .s2 { color: #BA2121 } /* Literal.String.Double */
.highlight .se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
.highlight .sh { color: #BA2121 } /* Literal.String.Heredoc */
.highlight .si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
.highlight .sx { color: #008000 } /* Literal.String.Other */
.highlight .sr { color: #BB6688 } /* Literal.String.Regex */
.highlight .s1 { color: #BA2121 } /* Literal.String.Single */
.highlight .ss { color: #19177C } /* Literal.String.Symbol */
.highlight .bp { color: #008000 } /* Name.Builtin.Pseudo */
.highlight .vc { color: #19177C } /* Name.Variable.Class */
.highlight .vg { color: #19177C } /* Name.Variable.Global */
.highlight .vi { color: #19177C } /* Name.Variable.Instance */
.highlight .il { color: #666666 } /* Literal.Number.Integer.Long */


</style>
<script type="text/javascript">
/*<![CDATA[*/
var asciidoc = {  // Namespace.

/////////////////////////////////////////////////////////////////////
// Table Of Contents generator
/////////////////////////////////////////////////////////////////////

/* Author: Mihai Bazon, September 2002
 * http://students.infoiasi.ro/~mishoo
 *
 * Table Of Content generator
 * Version: 0.4
 *
 * Feel free to use this script under the terms of the GNU General Public
 * License, as long as you do not remove or alter this notice.
 */

 /* modified by Troy D. Hanson, September 2006. License: GPL */
 /* modified by Stuart Rackham, 2006, 2009. License: GPL */

// toclevels = 1..4.
toc: function (toclevels) {

  function getText(el) {
    var text = "";
    for (var i = el.firstChild; i != null; i = i.nextSibling) {
      if (i.nodeType == 3 /* Node.TEXT_NODE */) // IE doesn't speak constants.
        text += i.data;
      else if (i.firstChild != null)
        text += getText(i);
    }
    return text;
  }

  function TocEntry(el, text, toclevel) {
    this.element = el;
    this.text = text;
    this.toclevel = toclevel;
  }

  function tocEntries(el, toclevels) {
    var result = new Array;
    var re = new RegExp('[hH]([1-'+(toclevels+1)+'])');
    // Function that scans the DOM tree for header elements (the DOM2
    // nodeIterator API would be a better technique but not supported by all
    // browsers).
    var iterate = function (el) {
      for (var i = el.firstChild; i != null; i = i.nextSibling) {
        if (i.nodeType == 1 /* Node.ELEMENT_NODE */) {
          var mo = re.exec(i.tagName);
          if (mo && (i.getAttribute("class") || i.getAttribute("className")) != "float") {
            result[result.length] = new TocEntry(i, getText(i), mo[1]-1);
          }
          iterate(i);
        }
      }
    }
    iterate(el);
    return result;
  }

  var toc = document.getElementById("toc");
  if (!toc) {
    return;
  }

  // Delete existing TOC entries in case we're reloading the TOC.
  var tocEntriesToRemove = [];
  var i;
  for (i = 0; i < toc.childNodes.length; i++) {
    var entry = toc.childNodes[i];
    if (entry.nodeName.toLowerCase() == 'div'
     && entry.getAttribute("class")
     && entry.getAttribute("class").match(/^toclevel/))
      tocEntriesToRemove.push(entry);
  }
  for (i = 0; i < tocEntriesToRemove.length; i++) {
    toc.removeChild(tocEntriesToRemove[i]);
  }

  // Rebuild TOC entries.
  var entries = tocEntries(document.getElementById("content"), toclevels);
  for (var i = 0; i < entries.length; ++i) {
    var entry = entries[i];
    if (entry.element.id == "")
      entry.element.id = "_toc_" + i;
    var a = document.createElement("a");
    a.href = "#" + entry.element.id;
    a.appendChild(document.createTextNode(entry.text));
    var div = document.createElement("div");
    div.appendChild(a);
    div.className = "toclevel" + entry.toclevel;
    toc.appendChild(div);
  }
  if (entries.length == 0)
    toc.parentNode.removeChild(toc);
},


/////////////////////////////////////////////////////////////////////
// Footnotes generator
/////////////////////////////////////////////////////////////////////

/* Based on footnote generation code from:
 * http://www.brandspankingnew.net/archive/2005/07/format_footnote.html
 */

footnotes: function () {
  // Delete existing footnote entries in case we're reloading the footnodes.
  var i;
  var noteholder = document.getElementById("footnotes");
  if (!noteholder) {
    return;
  }
  var entriesToRemove = [];
  for (i = 0; i < noteholder.childNodes.length; i++) {
    var entry = noteholder.childNodes[i];
    if (entry.nodeName.toLowerCase() == 'div' && entry.getAttribute("class") == "footnote")
      entriesToRemove.push(entry);
  }
  for (i = 0; i < entriesToRemove.length; i++) {
    noteholder.removeChild(entriesToRemove[i]);
  }

  // Rebuild footnote entries.
  var cont = document.getElementById("content");
  var spans = cont.getElementsByTagName("span");
  var refs = {};
  var n = 0;
  for (i=0; i<spans.length; i++) {
    if (spans[i].className == "footnote") {
      n++;
      var note = spans[i].getAttribute("data-note");
      if (!note) {
        // Use [\s\S] in place of . so multi-line matches work.
        // Because JavaScript has no s (dotall) regex flag.
        note = spans[i].innerHTML.match(/\s*\[([\s\S]*)]\s*/)[1];
        spans[i].innerHTML =
          "[<a id='_footnoteref_" + n + "' href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
        spans[i].setAttribute("data-note", note);
      }
      noteholder.innerHTML +=
        "<div class='footnote' id='_footnote_" + n + "'>" +
        "<a href='#_footnoteref_" + n + "' title='Return to text'>" +
        n + "</a>. " + note + "</div>";
      var id =spans[i].getAttribute("id");
      if (id != null) refs["#"+id] = n;
    }
  }
  if (n == 0)
    noteholder.parentNode.removeChild(noteholder);
  else {
    // Process footnoterefs.
    for (i=0; i<spans.length; i++) {
      if (spans[i].className == "footnoteref") {
        var href = spans[i].getElementsByTagName("a")[0].getAttribute("href");
        href = href.match(/#.*/)[0];  // Because IE return full URL.
        n = refs[href];
        spans[i].innerHTML =
          "[<a href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
      }
    }
  }
},

install: function(toclevels) {
  var timerId;

  function reinstall() {
    asciidoc.footnotes();
    if (toclevels) {
      asciidoc.toc(toclevels);
    }
  }

  function reinstallAndRemoveTimer() {
    clearInterval(timerId);
    reinstall();
  }

  timerId = setInterval(reinstall, 500);
  if (document.addEventListener)
    document.addEventListener("DOMContentLoaded", reinstallAndRemoveTimer, false);
  else
    window.onload = reinstallAndRemoveTimer;
}

}
asciidoc.install(2);
/*]]>*/
</script>
<meta name="author" content="Brian Clapper" />
<meta name="description" content="Scala Fundamentals Training" />
<meta name="keywords" content="scala,training,course,fundamentals,introduction">
</head>
<body class="book">
<div id="header">
<h1>Scala Bootcamp</h1>
<span id="author">Brian Clapper</span><br>
<span id="revnumber">version 1.1,</span>
<span id="revdate">December 2015</span>
<div id="toc">
  <div id="toctitle">Table of Contents</div>
  <noscript><p><b>JavaScript must be enabled in your browser to display the table of contents.</b></p></noscript>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="introduction">Introduction</h2>
<div class="sectionbody">
<div class="paragraph"><p>This introductory Scala course is the result of a collaboration between
NewCircle and Pearson Education, Inc. The course material is adapted from
Cay S. Horstmann&#8217;s introductory Scala book, <em>Scala for the Impatient</em>. As a
course participant, you will receive a copy of the book, and the close
correspondence between the course material and the book allows you to use
both the printed course material and the book as reference material during
and after the course.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="lesson-00-setup">Getting Started</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_lesson_objectives">Lesson Objectives</h3>
<div class="paragraph"><p>In this lesson, you&#8217;ll learn how to install Scala
and create a project.</p></div>
</div>
<div class="sect2">
<h3 id="_install_a_java_runtime">Install a Java runtime</h3>
<div class="paragraph"><p>You&#8217;ll need a Java runtime, 1.6 or better. See <a href="http://www.java.com/">http://www.java.com/</a></p></div>
</div>
<div class="sect2">
<h3 id="_download_and_install_scala">Download and Install Scala</h3>
<div class="paragraph"><p><strong>NOTE: If you use a Scala IDE (see below), you don&#8217;t need to install
Scala manually. The IDE will handle that for you.</strong></p></div>
<div class="paragraph"><p>Once you&#8217;ve installed Java, go to <a href="http://www.scala-lang.org/download/">http://www.scala-lang.org/download/</a> and
download Scala. You can download the distribution as a gzipped tar file, a
zip file, an Ubuntu/Debian <span class="monospaced">.deb</span> package, a Red Hat RPM, or a Windows MSI
installer.</p></div>
<div class="sect3">
<h4 id="_windows">Windows</h4>
<div class="paragraph"><p>The easiest way to install Scala is to download the zip file. That way,
you don&#8217;t have to worry about whether or not you have permission to install
the software under &#8216;C:\Program Files\&#8217;.</p></div>
<div class="paragraph"><p>Download the <span class="monospaced">scala-2.11.7.zip</span> file from
<a href="http://www.scala-lang.org/download/">http://www.scala-lang.org/download/</a> and unpack the zip file into a location
where you have permission to write files.</p></div>
<div class="paragraph"><p>Next, update your <span class="monospaced">PATH</span> variable. Pull up the Windows menu and right click on
<em>Computer</em>. Then, select <em>Properties</em>. On the resulting window, select
<em>Advanced system settings</em>, and click the <em>Environment Variables</em> button.
Update the <span class="monospaced">Path</span> setting to include the Scala bin directory.</p></div>
<div class="imageblock">
<div class="content">
<img src="images/00-install-windows-env-1.png" alt="00-install-windows-env-1.png">
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="images/00-install-windows-env-2.png" alt="00-install-windows-env-2.png">
</div>
</div>
<div class="sect4">
<h5 id="_test_your_installation">Test your installation</h5>
<div class="paragraph"><p>Test your installation by opening a command window and typing <span class="monospaced">scala -version</span>.
You should see something like the following:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>C:\Users\bmc&gt; scala -version
Scala code runner version 2.11.7 -- Copyright 2002-2015, LAMP/EPFL</pre>
</div></div>
</div>
</div>
<div class="sect3">
<h4 id="_mac_os_x_and_linux">Mac OS X and Linux</h4>
<div class="paragraph"><p>The easiest way to install Scala is to download the <span class="monospaced">tgz</span> file and unpack
it. That way, you don&#8217;t have to worry about whether or not you have
permission to install packages on your system.</p></div>
<div class="paragraph"><p>Download the <span class="monospaced">scala-2.11.7.tgz</span> file from
<a href="http://www.scala-lang.org/download/">http://www.scala-lang.org/download/</a> and unpack the file file into
<span class="monospaced">$HOME/scala</span>:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>$ cd # go to home directory
$ mkdir -p scala
$ cd scala
$ tar -xzf ~/Downloads/scala-2.11.7.tgz</pre>
</div></div>
<div class="paragraph"><p>Next, make sure the Scala <span class="monospaced">bin</span> directory is in your PATH. If you&#8217;re using
Bash, add the following command to your <span class="monospaced">$HOME/.bash_profile</span> file. If
you&#8217;re using Zsh, add the command to your <span class="monospaced">$HOME/.zshrc</span> file.</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>export PATH=$HOME/scala/scala-2.11.7/bin:$PATH</pre>
</div></div>
<div class="paragraph"><p>Then, in the existing command window, run the same command. That way, you
don&#8217;t have to bring up another command window.</p></div>
<div class="sect4">
<h5 id="_test_your_installation_2">Test your installation</h5>
<div class="paragraph"><p>Test your installation by opening a terminal window and typing
<span class="monospaced">scala -version</span>. You should see something like the following:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>$ scala -version
Scala code runner version 2.11.7 -- Copyright 2002-2013, LAMP/EPFL</pre>
</div></div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_download_and_install_typesafe_activator">Download and install Typesafe Activator</h3>
<div class="paragraph"><p>Typesafe Activator is a convenient tool for creating Scala projects. It also
serves as a front-end runner for the Scala Build Tool,
<a href="http://www.scala-sbt.org/">SBT</a>.</p></div>
<div class="paragraph"><p>If you&#8217;re using a Mac, and you have the
<a href="http://brew.sh/">Homebrew</a> package manager, you can install Typesafe
Activator with one command:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>brew install typesafe-activator</pre>
</div></div>
<div class="paragraph"><p>For other platforms, or for Macs without Homebrew, you can download Activator
here: <a href="https://www.typesafe.com/activator/download">https://www.typesafe.com/activator/download</a></p></div>
<div class="paragraph"><p>Follow the installation instructions, and make sure the <span class="monospaced">activator</span> binary is
in your path.</p></div>
</div>
<div class="sect2">
<h3 id="_a_note_on_ides_and_editors">A note on IDEs and Editors</h3>
<div class="paragraph"><p>While it&#8217;s entirely possible to use a regular editor with Scala, we
recommend that you use an IDE with explicit support for Scala. Install one
of the following:</p></div>
<div class="ulist"><ul>
<li>
<p>
The <a href="http://scala-ide.org/">Official Scala IDE</a>, based on Eclipse.
  <a href="http://scala-ide.org/">http://scala-ide.org/</a>
</p>
</li>
<li>
<p>
<a href="http://www.jetbrains.com/idea/">IntelliJ IDEA</a>, with the Scala plugin.
  <a href="http://www.jetbrains.com/idea/">http://www.jetbrains.com/idea/</a>
</p>
</li>
<li>
<p>
<a href="http://netbeans.org/">NetBeans</a>, with the Scala plugin.
  <a href="http://netbeans.org/">http://netbeans.org/</a>
</p>
</li>
</ul></div>
</div>
<div class="sect2">
<h3 id="_create_a_project_for_the_labs">Create a project for the labs</h3>
<div class="paragraph"><p>We&#8217;ll put all the labs inside a single project.</p></div>
<div class="paragraph"><p>We&#8217;re going to use Typesafe Activator to create our project. It&#8217;s the
simplest way to get going. However, it is entirely possible to create
a Scala project without using Activator.</p></div>
<div class="paragraph"><p>First, make sure you have an empty folder for this class, somewhere on your machine.
You&#8217;ll need a command window.</p></div>
<div class="ulist"><ul>
<li>
<p>
On Windows, bring up the Command Prompt (<span class="monospaced">CMD.EXE</span>)
</p>
</li>
<li>
<p>
On a Mac, bring up the Terminal application, which will launch a Unix shell.
</p>
</li>
<li>
<p>
On a Linux system, bring up a Terminal or <span class="monospaced">xterm</span> window, which will launch a Unix shell.
</p>
</li>
</ul></div>
<div class="paragraph"><p>Once you have a command prompt, type:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>$ <strong>activator new labs</strong></pre>
</div></div>
<div class="paragraph"><p>You&#8217;ll see a response similar to the following:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>Fetching the latest list of templates...

Browse the list of templates: http://typesafe.com/activator/templates
Choose from these featured templates or enter a template name:
  1) minimal-akka-java-seed
  2) minimal-akka-scala-seed
  3) minimal-java
  4) minimal-scala
  5) play-java
  6) play-scala
(hit tab to see a list of all templates)
&gt;</pre>
</div></div>
<div class="paragraph"><p>At the <span class="monospaced">&gt;</span> prompt, select <span class="monospaced">minimal-scala</span> (#4, above).</p></div>
<div class="paragraph"><p>Activator will then create an entire project tree.</p></div>
</div>
<div class="sect2">
<h3 id="_add_the_sources">Add the sources</h3>
<div class="paragraph"><p>Activator automatically created a <span class="monospaced">labs/src</span> tree, but we don&#8217;t need it. We&#8217;ll
be replacing it with the lab sources and testers for this class.</p></div>
<div class="ulist"><ul>
<li>
<p>
Remove the <span class="monospaced">labs/src</span> folder.
</p>
</li>
<li>
<p>
In the course&#8217;s Box.com site, go to <span class="monospaced">courseware</span>, then <span class="monospaced">labs</span>. You&#8217;ll see
  a <span class="monospaced">src</span> folder. Using the "[•••]" button on the right, download the folder
  as <span class="monospaced">src.zip</span>.
</p>
</li>
<li>
<p>
<em>Within</em> your <span class="monospaced">labs</span> folder, unpack the zip file. It&#8217;ll create a <em>new</em>
  <span class="monospaced">src</span> folder with the (stubbed out) labs.
</p>
</li>
</ul></div>
</div>
<div class="sect2">
<h3 id="_compile_the_code">Compile the code</h3>
<div class="paragraph"><p>The labs are all stubs. They compile, but the tests will all fail. Let&#8217;s verify
that you&#8217;re all set by compiling the code.</p></div>
<div class="paragraph"><p>In the same command window, within the <span class="monospaced">labs</span> directory, type:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>$ <strong>./activator</strong></pre>
</div></div>
<div class="paragraph"><p>(On Windows, you might need to type <span class="monospaced">activator.bat</span>, instead.)</p></div>
<div class="paragraph"><p>That command will bring up SBT. (If you previously installed SBT, and it&#8217;s in
your path, you can also simply type <span class="monospaced">sbt</span>. Use whichever is most convenient for you.)</p></div>
<div class="paragraph"><p>The first time SBT runs within a project, it&#8217;ll download a few things it needs. Then,
it&#8217;ll prompt you with a <span class="monospaced">&gt;</span>. At that prompt, type:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>> <strong>compile</strong></pre>
</div></div>
<div class="paragraph"><p>(Don&#8217;t type the "&gt;". That&#8217;s the SBT prompt.)</p></div>
<div class="sect3">
<h4 id="_prepare_your_project_for_your_ide">Prepare your project for your IDE</h4>
<div class="paragraph"><p>This courseware assumes you&#8217;re using either Eclipse (the Scala IDE) or
IntelliJ IDEA.</p></div>
</div>
</div>
<div class="sect2">
<h3 id="_eclipse">Eclipse</h3>
<div class="paragraph"><p>If you&#8217;re using Eclipse, add a special plugin SBT plugin that will allow
you to create an Eclipse project from within SBT. In your project
folder, create file <span class="monospaced">project/plugins.sbt</span>, with the following contents:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>addSbtPlugin("com.typesafe.sbteclipse" % "sbteclipse-plugin" % "4.0.0")</pre>
</div></div>
<div class="paragraph"><p>Then, bring up SBT. It&#8217;ll spew out a bunch of messages indicating that it&#8217;s
downloading the plugin and its dependencies. Then, at the SBT prompt, type:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>> <strong>eclipse</strong></pre>
</div></div>
<div class="paragraph"><p>(Don&#8217;t type the "&gt;". That&#8217;s the SBT prompt.)</p></div>
<div class="paragraph"><p>That command will download more stuff, and it&#8217;ll create all the necessary
Eclipse project files. Now, you can open your <span class="monospaced">labs</span> folder as an Eclipse
project.</p></div>
</div>
<div class="sect2">
<h3 id="_intellij_idea">IntelliJ IDEA</h3>
<div class="paragraph"><p>If you&#8217;re using a newer version of IntelliJ IDEA (version 14 or better),
you don&#8217;t need to do anything special IDEA&#8217;s Scala plugin automatically
handles SBT build files.</p></div>
<div class="ulist"><ul>
<li>
<p>
Import your project into IDEA with <em>New &gt; Project from Existing Sources</em>
</p>
</li>
<li>
<p>
Point the file browser at your <span class="monospaced">labs</span> directory
</p>
</li>
<li>
<p>
In the Import Project popup, select SBT as the project type, as shown
  in the image, below.
</p>
</li>
</ul></div>
<div class="imageblock">
<div class="content">
<img src="images/00-idea-import-1.png" alt="00-idea-import-1.png">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_testing">Testing</h3>
<div class="paragraph"><p>In this class, we will be using the ScalaTest testing framework. However,
there are several testing frameworks for Scala. The most popular are:</p></div>
<div class="ulist"><ul>
<li>
<p>
Specs2 <a href="https://etorreborre.github.io/specs2/">https://etorreborre.github.io/specs2/</a>
</p>
</li>
<li>
<p>
ScalaTest <a href="http://scalatest.org/">http://scalatest.org/</a>
</p>
</li>
<li>
<p>
ScalaCheck <a href="http://www.scalacheck.org/">http://www.scalacheck.org/</a>
</p>
</li>
</ul></div>
<div class="paragraph"><p>To prepare to use ScalaTest, add the following to your <span class="monospaced">labs</span> project&#8217;s
<span class="monospaced">build.sbt</span> file.</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>libraryDependencies += "org.scalatest" % "scalatest_2.11" % "2.2.4" % "test"</pre>
</div></div>
<div class="sect3">
<h4 id="_how_to_run_tests">How to run tests</h4>
<div class="paragraph"><p>We&#8217;ll be running tests, as part of doing the labs. Within SBT, you can run
all tests with one simple command:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>> <strong>test</strong></pre>
</div></div>
<div class="paragraph"><p>You can also run just one test specification, as follows:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>> <strong>test-only com.newcircle.tests.csf.ForLoopSpec</strong></pre>
</div></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="lesson-01-basics">The Basics</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_lesson_objectives_2">Lesson Objectives</h3>
<div class="paragraph"><p>In this lesson, you will learn how to use Scala as an industrial-strength
pocket calculator, working interactively with numbers and arithmetic
operations. We introduce a number of important Scala concepts and idioms
along the way. You will also learn how to browse the Scaladoc documentation
at a beginner’s level.</p></div>
<div class="paragraph"><p>Highlights:</p></div>
<div class="ulist"><ul>
<li>
<p>
Using the Scala interpreter
</p>
</li>
<li>
<p>
Defining variables with <span class="monospaced">var</span> and <span class="monospaced">val</span>
</p>
</li>
<li>
<p>
Numeric types
</p>
</li>
<li>
<p>
Using operators and functions
</p>
</li>
<li>
<p>
Navigating Scaladoc
</p>
</li>
</ul></div>
</div>
<div class="sect2">
<h3 id="_the_scala_interpreter">The Scala Interpreter</h3>
<div class="paragraph"><p>If you run the <span class="monospaced">scala</span> command without any arguments, it runs Scala in
interactive mode, allowing you to type Scala expressions and have them
evaluated right away. Interactive interpreters are often called REPLs, an
acronym for "read, eval, print, loop (back for more)".</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">If you don&#8217;t like running the REPL at the command line, both IntelliJ IDEA
and the Eclipse Scala IDE support running the REPL within the IDEA. See
<a href="http://horstmann.com/scala/install/">http://horstmann.com/scala/install/</a> for details.</td>
</tr></table>
</div>
<div class="paragraph"><p>To bring up the REPL, type <span class="monospaced">scala</span> at the command line:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>$ scala
Welcome to Scala version 2.11.7 (Java HotSpot(TM) 64-Bit Server VM, Java 1.7.0).
Type in expressions to have them evaluated.
Type :help for more information.

scala&gt;</pre>
</div></div>
<div class="paragraph"><p>At the `scala&gt; ` prompt, you can enter Scala expressions that will be evaluated
immediately.</p></div>
<div class="sect3">
<h4 id="_lab_type_along">Lab (type-along)</h4>
<div class="paragraph"><p>Fire up the Scala REPL and enter the bold lines. For example, if you type
<span class="monospaced">8 * 5 * 2</span>, you get <span class="monospaced">42</span>, as seen below:</p></div>
<div class="paragraph"><p><strong>Expressions</strong></p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>scala> <strong>8 * 5 + 2</strong>
res0: Int = 42</pre>
</div></div>
<div class="paragraph"><p>The answer is stored in variable <span class="monospaced">res0</span>. You can use that name in subsequent
computations:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>scala> <strong>0.5 * res0</strong>
res1: Double = 21.0
scala> <strong>"Hello, " + res0</strong>
res2: String = Hello, 42</pre>
</div></div>
<div class="paragraph"><p>Note that the interpreter also displays the type of the result—in our examples,
<span class="monospaced">Int</span>, <span class="monospaced">Double</span>, and <span class="monospaced">String</span>.</p></div>
<div class="paragraph"><p><strong>Methods</strong></p></div>
<div class="paragraph"><p>You can call methods (functions). If you&#8217;re using the REPL from the
command-line, you may be able to use <em>tab completion</em> for method names.
For instance, try typing <span class="monospaced">res2.to</span>, then hit the Tab key. If the interpreter
offers choices such as:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>toCharArray   toLowerCase   toString   toUpperCase</pre>
</div></div>
<div class="paragraph"><p>then tab completion works in your environment. Type a <span class="monospaced">U</span> and hit the
Tab key again. You should now get a single completion:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>res2.toUpperCase</pre>
</div></div>
<div class="paragraph"><p>Hit the enter key, and the answer is displayed.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">If you can&#8217;t use tab completion in your environment, you&#8217;ll have to
type the entire method name yourself.</td>
</tr></table>
</div>
<div class="paragraph"><p>Also, try hitting the ↑ and ↓ arrow keys. In most implementations, cycle
through the REPL&#8217;s <em>command history</em>, and you can stop and edit any previous
command inline. Use the ←, →, and Del keys to change the last command to</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>res2.to<strong>Low</strong>erCase</pre>
</div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">If you&#8217;re an Emacs user, you&#8217;ll be pleased to know that the REPL supports
Emacs-style Ctrl-P, Ctrl-N, Ctrl-B, Ctrl-F, Ctrl-A and Ctrl-E keystrokes. If
you&#8217;re not an Emacs user, or if you don&#8217;t know what those are, don&#8217;t sweat it.</td>
</tr></table>
</div>
<div class="paragraph"><p>As you can see, the Scala REPL reads an expression, evaluations it, prints it,
and then prompts you for another expression.</p></div>
<div class="paragraph"><p>Technically speaking, the <span class="monospaced">scala</span> program is <em>not</em> an interpreter. Instead,
whenever you type an expression, <span class="monospaced">scala</span> quickly compiles it into bytecode
and executes the bytecode with the Java virtual machine.</p></div>
<div class="paragraph"><p>To exit the REPL, type <span class="monospaced">Ctrl-D</span> (on Unix or Mac systems) or <span class="monospaced">Ctrl-Z ENTER</span>
(on Windows systems). Or, simply type <span class="monospaced">:quit</span>.</p></div>
<div class="sidebarblock">
<div class="content">
<div class="title">The REPL is your friend</div>
<div class="paragraph"><p>Instant feedback encourages experimenting, and you will feel good whenever
something works.</p></div>
<div class="paragraph"><p>It is a good idea to keep an editor window open at the same time, so you
can copy and paste successful code snippets for later use. Also, as you try
more complex examples, you may want to compose them in the editor and then
paste them into the REPL. The REPL&#8217;s <span class="monospaced">:paste</span> command is useful for that.</p></div>
</div></div>
<div class="paragraph"><p>Aside from allowing any Scala expression, the REPL has numerous useful
commands, all prefixed with ":". Some examples:</p></div>
<table class="tableblock frame-all grid-all"
style="
width:90%;
">
<col style="width:16%;">
<col style="width:83%;">
<thead>
<tr>
<th class="tableblock halign-left valign-top" > Command              </th>
<th class="tableblock halign-left valign-top" > Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">:cp &lt;path&gt;</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">add a jar or directory to the class path</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">:help</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">print a list of all available special commands</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">:history [num]</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">show the history</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">:implicits [-v]</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">show the implicits in scope</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">:kind [-v] &lt;expr&gt;</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">display the kind of expression&#8217;s type</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">:load &lt;path&gt;</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">interpret the lines in the specified file</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">:paste [-raw] [path]</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">enter paste mode or paste a file</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">:quit</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">exit the REPL</p></td>
</tr>
</tbody>
</table>
<div class="paragraph"><p>Type <span class="monospaced">:help</span> in the REPL to see the complete list.</p></div>
</div>
</div>
<div class="sect2">
<h3 id="_declaring_values_and_variables">Declaring Values and Variables</h3>
<div class="paragraph"><p>Instead of using the names <span class="monospaced">res0</span>, <span class="monospaced">res1</span>, and so on, you can define your
own names:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>scala> <strong>val answer = 8 * 5 + 2</strong>
answer: Int = 42</pre>
</div></div>
<div class="paragraph"><p>You can use these names in subsequent expressions:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>scala> <strong>0.5 * answer</strong>
res3: Double = 21.0</pre>
</div></div>
<div class="paragraph"><p>A value declared with <span class="monospaced">val</span> is actually a constant—you can’t change its
contents:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>scala> <strong>answer = 0</strong>
error: reassignment to val</pre>
</div></div>
<div class="paragraph"><p>To declare a variable whose contents can vary, use a <span class="monospaced">var</span>:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">var</span> <span class="n">counter</span> <span class="k">=</span> <span class="mi">0</span>
<span class="n">counter</span> <span class="k">=</span> <span class="mi">1</span> <span class="c1">// OK, can change a var</span>
</pre></div></div></div>
<div class="paragraph"><p>In Scala, you are encouraged to use a <span class="monospaced">val</span> unless you really need to
change the contents. Perhaps surprisingly for Java or C++ programmers, most
programs don’t need many <span class="monospaced">var</span> variables.</p></div>
<div class="paragraph"><p>Note that you need not specify the type of a value or variable. It is
<em>inferred</em> from the type of the expression with which you initialize it.
(It is an error to declare a value or variable without initializing it.)</p></div>
<div class="paragraph"><p>However, you <em>can</em> specify the type, if necessary or preferred. For example,</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">val</span> <span class="n">greeting</span><span class="k">:</span> <span class="kt">String</span> <span class="o">=</span> <span class="kc">null</span>
<span class="k">val</span> <span class="n">greeting</span><span class="k">:</span> <span class="kt">Any</span> <span class="o">=</span> <span class="s">&quot;Hello&quot;</span>
</pre></div></div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph"><p>In Scala, the type of a variable or function is always written <em>after</em> the
name of the variable or function. This makes it easier to read declarations
with complex types.</p></div>
<div class="paragraph"><p>As you move back and forth between Scala and Java, you may find that your
fingers write Java declarations such as <span class="monospaced">String greeting</span> on autopilot, so
you have to rewrite them as <span class="monospaced">greeting: String</span>. While this is a bit
annoying, many Scala programmers prefer Scala&#8217;s syntax. When working on
complex Scala programs, many Scala programmers appreicate not having to
decrypt C-style type declarations.</p></div>
</td>
</tr></table>
</div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">You may have noticed that there were no semicolons after variable
declarations or assignments. In Scala, semicolons are only required if you
have multiple statements on the same line.</td>
</tr></table>
</div>
<div class="paragraph"><p>You can declare multiple values or variables together:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">val</span> <span class="n">xmax</span><span class="o">,</span> <span class="n">ymax</span> <span class="k">=</span> <span class="mi">100</span> <span class="c1">// Sets xmax and ymax to 100</span>
<span class="k">var</span> <span class="n">greeting</span><span class="o">,</span> <span class="n">message</span><span class="k">:</span> <span class="kt">String</span> <span class="o">=</span> <span class="kc">null</span>
  <span class="c1">// greeting and message are both strings, initialized with null</span>
</pre></div></div></div>
</div>
<div class="sect2">
<h3 id="_lab_span_class_monospaced_res_span_variables">Lab: <span class="monospaced">res</span> variables</h3>
<div class="paragraph"><p>Using the REPL, determine whether the <span class="monospaced">res</span> variables are <span class="monospaced">val</span> or <span class="monospaced">var</span>.</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="lesson-01a-common-types">Commonly Used Types</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_numerics">Numerics</h3>
<div class="paragraph"><p>You have already seen some of the data types of the Scala language, such as
<span class="monospaced">Int</span> and <span class="monospaced">Double</span>. Like Java, Scala has seven numeric types:</p></div>
<div class="ulist"><ul>
<li>
<p>
<span class="monospaced">Byte</span>
</p>
</li>
<li>
<p>
<span class="monospaced">Char</span>
</p>
</li>
<li>
<p>
<span class="monospaced">Short</span>
</p>
</li>
<li>
<p>
<span class="monospaced">Int</span>
</p>
</li>
<li>
<p>
<span class="monospaced">Long</span>
</p>
</li>
<li>
<p>
<span class="monospaced">Float</span>
</p>
</li>
<li>
<p>
<span class="monospaced">Double</span>
</p>
</li>
<li>
<p>
<span class="monospaced">Boolean</span>
</p>
</li>
</ul></div>
<div class="paragraph"><p>However, unlike Java, these types are <em>classes</em>. Also unlike Java, There is
no distinction between primitive types and class types in Scala. You can
invoke methods on numbers, for example:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>scala> 1.toString()
res0: String = 1</pre>
</div></div>
<div class="paragraph"><p>or, even more interestingly:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="n">scala</span><span class="o">&gt;</span> <span class="mf">1.</span><span class="n">to</span><span class="o">(</span><span class="mi">10</span><span class="o">)</span>
<span class="n">res1</span><span class="k">:</span> <span class="kt">scala.collection.immutable.Range.Inclusive</span> <span class="o">=</span> <span class="nc">Range</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="mi">5</span><span class="o">,</span> <span class="mi">6</span><span class="o">,</span> <span class="mi">7</span><span class="o">,</span> <span class="mi">8</span><span class="o">,</span> <span class="mi">9</span><span class="o">,</span> <span class="mi">10</span><span class="o">)</span>
</pre></div></div></div>
<div class="paragraph"><p>(We&#8217;ll discuss the <span class="monospaced">Range</span> class later. For now, just treat it as a
collection of numbers.)</p></div>
<div class="sect3">
<h4 id="_no_boxing">No boxing</h4>
<div class="paragraph"><p>In Scala, there is no need for wrapper types (or, to use Java&#8217;s
terminology, "boxing"). The Scala compiler generates the appropriate
bytecode to ensure that primitive types like <span class="monospaced">int</span> are converted to their
boxed equivalents (<span class="monospaced">Integer</span>).</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">If you make an array of <span class="monospaced">Int</span> objects in Scala, you&#8217;ll get a <span class="monospaced">int[]</span>
array in the virtual machine.</td>
</tr></table>
</div>
</div>
<div class="sect3">
<h4 id="_rich_numbers">Rich Numbers</h4>
<div class="paragraph"><p><span class="monospaced">StringOps</span> <em>enriches</em> <span class="monospaced">java.lang.String</span> with extra capabilities.
Similarly, there are <span class="monospaced">RichInt</span>, <span class="monospaced">RichDouble</span>, <span class="monospaced">RichChar</span>, and other,
similar, classes that enrich their corresponding basic classes (<span class="monospaced">Int</span>,
<span class="monospaced">Double</span>, etc). The <span class="monospaced">to</span> method we discussed previously is actually a method
of the <span class="monospaced">RichInt</span> class. In the expression</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="mf">1.</span><span class="n">to</span><span class="o">(</span><span class="mi">10</span><span class="o">)</span>
</pre></div></div></div>
<div class="paragraph"><p>the <span class="monospaced">Int</span> value "1" is first converted to a <span class="monospaced">RichInt</span>, and the <span class="monospaced">to</span> method is
applied to the resulting object.</p></div>
</div>
<div class="sect3">
<h4 id="_other_numeric_types">Other Numeric Types</h4>
<div class="paragraph"><p>Finally, there are classes <span class="monospaced">BigInt</span> and <span class="monospaced">BigDecimal</span> for computations with
an arbitrary (but finite) number of digits. These are backed by the
<span class="monospaced">java.math.BigInteger</span> and <span class="monospaced">java.math.BigDecimal</span> classes, but, as you will
see in the next section, they are much more convenient because you can use
them with the usual mathematical operators.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph"><p>In Scala, you use methods, not casts, to convert between numeric types. For
example, <span class="monospaced">99.44.toInt</span> is <span class="monospaced">99</span>, and <span class="monospaced">99.toChar</span> is <em>c</em>. Of course, as in
Java, the <span class="monospaced">toString</span> method converts any object to a string.</p></div>
<div class="paragraph"><p>To convert a string containing a number into the number, use <span class="monospaced">toInt</span> or
<span class="monospaced">toDouble</span>. For example, <span class="monospaced">"99.44".toDouble</span> is <span class="monospaced">99.44</span>.</p></div>
</td>
</tr></table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_characters">Characters</h3>
<div class="paragraph"><p>Scala uses single quotes to indicate character literals, just as Java does.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">val</span> <span class="n">c</span> <span class="k">=</span> <span class="-Symbol">&#39;a</span><span class="err">&#39;</span>
</pre></div></div></div>
</div>
<div class="sect2">
<h3 id="_normal_strings">Normal Strings</h3>
<div class="paragraph"><p>As we saw previously, Scala relies on the underlying <span class="monospaced">java.lang.String</span>
class for strings. However, it augments that class with well over 100
operations from the <span class="monospaced">StringOps</span> class.</p></div>
<div class="paragraph"><p>For example, the <span class="monospaced">intersect</span> method yields the characters that are
common to two strings:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>scala> <strong>"Hello".intersect("World")</strong>
res0: String = lo</pre>
</div></div>
<div class="paragraph"><p>In that expression, the <span class="monospaced">java.lang.String</span> object "Hello" is implicitly
converted to a <span class="monospaced">StringOps</span> object, and then the <span class="monospaced">intersect</span> method of the
<span class="monospaced">StringOps</span> class is applied. The result is then implicitly converted
<em>back</em> to a <span class="monospaced">String</span>.</p></div>
<div class="paragraph"><p>Thus, Scala strings have all the methods in the Java <span class="monospaced">String</span> class <em>plus</em>
all the methods in the Scala <span class="monospaced">StringOps</span> class.</p></div>
</div>
<div class="sect2">
<h3 id="_raw_strings">Raw Strings</h3>
<div class="paragraph"><p>Scala has a "raw" string syntax. In a normal strings, Scala expands
metacharacters, such as <span class="monospaced">\n</span> (for newline) and <span class="monospaced">\t</span> (for tab). With raw strings,
however, every character is treated literally.</p></div>
<div class="paragraph"><p>Raw strings are delimited with triple quotes. For instance:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>scala> <strong>println("a\nb")</strong>
a
b

scala> <strong>println("""a\nb""")</strong>
a\nb</pre>
</div></div>
<div class="paragraph"><p>A raw string may contain any characters whatsoever, including newlines,
quotation marks, and special characters (except, of course, three quotes in a
row.) For example:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>scala> <strong>println("""SQL Command Shell, version 0.1-alpha.
                  Type "HELP" for help.""")</strong>
SQL Command Shell, version 0.1-alpha.
                  Type "HELP" for help.</pre>
</div></div>
<div class="paragraph"><p>That doesn&#8217;t quite look right, though.</p></div>
<div class="paragraph"><p>The problem is that the leading spaces before the second line are included
in the string.</p></div>
<div class="paragraph"><p>This situation is so common that Scala provides a special <span class="monospaced">stripMargin</span>
function on <span class="monospaced">String</span>. To use it, put a pipe symbol (|) before each line and
use <span class="monospaced">stripMargin</span> on the whole string:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>scala> <strong>println("""|SQL Command Shell, version 0.1-alpha.
                  |Type "HELP" for help.""".stripMargin)</strong>
SQL Command Shell, version 0.1-alpha.
Type "HELP" for help.</pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_string_interpolation">String Interpolation</h3>
<div class="paragraph"><p>String interpolation, available starting in Scala 2.10.0, allows you to
embed variable references directly in processed string literals. Here’s an
example:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">val</span> <span class="n">name</span> <span class="k">=</span> <span class="s">&quot;James&quot;</span>
<span class="n">println</span><span class="o">(</span><span class="s">s&quot;Hello, </span><span class="si">$name</span><span class="s">&quot;</span><span class="o">)</span>
</pre></div></div></div>
<div class="paragraph"><p>In the above, the literal <span class="monospaced">s"Hello, $name"</span> is a <em>processed</em> string literal.
This means that the compiler does some additional work on this literal. A
processed string literal is denoted by a one or more characters preceding the
leading quotation mark (").</p></div>
<div class="paragraph"><p>Scala provides three string interpolation forms out of the box. You can add
your own, but that&#8217;s beyond the scope of this class. If you&#8217;re interested,
see
<a href="http://docs.scala-lang.org/overviews/core/string-interpolation.html#advanced-usage">http://docs.scala-lang.org/overviews/core/string-interpolation.html#advanced-usage</a>.</p></div>
<div class="sect3">
<h4 id="_the_span_class_monospaced_s_span_interpolator">The <span class="monospaced">s</span> interpolator</h4>
<div class="paragraph"><p>Prefixing a string literal with <span class="monospaced">s</span> allows the use of Scala variables and
expressions within a string. You precede the expression to be interpolated
with a <span class="monospaced">$</span>. If the expression is a simple variable name, that&#8217;s all you need
to do. If it&#8217;s something more complicated, you need to surround it with <span class="monospaced">{}</span>
characters. For example:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>scala&gt; val name = "James"
name: String = James

scala&gt; println(s"Hello, $name")
Hello, James

scala&gt; println(s"1 + 1 = ${1 + 1}")
1 + 1 = 2</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="_the_span_class_monospaced_raw_span_interpolator">The <span class="monospaced">raw</span> interpolator</h4>
<div class="paragraph"><p>The <span class="monospaced">raw</span> interpolator is similar to the <span class="monospaced">s</span> interpolator except that it
performs no escaping of literals within the string:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>scala&gt; s"a\nb"
res0: String =
a
b


scala&gt; raw"a\nb"
res1: String = a\nb</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="_the_span_class_monospaced_f_span_interpolator">The <span class="monospaced">f</span> interpolator</h4>
<div class="paragraph"><p>Prefixing a string literal with <span class="monospaced">f</span> allows the creation of simple formatted
strings, similar to <span class="monospaced">printf</span> in other languages. When using the <span class="monospaced">f</span>
interpolator, all variable references should be followed by a printf-style
format string, like <span class="monospaced">%d</span>. Let’s look at an example:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">val</span> <span class="n">height</span> <span class="k">=</span> <span class="mf">1.9d</span>
<span class="k">val</span> <span class="n">name</span> <span class="k">=</span> <span class="s">&quot;James&quot;</span>
<span class="n">println</span><span class="o">(</span><span class="s">f&quot;</span><span class="si">$name</span><span class="s">%s is </span><span class="si">$height</span><span class="s">%2.2f meters tall&quot;</span><span class="o">)</span> <span class="c1">// James is 1.90 meters tall</span>
</pre></div></div></div>
<div class="paragraph"><p>Arguably, that&#8217;s more difficult to read than a <span class="monospaced">printf</span> call:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="n">printf</span><span class="o">(</span><span class="s">&quot;%s is %2.2f meters tall\n&quot;</span><span class="o">,</span> <span class="n">name</span><span class="o">,</span> <span class="n">height</span><span class="o">)</span> <span class="c1">// James is 1.90 meters tall</span>
</pre></div></div></div>
<div class="paragraph"><p>So why would you ever use <span class="monospaced">f</span> interpolation rather than <span class="monospaced">printf</span>? The
primary reason is <em>type safety</em>. If you try to pass a format string that
only works for integers but pass a double, the compiler will issue an
error:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>scala&gt; val height = 1.9d
height: Double = 1.9

scala&gt; f"$height%4d"
console:9: error: type mismatch;
 found   : Double
 required: Int
              f"$height%4d"
                 ^</pre>
</div></div>
</div>
</div>
<div class="sect2">
<h3 id="_arithmetic_and_operator_overloading">Arithmetic and Operator Overloading</h3>
<div class="paragraph"><p>Arithmetic operators in Scala work just as you would expect in Java or C++:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">val</span> <span class="n">answer</span> <span class="k">=</span> <span class="mi">8</span> <span class="o">*</span> <span class="mi">5</span> <span class="o">+</span> <span class="mi">2</span>
</pre></div></div></div>
<div class="paragraph"><p>The <span class="monospaced">+</span>, <span class="monospaced">-</span>, <span class="monospaced">*</span>, <span class="monospaced">/</span>, and <span class="monospaced">%</span> operators do their usual job, as do the bit
operators <span class="monospaced">&amp;</span>, <span class="monospaced">|</span>, <span class="monospaced">^</span>, <span class="monospaced">&gt;&gt;</span>, and <span class="monospaced">&lt;&lt;</span>. There is just one surprising
aspect: These operators are actually <em>methods</em>.</p></div>
<div class="paragraph"><p>For example,</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="n">a</span> <span class="o">+</span> <span class="n">b</span>
</pre></div></div></div>
<div class="paragraph"><p>is a shorthand for</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="n">a</span><span class="o">.+(</span><span class="n">b</span><span class="o">)</span>
</pre></div></div></div>
<div class="paragraph"><p>Here, <span class="monospaced">+</span> is the name of the method. Scala has no silly prejudice against
non-alphanumeric characters in method names. You can define methods with
just about any symbols for names.</p></div>
<div class="paragraph"><p>For example, the <span class="monospaced">BigInt</span> class defines a method called <span class="monospaced">/%</span> that returns a
pair containing the quotient and remainder of a division.</p></div>
<div class="paragraph"><p>In general, you can write</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>a <em>method</em> b</pre>
</div></div>
<div class="paragraph"><p>as a shorthand for</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>a.<em>method</em>(b)</pre>
</div></div>
<div class="paragraph"><p>where <em>method</em> is a method with two parameters (one implicit, one
explicit).</p></div>
<div class="paragraph"><p>For example, instead of</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="mf">1.</span><span class="n">to</span><span class="o">(</span><span class="mi">10</span><span class="o">)</span>
</pre></div></div></div>
<div class="paragraph"><p>you can write</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="mi">1</span> <span class="n">to</span> <span class="mi">10</span>
</pre></div></div></div>
<div class="paragraph"><p>Use whatever you think is easier to read. Beginning Scala programmers tend
to stick to the Java syntax, and that is just fine.</p></div>
<div class="paragraph"><p>There is one notable difference between Scala and Java or C++. Scala does
not have <span class="monospaced">++</span> or <span class="monospaced">--</span> operators. Instead, simply use <span class="monospaced">+= 1</span> or <span class="monospaced">-= 1</span>:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span> <span class="c1">// ...because Scala has no ++</span>
</pre></div></div></div>
<div class="paragraph"><p>You can use the usual mathematical operators with <span class="monospaced">BigInt</span> and <span class="monospaced">BigDecimal</span>
objects:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>scala> <strong>val x: BigInt = 1234567890</strong>
x: BigInt = 1234567890

scala> <strong>x * x * x</strong>
res0: scala.math.BigInt = 1881676371789154860897069000</pre>
</div></div>
<div class="paragraph"><p>That’s much better than Java, where you would have had to call
<span class="monospaced">x.multiply(x).multiply(x)</span>.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph"><p>In Java, you cannot overload operators, and the Java designers claimed this
is a good thing because it stops you from inventing crazy operators like
<span class="monospaced">!@$&amp;*</span> that would make your program impossible to read. Of course, that’s
silly: You can make your programs just as hard to read by using crazy
method names like <span class="monospaced">qxywz</span>. Scala allows you to define operators, leaving it
up to you to use this feature with restraint and good taste.</p></div>
</td>
</tr></table>
</div>
</div>
<div class="sect2">
<h3 id="_calling_functions_and_methods">Calling Functions and Methods</h3>
<div class="paragraph"><p>Scala has functions, in addition to methods. It is simpler to use
mathematical functions such as <span class="monospaced">min</span> or <span class="monospaced">pow</span> in Scala than in Java,
because you need not call static methods from a class.</p></div>
<div class="paragraph"><p>Try typing the following in the REPL:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>scala&gt; import scala.math._
import scala.math._

scala&gt; sqrt(2)
res0: Double = 1.4142135623730951

scala&gt; pow(2, 4)
res1: Double = 16.0

scala&gt; min(3, Pi)
res2: Double = 3.0</pre>
</div></div>
<div class="paragraph"><p>These functions are defined in the <span class="monospaced">scala.math</span> package, which explains the
<span class="monospaced">import</span>. (In Scala, the underscore ("_") character is a wildcard, like
"*" in Java.)</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph"><p>To use a package that starts with scala., you can omit the <span class="monospaced">scala</span> prefix.
For example, the following two imports are equivalent:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">import</span> <span class="nn">scala.math._</span>
<span class="k">import</span> <span class="nn">math._</span>
</pre></div></div></div>
<div class="paragraph"><p>Similarly, the following two expressions are equivalent:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="n">scala</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="o">(</span><span class="mi">2</span><span class="o">)</span>
<span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="o">(</span><span class="mi">2</span><span class="o">)</span>
</pre></div></div></div>
</td>
</tr></table>
</div>
<div class="paragraph"><p>We will discussion the <span class="monospaced">import</span> statement later.</p></div>
</div>
<div class="sect2">
<h3 id="_companion_objects">Companion Objects</h3>
<div class="paragraph"><p>Scala doesn’t have static methods, but it has a similar feature, called
<em>singleton objects</em>, which we will discuss in detail later.</p></div>
<div class="paragraph"><p>Often, a class has a <em>companion object</em> whose methods act just like static
methods do in Java. For example, the <span class="monospaced">BigInt</span> companion object to the
<span class="monospaced">BigInt</span> class has a method <span class="monospaced">probablePrime</span> that generates a random prime
number with a given number of bits:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="nc">BigInt</span><span class="o">.</span><span class="n">probablePrime</span><span class="o">(</span><span class="mi">100</span><span class="o">,</span> <span class="n">scala</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="nc">Random</span><span class="o">)</span>
</pre></div></div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">Try this in the REPL.</td>
</tr></table>
</div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph"><p>Here, <span class="monospaced">Random</span> is a singleton random number generator object, defined in
the <span class="monospaced">scala.util</span> package. This is one of the few situations where a
singleton object is better than a class. In Java, it is a common error to
construct a new <span class="monospaced">java.util.Random</span> object for each random number.</p></div>
</td>
</tr></table>
</div>
<div class="paragraph"><p>Scala methods without parameters often don&#8217;t use parentheses. For example,
<span class="monospaced">toString</span> is often called without parentheses. Similarly, the <span class="monospaced">StringOps</span>
class has a <span class="monospaced">distinct</span> method, defined without <span class="monospaced">()</span>, to get the distinct
letters in a string:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>scala> <strong>"Hello, world".distinct</strong>
res0: String = Helo, wrd</pre>
</div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">The rule of thumb is that a parameterless method that doesn’t modify
the object has no parentheses.</td>
</tr></table>
</div>
</div>
<div class="sect2">
<h3 id="_the_span_class_monospaced_apply_span_method">The <span class="monospaced">apply</span> Method</h3>
<div class="paragraph"><p>In Scala, it is common to use a syntax that looks like a function call. For
example, if <span class="monospaced">s</span> is a string, then <span class="monospaced">s(i)</span> is the <em>i</em><sup>th</sup> character of the
string. (In C++, you would write <span class="monospaced">s[i]</span>; in Java, <span class="monospaced">s.charAt(i)</span>.) Try it
out in the REPL:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>scala> <strong>"Hello"(4)</strong>
res1: Char = o</pre>
</div></div>
<div class="paragraph"><p>You can think of this as an overloaded form of the <span class="monospaced">()</span> operator. It is
implemented as a method with the name <span class="monospaced">apply</span>. For example, in the
documentation of the <span class="monospaced">StringOps</span> class, you will find a method</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">def</span> <span class="n">apply</span><span class="o">(</span><span class="n">n</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span><span class="k">:</span> <span class="kt">Char</span>
</pre></div></div></div>
<div class="paragraph"><p><span class="monospaced">"Hello"(4)</span> is actually shorthand for:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="s">&quot;Hello&quot;</span><span class="o">.</span><span class="n">apply</span><span class="o">(</span><span class="mi">4</span><span class="o">)</span>
</pre></div></div></div>
<div class="paragraph"><p>When you look at the documentation for the <span class="monospaced">BigInt</span> companion object, you
will see apply methods that let you convert strings or numbers to <span class="monospaced">BigInt</span>
objects. For example, the call:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="nc">BigInt</span><span class="o">(</span><span class="s">&quot;1234567890&quot;</span><span class="o">)</span>
</pre></div></div></div>
<div class="paragraph"><p>is a shortcut for</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="nc">BigInt</span><span class="o">.</span><span class="n">apply</span><span class="o">(</span><span class="s">&quot;1234567890&quot;</span><span class="o">)</span>
</pre></div></div></div>
<div class="paragraph"><p>It yields a new <span class="monospaced">BigInt</span> object, <em>without have to call</em> <span class="monospaced">new</span>.</p></div>
<div class="paragraph"><p>Using the <span class="monospaced">apply</span> method of a companion object is a common Scala idiom for
constructing objects. For instance, <span class="monospaced">Array(1, 4, 9, 16)</span> returns an array of
integers, courtesy of the <span class="monospaced">apply</span> method in the <span class="monospaced">Array</span> companion object.</p></div>
</div>
<div class="sect2">
<h3 id="_lab_span_class_monospaced_bigint_span">Lab: <span class="monospaced">BigInt</span></h3>
<div class="paragraph"><p>Using the REPL, figure out how to use <span class="monospaced">BigInt</span> to compute 2<sup>1024</sup>.</p></div>
<div class="paragraph"><p>Hints:</p></div>
<div class="ulist"><ul>
<li>
<p>
Remember that you can create a <span class="monospaced">BigInt</span> by invoking it: <span class="monospaced">BigInt(10)</span>
</p>
</li>
<li>
<p>
In the REPL, the Tab character is your friend. Use it to figure out how
  to do exponentiation.
</p>
</li>
</ul></div>
</div>
<div class="sect2">
<h3 id="_scaladoc">Scaladoc</h3>
<div class="paragraph"><p>Java programmers use Javadoc to navigate the Java API. Scala has its own
variant, called Scaladoc. Let&#8217;s take a look at Scaladoc. Fire up a browser
and head over to
<a href="http://www.scala-lang.org/api/current/">www.scala-lang.org/api/current/</a>.</p></div>
<div class="paragraph"><p>Navigating Scaladoc is a bit more challenging than Javadoc. Scala classes
tend to have many more convenience methods than Java classes. Some methods
use features that you haven’t learned yet. Finally, some features are
exposed as they are implemented, not as they are used. (The Scala team is
working on improving the Scaladoc presentation, so that it can be more
approachable to beginners in the future.)</p></div>
<div class="paragraph"><p>Here are some tips for navigating Scaladoc, for a newcomer to the language.</p></div>
<div class="paragraph"><p>You can browse Scaladoc online at
<a href="http://www.scala-lang.org/api">www.scala-lang.org/api</a>,
but it is a good
idea to download a copy from
<a href="http://www.scala-lang.org/downloads#api">www.scala-lang.org/downloads#api</a>
and install it locally.</p></div>
<div class="sect3">
<h4 id="_filtering_and_searching">Filtering and Searching</h4>
<div class="paragraph"><p>Unlike Javadoc, which presents an alphabetical listing of classes,
Scaladoc’s class list is sorted by packages. If you know the class name but
not the package name, use the filter in the top left corner.</p></div>
<div class="paragraph"><p>Let&#8217;s try it. Put your cursor into the filter box and type <strong>Big</strong>.</p></div>
</div>
<div class="sect3">
<h4 id="_what_are_c_and_o">What are "C" and "O"?</h4>
<div class="paragraph"><p>Note the O and C symbols next to each class name. They permit you to navigate
to the documentation for a class &#169; or its companion object (O).</p></div>
</div>
<div class="sect3">
<h4 id="_tips">Tips</h4>
<div class="paragraph"><p>Scaladoc can be overwhelming. Here are some tips.</p></div>
<div class="paragraph"><p><strong>Remember enriched classes.</strong></p></div>
<div class="paragraph"><p>Look into <span class="monospaced">RichInt</span>, <span class="monospaced">RichDouble</span>, etc., if you want to know how to work
with numeric types. Similarly, for strings, look at <span class="monospaced">StringOps</span>.</p></div>
<div class="paragraph"><p><strong>Math functions are in a package.</strong></p></div>
<div class="paragraph"><p>The mathematical functions are in the <em>package</em> <span class="monospaced">scala.math</span>, not in a class.</p></div>
<div class="paragraph"><p><strong>There are some funny names in here.</strong></p></div>
<div class="paragraph"><p>Sometimes, you&#8217;ll see functions with funny names. For example, in <span class="monospaced">BigInt</span>,
there&#8217;s a <span class="monospaced">unary_-</span> method. As we&#8217;ll see later, this is how to you define
the prefix negation operator <span class="monospaced">-x</span>.</p></div>
<div class="paragraph"><p><strong>Don&#8217;t worry about implicits for now.</strong></p></div>
<div class="paragraph"><p>A method tagged with <span class="monospaced">implicit</span> is an automatic conversion. We&#8217;ll talk about
implicits later.</p></div>
<div class="paragraph"><p><strong>Functions can be parameters.</strong></p></div>
<div class="paragraph"><p>Methods can take functions as parameters. For instance, the <span class="monospaced">count</span> method in
<span class="monospaced">StringOps</span> requires a function that returns <span class="monospaced">true</span> or <span class="monospaced">false</span> for a <span class="monospaced">Char</span>,
specifying which characters should be counted:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">def</span> <span class="n">count</span><span class="o">(</span><span class="n">p</span><span class="k">:</span> <span class="o">(</span><span class="kt">Char</span><span class="o">)</span> <span class="o">=&gt;</span> <span class="nc">Boolean</span><span class="o">)</span><span class="k">:</span> <span class="kt">Int</span>
</pre></div></div></div>
<div class="paragraph"><p>For example:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>scala> <strong>"Hello, world".count(_.isLetter)</strong>
res0: Int = 10</pre>
</div></div>
<div class="paragraph"><p>You supply a function, often in a very compact notation, when you call the
method. As an example, the call <span class="monospaced">s.count(_.isUpper)</span> counts the number of
uppercase characters in <span class="monospaced">s</span>. We will discuss this style of programming later.</p></div>
<div class="paragraph"><p><strong>Why are there so many methods?</strong></p></div>
<div class="paragraph"><p>Don’t get discouraged that there are so many methods. It’s the Scala way to
provide lots of methods for every conceivable use case. When you need to
solve a particular problem, just look for a method that is useful. More
often than not, there is one that addresses your task, which means you
don’t have to write so much code yourself.</p></div>
<div class="paragraph"><p><strong>This one is <em>completely</em> unreadable!</strong></p></div>
<div class="paragraph"><p>Don&#8217;t worry if you run into the occasional indecipherable incantation, such
as this one in the <span class="monospaced">StringOps</span> class:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">def</span> <span class="n">patch</span> <span class="o">[</span><span class="kt">B</span> <span class="k">&gt;:</span> <span class="kt">Char</span>, <span class="kt">That</span><span class="o">](</span><span class="n">from</span><span class="k">:</span> <span class="kt">Int</span><span class="o">,</span> <span class="n">patch</span><span class="k">:</span> <span class="kt">GenSeq</span><span class="o">[</span><span class="kt">B</span><span class="o">],</span> <span class="n">replaced</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span> <span class="o">(</span><span class="k">implicit</span> <span class="n">bf</span><span class="k">:</span> <span class="kt">CanBuildFrom</span><span class="o">[</span><span class="kt">String</span>, <span class="kt">B</span>, <span class="kt">That</span><span class="o">])</span><span class="k">:</span> <span class="kt">That</span>
</pre></div></div></div>
<div class="paragraph"><p>Just ignore it. There is another version of patch that looks more reasonable:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">def</span> <span class="n">patch</span><span class="o">(</span><span class="n">from</span><span class="k">:</span> <span class="kt">Int</span><span class="o">,</span> <span class="n">that</span><span class="k">:</span> <span class="kt">GenSeq</span><span class="o">[</span><span class="kt">Char</span><span class="o">],</span> <span class="n">replaced</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span><span class="k">:</span> <span class="kt">StringOps</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span>
</pre></div></div></div>
<div class="paragraph"><p>If you think of <span class="monospaced">GenSeq[Char]</span> and <span class="monospaced">StringOps[A]</span> as String, the method is
pretty easy to understand from the documentation. And it’s easy to try it
out in the REPL:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>scala> <strong>"Harry".patch(1, "ung", 2)</strong>
res2: String = Hungry</pre>
</div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">When in doubt, <em>always</em> fire up the REPL and try it out.</td>
</tr></table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_lab_experimenting_with_string_methods">Lab: Experimenting with string methods</h3>
<div class="paragraph"><p>What do the following string methods do? Use the REPL (and, if you wish,
Scaladoc) to find out.</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>scala> <strong>val s = "Hello, world!"</strong>
s: String = Hello, world!

scala> <strong>s.take(2)</strong>
???

scala> <strong>s.take(2000)</strong>
???

scala> <strong>s.drop(5)</strong>
???

scala> <strong>s.drop(5922)</strong>
???

scala> <strong>s.takeRight(4)</strong>
???

scala> <strong>s.dropRight(3)</strong>
???</pre>
</div></div>
<div class="paragraph"><p>Play around until you have a good idea of what these methods do. Why would
you use them? Are there any cases where they make more sense than using
<span class="monospaced">substring</span>?</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="lesson-02-control-structures-and-functions">Control Structures and Functions</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_lesson_objectives_3">Lesson Objectives</h3>
<div class="paragraph"><p>In this lesson, we will cover:</p></div>
<div class="ulist"><ul>
<li>
<p>
Conditional Expressions
</p>
</li>
<li>
<p>
Statement Termination
</p>
</li>
<li>
<p>
Block Expressions and Assignments
</p>
</li>
<li>
<p>
Input and Output
</p>
</li>
<li>
<p>
Loops
</p>
</li>
<li>
<p>
Advanced <em>for</em> Loops and <em>for</em> Comprehensions
</p>
</li>
<li>
<p>
Functions
</p>
</li>
<li>
<p>
Default and Named Arguments
</p>
</li>
<li>
<p>
Variable Arguments
</p>
</li>
<li>
<p>
Procedures
</p>
</li>
<li>
<p>
Lazy Values
</p>
</li>
<li>
<p>
Exceptions
</p>
</li>
</ul></div>
</div>
<div class="sect2">
<h3 id="_summary">Summary</h3>
<div class="paragraph"><p>Here&#8217;s a summary of what we&#8217;ll be covering.</p></div>
<div class="ulist"><ul>
<li>
<p>
An <span class="monospaced">if</span> expression has a value.
</p>
</li>
<li>
<p>
A block has a value: the value of its last expression.
</p>
</li>
<li>
<p>
The Scala <span class="monospaced">for</span> loop is like an “enhanced” Java for loop.
</p>
</li>
<li>
<p>
Semicolons are (mostly) optional.
</p>
</li>
<li>
<p>
The <span class="monospaced">void</span> type is <span class="monospaced">Unit</span>.
</p>
</li>
<li>
<p>
Avoid using <span class="monospaced">return</span> in a function.
</p>
</li>
<li>
<p>
Beware of missing = in a function definition.
</p>
</li>
<li>
<p>
Exceptions work just like in Java or C++, but you use a “pattern matching”
  syntax for <span class="monospaced">catch</span>.
</p>
</li>
<li>
<p>
Scala has no checked exceptions.
</p>
</li>
</ul></div>
</div>
<div class="sect2">
<h3 id="_conditional_expressions">Conditional Expressions</h3>
<div class="paragraph"><p>Scala has an <span class="monospaced">if/else</span> construct with the same syntax as in Java or C++.
However, in Scala, an <span class="monospaced">if/else</span> has a value: the value of the
expression that follows the <span class="monospaced">if</span> or <span class="monospaced">else</span>.</p></div>
<div class="paragraph"><p>For example, consider this simple <span class="monospaced">if</span> statement:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">if</span> <span class="o">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">)</span> <span class="mi">1</span> <span class="k">else</span> <span class="o">-</span><span class="mi">1</span>
</pre></div></div></div>
<div class="paragraph"><p>That statement has a value of 1 or -1, depending on the value of <span class="monospaced">x</span>. You can
put that value in a variable:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">val</span> <span class="n">s</span> <span class="k">=</span> <span class="k">if</span> <span class="o">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">)</span> <span class="mi">1</span> <span class="k">else</span> <span class="o">-</span><span class="mi">1</span>
</pre></div></div></div>
<div class="paragraph"><p>This has the same effect as</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">if</span> <span class="o">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">)</span> <span class="n">s</span> <span class="k">=</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">s</span> <span class="k">=</span> <span class="o">-</span><span class="mi">1</span>
</pre></div></div></div>
<div class="paragraph"><p>However, the first form is better because it can be used to initialize a
<span class="monospaced">val</span>. In the second form, <span class="monospaced">s</span> needs to be a <span class="monospaced">var</span>.</p></div>
<div class="sect3">
<h4 id="_scala_has_no_ternary_em_if_em">Scala has no ternary <em>if</em></h4>
<div class="paragraph"><p>Java, C and C++ have a <span class="monospaced">?:</span> operator (the so-called <em>ternary if</em>) for this
purpose. The expression:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="o">-</span><span class="mi">1</span> <span class="c1">// Java, C or C++</span>
</pre></div></div></div>
<div class="paragraph"><p>is equivalent to the Scala expression:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">if</span> <span class="o">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">)</span> <span class="mi">1</span> <span class="k">else</span> <span class="o">-</span><span class="mi">1</span>
</pre></div></div></div>
<div class="paragraph"><p>However, you can’t put statements inside a <span class="monospaced">?:</span> expression. The Scala
<span class="monospaced">if/else</span> combines the <span class="monospaced">if/else</span> and <span class="monospaced">?:</span> constructs that are separate in
Java and C++.</p></div>
</div>
<div class="sect3">
<h4 id="_expressions_have_types">Expressions have types</h4>
<div class="paragraph"><p>In Scala, every expression has a type. For example, the expression:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">if</span> <span class="o">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">)</span> <span class="mi">1</span> <span class="k">else</span> <span class="o">-</span><span class="mi">1</span>
</pre></div></div></div>
<div class="paragraph"><p>has the type <span class="monospaced">Int</span> because both branches have the type <span class="monospaced">Int</span>. The type of a
mixed-type expression, such as</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">if</span> <span class="o">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">)</span> <span class="s">&quot;positive&quot;</span> <span class="k">else</span> <span class="o">-</span><span class="mi">1</span>
</pre></div></div></div>
<div class="paragraph"><p>is the common supertype of both branches. In this example, one branch is a
<span class="monospaced">java.lang.String</span>, and the other an <span class="monospaced">Int</span>. Their common supertype is called
<span class="monospaced">Any</span>, which is sort of like Java&#8217;s <span class="monospaced">Object</span>, kind of. (More on that later.)</p></div>
<div class="paragraph"><p>If the else part is omitted:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">if</span> <span class="o">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">)</span> <span class="mi">1</span>
</pre></div></div></div>
<div class="paragraph"><p>then it is possible that the <span class="monospaced">if</span> statement yields no value.</p></div>
<div class="paragraph"><p>However, in Scala, <em>every</em> expression is supposed to have <em>some</em> value.
This is finessed by introducing a class <span class="monospaced">Unit</span> that has one value, written
as <span class="monospaced">()</span>. The <span class="monospaced">if</span> statement without an <span class="monospaced">else</span> is equivalent to</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">if</span> <span class="o">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">)</span> <span class="mi">1</span> <span class="k">else</span> <span class="o">()</span>
</pre></div></div></div>
<div class="paragraph"><p>Think of <span class="monospaced">()</span> as a placeholder for "no useful value," and think of <span class="monospaced">Unit</span>
as the rough analog of <span class="monospaced">void</span> in Java or C++.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph"><p>It&#8217;s a rough analog because, technically speaking, <span class="monospaced">void</span> has no value,
whereas <span class="monospaced">Unit</span> has one value that signifies “no value”. Python&#8217;s <span class="monospaced">None</span>
and Ruby&#8217;s <span class="monospaced">nil</span> are akin to Scala&#8217;s <span class="monospaced">Unit</span>.</p></div>
</td>
</tr></table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_statement_termination">Statement Termination</h3>
<div class="paragraph"><p>In Java and C++, every statement ends with a semicolon. In Scala, a
semicolon is never required if it falls just before the end of the line. A
semicolon is also optional before an <span class="monospaced">}</span>, an <span class="monospaced">else</span>, and similar locations
where it is clear from context that the end of a statement has been
reached.</p></div>
<div class="paragraph"><p>However, if you want to have more than one statement on a single line, you
need to separate them with semicolons. For example,</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">if</span> <span class="o">(</span><span class="n">n</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span> <span class="n">r</span> <span class="k">=</span> <span class="n">r</span> <span class="o">*</span> <span class="n">n</span><span class="o">;</span> <span class="n">n</span> <span class="o">-=</span> <span class="mi">1</span> <span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>If you want to continue a long statement over two lines, make sure that the
first line ends in a symbol that cannot be the end of a statement. An
operator is often a good choice:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="n">s</span> <span class="k">=</span> <span class="n">s0</span> <span class="o">+</span> <span class="o">(</span><span class="n">v</span> <span class="o">-</span> <span class="n">v0</span><span class="o">)</span> <span class="o">*</span> <span class="n">t</span> <span class="o">+</span> <span class="c1">// The + tells the parser that this is not the end</span>
  <span class="mf">0.5</span> <span class="o">*</span> <span class="o">(</span><span class="n">a</span> <span class="o">-</span> <span class="n">a0</span><span class="o">)</span> <span class="o">*</span> <span class="n">t</span> <span class="o">*</span> <span class="n">t</span>
</pre></div></div></div>
<div class="paragraph"><p>In practice, long expressions usually involve function or method calls, and
then you don’t need to worry much: After an opening <span class="monospaced">(</span>, the compiler won’t
infer the end of a statement until it has seen the matching ).</p></div>
<div class="paragraph"><p>In the same spirit, Scala programmers favor the Kernighan &amp; Ritchie brace
style:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">if</span> <span class="o">(</span><span class="n">n</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">r</span> <span class="k">=</span> <span class="n">r</span> <span class="o">*</span> <span class="n">n</span>
  <span class="n">n</span> <span class="o">-=</span> <span class="mi">1</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>The line ending with a <span class="monospaced">{</span> tells the compiler "there&#8217;s more to come."</p></div>
<div class="paragraph"><p>Many programmers coming from Java or C++ are initially uncomfortable about
omitting semicolons. If you prefer to have them, just put them in. They do
no harm.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">Using semicolons, when they&#8217;re not necessary, results in
non-idiomatic Scala.</td>
</tr></table>
</div>
</div>
<div class="sect2">
<h3 id="_block_expressions_and_assignments">Block Expressions and Assignments</h3>
<div class="paragraph"><p>In Java or C++, a block statement is a sequence of statements enclosed in
<span class="monospaced">{ }</span>. You use a block statement whenever you need to put multiple actions
in the body of a branch or loop statement.</p></div>
<div class="paragraph"><p>In Scala, a <span class="monospaced">{ }</span> block contains a sequence of expressions, and the result
is also an expression. The value of the block is the value of the last
expression.</p></div>
<div class="paragraph"><p>This feature can be useful if the initialization of a <span class="monospaced">val</span> takes more than
one step. For example,</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">val</span> <span class="n">distance</span> <span class="k">=</span> <span class="o">{</span>
  <span class="k">val</span> <span class="n">dx</span> <span class="k">=</span> <span class="n">x</span> <span class="o">-</span> <span class="n">x0</span>
  <span class="k">val</span> <span class="n">dy</span> <span class="k">=</span> <span class="n">y</span> <span class="o">-</span> <span class="n">y0</span>
  <span class="n">sqrt</span><span class="o">(</span><span class="n">dx</span> <span class="o">*</span> <span class="n">dx</span> <span class="o">+</span> <span class="n">dy</span> <span class="o">*</span> <span class="n">dy</span><span class="o">)</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>The value of the <span class="monospaced">{ }</span> block is the last expression,
<span class="monospaced">sqrt(dx * dx + dy * dy)</span>. The variables <span class="monospaced">dx</span> and <span class="monospaced">dy</span>, which were only
needed as intermediate values in the computation, are neatly hidden from the
rest of the program.</p></div>
<div class="paragraph"><p>In Scala, assignments have no value. Strictly speaking, they have a
value of type <span class="monospaced">Unit</span>.</p></div>
<div class="paragraph"><p>A block that ends with an assignment statement, such as</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="o">{</span> <span class="n">r</span> <span class="k">=</span> <span class="n">r</span> <span class="o">*</span> <span class="n">n</span><span class="o">;</span> <span class="n">n</span> <span class="o">-=</span> <span class="mi">1</span> <span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>has a <span class="monospaced">Unit</span> value. This is not a problem, but it <em>is</em> something to be
aware of when defining functions.</p></div>
<div class="paragraph"><p>Since assignments have <span class="monospaced">Unit</span> value, don’t chain them together.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="n">x</span> <span class="k">=</span> <span class="n">y</span> <span class="k">=</span> <span class="mi">1</span> <span class="c1">// No</span>
</pre></div></div></div>
<div class="paragraph"><p>The value of <span class="monospaced">y = 1</span> is <span class="monospaced">()</span>, so the value of <span class="monospaced">x</span> becomes <span class="monospaced">Unit</span>. (You
probably don&#8217;t want that.)</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">In contrast, in Java and C++, the value of an assignment is the value
that is being assigned. In those languages, chained assignments are
useful.)</td>
</tr></table>
</div>
</div>
<div class="sect2">
<h3 id="_simple_input_and_output">Simple Input and Output</h3>
<div class="paragraph"><p>To print a value, use the <span class="monospaced">print</span> or <span class="monospaced">println</span> function. The latter adds a
newline character after the printout. For example,</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="n">print</span><span class="o">(</span><span class="s">&quot;Answer: &quot;</span><span class="o">)</span>
<span class="n">println</span><span class="o">(</span><span class="mi">42</span><span class="o">)</span>
</pre></div></div></div>
<div class="paragraph"><p>yields the same output as</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="n">println</span><span class="o">(</span><span class="s">&quot;Answer: &quot;</span> <span class="o">+</span> <span class="mi">42</span><span class="o">)</span>
</pre></div></div></div>
<div class="paragraph"><p>There is also a <span class="monospaced">printf</span> function with a C-style format string:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="n">printf</span><span class="o">(</span><span class="s">&quot;Hello, %s! You are %d years old.\n&quot;</span><span class="o">,</span> <span class="s">&quot;Fred&quot;</span><span class="o">,</span> <span class="mi">42</span><span class="o">)</span>
</pre></div></div></div>
</div>
<div class="sect2">
<h3 id="_loops">Loops</h3>
<div class="paragraph"><p>Scala has the same while and do loops as Java and C++. For example,</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">while</span> <span class="o">(</span><span class="n">n</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">r</span> <span class="k">=</span> <span class="n">r</span> <span class="o">*</span> <span class="n">n</span>
  <span class="n">n</span> <span class="o">-=</span> <span class="mi">1</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>Scala has no direct analog of the <span class="monospaced">for (initialize; test; update)</span> loop. If
you need such a loop, you have two choices:</p></div>
<div class="ulist"><ul>
<li>
<p>
Use a <span class="monospaced">while</span> loop.
</p>
</li>
<li>
<p>
Use a <span class="monospaced">for</span> statement, as shown below.
</p>
</li>
</ul></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">for</span> <span class="o">(</span><span class="n">i</span> <span class="k">&lt;-</span> <span class="mi">1</span> <span class="n">to</span> <span class="n">n</span><span class="o">)</span>
  <span class="n">r</span> <span class="k">=</span> <span class="n">r</span> <span class="o">*</span> <span class="n">i</span>
</pre></div></div></div>
<div class="paragraph"><p>Recall the <span class="monospaced">to</span> method on <span class="monospaced">RichInt</span>, from the previous lesson.
The call <span class="monospaced">1 to n</span> returns a <span class="monospaced">Range</span> of the numbers from <span class="monospaced">1 to n</span> (inclusive).</p></div>
<div class="paragraph"><p>The construct</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">for</span> <span class="o">(</span><span class="n">i</span> <span class="k">&lt;-</span> <span class="n">expr</span><span class="o">)</span>
</pre></div></div></div>
<div class="paragraph"><p>makes the variable <span class="monospaced">i</span> traverse all values of the expression to the right of
the <span class="monospaced">&lt;-</span>. Exactly how that traversal works depends on the type of the
expression. For a Scala collection, such as a <span class="monospaced">Range</span>, the loop makes <span class="monospaced">i</span>
assume each value in turn.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">There is no <span class="monospaced">val</span> or <span class="monospaced">var</span> before the variable in the <span class="monospaced">for</span> loop. The
variable is automatically a <span class="monospaced">val</span>. The type of the variable is the element
type of the collection (<span class="monospaced">Int</span>, in the above loop). The scoop of the variable
extends to the end of the loop.</td>
</tr></table>
</div>
<div class="sect3">
<h4 id="_span_class_monospaced_until_span"><span class="monospaced">until</span></h4>
<div class="paragraph"><p>When traversing a string or array, you often need a range from 0 to <em>n</em> – 1.
In that case, use the <span class="monospaced">until</span> method instead of the <span class="monospaced">to</span> method.
<span class="monospaced">until</span> returns a range that doesn’t include the upper bound.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">val</span> <span class="n">s</span> <span class="k">=</span> <span class="s">&quot;Hello&quot;</span>
<span class="k">var</span> <span class="n">sum</span> <span class="k">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="o">(</span><span class="n">i</span> <span class="k">&lt;-</span> <span class="mi">0</span> <span class="n">until</span> <span class="n">s</span><span class="o">.</span><span class="n">length</span><span class="o">)</span> <span class="c1">// Last value for i is s.length - 1</span>
  <span class="n">sum</span> <span class="o">+=</span> <span class="n">s</span><span class="o">(</span><span class="n">i</span><span class="o">)</span>
</pre></div></div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph"><p><span class="monospaced">until</span> and <span class="monospaced">to</span> are actually method calls on <span class="monospaced">RichInt</span>.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="mi">0</span> <span class="n">until</span> <span class="mi">10</span>  <span class="c1">// same as 0.until(10)</span>
<span class="mi">1</span> <span class="n">to</span> <span class="mi">20</span>     <span class="c1">// same as 1.to(20)</span>
</pre></div></div></div>
</td>
</tr></table>
</div>
<div class="paragraph"><p>In this example, there is actually no need to use indexes. You can directly
loop over the characters:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">var</span> <span class="n">sum</span> <span class="k">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="o">(</span><span class="n">ch</span> <span class="k">&lt;-</span> <span class="s">&quot;Hello&quot;</span><span class="o">)</span> <span class="n">sum</span> <span class="o">+=</span> <span class="n">ch</span>
</pre></div></div></div>
<div class="paragraph"><p>This is more idiomatic.</p></div>
<div class="paragraph"><p><strong>However</strong>, in Scala, loops are not used as often as in other languages. As
we will see later, you can often process the values in a sequence by
applying a function to all of them, which can be done with a single method
call.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="title">No <span class="monospaced">break</span> or <span class="monospaced">continue</span></div>
<div class="paragraph"><p>Scala has no <span class="monospaced">break</span> or <span class="monospaced">continue</span> statements to break out of a loop. So,
what if you actually need to do that? There are several options.</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Use a Boolean control variable instead.
</p>
</li>
<li>
<p>
Use nested functions: You can <span class="monospaced">return</span> from the middle of a function.
</p>
</li>
<li>
<p>
Use the <span class="monospaced">break</span> method in the <span class="monospaced">Breaks</span> object, as shown below.
</p>
</li>
</ol></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">import</span> <span class="nn">scala.util.control.Breaks._</span>
<span class="n">breakable</span> <span class="o">{</span>
   <span class="k">for</span> <span class="o">(...)</span> <span class="o">{</span>
      <span class="k">if</span> <span class="o">(...)</span> <span class="n">break</span><span class="o">;</span> <span class="c1">// Exits the breakable block</span>
      <span class="o">...</span>
   <span class="o">}</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>The third approach works by throwing and catching an exception. While
this works, it has performance issues.</p></div>
<div class="paragraph"><p>In general, it&#8217;s best (and more idiomatic) to organize your loops so that
<span class="monospaced">break</span> and <span class="monospaced">continue</span> are not necessary.</p></div>
</td>
</tr></table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_advanced_span_class_monospaced_for_span_loops_and_span_class_monospaced_for_span_comprehensions">Advanced <span class="monospaced">for</span> Loops and <span class="monospaced">for</span> Comprehensions</h3>
<div class="paragraph"><p>In the preceding section, you saw the basic form of the <span class="monospaced">for</span> loop.
However, this construct is much richer in Scala than in Java or C++. This
section covers the advanced features.</p></div>
<div class="paragraph"><p>You can have multiple generators of the form <span class="monospaced">variable &lt;- expression</span>.
Separate them by semicolons or newlines. (With newlines, though, use <span class="monospaced">{ }</span>
instead of <span class="monospaced">( )</span>.)</p></div>
<div class="paragraph"><p>For example,</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">for</span> <span class="o">(</span><span class="n">i</span> <span class="k">&lt;-</span> <span class="mi">1</span> <span class="n">to</span> <span class="mi">3</span><span class="o">;</span> <span class="n">j</span> <span class="k">&lt;-</span> <span class="mi">1</span> <span class="n">to</span> <span class="mi">3</span><span class="o">)</span> <span class="n">print</span><span class="o">((</span><span class="mi">10</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="n">j</span><span class="o">)</span> <span class="o">+</span> <span class="s">&quot; &quot;</span><span class="o">)</span>
<span class="c1">// Prints 11 12 13 21 22 23 31 32 33</span>

<span class="c1">// Or:</span>
<span class="k">for</span> <span class="o">{</span> <span class="n">i</span> <span class="k">&lt;-</span> <span class="mi">1</span> <span class="n">to</span> <span class="mi">3</span>
      <span class="n">j</span> <span class="k">&lt;-</span> <span class="mi">1</span> <span class="n">to</span> <span class="mi">3</span> <span class="o">}</span>
  <span class="n">print</span><span class="o">((</span><span class="mi">10</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="n">j</span><span class="o">)</span> <span class="o">+</span> <span class="s">&quot; &quot;</span><span class="o">)</span>
</pre></div></div></div>
<div class="paragraph"><p>You can count down, rather than up, using the <span class="monospaced">by</span> modifier:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">for</span> <span class="o">(</span><span class="n">i</span> <span class="k">&lt;-</span> <span class="mi">20</span> <span class="n">to</span> <span class="mi">1</span> <span class="n">by</span> <span class="o">-</span><span class="mi">2</span><span class="o">)</span> <span class="n">print</span><span class="o">(</span><span class="n">i</span> <span class="o">+</span> <span class="s">&quot; &quot;</span><span class="o">)</span>
<span class="c1">// Prints 20 18 16 14 12 10 8 6 4 2</span>
</pre></div></div></div>
<div class="paragraph"><p>Each generator can have a guard, a Boolean condition preceded by <span class="monospaced">if</span>:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">for</span> <span class="o">{</span> <span class="n">i</span> <span class="k">&lt;-</span> <span class="mi">1</span> <span class="n">to</span> <span class="mi">3</span>
      <span class="n">j</span> <span class="k">&lt;-</span> <span class="mi">1</span> <span class="n">to</span> <span class="mi">3</span> <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="n">j</span> <span class="o">}</span>
  <span class="n">print</span><span class="o">((</span><span class="mi">10</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="n">j</span><span class="o">)</span> <span class="o">+</span> <span class="s">&quot; &quot;</span><span class="o">)</span>

<span class="c1">// Prints 12 13 21 23 31 32</span>
</pre></div></div></div>
<div class="paragraph"><p>Note that there is no semicolon before the <span class="monospaced">if</span>.</p></div>
<div class="paragraph"><p>You can have any number of definitions, introducing variables that can be
used inside the loop:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">for</span> <span class="o">{</span> <span class="n">i</span> <span class="k">&lt;-</span> <span class="mi">1</span> <span class="n">to</span> <span class="mi">3</span>
      <span class="n">from</span> <span class="k">=</span> <span class="mi">4</span> <span class="o">-</span> <span class="n">i</span>
      <span class="n">j</span> <span class="k">&lt;-</span> <span class="n">from</span> <span class="n">to</span> <span class="mi">3</span> <span class="o">}</span>
  <span class="n">print</span><span class="o">((</span><span class="mi">10</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="n">j</span><span class="o">)</span> <span class="o">+</span> <span class="s">&quot; &quot;</span><span class="o">)</span>

<span class="c1">// Prints 13 22 23 31 32 33</span>
</pre></div></div></div>
</div>
<div class="sect2">
<h3 id="_lab_for_loops">Lab: for loops</h3>
<div class="paragraph"><p>Open <span class="monospaced">labs/src/main/scala/com/newcircle/csf/ForLoop.scala</span> and
complete the function. You&#8217;re writing a Scala <span class="monospaced">for</span> loop that emulates this
Java <span class="monospaced">for</span> loop:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">10</span><span class="o">;</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span><span class="o">--)</span> <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">i</span><span class="o">)</span>
</pre></div></div></div>
<div class="paragraph"><p>Here&#8217;s the lab:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">package</span> <span class="nn">com.newcircle.csf</span>

<span class="k">import</span> <span class="nn">com.newcircle.util.Output</span>

<span class="k">class</span> <span class="nc">ForLoop</span> <span class="k">extends</span> <span class="nc">Output</span> <span class="o">{</span>

  <span class="cm">/** Write a function, in Scala, that does the equivalent of this Java</span>
<span class="cm">    * for loop:</span>
<span class="cm">    *</span>
<span class="cm">    *   for (int i = 10; i &gt;= 0; i --) System.out.println(i);</span>
<span class="cm">    *</span>
<span class="cm">    * Use the `println` function inherited from `Output`.</span>
<span class="cm">    */</span>
  <span class="k">def</span> <span class="n">forLoop</span><span class="o">(</span><span class="n">upper</span><span class="k">:</span> <span class="kt">Int</span><span class="o">,</span> <span class="n">lower</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="o">{</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>You need to fill out the <span class="monospaced">forLoop</span> function.</p></div>
<div class="paragraph"><p>There&#8217;s already a tester in place for the lab; it&#8217;s located in
<span class="monospaced">labs/src/test/scala/com/newcircle/csf/ForLoopSpec.scala</span>.</p></div>
<div class="paragraph"><p>From the <span class="monospaced">sbt</span> console, you can run the test as follows:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>&gt; test-only com.newcircle.tests.csf.ForLoopSpec</pre>
</div></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_yield">yield</h2>
<div class="sectionbody">
<div class="paragraph"><p>When the body of the <span class="monospaced">for</span> loop starts with <span class="monospaced">yield</span>, then the loop
constructs a collection of values, one for each iteration, yielding them
as the result of the <span class="monospaced">for</span>:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">for</span> <span class="o">(</span><span class="n">i</span> <span class="k">&lt;-</span> <span class="mi">1</span> <span class="n">to</span> <span class="mi">10</span><span class="o">)</span> <span class="k">yield</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">3</span>
<span class="c1">// Yields Vector(1, 2, 0, 1, 2, 0, 1, 2, 0, 1)</span>
</pre></div></div></div>
<div class="paragraph"><p>This type of <span class="monospaced">loop</span> is called a <em>for comprehension</em>.</p></div>
<div class="paragraph"><p>The generated collection is compatible with the first generator in the loop.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">for</span> <span class="o">(</span><span class="n">c</span> <span class="k">&lt;-</span> <span class="s">&quot;Hello&quot;</span><span class="o">;</span> <span class="n">i</span> <span class="k">&lt;-</span> <span class="mi">0</span> <span class="n">to</span> <span class="mi">1</span><span class="o">)</span> <span class="k">yield</span> <span class="o">(</span><span class="n">c</span> <span class="o">+</span> <span class="n">i</span><span class="o">).</span><span class="n">toChar</span>
<span class="c1">// Yields &quot;HIeflmlmop&quot;</span>

<span class="k">for</span> <span class="o">(</span><span class="n">i</span> <span class="k">&lt;-</span> <span class="mi">0</span> <span class="n">to</span> <span class="mi">1</span><span class="o">;</span> <span class="n">c</span> <span class="k">&lt;-</span> <span class="s">&quot;Hello&quot;</span><span class="o">)</span> <span class="k">yield</span> <span class="o">(</span><span class="n">c</span> <span class="o">+</span> <span class="n">i</span><span class="o">).</span><span class="n">toChar</span>
<span class="c1">// Yields Vector(&#39;H&#39;, &#39;e&#39;, &#39;l&#39;, &#39;l&#39;, &#39;o&#39;, &#39;I&#39;, &#39;f&#39;, &#39;m&#39;, &#39;m&#39;, &#39;p&#39;)</span>
</pre></div></div></div>
<div class="sect2">
<h3 id="_functions">Functions</h3>
<div class="paragraph"><p>Scala has functions in addition to methods. A <em>method</em> operates on (is
conceptually attached to) an object, but a function doesn’t. C++ has
functions as well, but in Java, you have to imitate them with static
methods.</p></div>
<div class="paragraph"><p>To define a function, you specify the function’s name, parameters, and body
like this:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">def</span> <span class="n">abs</span><span class="o">(</span><span class="n">x</span><span class="k">:</span> <span class="kt">Double</span><span class="o">)</span> <span class="k">=</span> <span class="k">if</span> <span class="o">(</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="o">)</span> <span class="n">x</span> <span class="k">else</span> <span class="o">-</span><span class="n">x</span>
</pre></div></div></div>
<div class="paragraph"><p>You must specify the types of all parameters. However, as long as the
function is not recursive, you need not specify the return type. The Scala
compiler determines the return type from the type of the expression to the
right of the <span class="monospaced">=</span> symbol.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">If your functions are complex, it&#8217;s worth including a return type anyway.
The compiler might be able to infer the return value, but the next person who
reads your code might have more trouble.</td>
</tr></table>
</div>
<div class="paragraph"><p>If the body of the function requires more than one expression, use a block.
The last expression of the block becomes the value that the function
returns. For example, the following function returns the value of r after
the for loop.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">def</span> <span class="n">fac</span><span class="o">(</span><span class="n">n</span> <span class="k">:</span> <span class="kt">Int</span><span class="o">)</span> <span class="k">=</span> <span class="o">{</span>
  <span class="k">var</span> <span class="n">r</span> <span class="k">=</span> <span class="mi">1</span>
  <span class="k">for</span> <span class="o">(</span><span class="n">i</span> <span class="k">&lt;-</span> <span class="mi">1</span> <span class="n">to</span> <span class="n">n</span><span class="o">)</span> <span class="n">r</span> <span class="k">=</span> <span class="n">r</span> <span class="o">*</span> <span class="n">i</span>
  <span class="n">r</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>There is no need for the return keyword in this example. It is possible to
use <span class="monospaced">return</span> as in Java or C++, to exit a function immediately, but that is
not commonly done in Scala.</p></div>
</div>
<div class="sect2">
<h3 id="_lab_function">Lab: function</h3>
<div class="paragraph"><p>Open <span class="monospaced">labs/src/main/scala/com/newcircle/csf/Signum.scala</span> and complete
the <span class="monospaced">signum</span> function. You&#8217;re solving the following exercise:</p></div>
<div class="paragraph"><p>The <em>signum</em> of a number is 1 if the number is positive, -1 if it is negative,
and 0 otherwise. Write a function that computes this value.</p></div>
<div class="paragraph"><p>Here&#8217;s the lab:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">package</span> <span class="nn">com.newcircle.csf</span>

<span class="k">class</span> <span class="nc">Signum</span> <span class="o">{</span>

  <span class="cm">/** Write a function that computes the signum of a number. See the</span>
<span class="cm">    * course material for a description.</span>
<span class="cm">    */</span>
  <span class="k">def</span> <span class="n">signum</span><span class="o">(</span><span class="n">n</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span> <span class="k">=</span> <span class="o">{</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>There&#8217;s already a tester in place for the lab; it&#8217;s located in
<span class="monospaced">labs/src/test/scala/com/newcircle/csf/SignumSpec.scala</span>.</p></div>
<div class="paragraph"><p>From the <span class="monospaced">sbt</span> console, you can run the test as follows:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>&gt; test-only com.newcircle.tests.csf.SignumSpec</pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_default_and_named_arguments">Default and Named Arguments</h3>
<div class="paragraph"><p>You can provide default arguments for functions that are used when you
don’t specify explicit values. For example,</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">def</span> <span class="n">decorate</span><span class="o">(</span><span class="n">str</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">left</span><span class="k">:</span> <span class="kt">String</span> <span class="o">=</span> <span class="s">&quot;[&quot;</span><span class="o">,</span> <span class="n">right</span><span class="k">:</span> <span class="kt">String</span> <span class="o">=</span> <span class="s">&quot;]&quot;</span><span class="o">)</span> <span class="k">=</span>
  <span class="n">left</span> <span class="o">+</span> <span class="n">str</span> <span class="o">+</span> <span class="n">right</span>
</pre></div></div></div>
<div class="paragraph"><p>This function has two parameters, left and right, with default arguments
"[" and "]".</p></div>
<div class="paragraph"><p>If you call <span class="monospaced">decorate("Hello")</span>, you get "[Hello]". If you don’t like the
defaults, supply your own:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="n">decorate</span><span class="o">(</span><span class="s">&quot;Hello&quot;</span><span class="o">,</span> <span class="s">&quot;&lt;&lt;&lt;&quot;</span><span class="o">,</span> <span class="s">&quot;&gt;&gt;&gt;&quot;</span><span class="o">).</span>
</pre></div></div></div>
<div class="paragraph"><p>If you supply fewer arguments than there are parameters, the defaults are
applied from the end. For example,</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="n">decorate</span><span class="o">(</span><span class="s">&quot;Hello&quot;</span><span class="o">,</span> <span class="s">&quot;&gt;&gt;&gt;[&quot;</span><span class="o">)</span>
</pre></div></div></div>
<div class="paragraph"><p>uses the default value of the right parameter, yielding "&gt;&gt;&gt;[Hello]".</p></div>
<div class="paragraph"><p>You can also specify the parameter names when you supply the arguments. For
example,</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="n">decorate</span><span class="o">(</span><span class="n">left</span> <span class="k">=</span> <span class="s">&quot;&lt;&lt;&lt;&quot;</span><span class="o">,</span> <span class="n">str</span> <span class="k">=</span> <span class="s">&quot;Hello&quot;</span><span class="o">,</span> <span class="n">right</span> <span class="k">=</span> <span class="s">&quot;&gt;&gt;&gt;&quot;</span><span class="o">)</span>
</pre></div></div></div>
<div class="paragraph"><p>The result is <span class="monospaced">"&lt;&lt;&lt;Hello&gt;&gt;&gt;"</span>. Note that the named arguments need not be in
the same order as the parameters.</p></div>
<div class="paragraph"><p>Named arguments can make a function call more readable. They are also
useful if a function has many default parameters.</p></div>
<div class="paragraph"><p>You can mix unnamed and named arguments, provided the unnamed ones come first:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="n">decorate</span><span class="o">(</span><span class="s">&quot;Hello&quot;</span><span class="o">,</span> <span class="n">right</span> <span class="k">=</span> <span class="s">&quot;]&lt;&lt;&lt;&quot;</span><span class="o">)</span> <span class="c1">// Calls decorate(&quot;Hello&quot;, &quot;[&quot;, &quot;]&lt;&lt;&lt;&quot;)</span>
</pre></div></div></div>
</div>
<div class="sect2">
<h3 id="_variable_arguments">Variable Arguments</h3>
<div class="paragraph"><p>Sometimes, it is convenient to implement a function that can take a
variable number of arguments. The following example shows the syntax:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">def</span> <span class="n">sum</span><span class="o">(</span><span class="n">args</span><span class="k">:</span> <span class="kt">Int*</span><span class="o">)</span> <span class="k">=</span> <span class="o">{</span>
  <span class="k">var</span> <span class="n">result</span> <span class="k">=</span> <span class="mi">0</span>
  <span class="k">for</span> <span class="o">(</span><span class="n">arg</span> <span class="k">&lt;-</span> <span class="n">args</span><span class="o">)</span> <span class="n">result</span> <span class="o">+=</span> <span class="n">arg</span>
  <span class="n">result</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>You can call this function with as many arguments as you like.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">val</span> <span class="n">s</span> <span class="k">=</span> <span class="n">sum</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="mi">9</span><span class="o">,</span> <span class="mi">16</span><span class="o">,</span> <span class="mi">25</span><span class="o">)</span>
</pre></div></div></div>
<div class="paragraph"><p>The function receives a single parameter of type <span class="monospaced">Seq</span>, which we will
discuss later. For now, all you need to know is that you can use a <span class="monospaced">for</span>
loop to visit each element.</p></div>
<div class="paragraph"><p>If you already have a sequence of values, you cannot pass it directly to
such a function. For example, the following is not correct:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">val</span> <span class="n">s</span> <span class="k">=</span> <span class="n">sum</span><span class="o">(</span><span class="mi">1</span> <span class="n">to</span> <span class="mi">5</span><span class="o">)</span> <span class="c1">// Error</span>
</pre></div></div></div>
<div class="paragraph"><p>If the <span class="monospaced">sum</span> function is called with one argument, that must be a single
integer, not a range of integers. The remedy is to tell the compiler that
you want the parameter to be considered an argument sequence. To do that,
append <span class="monospaced">: _*</span>:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">val</span> <span class="n">s</span> <span class="k">=</span> <span class="n">sum</span><span class="o">(</span><span class="mi">1</span> <span class="n">to</span> <span class="mi">5</span><span class="k">:</span> <span class="k">_</span><span class="kt">*</span><span class="o">)</span> <span class="c1">// Consider 1 to 5 as an argument sequence</span>
</pre></div></div></div>
<div class="paragraph"><p>This call syntax is needed in a recursive definition:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">def</span> <span class="n">recursiveSum</span><span class="o">(</span><span class="n">args</span><span class="k">:</span> <span class="kt">Int*</span><span class="o">)</span> <span class="k">:</span> <span class="kt">Int</span> <span class="o">=</span> <span class="o">{</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">args</span><span class="o">.</span><span class="n">length</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="mi">0</span>
  <span class="k">else</span> <span class="n">args</span><span class="o">.</span><span class="n">head</span> <span class="o">+</span> <span class="n">recursiveSum</span><span class="o">(</span><span class="n">args</span><span class="o">.</span><span class="n">tail</span> <span class="k">:</span> <span class="k">_</span><span class="kt">*</span><span class="o">)</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>Here, the head of a sequence is its initial element, and tail is a sequence
of all other elements. The tail is a <span class="monospaced">Seq</span>, so we have to use <span class="monospaced">: _*</span> to
convert it to an argument sequence.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Caution</div>
</td>
<td class="content">
<div class="paragraph"><p>When you call a Java method with variable arguments of type <span class="monospaced">Object</span>, such
as <span class="monospaced">PrintStream.printf</span> or <span class="monospaced">MessageFormat.format</span>, you need to convert any
primitive types by hand. For example,</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">val</span> <span class="n">str</span> <span class="k">=</span> <span class="nc">MessageFormat</span><span class="o">.</span><span class="n">format</span><span class="o">(</span><span class="s">&quot;The answer to {0} is {1}&quot;</span><span class="o">,</span>  <span class="s">&quot;everything&quot;</span><span class="o">,</span> <span class="mf">42.</span><span class="n">asInstanceOf</span><span class="o">[</span><span class="kt">AnyRef</span><span class="o">])</span>
</pre></div></div></div>
<div class="paragraph"><p>This is the case for any <span class="monospaced">Object</span> parameter, but it is most common with
varargs methods.</p></div>
</td>
</tr></table>
</div>
</div>
<div class="sect2">
<h3 id="_procedures">Procedures</h3>
<div class="paragraph"><p>A function that returns no value is called a <em>procedure</em> and should return
<span class="monospaced">Unit</span>. For example, the following procedure prints a string inside a box:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre> -------
 |Hello|
 -------</pre>
</div></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">def</span> <span class="n">box</span><span class="o">(</span><span class="n">s</span> <span class="k">:</span> <span class="kt">String</span><span class="o">)</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="o">{</span>
  <span class="k">val</span> <span class="n">border</span> <span class="k">=</span> <span class="s">&quot;-&quot;</span> <span class="o">*</span> <span class="n">s</span><span class="o">.</span><span class="n">length</span> <span class="o">+</span> <span class="s">&quot;--\n&quot;</span>
  <span class="n">println</span><span class="o">(</span><span class="n">border</span> <span class="o">+</span> <span class="s">&quot;|&quot;</span> <span class="o">+</span> <span class="n">s</span> <span class="o">+</span> <span class="s">&quot;|\n&quot;</span> <span class="o">+</span> <span class="n">border</span><span class="o">)</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Caution</div>
</td>
<td class="content">
<div class="paragraph"><p>Scala also supports a different (older), and more confusing, procedure notation,
one that has been deprecated and is slated for removal in an upcoming
version of Scala.</p></div>
<div class="paragraph"><p>If the function body is enclosed in braces <em>without</em> a preceding = symbol,
then the return type is <span class="monospaced">Unit</span>. For example, here&#8217;s the <span class="monospaced">box</span> function in
the older procedure notation:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">def</span> <span class="n">box</span><span class="o">(</span><span class="n">s</span> <span class="k">:</span> <span class="kt">String</span><span class="o">)</span> <span class="o">{</span> <span class="c1">// Look carefully: no =</span>
  <span class="k">val</span> <span class="n">border</span> <span class="k">=</span> <span class="s">&quot;-&quot;</span> <span class="o">*</span> <span class="n">s</span><span class="o">.</span><span class="n">length</span> <span class="o">+</span> <span class="s">&quot;--\n&quot;</span>
  <span class="n">println</span><span class="o">(</span><span class="n">border</span> <span class="o">+</span> <span class="s">&quot;|&quot;</span> <span class="o">+</span> <span class="n">s</span> <span class="o">+</span> <span class="s">&quot;|\n&quot;</span> <span class="o">+</span> <span class="n">border</span><span class="o">)</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>This older syntax is error-prone. It&#8217;s easy to overlook the missing <span class="monospaced">=</span>, and
it&#8217;s a common error to accidentally omit the = in a function
definition. You then get an error message at the point where the function
is called, and you are told that <span class="monospaced">Unit</span> is not acceptable at that location.</p></div>
<div class="paragraph"><p>That&#8217;s why the preferred (and soon to be only) syntax for a procedure is to
declare it as <em>explicitly</em> returning <span class="monospaced">Unit</span>.</p></div>
</td>
</tr></table>
</div>
</div>
<div class="sect2">
<h3 id="_lazy_values">Lazy Values</h3>
<div class="paragraph"><p>When a <span class="monospaced">val</span> is declared as lazy, its initialization is deferred until it
is accessed for the first time. For example,</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">lazy</span> <span class="k">val</span> <span class="n">words</span> <span class="k">=</span> <span class="n">scala</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="nc">Source</span><span class="o">.</span><span class="n">fromFile</span><span class="o">(</span><span class="s">&quot;/usr/share/dict/words&quot;</span><span class="o">).</span><span class="n">mkString</span>
</pre></div></div></div>
<div class="paragraph"><p>(The above call reads all characters from a file into a string. More on that
later.)</p></div>
<div class="paragraph"><p>If the program never accesses <span class="monospaced">words</span>, the file is never opened. To verify
this, try it out in the REPL, but misspell the file name. There will be no
error when the initialization statement is executed. However, when you
access words, you will get an error message that the file is not found.</p></div>
<div class="paragraph"><p>Lazy values are useful to delay costly initialization statements. They can
also deal with other initialization issues, such as circular dependencies.
Moreover, they are essential for developing lazy data structures, such as
Streams.</p></div>
<div class="paragraph"><p>You can think of lazy values as halfway between <span class="monospaced">val</span> and <span class="monospaced">def</span>. Compare:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">val</span> <span class="n">words</span> <span class="k">=</span> <span class="n">scala</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="nc">Source</span><span class="o">.</span><span class="n">fromFile</span><span class="o">(</span><span class="s">&quot;/usr/share/dict/words&quot;</span><span class="o">).</span><span class="n">mkString</span>
<span class="c1">// Evaluated as soon as words is defined</span>

<span class="k">lazy</span> <span class="k">val</span> <span class="n">words</span> <span class="k">=</span> <span class="n">scala</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="nc">Source</span><span class="o">.</span><span class="n">fromFile</span><span class="o">(</span><span class="s">&quot;/usr/share/dict/words&quot;</span><span class="o">).</span><span class="n">mkString</span>
<span class="c1">// Evaluated the first time words is used</span>

<span class="k">def</span> <span class="n">words</span> <span class="k">=</span> <span class="n">scala</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="nc">Source</span><span class="o">.</span><span class="n">fromFile</span><span class="o">(</span><span class="s">&quot;/usr/share/dict/words&quot;</span><span class="o">).</span><span class="n">mkString</span>
<span class="c1">// Evaluated every time words is used</span>
</pre></div></div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">Laziness is not cost-free. Every time a lazy value is accessed, a
method is called that checks, in a threadsafe manner, whether the value has
already been initialized.</td>
</tr></table>
</div>
</div>
<div class="sect2">
<h3 id="_exceptions">Exceptions</h3>
<div class="paragraph"><p>Scala exceptions work the same way as in Java or C++. When you throw an
exception, for example</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">throw</span> <span class="k">new</span> <span class="nc">IllegalArgumentException</span><span class="o">(</span><span class="s">&quot;x should not be negative&quot;</span><span class="o">)</span>
</pre></div></div></div>
<div class="paragraph"><p>the current computation is aborted, and the runtime system looks for an
exception handler that can accept an <span class="monospaced">IllegalArgumentException</span>. Control
resumes with the innermost such handler. If no such handler exists, the
program terminates.</p></div>
<div class="paragraph"><p>As in Java, the objects that you throw need to belong to a subclass of
<span class="monospaced">java.lang.Throwable</span>. However, unlike Java, Scala has no “checked”
exceptions. That is,
<strong>you never have to declare that a function or method might throw an exception.</strong></p></div>
<div class="paragraph"><p>A <span class="monospaced">throw</span> expression has the special type <span class="monospaced">Nothing</span>. This is useful in
<span class="monospaced">if/else</span> expressions. If one branch has type <span class="monospaced">Nothing</span>, the type of the
<span class="monospaced">if/else</span> expression is the type of the other branch. For example, consider:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">if</span> <span class="o">(</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">sqrt</span><span class="o">(</span><span class="n">x</span><span class="o">)</span>
<span class="o">}</span>
<span class="k">else</span> <span class="k">throw</span> <span class="k">new</span> <span class="nc">IllegalArgumentException</span><span class="o">(</span><span class="s">&quot;x should not be negative&quot;</span><span class="o">)</span>
</pre></div></div></div>
<div class="paragraph"><p>The first branch has type <span class="monospaced">Double</span>, and the second has type <span class="monospaced">Nothing</span>.
Therefore, the <span class="monospaced">if/else</span> expression also has type <span class="monospaced">Double</span>.</p></div>
<div class="paragraph"><p>The syntax for catching exceptions is modeled after the pattern matching
syntax, which we&#8217;ll discuss later. For now, just note the syntax:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">val</span> <span class="n">url</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">URL</span><span class="o">(</span><span class="s">&quot;http://horstmann.com/fred-tiny.gif&quot;</span><span class="o">)</span>
<span class="k">try</span> <span class="o">{</span>
  <span class="n">process</span><span class="o">(</span><span class="n">url</span><span class="o">)</span>
<span class="o">}</span>
<span class="k">catch</span> <span class="o">{</span>
  <span class="k">case</span> <span class="k">_:</span> <span class="kt">MalformedURLException</span> <span class="o">=&gt;</span> <span class="n">println</span><span class="o">(</span><span class="s">&quot;Bad URL: &quot;</span> <span class="o">+</span> <span class="n">url</span><span class="o">)</span>
  <span class="k">case</span> <span class="n">ex</span><span class="k">:</span> <span class="kt">IOException</span> <span class="o">=&gt;</span> <span class="n">ex</span><span class="o">.</span><span class="n">printStackTrace</span><span class="o">()</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>As in Java or C++, the more general exception types should come after the
more specific ones.</p></div>
<div class="paragraph"><p>Note that you can use _ for the variable name if you don’t need it.</p></div>
<div class="paragraph"><p>The <span class="monospaced">try/finally</span> statement lets you dispose of a resource whether or not
an exception has occurred. For example:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">var</span> <span class="n">in</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">URL</span><span class="o">(</span><span class="s">&quot;http://horstmann.com/fred.gif&quot;</span><span class="o">).</span><span class="n">openStream</span><span class="o">()</span>
<span class="k">try</span> <span class="o">{</span>
  <span class="n">process</span><span class="o">(</span><span class="n">in</span><span class="o">)</span>
<span class="o">}</span>
<span class="k">finally</span> <span class="o">{</span>
  <span class="n">in</span><span class="o">.</span><span class="n">close</span><span class="o">()</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>The <span class="monospaced">finally</span> clause is executed whether or not the process function throws
an exception. The reader is always closed.</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="lesson-03-working-with-arrays">Working with Arrays</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_lesson_objectives_4">Lesson Objectives</h3>
<div class="paragraph"><p>In this lesson, we will explore Scala arrays. Java and C++ programmers
usually choose an array (or an array-like collection) when they need to
collect a group of elements. In Scala, there are other choices, which
we&#8217;ll get to later. For now, let&#8217;s spend a little time with arrays.</p></div>
</div>
<div class="sect2">
<h3 id="_summary_2">Summary</h3>
<div class="paragraph"><p>Use an Array if the length is fixed, and an ArrayBuffer if the length can vary.</p></div>
<div class="ulist"><ul>
<li>
<p>
Don’t use <span class="monospaced">new</span> when supplying initial values.
</p>
</li>
<li>
<p>
Use <span class="monospaced">()</span> (<strong>not</strong> <span class="monospaced">[]</span>) to access elements.
</p>
</li>
<li>
<p>
Use <span class="monospaced">for (elem &lt;- arr)</span> to traverse the elements.
</p>
</li>
<li>
<p>
Use <span class="monospaced">for (elem &lt;- arr if ... ) ... yield ...</span> to transform into a new
  array.
</p>
</li>
<li>
<p>
Scala and Java arrays are interoperable; with <span class="monospaced">ArrayBuffer</span>, use
  <span class="monospaced">scala.collection.JavaConversions</span>.
</p>
</li>
</ul></div>
</div>
<div class="sect2">
<h3 id="_fixed_length_arrays">Fixed-length Arrays</h3>
<div class="paragraph"><p>If you need an array of fixed length, use the <span class="monospaced">Array</span> type:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">val</span> <span class="n">nums</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">Array</span><span class="o">[</span><span class="kt">Int</span><span class="o">](</span><span class="mi">10</span><span class="o">)</span>
<span class="c1">// An array of ten integers, all initialized with zero</span>
<span class="k">val</span> <span class="n">a</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">Array</span><span class="o">[</span><span class="kt">String</span><span class="o">](</span><span class="mi">10</span><span class="o">)</span>
<span class="c1">// A string array with ten elements, all initialized with null</span>
<span class="k">val</span> <span class="n">s</span> <span class="k">=</span> <span class="nc">Array</span><span class="o">(</span><span class="s">&quot;Hello&quot;</span><span class="o">,</span> <span class="s">&quot;World&quot;</span><span class="o">)</span>
<span class="c1">// An Array[String] of length 2—the type is inferred</span>
<span class="c1">// Note: No *new* when you supply initial values</span>
<span class="n">s</span><span class="o">(</span><span class="mi">0</span><span class="o">)</span> <span class="k">=</span> <span class="s">&quot;Goodbye&quot;</span>
<span class="c1">// Array(&quot;Goodbye&quot;, &quot;World&quot;)</span>
<span class="c1">// Use () instead of [] to access elements</span>
</pre></div></div></div>
<div class="paragraph"><p>In the JVM (i.e., the compiled bytecode), a Scala <span class="monospaced">Array</span> is implemented as
a Java array. In the preceding example, the type of each of the arrays is
<span class="monospaced">java.lang.String[]</span> at runtime. An array of <span class="monospaced">Int</span>, <span class="monospaced">Double</span>, or another
equivalent of the Java primitives becomes a primitive type array at runtime.
For instance, the Scala array <span class="monospaced">Array(2,3,5,7,11)</span> is an <span class="monospaced">int[]</span> at runtime.</p></div>
</div>
<div class="sect2">
<h3 id="_lab_swapping_array_elements">Lab: swapping array elements</h3>
<div class="paragraph"><p>Open
<span class="monospaced">labs/src/main/scala/com/newcircle/arrays/SwapAdjacentArrayElements.scala</span>.
In that file is a class, <span class="monospaced">SwapAdjacentArrayElements</span>, containing two
functions you need to fill out.</p></div>
<div class="ulist"><ul>
<li>
<p>
<span class="monospaced">swapInPlace()</span> should take an array of integers and swap adjacent elements
  in place. For instance it should convert <span class="monospaced">Array(1, 2, 3, 4, 5)</span> to
  <span class="monospaced">Array(2, 1, 4, 3, 5)</span>.
</p>
</li>
<li>
<p>
<span class="monospaced">swapToNewArray()</span> should take an array of integers and do the same swapping
  operation, returning a <em>new</em> array with the rearranged contents.
</p>
</li>
</ul></div>
<div class="paragraph"><p>There&#8217;s an existing tester. Run it, from SBT, as follows:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>&gt; test-only com.newcircle.tests.arrays.SwapAdjacentArrayElementsSpec</pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_variable_length_arrays_array_buffers">Variable-length Arrays: Array Buffers</h3>
<div class="paragraph"><p>Java has <span class="monospaced">ArrayList</span>, and C++ has <span class="monospaced">vector</span>, for arrays that grow and shrink on
demand. The equivalent in Scala is <span class="monospaced">ArrayBuffer</span>.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">import</span> <span class="nn">scala.collection.mutable.ArrayBuffer</span>
<span class="k">val</span> <span class="n">b</span> <span class="k">=</span> <span class="nc">ArrayBuffer</span><span class="o">[</span><span class="kt">Int</span><span class="o">]()</span>
<span class="c1">// Or new ArrayBuffer[Int]</span>
<span class="c1">// An empty array buffer, ready to hold integers</span>
<span class="n">b</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="c1">// ArrayBuffer(1)</span>
<span class="c1">// Add an element at the end with +=</span>
<span class="n">b</span> <span class="o">+=</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">5</span><span class="o">)</span>
<span class="c1">// ArrayBuffer(1, 1, 2, 3, 5)</span>
<span class="c1">// Add multiple elements at the end by enclosing them in parentheses</span>
<span class="n">b</span> <span class="o">++=</span> <span class="nc">Array</span><span class="o">(</span><span class="mi">8</span><span class="o">,</span> <span class="mi">13</span><span class="o">,</span> <span class="mi">21</span><span class="o">)</span>
<span class="c1">// ArrayBuffer(1, 1, 2, 3, 5, 8, 13, 21)</span>
<span class="c1">// You can append any collection with the ++= operator</span>
<span class="n">b</span><span class="o">.</span><span class="n">trimEnd</span><span class="o">(</span><span class="mi">5</span><span class="o">)</span>
<span class="c1">// ArrayBuffer(1, 1, 2)</span>
<span class="c1">// Removes the last five elements</span>
</pre></div></div></div>
<div class="paragraph"><p>An <span class="monospaced">ArrayBuffer</span> is optimized for adding and removing at the <em>end</em> of the list.</p></div>
<div class="paragraph"><p>You <em>can</em> insert or remove elements from any location in the buffer, but
doing so is less efficient, since the elements after the location have to be
shifted.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="n">b</span><span class="o">.</span><span class="n">insert</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="mi">6</span><span class="o">)</span>
<span class="c1">// ArrayBuffer(1, 1, 6, 2)</span>
<span class="c1">// Insert before index 2</span>
<span class="n">b</span><span class="o">.</span><span class="n">insert</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="mi">7</span><span class="o">,</span> <span class="mi">8</span><span class="o">,</span> <span class="mi">9</span><span class="o">)</span>
<span class="c1">// ArrayBuffer(1, 1, 7, 8, 9, 6, 2)</span>
<span class="c1">// You can insert as many elements as you like</span>
<span class="n">b</span><span class="o">.</span><span class="n">remove</span><span class="o">(</span><span class="mi">2</span><span class="o">)</span>
<span class="c1">// ArrayBuffer(1, 1, 8, 9, 6, 2)</span>
<span class="n">b</span><span class="o">.</span><span class="n">remove</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">)</span>
<span class="c1">// ArrayBuffer(1, 1, 2)</span>
<span class="c1">// The second parameter tells how many elements to remove</span>
</pre></div></div></div>
<div class="paragraph"><p>If you want to build an array dynamically, but fix its size once it&#8217;s built,
use an <span class="monospaced">ArrayBuffer</span> and convert it, at the end, to an <span class="monospaced">Array</span>.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">import</span> <span class="nn">scala.io.Source</span>
<span class="k">import</span> <span class="nn">scala.collection.mutable.ArrayBuffer</span>

<span class="k">val</span> <span class="n">path</span> <span class="k">=</span> <span class="s">&quot;...&quot;</span>
<span class="k">val</span> <span class="n">buf</span> <span class="k">=</span> <span class="nc">ArrayBuffer</span><span class="o">[</span><span class="kt">String</span><span class="o">]()</span>
<span class="k">for</span> <span class="o">{</span> <span class="n">line</span> <span class="k">&lt;-</span> <span class="nc">Source</span><span class="o">.</span><span class="n">fromFile</span><span class="o">(</span><span class="n">path</span><span class="o">).</span><span class="n">getLines</span>
      <span class="n">stripped</span> <span class="k">=</span> <span class="n">line</span><span class="o">.</span><span class="n">trim</span><span class="o">()</span> <span class="k">if</span> <span class="o">!</span><span class="n">stripped</span><span class="o">.</span><span class="n">startsWith</span><span class="o">(</span><span class="s">&quot;#&quot;</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="n">stripped</span><span class="o">.</span><span class="n">length</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">}</span>
  <span class="n">buf</span> <span class="o">+=</span> <span class="n">stripped</span>

<span class="k">val</span> <span class="n">lines</span> <span class="k">=</span> <span class="n">buf</span><span class="o">.</span><span class="n">toArray</span>
</pre></div></div></div>
<div class="paragraph"><p>(As it happens, there&#8217;s a more idiomatic way to do that, but we&#8217;ll get to that
later.)</p></div>
<div class="paragraph"><p>You can also convert an array to an <span class="monospaced">ArrayBuffer</span> by calling <span class="monospaced">toBuffer</span> on
the array.</p></div>
</div>
<div class="sect2">
<h3 id="_traversing_arrays_and_array_buffers">Traversing Arrays and Array Buffers</h3>
<div class="paragraph"><p>In Java and C++, there are several syntactical differences between arrays
and array lists/vectors. Scala is much more uniform. Most of the time, you
can use the same code for both.</p></div>
<div class="paragraph"><p>Here is one (naive) way to traverse an array or array buffer with a <span class="monospaced">for</span>
loop:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">for</span> <span class="o">(</span><span class="n">i</span> <span class="k">&lt;-</span> <span class="mi">0</span> <span class="n">until</span> <span class="n">a</span><span class="o">.</span><span class="n">length</span><span class="o">)</span>
  <span class="n">println</span><span class="o">(</span><span class="n">i</span> <span class="o">+</span> <span class="s">&quot;: &quot;</span> <span class="o">+</span> <span class="n">a</span><span class="o">(</span><span class="n">i</span><span class="o">))</span>
</pre></div></div></div>
<div class="paragraph"><p>The variable i goes from 0 to <span class="monospaced">a.length - 1</span>.</p></div>
<div class="paragraph"><p>To visit every second element, use:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="mi">0</span> <span class="n">until</span> <span class="o">(</span><span class="n">a</span><span class="o">.</span><span class="n">length</span><span class="o">,</span> <span class="mi">2</span><span class="o">)</span> <span class="c1">// Range(0, 2, 4, ...)</span>
</pre></div></div></div>
<div class="paragraph"><p>To visit the elements starting from the end of the array, use:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="o">(</span><span class="mi">0</span> <span class="n">until</span> <span class="n">a</span><span class="o">.</span><span class="n">length</span><span class="o">).</span><span class="n">reverse</span> <span class="c1">// Range(..., 2, 1, 0)</span>
</pre></div></div></div>
<div class="paragraph"><p>If you don’t need the array index in the loop body, there&#8217;s a much easier
and more readable construct:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">for</span> <span class="o">(</span><span class="n">elem</span> <span class="k">&lt;-</span> <span class="n">a</span><span class="o">)</span>
  <span class="n">println</span><span class="o">(</span><span class="n">elem</span><span class="o">)</span>
</pre></div></div></div>
<div class="paragraph"><p>This is very similar to the “enhanced” for loop in Java or the
“range-based” for loop in C++.</p></div>
</div>
<div class="sect2">
<h3 id="_span_class_monospaced_take_span_and_span_class_monospaced_drop_span"><span class="monospaced">take</span> and <span class="monospaced">drop</span></h3>
<div class="paragraph"><p>You can also use the built-in functions <span class="monospaced">take</span> and <span class="monospaced">drop</span> to transform
arrays into new arrays.</p></div>
<div class="paragraph"><p><span class="monospaced">take</span> takes up to the first <em>n</em> elements of an array and returns those
elements in a new array. For instance:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">val</span> <span class="n">a</span> <span class="k">=</span> <span class="nc">Array</span><span class="o">(</span><span class="s">&quot;Alice&quot;</span><span class="o">,</span> <span class="s">&quot;Bob&quot;</span><span class="o">,</span> <span class="s">&quot;Carol&quot;</span><span class="o">)</span>
<span class="n">a</span><span class="o">.</span><span class="n">take</span><span class="o">(</span><span class="mi">1</span><span class="o">)</span>   <span class="c1">// returns Array(&quot;Alice&quot;)</span>
<span class="n">a</span><span class="o">.</span><span class="n">take</span><span class="o">(</span><span class="mi">0</span><span class="o">)</span>   <span class="c1">// returns Array()</span>
<span class="n">a</span><span class="o">.</span><span class="n">take</span><span class="o">(</span><span class="mi">300</span><span class="o">)</span> <span class="c1">// returns Array(&quot;Alice&quot;, &quot;Bob&quot;, &quot;Carol&quot;), but as a copy</span>
</pre></div></div></div>
<div class="paragraph"><p>There&#8217;s a corresponding <span class="monospaced">drop</span> function that drops up to the first <em>n</em>
elements, returning a new array.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">val</span> <span class="n">a</span> <span class="k">=</span> <span class="nc">Array</span><span class="o">(</span><span class="s">&quot;Alice&quot;</span><span class="o">,</span> <span class="s">&quot;Bob&quot;</span><span class="o">,</span> <span class="s">&quot;Carol&quot;</span><span class="o">)</span>
<span class="n">a</span><span class="o">.</span><span class="n">drop</span><span class="o">(</span><span class="mi">1</span><span class="o">)</span>   <span class="c1">// returns Array(&quot;Bob&quot;, &quot;Carol&quot;)</span>
<span class="n">a</span><span class="o">.</span><span class="n">drop</span><span class="o">(</span><span class="mi">0</span><span class="o">)</span>   <span class="c1">// returns Array(&quot;Alice&quot;, &quot;Bob&quot;, &quot;Carol&quot;), but as a copy</span>
<span class="n">a</span><span class="o">.</span><span class="n">drop</span><span class="o">(</span><span class="mi">30</span><span class="o">)</span>  <span class="c1">// returns Array()</span>
</pre></div></div></div>
<div class="paragraph"><p>As we&#8217;ll see later, <span class="monospaced">take</span> and <span class="monospaced">drop</span> aren&#8217;t limited to arrays.</p></div>
</div>
<div class="sect2">
<h3 id="_transforming_arrays">Transforming Arrays</h3>
<div class="paragraph"><p>So far, we haven&#8217;t done anything especially unique. Though the above array
accesses use slightly different syntax than Java, they&#8217;re not that much
different, really.</p></div>
<div class="paragraph"><p>But Scala doesn&#8217;t stop there.</p></div>
<div class="paragraph"><p>In Scala, it&#8217;s extremely easy to take an array (or array buffer) and
transform it, using <span class="monospaced">yield</span>.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">val</span> <span class="n">a</span> <span class="k">=</span> <span class="nc">Array</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">5</span><span class="o">,</span> <span class="mi">7</span><span class="o">,</span> <span class="mi">11</span><span class="o">)</span>
<span class="k">val</span> <span class="n">result</span> <span class="k">=</span> <span class="k">for</span> <span class="o">(</span><span class="n">elem</span> <span class="k">&lt;-</span> <span class="n">a</span><span class="o">)</span> <span class="k">yield</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">elem</span>
<span class="c1">// result is Array(4, 6, 10, 14, 22)</span>
</pre></div></div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">Such transformations don&#8217;t modify the original array; they yield a
new one.</td>
</tr></table>
</div>
<div class="paragraph"><p>The <span class="monospaced">for (...) yield</span> loop creates a new collection of the same type as the
original collection. If you started with an array, you get another array.
If you started with an array buffer, that’s what you get.</p></div>
<div class="paragraph"><p>The result contains the expressions after the <span class="monospaced">yield</span>, one for each
iteration of the loop.</p></div>
<div class="paragraph"><p>Again, you can use a guard to filter elements based on boolean conditions.
For example:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="c1">// Keep only the even elements, then double them.</span>
<span class="k">for</span> <span class="o">(</span><span class="n">elem</span> <span class="k">&lt;-</span> <span class="n">a</span> <span class="k">if</span> <span class="n">elem</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="k">yield</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">elem</span>
</pre></div></div></div>
<div class="paragraph"><p>These techniques also work on collections, which we&#8217;ll discuss later.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph"><p>When we discuss higher-order functions, we&#8217;ll see another way to transform
arrays, array buffers and collections, using special <span class="monospaced">map()</span> and <span class="monospaced">filter()</span>
methods.</p></div>
</td>
</tr></table>
</div>
</div>
<div class="sect2">
<h3 id="_common_algorithms">Common Algorithms</h3>
<div class="paragraph"><p>It is often said that a large percentage of business computations are
nothing but computing sums and sorting. Fortunately, Scala has built-in
functions for these tasks.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="nc">Array</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">7</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">9</span><span class="o">).</span><span class="n">sum</span>
<span class="c1">// 19</span>
<span class="c1">// Works for ArrayBuffer too</span>
</pre></div></div></div>
<div class="paragraph"><p>In order to use the <span class="monospaced">sum</span> method, the element type must be a numeric type:
either an integral or floating-point type or <span class="monospaced">BigInteger</span>/<span class="monospaced">BigDecimal</span>.</p></div>
<div class="paragraph"><p>Similarly, the <span class="monospaced">min</span> and <span class="monospaced">max</span> methods yield the smallest and largest element
in an array or array buffer.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="nc">ArrayBuffer</span><span class="o">(</span><span class="s">&quot;Mary&quot;</span><span class="o">,</span> <span class="s">&quot;had&quot;</span><span class="o">,</span> <span class="s">&quot;a&quot;</span><span class="o">,</span> <span class="s">&quot;little&quot;</span><span class="o">,</span> <span class="s">&quot;lamb&quot;</span><span class="o">).</span><span class="n">max</span>
<span class="c1">// &quot;little&quot;</span>
</pre></div></div></div>
<div class="paragraph"><p>The <span class="monospaced">sorted</span> method sorts an array or array buffer and returns the sorted
array or array buffer, without modifying the original:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">val</span> <span class="n">b</span> <span class="k">=</span> <span class="nc">ArrayBuffer</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">7</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">9</span><span class="o">)</span>
<span class="k">val</span> <span class="n">bSorted</span> <span class="k">=</span> <span class="n">b</span><span class="o">.</span><span class="n">sorted</span>
<span class="c1">// b is unchanged; bSorted is ArrayBuffer(1, 2, 7, 9)</span>
</pre></div></div></div>
<div class="paragraph"><p>You can also supply a comparison function, but then you use the <span class="monospaced">sortWith</span>
method:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">val</span> <span class="n">bDescending</span> <span class="k">=</span> <span class="n">b</span><span class="o">.</span><span class="n">sortWith</span><span class="o">((</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="n">a</span> <span class="o">&gt;</span> <span class="n">b</span><span class="o">)</span> <span class="c1">// ArrayBuffer(9, 7, 2, 1)</span>
</pre></div></div></div>
<div class="paragraph"><p>We&#8217;ll talk more about the function syntax in a bit.</p></div>
<div class="paragraph"><p>You can sort an array, but not an array buffer, in place:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">val</span> <span class="n">a</span> <span class="k">=</span> <span class="nc">Array</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">7</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">9</span><span class="o">)</span>
<span class="n">scala</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="nc">Sorting</span><span class="o">.</span><span class="n">quickSort</span><span class="o">(</span><span class="n">a</span><span class="o">)</span>
<span class="c1">// a is now Array(1, 2, 7, 9)</span>
</pre></div></div></div>
<div class="paragraph"><p>For the <span class="monospaced">min</span>, <span class="monospaced">max</span>, and <span class="monospaced">quickSort</span> methods, the element type must have a
comparison operation. This is the case for numbers, strings, and other
types with the <span class="monospaced">Ordered</span> trait.</p></div>
<div class="paragraph"><p>Finally, if you want to display the contents of an array or array buffer,
the <span class="monospaced">mkString</span> method lets you specify the separator between elements. A
second variant has parameters for the prefix and suffix. For example,</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="n">a</span><span class="o">.</span><span class="n">mkString</span><span class="o">(</span><span class="s">&quot; and &quot;</span><span class="o">)</span>        <span class="c1">// &quot;1 and 2 and 7 and 9&quot;</span>
<span class="n">a</span><span class="o">.</span><span class="n">mkString</span><span class="o">(</span><span class="s">&quot;&lt;&quot;</span><span class="o">,</span> <span class="s">&quot;,&quot;</span><span class="o">,</span> <span class="s">&quot;&gt;&quot;</span><span class="o">)</span>  <span class="c1">// &quot;&lt;1,2,7,9&gt;&quot;</span>
</pre></div></div></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="n">a</span><span class="o">.</span><span class="n">toString</span> <span class="c1">// &quot;[I@b73e5&quot;</span>
           <span class="c1">// This is the useless Array.toString method from Java</span>
<span class="n">b</span><span class="o">.</span><span class="n">toString</span> <span class="c1">// &quot;ArrayBuffer(1, 7, 2, 9)&quot;</span>
           <span class="c1">// ArrayBuffer.toString shows the type, which is useful for debugging</span>
</pre></div></div></div>
</div>
<div class="sect2">
<h3 id="_lab_common_algorithms">Lab: common algorithms</h3>
<div class="paragraph"><p>Open
<span class="monospaced">labs/src/main/scala/com/newcircle/arrays/CommonArrayAlgorithms.scala</span>.
In that file is a class, <span class="monospaced">CommonArrayAlgorithms</span>, containing two
functions you need to fill out.</p></div>
<div class="ulist"><ul>
<li>
<p>
<span class="monospaced">average()</span> must take an array of <span class="monospaced">Double</span> objects and return the average
  (mean). Hint: This is a one-line function.
</p>
</li>
<li>
<p>
<span class="monospaced">reverseSort()</span> takes an array of integers and sorts them in reverse
  order. Solve this lab <em>without</em> using a comparison function.
</p>
</li>
</ul></div>
<div class="paragraph"><p>There&#8217;s an existing tester. Run it, from SBT, as follows:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>&gt; test-only com.newcircle.tests.arrays.CommonArrayAlgorithmsSpec</pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_multidimensional_arrays">Multidimensional Arrays</h3>
<div class="paragraph"><p>Like in Java, multidimensional arrays are implemented as arrays of arrays.
For example, a two-dimensional array of <span class="monospaced">Double</span> values has the type
<span class="monospaced">Array[Array[Double]]</span>. To construct such an array, use the <span class="monospaced">ofDim</span> method:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">val</span> <span class="n">matrix</span> <span class="k">=</span> <span class="nc">Array</span><span class="o">.</span><span class="n">ofDim</span><span class="o">[</span><span class="kt">Double</span><span class="o">](</span><span class="mi">3</span><span class="o">,</span> <span class="mi">4</span><span class="o">)</span> <span class="c1">// Three rows, four columns</span>
</pre></div></div></div>
<div class="paragraph"><p>To access an element, use two pairs of parentheses:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="n">matrix</span><span class="o">(</span><span class="n">row</span><span class="o">)(</span><span class="n">column</span><span class="o">)</span> <span class="k">=</span> <span class="mi">42</span>
</pre></div></div></div>
<div class="paragraph"><p>You can make ragged arrays, with varying row lengths:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">val</span> <span class="n">triangle</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">Array</span><span class="o">[</span><span class="kt">Array</span><span class="o">[</span><span class="kt">Int</span><span class="o">]](</span><span class="mi">10</span><span class="o">)</span>
<span class="k">for</span> <span class="o">(</span><span class="n">i</span> <span class="k">&lt;-</span> <span class="mi">0</span> <span class="n">until</span> <span class="n">triangle</span><span class="o">.</span><span class="n">length</span><span class="o">)</span>
  <span class="n">triangle</span><span class="o">(</span><span class="n">i</span><span class="o">)</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">Array</span><span class="o">[</span><span class="kt">Int</span><span class="o">](</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="o">)</span>
</pre></div></div></div>
</div>
<div class="sect2">
<h3 id="_interoperating_with_java">Interoperating with Java</h3>
<div class="paragraph"><p>Since Scala arrays are implemented as Java arrays, you can pass them back
and forth between Java and Scala.</p></div>
<div class="paragraph"><p>If you call a Java method that receives or returns a <span class="monospaced">java.util.List</span>, you
could, of course, use a Java <span class="monospaced">ArrayList</span> in your Scala code. However,
doing so is:</p></div>
<div class="ulist"><ul>
<li>
<p>
unattractive
</p>
</li>
<li>
<p>
less powerful (<span class="monospaced">java.util.ArrayList</span> doesn&#8217;t have most of the useful methods
  Scala provides in its collections)
</p>
</li>
<li>
<p>
non-idiomatic
</p>
</li>
</ul></div>
<div class="paragraph"><p>Instead, import the implicit conversion methods in
<span class="monospaced">scala.collection.JavaConversions</span>. Then you can use Scala buffers in your
code, and they automatically get wrapped into Java lists when calling a
Java method.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph"><p><strong>Implicits are magic (for now)</strong></p></div>
<div class="paragraph"><p>We&#8217;ll discuss implicits in greater detail later. For now, though, just
think of them as magic wands that automatically augment certain classes
with new methods.</p></div>
</td>
</tr></table>
</div>
<div class="paragraph"><p>For example, the <span class="monospaced">java.lang.ProcessBuilder</span> class has a constructor with a
<span class="monospaced">List&lt;String&gt;</span> parameter. Here is how you can call it from Scala:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">import</span> <span class="nn">scala.collection.JavaConversions.bufferAsJavaList</span>
<span class="k">import</span> <span class="nn">scala.collection.mutable.ArrayBuffer</span>
<span class="k">val</span> <span class="n">command</span> <span class="k">=</span> <span class="nc">ArrayBuffer</span><span class="o">(</span><span class="s">&quot;ls&quot;</span><span class="o">,</span> <span class="s">&quot;-al&quot;</span><span class="o">,</span> <span class="s">&quot;/home/cay&quot;</span><span class="o">)</span>
<span class="k">val</span> <span class="n">pb</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">ProcessBuilder</span><span class="o">(</span><span class="n">command</span><span class="o">)</span> <span class="c1">// Scala to Java</span>
</pre></div></div></div>
<div class="paragraph"><p>Because the implicit <span class="monospaced">bufferAsJavaList</span> has been brought into scope, the
Scala buffer is automatically wrapped into an object of a Java class that
implements the <span class="monospaced">java.util.List</span> interface.</p></div>
<div class="paragraph"><p>Conversely, when a Java method returns a <span class="monospaced">java.util.List</span>, you can have it
automatically converted into a <span class="monospaced">Buffer</span>:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">import</span> <span class="nn">scala.collection.JavaConversions.asScalaBuffer</span>
<span class="k">import</span> <span class="nn">scala.collection.mutable.Buffer</span>
<span class="k">val</span> <span class="n">cmd</span> <span class="k">:</span> <span class="kt">Buffer</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span> <span class="n">pb</span><span class="o">.</span><span class="n">command</span><span class="o">()</span> <span class="c1">// Java to Scala</span>
<span class="c1">// You can&#39;t use ArrayBuffer—the wrapped object is only guaranteed to be a Buffer</span>
</pre></div></div></div>
<div class="paragraph"><p>If the Java method returns a wrapped Scala buffer, then the implicit
conversion unwraps the original object.</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="lesson-04-maps-and-tuples">Maps and Tuples</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_lesson_objectives_5">Lesson Objectives</h3>
<div class="paragraph"><p><em>If you can only have one data structure, make it a hash table.</em> —Old Programmer Saying</p></div>
<div class="paragraph"><p>Hash tables—or, more generally, maps—are among the most versatile data
structures. As you will see in this lesson, Scala makes it particularly
easy to use them.</p></div>
<div class="paragraph"><p>Maps are collections of key/value pairs. Nearly all modern programming
languages provide some kind of support for maps, whether directly in syntax
or via a library (or both).</p></div>
<div class="ulist"><ul>
<li>
<p>
Python calls them <em>dictionaries</em>. So does C#.
</p>
</li>
<li>
<p>
Ruby and Perl call them <em>hashes</em>.
</p>
</li>
<li>
<p>
Java and Scala call them <em>maps</em>.
</p>
</li>
</ul></div>
<div class="paragraph"><p>Scala also has a general notion of tuples—read-only aggregates of <em>n</em>
objects, not necessarily of the same type. A pair is simply a tuple with
<em>n</em> = 2. Tuples are useful whenever you need to aggregate two or more
values together, and we briefly discuss the syntax at the end of this
lesson.</p></div>
</div>
<div class="sect2">
<h3 id="_summary_3">Summary</h3>
<div class="ulist"><ul>
<li>
<p>
Scala has a pleasant syntax for creating, querying, and traversing maps.
</p>
</li>
<li>
<p>
You need to choose between mutable and immutable maps.
</p>
</li>
<li>
<p>
By default, you get a hash map, but you can also get a tree map.
</p>
</li>
<li>
<p>
You can easily convert between Scala and Java maps.
</p>
</li>
<li>
<p>
Tuples are useful for aggregating values.
</p>
</li>
</ul></div>
</div>
<div class="sect2">
<h3 id="_constructing_a_map">Constructing a Map</h3>
<div class="paragraph"><p>The simplest way to construct a map is as follows:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">val</span> <span class="n">scores</span> <span class="k">=</span> <span class="nc">Map</span><span class="o">(</span><span class="s">&quot;Alice&quot;</span> <span class="o">-&gt;</span> <span class="mi">10</span><span class="o">,</span> <span class="s">&quot;Bob&quot;</span> <span class="o">-&gt;</span> <span class="mi">3</span><span class="o">,</span> <span class="s">&quot;Cindy&quot;</span> <span class="o">-&gt;</span> <span class="mi">8</span><span class="o">)</span>
</pre></div></div></div>
<div class="paragraph"><p>This constructs an immutable <span class="monospaced">Map[String, Int]</span> whose contents can’t be
changed.</p></div>
<div class="paragraph"><p>If you want a mutable map, use:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">val</span> <span class="n">scores</span> <span class="k">=</span> <span class="n">scala</span><span class="o">.</span><span class="n">collection</span><span class="o">.</span><span class="n">mutable</span><span class="o">.</span><span class="nc">Map</span><span class="o">(</span><span class="s">&quot;Alice&quot;</span> <span class="o">-&gt;</span> <span class="mi">10</span><span class="o">,</span> <span class="s">&quot;Bob&quot;</span> <span class="o">-&gt;</span> <span class="mi">3</span><span class="o">,</span> <span class="s">&quot;Cindy&quot;</span> <span class="o">-&gt;</span> <span class="mi">8</span><span class="o">)</span>
</pre></div></div></div>
<div class="paragraph"><p>If you want to start out with an empty map, you have to supply type parameters.
There are two ways to do it:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="nc">Map</span><span class="o">[</span><span class="kt">String</span>, <span class="kt">Int</span><span class="o">]()</span>
<span class="nc">Map</span><span class="o">.</span><span class="n">empty</span><span class="o">[</span><span class="kt">String</span>, <span class="kt">Int</span><span class="o">]</span>
</pre></div></div></div>
<div class="paragraph"><p>In Scala, a map is a collection of pairs. A pair is simply a grouping of
two values, not necessarily of the same type, such as <span class="monospaced">("Alice", 10)</span>.</p></div>
<div class="paragraph"><p>Formally, this pair is a 2-tuple, an instance of the <span class="monospaced">Tuple2</span> class. Thus,
<span class="monospaced">("Alice", 10)</span> has the type <span class="monospaced">Tuple2[String, Int]</span>.</p></div>
<div class="paragraph"><p>Scala has two ways to create a pair:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="s">&quot;Alice&quot;</span> <span class="o">-&gt;</span> <span class="mi">10</span>   <span class="c1">// using the -&gt; operator</span>
<span class="o">(</span><span class="s">&quot;Alice&quot;</span><span class="o">,</span> <span class="mi">10</span><span class="o">)</span>   <span class="c1">// using the 2-tuple syntax</span>
</pre></div></div></div>
<div class="paragraph"><p>This means there are two equivalent ways to define our original map:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">val</span> <span class="n">scores</span> <span class="k">=</span> <span class="nc">Map</span><span class="o">(</span><span class="s">&quot;Alice&quot;</span> <span class="o">-&gt;</span> <span class="mi">10</span><span class="o">,</span> <span class="s">&quot;Bob&quot;</span> <span class="o">-&gt;</span> <span class="mi">3</span><span class="o">,</span> <span class="s">&quot;Cindy&quot;</span> <span class="o">-&gt;</span> <span class="mi">8</span><span class="o">)</span>
<span class="k">val</span> <span class="n">scores</span> <span class="k">=</span> <span class="nc">Map</span><span class="o">((</span><span class="s">&quot;Alice&quot;</span><span class="o">,</span> <span class="mi">10</span><span class="o">),</span> <span class="o">(</span><span class="s">&quot;Bob&quot;</span><span class="o">,</span> <span class="mi">3</span><span class="o">),</span> <span class="o">(</span><span class="s">&quot;Cindy&quot;</span><span class="o">,</span> <span class="mi">8</span><span class="o">))</span>
</pre></div></div></div>
<div class="paragraph"><p>The <span class="monospaced">-&gt;</span> operator is just a little easier on the eyes than the parentheses.
It also supports the intuition that a map data structure is a kind of
function that maps keys to values. The difference is that a function
computes values, and a map just looks them up.</p></div>
</div>
<div class="sect2">
<h3 id="_accessing_map_values">Accessing Map Values</h3>
<div class="paragraph"><p>In Scala, the analogy between functions and maps is particularly close
because you use the <span class="monospaced">()</span> notation to look up key values.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">val</span> <span class="n">bobsScore</span> <span class="k">=</span> <span class="n">scores</span><span class="o">(</span><span class="s">&quot;Bob&quot;</span><span class="o">)</span> <span class="c1">// Like scores.get(&quot;Bob&quot;) in Java</span>
</pre></div></div></div>
<div class="paragraph"><p>If the map doesn’t contain a value for the requested key, an exception is
thrown.</p></div>
<div class="paragraph"><p>To check whether there is a key with the given value, call the <span class="monospaced">contains</span>
method:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">val</span> <span class="n">bobsScore</span> <span class="k">=</span> <span class="k">if</span> <span class="o">(</span><span class="n">scores</span><span class="o">.</span><span class="n">contains</span><span class="o">(</span><span class="s">&quot;Bob&quot;</span><span class="o">))</span> <span class="n">scores</span><span class="o">(</span><span class="s">&quot;Bob&quot;</span><span class="o">)</span> <span class="k">else</span> <span class="mi">0</span>
</pre></div></div></div>
<div class="paragraph"><p>Since this call combination is so common, there is a shortcut:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">val</span> <span class="n">bobsScore</span> <span class="k">=</span> <span class="n">scores</span><span class="o">.</span><span class="n">getOrElse</span><span class="o">(</span><span class="s">&quot;Bob&quot;</span><span class="o">,</span> <span class="mi">0</span><span class="o">)</span>
<span class="c1">// If the map contains the key &quot;Bob&quot;, return the value; otherwise, return 0.</span>
</pre></div></div></div>
<div class="paragraph"><p>Finally, the call <span class="monospaced">map.get(key)</span> returns an <span class="monospaced">Option</span> object that is either
<span class="monospaced">Some(value)</span> or <span class="monospaced">None</span>. (We discuss the <span class="monospaced">Option</span> class in later. For now,
think of it as a replacement for the null/not-null dichotomy.)</p></div>
</div>
<div class="sect2">
<h3 id="_updating_map_values">Updating Map Values</h3>
<div class="paragraph"><p>In a mutable map, you can update a map value, or add a new one, with a <span class="monospaced">()</span>
to the left of an = sign:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="n">scores</span><span class="o">(</span><span class="s">&quot;Bob&quot;</span><span class="o">)</span> <span class="k">=</span> <span class="mi">10</span>
<span class="c1">// Updates the existing value for the key &quot;Bob&quot; (assuming scores is mutable)</span>
<span class="n">scores</span><span class="o">(</span><span class="s">&quot;Fred&quot;</span><span class="o">)</span> <span class="k">=</span> <span class="mi">7</span>
<span class="c1">// Adds a new key/value pair to scores (assuming it is mutable)</span>
</pre></div></div></div>
<div class="paragraph"><p>Alternatively, you can use the += operation to add multiple associations:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="n">scores</span> <span class="o">+=</span> <span class="o">(</span><span class="s">&quot;Bob&quot;</span> <span class="o">-&gt;</span> <span class="mi">10</span><span class="o">,</span> <span class="s">&quot;Fred&quot;</span> <span class="o">-&gt;</span> <span class="mi">7</span><span class="o">)</span>
</pre></div></div></div>
<div class="paragraph"><p>To remove a key and its associated value, use the -= operator:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="n">scores</span> <span class="o">-=</span> <span class="s">&quot;Alice&quot;</span>
</pre></div></div></div>
<div class="paragraph"><p>You can’t update an immutable map, but you can do something that’s just as
useful: obtain a new map that has the desired update:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">val</span> <span class="n">newScores</span> <span class="k">=</span> <span class="n">scores</span> <span class="o">+</span> <span class="o">(</span><span class="s">&quot;Bob&quot;</span> <span class="o">-&gt;</span> <span class="mi">10</span><span class="o">,</span> <span class="s">&quot;Fred&quot;</span> <span class="o">-&gt;</span> <span class="mi">7</span><span class="o">)</span> <span class="c1">// New map with update</span>
</pre></div></div></div>
<div class="paragraph"><p>The <span class="monospaced">newScores</span> map contains the same associations as scores, except that
"Bob" has been updated and "Fred" added.</p></div>
<div class="paragraph"><p>Instead of saving the result as a new value, you can update a <span class="monospaced">var</span>:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">var</span> <span class="n">scores</span> <span class="k">=</span> <span class="o">...</span>
<span class="n">scores</span> <span class="k">=</span> <span class="n">scores</span> <span class="o">+</span> <span class="o">(</span><span class="s">&quot;Bob&quot;</span> <span class="o">-&gt;</span> <span class="mi">10</span><span class="o">,</span> <span class="s">&quot;Fred&quot;</span> <span class="o">-&gt;</span> <span class="mi">7</span><span class="o">)</span>
</pre></div></div></div>
<div class="paragraph"><p>Similarly, to remove a key from an immutable map, use the - operator to
obtain a new map without the key:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="n">scores</span> <span class="k">=</span> <span class="n">scores</span> <span class="o">-</span> <span class="s">&quot;Alice&quot;</span>
</pre></div></div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">You might think that it is inefficient to keep constructing new maps, but
that is not the case. The old and new maps share most of their structure.
(This is possible because they are immutable.)</td>
</tr></table>
</div>
</div>
<div class="sect2">
<h3 id="_iterating_over_maps">Iterating over Maps</h3>
<div class="paragraph"><p>Iterating over the contents of a map (mutable or immutable) is very easy.
The following amazingly simple loop iterates over all key/value pairs of a
map:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">for</span> <span class="o">((</span><span class="n">k</span><span class="o">,</span> <span class="n">v</span><span class="o">)</span> <span class="k">&lt;-</span> <span class="n">map</span><span class="o">)</span> <span class="n">println</span><span class="o">(</span><span class="n">k</span> <span class="o">+</span> <span class="s">&quot; -&gt; &quot;</span> <span class="o">+</span> <span class="n">v</span><span class="o">)</span>
</pre></div></div></div>
<div class="paragraph"><p>We&#8217;ll see why this works later.</p></div>
<div class="paragraph"><p>If for some reason you just want to visit the keys or values, use the
<span class="monospaced">keySet</span> and <span class="monospaced">values</span> methods, as you would in Java. The <span class="monospaced">values</span> method
returns an <span class="monospaced">Iterable</span> that you can use in a for loop.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="n">scores</span><span class="o">.</span><span class="n">keySet</span> <span class="c1">// A set such as Set(&quot;Bob&quot;, &quot;Cindy&quot;, &quot;Fred&quot;, &quot;Alice&quot;)</span>
<span class="k">for</span> <span class="o">(</span><span class="n">v</span> <span class="k">&lt;-</span> <span class="n">scores</span><span class="o">.</span><span class="n">values</span><span class="o">)</span> <span class="n">println</span><span class="o">(</span><span class="n">v</span><span class="o">)</span> <span class="c1">// Prints 10 8 7 10 or some permutation thereof</span>
</pre></div></div></div>
<div class="paragraph"><p>To reverse a map—that is, switch keys and values—use:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">for</span> <span class="o">((</span><span class="n">k</span><span class="o">,</span> <span class="n">v</span><span class="o">)</span> <span class="k">&lt;-</span> <span class="n">map</span><span class="o">)</span> <span class="k">yield</span> <span class="o">(</span><span class="n">v</span><span class="o">,</span> <span class="n">k</span><span class="o">)</span>
</pre></div></div></div>
</div>
<div class="sect2">
<h3 id="_sorted_maps">Sorted Maps</h3>
<div class="paragraph"><p>When working with a map, you need to choose an implementation: a hash table
or a balanced tree. By default, Scala gives you a hash table. You might
want a tree map if you don’t have a good hash function for the keys, or if
you need to visit the keys in sorted order.</p></div>
<div class="paragraph"><p>To get an immutable tree map instead of a hash map, use</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">val</span> <span class="n">scores</span> <span class="k">=</span> <span class="n">scala</span><span class="o">.</span><span class="n">collection</span><span class="o">.</span><span class="n">immutable</span><span class="o">.</span><span class="nc">SortedMap</span><span class="o">(</span><span class="s">&quot;Alice&quot;</span> <span class="o">-&gt;</span> <span class="mi">10</span><span class="o">,</span> <span class="s">&quot;Fred&quot;</span> <span class="o">-&gt;</span> <span class="mi">7</span><span class="o">,</span> <span class="s">&quot;Bob&quot;</span> <span class="o">-&gt;</span> <span class="mi">3</span><span class="o">,</span> <span class="s">&quot;Cindy&quot;</span> <span class="o">-&gt;</span> <span class="mi">8</span><span class="o">)</span>
</pre></div></div></div>
<div class="paragraph"><p>Unfortunately, there is no mutable tree map. Your best bet is to adapt a
Java <span class="monospaced">TreeMap</span>, which we will do in a future lesson.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph"><p>If you want to visit the keys in insertion order, use a <span class="monospaced">LinkedHashMap</span>,
just as you would in Java. For example,</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">val</span> <span class="n">months</span> <span class="k">=</span> <span class="n">scala</span><span class="o">.</span><span class="n">collection</span><span class="o">.</span><span class="n">mutable</span><span class="o">.</span><span class="nc">LinkedHashMap</span><span class="o">(</span><span class="s">&quot;January&quot;</span> <span class="o">-&gt;</span> <span class="mi">1</span><span class="o">,</span>  <span class="s">&quot;February&quot;</span> <span class="o">-&gt;</span> <span class="mi">2</span><span class="o">,</span> <span class="s">&quot;March&quot;</span> <span class="o">-&gt;</span> <span class="mi">3</span><span class="o">,</span> <span class="s">&quot;April&quot;</span> <span class="o">-&gt;</span> <span class="mi">4</span><span class="o">,</span> <span class="s">&quot;May&quot;</span> <span class="o">-&gt;</span> <span class="mi">5</span><span class="o">,</span> <span class="o">...)</span>
</pre></div></div></div>
</td>
</tr></table>
</div>
</div>
<div class="sect2">
<h3 id="_lab_count_words">Lab: count words</h3>
<div class="paragraph"><p>Open
<span class="monospaced">labs/src/main/scala/com/newcircle/maptuple/CountWords.scala</span>.
In it, you&#8217;ll find a <span class="monospaced">WordCounter</span> class with a <span class="monospaced">countWords</span> procedure.
The <span class="monospaced">countWords</span> method takes a sentence, splits the sentence into words,
and counts the occurrences of each word. When it&#8217;s done, it prints the words
and the counts, in sorted order by word. For instance, for the sentence
"Red sky at night, sailors delight, red sky at morning, sailor take warning",
print the following:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>at 2
delight 1
morning 1
night 1
red 2
sailor 1
sailors 1
sky 2
take 1
warning 1</pre>
</div></div>
<div class="paragraph"><p>Hints:</p></div>
<div class="ulist"><ul>
<li>
<p>
Use the <span class="monospaced">splitSentence()</span> method already in the class to split the sentence
  into words.
</p>
</li>
<li>
<p>
You&#8217;ll obviously want a <span class="monospaced">Map</span>. What will the map&#8217;s keys be? How about its
  values?
</p>
</li>
<li>
<p>
Use the <span class="monospaced">println()</span> function inherited from <span class="monospaced">Output</span> to print your results.
</p>
</li>
</ul></div>
<div class="paragraph"><p>To test your solution, run the predefined tester in SBT:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>&gt; test-only com.newcircle.tests.maptuple.CountWordsSpec</pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_interoperating_with_java_2">Interoperating with Java</h3>
<div class="paragraph"><p>If you get a Java map from calling a Java method, you may want to convert
it to a Scala map so that you can use the (more pleasant) Scala map API.
This is also useful if you want to work with a mutable tree map, which
Scala doesn’t provide.</p></div>
<div class="paragraph"><p>Simply add an import statement, to pull in the appropriate magic-wand
implicit:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">import</span> <span class="nn">scala.collection.JavaConversions.mapAsScalaMap</span>
</pre></div></div></div>
<div class="paragraph"><p>Then trigger the conversion by specifying the Scala map type:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">import</span> <span class="nn">scala.collection.mutable.Map</span>
<span class="k">import</span> <span class="nn">java.util.</span><span class="o">{</span><span class="nc">TreeMap</span> <span class="k">=&gt;</span> <span class="nc">JTreeMap</span><span class="o">}</span>

<span class="k">val</span> <span class="n">scores</span><span class="k">:</span> <span class="kt">Map</span><span class="o">[</span><span class="kt">String</span>, <span class="kt">Int</span><span class="o">]</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">JTreeMap</span><span class="o">[</span><span class="kt">String</span>, <span class="kt">Int</span><span class="o">]</span>
</pre></div></div></div>
<div class="paragraph"><p>In addition, you can get a conversion from <span class="monospaced">java.util.Properties</span> to a
<span class="monospaced">Map[String, String]</span>:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">import</span> <span class="nn">scala.collection.JavaConversions.propertiesAsScalaMap</span>

<span class="k">val</span> <span class="n">props</span><span class="k">:</span> <span class="kt">scala.collection.Map</span><span class="o">[</span><span class="kt">String</span>, <span class="kt">String</span><span class="o">]</span> <span class="k">=</span> <span class="nc">System</span><span class="o">.</span><span class="n">getProperties</span><span class="o">()</span>
</pre></div></div></div>
<div class="paragraph"><p>Conversely, to pass a Scala map to a method that expects a Java map,
provide the opposite implicit conversion. For example:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">import</span> <span class="nn">scala.collection.JavaConversions.mapAsJavaMap</span>
<span class="k">import</span> <span class="nn">java.awt.font.TextAttribute._</span> <span class="c1">// Import keys for map below</span>

<span class="k">val</span> <span class="n">attrs</span> <span class="k">=</span> <span class="nc">Map</span><span class="o">(</span><span class="nc">FAMILY</span> <span class="o">-&gt;</span> <span class="s">&quot;Serif&quot;</span><span class="o">,</span> <span class="nc">SIZE</span> <span class="o">-&gt;</span> <span class="mi">12</span><span class="o">)</span> <span class="c1">// A Scala map</span>
<span class="k">val</span> <span class="n">font</span> <span class="k">=</span> <span class="k">new</span> <span class="n">java</span><span class="o">.</span><span class="n">awt</span><span class="o">.</span><span class="nc">Font</span><span class="o">(</span><span class="n">attrs</span><span class="o">)</span> <span class="c1">// Expects a Java map</span>
</pre></div></div></div>
</div>
<div class="sect2">
<h3 id="_tuples">Tuples</h3>
<div class="paragraph"><p>Maps are collections of key/value pairs. Pairs are the simplest case of
tuples—aggregates of values of different types.</p></div>
<div class="paragraph"><p>A tuple value is formed by enclosing individual values in parentheses. For
example,</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mf">3.14</span><span class="o">,</span> <span class="s">&quot;Fred&quot;</span><span class="o">)</span>
</pre></div></div></div>
<div class="paragraph"><p>is a tuple of type</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="nc">Tuple3</span><span class="o">[</span><span class="kt">Int</span>, <span class="kt">Double</span>, <span class="kt">String</span><span class="o">]</span>
</pre></div></div></div>
<div class="paragraph"><p>which is also written as</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="o">(</span><span class="nc">Int</span><span class="o">,</span> <span class="nc">Double</span><span class="o">,</span> <span class="nc">String</span><span class="o">)</span>
</pre></div></div></div>
<div class="paragraph"><p>This second representation is what the REPL shows:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>scala&gt; *(1, 3.14, "Fred")*
res0: (Int, Double, String) = (1,3.14,Fred)</pre>
</div></div>
<div class="paragraph"><p>If you have a tuple, say,</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">val</span> <span class="n">t</span> <span class="k">=</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mf">3.14</span><span class="o">,</span> <span class="s">&quot;Fred&quot;</span><span class="o">)</span>
</pre></div></div></div>
<div class="paragraph"><p>then you can access its components with the methods <span class="monospaced">_1</span>, <span class="monospaced">_2</span>, <span class="monospaced">_3</span>, for
example:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">val</span> <span class="n">second</span> <span class="k">=</span> <span class="n">t</span><span class="o">.</span><span class="n">_2</span> <span class="c1">// Sets second to 3.14</span>
</pre></div></div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Caution</div>
</td>
<td class="content">Unlike array or string positions, the component positions of a
tuple start with 1, not 0. Yes, this is initially confusing. You get used to
it.</td>
</tr></table>
</div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">You can write <span class="monospaced">t._2</span> as <span class="monospaced">t _2</span> (with a space, instead of a period), but
not as <span class="monospaced">t_2</span>.</td>
</tr></table>
</div>
<div class="paragraph"><p>Usually, though, it&#8217;s better (and more readable) to use pattern matching
to destructure the components of a tuple:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">val</span> <span class="o">(</span><span class="n">first</span><span class="o">,</span> <span class="n">second</span><span class="o">,</span> <span class="n">third</span><span class="o">)</span> <span class="k">=</span> <span class="n">t</span>
</pre></div></div></div>
<div class="paragraph"><p>If you don&#8217;t need all the components, it&#8217;s a Scala convention to use a
throwaway variable named <span class="monospaced">_</span>:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">val</span> <span class="o">(</span><span class="k">_</span><span class="o">,</span> <span class="n">second</span><span class="o">,</span> <span class="k">_</span><span class="o">)</span> <span class="k">=</span> <span class="n">t</span>
</pre></div></div></div>
<div class="paragraph"><p>Tuples are useful for functions that return more than one value. For
example, the <span class="monospaced">partition</span> method of the <span class="monospaced">StringOps</span> class returns a pair of
strings, containing the characters that fulfill a condition and those that
don’t:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="s">&quot;New York&quot;</span><span class="o">.</span><span class="n">partition</span><span class="o">(</span><span class="k">_</span><span class="o">.</span><span class="n">isUpper</span><span class="o">)</span> <span class="c1">// Yields the pair (&quot;NY&quot;, &quot;ew ork&quot;)</span>
</pre></div></div></div>
</div>
<div class="sect2">
<h3 id="_lab_tuples">Lab: tuples</h3>
<div class="paragraph"><p>Open <span class="monospaced">labs/src/main/scala/com/newcircle/maptuple/Stats.scala</span>. In it,
you&#8217;ll find a <span class="monospaced">Stats</span> object with a <span class="monospaced">statsFor</span> function. The <span class="monospaced">statsFor</span>
function takes an array of integers and computes the minimum (an integer),
maximum (an integer), mode (an integer), mean (a <span class="monospaced">Double</span>), and median (a
<span class="monospaced">Double</span>). It returns all of them as a single result.</p></div>
<div class="paragraph"><p>Notes:</p></div>
<div class="ulist"><ul>
<li>
<p>
If you don&#8217;t remember the definitions of <em>mean</em>, <em>median</em> and <em>mode</em>,
  a quick web search will refresh your memory.
</p>
</li>
<li>
<p>
If a given array has more than one mode, throw an <span class="monospaced">IllegalArgumentException</span>.
</p>
</li>
<li>
<p>
Be sure to handle the special cases of an empty array and an array with one
  number.
</p>
</li>
</ul></div>
<div class="paragraph"><p>To test your solution, run this tester in SBT:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>&gt; test-only com.newcircle.tests.maptuple.StatsSpec</pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_zipping">Zipping</h3>
<div class="paragraph"><p>One reason for using tuples is to bundle together values so that they can
be processed together. This is commonly done with the <span class="monospaced">zip</span> method. For
example, the code</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">val</span> <span class="n">symbols</span> <span class="k">=</span> <span class="nc">Array</span><span class="o">(</span><span class="s">&quot;&lt;&quot;</span><span class="o">,</span> <span class="s">&quot;-&quot;</span><span class="o">,</span> <span class="s">&quot;&gt;&quot;</span><span class="o">)</span>
<span class="k">val</span> <span class="n">counts</span> <span class="k">=</span> <span class="nc">Array</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="mi">10</span><span class="o">,</span> <span class="mi">2</span><span class="o">)</span>
<span class="k">val</span> <span class="n">pairs</span> <span class="k">=</span> <span class="n">symbols</span><span class="o">.</span><span class="n">zip</span><span class="o">(</span><span class="n">counts</span><span class="o">)</span>
</pre></div></div></div>
<div class="paragraph"><p>yields an array of pairs</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="nc">Array</span><span class="o">((</span><span class="s">&quot;&lt;&quot;</span><span class="o">,</span> <span class="mi">2</span><span class="o">),</span> <span class="o">(</span><span class="s">&quot;-&quot;</span><span class="o">,</span> <span class="mi">10</span><span class="o">),</span> <span class="o">(</span><span class="s">&quot;&gt;&quot;</span><span class="o">,</span> <span class="mi">2</span><span class="o">))</span>
</pre></div></div></div>
<div class="paragraph"><p>The pairs can then be processed together:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">for</span> <span class="o">((</span><span class="n">s</span><span class="o">,</span> <span class="n">n</span><span class="o">)</span> <span class="k">&lt;-</span> <span class="n">pairs</span><span class="o">)</span> <span class="nc">Console</span><span class="o">.</span><span class="n">print</span><span class="o">(</span><span class="n">s</span> <span class="o">*</span> <span class="n">n</span><span class="o">)</span> <span class="c1">// Prints &lt;&lt;----------&gt;&gt;</span>
</pre></div></div></div>
</div>
<div class="sect2">
<h3 id="_turn_a_collection_of_2_tuples_into_a_map">Turn a collection of 2-tuples into a map</h3>
<div class="paragraph"><p>The <span class="monospaced">toMap</span> method turns a collection of pairs (2-tuples) into a map.</p></div>
<div class="paragraph"><p>Suppose you have a collection of keys and parallel values:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">val</span> <span class="n">keys</span> <span class="k">=</span> <span class="nc">Array</span><span class="o">(</span><span class="s">&quot;Alice&quot;</span><span class="o">,</span> <span class="s">&quot;Bob&quot;</span><span class="o">,</span> <span class="s">&quot;Carol&quot;</span><span class="o">)</span>
<span class="k">val</span> <span class="n">values</span> <span class="k">=</span> <span class="nc">Array</span><span class="o">(</span><span class="mi">32</span><span class="o">,</span> <span class="mi">35</span><span class="o">,</span> <span class="mi">34</span><span class="o">)</span>
</pre></div></div></div>
<div class="paragraph"><p>You can turn them into a map with a single expression:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="n">keys</span><span class="o">.</span><span class="n">zip</span><span class="o">(</span><span class="n">values</span><span class="o">).</span><span class="n">toMap</span>
<span class="c1">// yields scala.collection.immutable.Map[String,Int] = Map(Alice -&gt; 32, Bob -&gt; 35, Carol -&gt; 34)</span>
</pre></div></div></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="lesson-05-classes">Classes</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_lesson_objectives_6">Lesson Objectives</h3>
<div class="paragraph"><p>In this lesson, you will learn how to implement classes in Scala. If you
know classes in Java or C++, you won’t find this difficult, and you will
enjoy the much more concise notation of Scala.</p></div>
</div>
<div class="sect2">
<h3 id="_summary_4">Summary</h3>
<div class="ulist"><ul>
<li>
<p>
Fields in classes automatically come with getters and setters.
</p>
</li>
<li>
<p>
You can replace a field with a custom getter/setter without changing the
  client of a class. This is the "uniform access principle."
</p>
</li>
<li>
<p>
Use the <span class="monospaced">@BeanProperty</span> annotation to generate the JavaBeans <span class="monospaced">getXxx</span>/<span class="monospaced">setXxx</span>
  methods.
</p>
</li>
<li>
<p>
Every class has a primary constructor that is “interwoven” with the class
  definition. Its parameters turn into the fields of the class. The primary
  constructor executes all statements in the body of the class.
</p>
</li>
<li>
<p>
Auxiliary constructors are optional. They are called this.
</p>
</li>
</ul></div>
</div>
<div class="sect2">
<h3 id="_simple_classes_and_parameterless_methods">Simple Classes and Parameterless Methods</h3>
<div class="paragraph"><p>In its simplest form, a Scala class looks very much like its equivalent in
Java or C++:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Counter</span> <span class="o">{</span>
  <span class="k">private</span> <span class="k">var</span> <span class="n">value</span> <span class="k">=</span> <span class="mi">0</span> <span class="c1">// You must initialize the field</span>
  <span class="k">def</span> <span class="n">increment</span><span class="o">()</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="o">{</span> <span class="n">value</span> <span class="o">+=</span> <span class="mi">1</span> <span class="o">}</span> <span class="c1">// Methods are public by default</span>
  <span class="k">def</span> <span class="n">current</span><span class="o">()</span> <span class="k">=</span> <span class="n">value</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>In Scala, a class is not declared as <span class="monospaced">public</span>. A Scala source file can
contain multiple classes, and all of them have public visibility.</p></div>
<div class="paragraph"><p>To use this class, you construct objects and invoke methods in the usual
way:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">val</span> <span class="n">myCounter</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">Counter</span> <span class="c1">// Or new Counter()</span>
<span class="n">myCounter</span><span class="o">.</span><span class="n">increment</span><span class="o">()</span>
<span class="n">println</span><span class="o">(</span><span class="n">myCounter</span><span class="o">.</span><span class="n">current</span><span class="o">)</span>
</pre></div></div></div>
<div class="paragraph"><p>You can call a parameterless method (such as <span class="monospaced">current</span>) with or without
parentheses:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="n">myCounter</span><span class="o">.</span><span class="n">current</span> <span class="c1">// OK</span>
<span class="n">myCounter</span><span class="o">.</span><span class="n">current</span><span class="o">()</span> <span class="c1">// Also OK</span>
</pre></div></div></div>
<div class="paragraph"><p>Which form should you use? It is considered good style to use () for a
mutator method (a method that changes the object state), and to drop the ()
for an accessor method (a method that does not change the object state).</p></div>
<div class="paragraph"><p>That’s what we did in our example:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="n">myCounter</span><span class="o">.</span><span class="n">increment</span><span class="o">()</span> <span class="c1">// Use () with mutator</span>
<span class="n">println</span><span class="o">(</span><span class="n">myCounter</span><span class="o">.</span><span class="n">current</span><span class="o">)</span> <span class="c1">// Don&#39;t use () with accessor</span>
</pre></div></div></div>
<div class="paragraph"><p>You can enforce this style by declaring current without ():</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Counter</span> <span class="o">{</span>
  <span class="o">...</span>
  <span class="k">def</span> <span class="n">current</span> <span class="k">=</span> <span class="n">value</span> <span class="c1">// No () in definition</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>Now the class user <em>must</em> use <span class="monospaced">myCounter.current</span>, without parentheses.</p></div>
</div>
<div class="sect2">
<h3 id="_properties_with_getters_and_setters">Properties with Getters and Setters</h3>
<div class="paragraph"><p>When writing a Java class, we don’t like to use public fields:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Person</span> <span class="o">{</span> <span class="c1">// This is Java</span>
  <span class="kd">public</span> <span class="kt">int</span> <span class="n">age</span><span class="o">;</span> <span class="c1">// Frowned upon in Java</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>With a public field, anyone could write to <span class="monospaced">fred.age</span>, making Fred younger or
older. That’s why we prefer to use getter and setter methods:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Person</span> <span class="o">{</span> <span class="c1">// This is Java</span>
  <span class="kd">private</span> <span class="kt">int</span> <span class="n">age</span><span class="o">;</span>
  <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getAge</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="n">age</span><span class="o">;</span> <span class="o">}</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setAge</span><span class="o">(</span><span class="kt">int</span> <span class="n">age</span><span class="o">)</span> <span class="o">{</span> <span class="k">this</span><span class="o">.</span><span class="na">age</span> <span class="o">=</span> <span class="n">age</span><span class="o">;</span> <span class="o">}</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>A getter/setter pair such as this one is often called a property. We say
that the class <span class="monospaced">Person</span> has an <span class="monospaced">age</span> property.</p></div>
<div class="paragraph"><p>Why is this any better? By itself, it isn’t. Anyone can call
<span class="monospaced">fred.setAge(21)</span>, keeping him forever twenty-one.</p></div>
<div class="paragraph"><p>But if that becomes a problem, we can guard against it:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="kd">public</span> <span class="kt">void</span> <span class="nf">setAge</span><span class="o">(</span><span class="kt">int</span> <span class="n">newValue</span><span class="o">)</span> <span class="o">{</span> <span class="k">if</span> <span class="o">(</span><span class="n">newValue</span> <span class="o">&gt;</span> <span class="n">age</span><span class="o">)</span> <span class="n">age</span> <span class="o">=</span> <span class="n">newValue</span><span class="o">;</span> <span class="o">}</span>
<span class="c1">// Can&#39;t get younger</span>
</pre></div></div></div>
<div class="paragraph"><p>Getters and setters are better than public fields because they let you
start with simple get/set semantics and evolve them as needed.</p></div>
<div class="paragraph"><p>Scala automatically provides getter and setter methods for every field.
Here, we define a <span class="monospaced">public</span> field:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Person</span> <span class="o">{</span>
  <span class="k">var</span> <span class="n">age</span> <span class="k">=</span> <span class="mi">0</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>During compilation, Scala generates a class for the JVM with a <em>private</em>
<span class="monospaced">age</span> field and getter and setter methods. These generated methods are
public because we did not declare age as <span class="monospaced">private</span>. (For a private field,
the getter and setter methods are private.)</p></div>
<div class="paragraph"><p>In Scala, the getter and setter methods are called <span class="monospaced">age</span> and <span class="monospaced">age_=</span>.
For example:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="n">println</span><span class="o">(</span><span class="n">fred</span><span class="o">.</span><span class="n">age</span><span class="o">)</span> <span class="c1">// Calls the method fred.age()</span>
<span class="n">fred</span><span class="o">.</span><span class="n">age</span> <span class="k">=</span> <span class="mi">21</span>     <span class="c1">// Calls fred.age_=(21)</span>
</pre></div></div></div>
<div class="paragraph"><p>In Scala, the getters and setters are not named <span class="monospaced">getXxx</span> and <span class="monospaced">setXxx</span>, but
they fulfill the same purpose.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph"><p>To see these methods with your own eyes, compile the <span class="monospaced">Person</span> class and then
look at the bytecode with <span class="monospaced">javap</span>:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>$ scalac Person.scala
$ javap -private Person
Compiled from "Person.scala"
public class Person extends java.lang.Object implements scala.ScalaObject{
  private int age;
  public int age();
  public void age_$eq(int);
  public Person();
}</pre>
</div></div>
<div class="paragraph"><p>As you can see, the compiler created methods age and age_$eq. (The = symbol
is translated to <span class="monospaced">$eq</span> because the JVM does not allow an = in a method name.)</p></div>
</td>
</tr></table>
</div>
<div class="paragraph"><p>At any time, you can redefine the getter and setter methods yourself. For
example,</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Person</span> <span class="o">{</span>
  <span class="k">private</span> <span class="k">var</span> <span class="n">privateAge</span> <span class="k">=</span> <span class="mi">0</span> <span class="c1">// Make private and rename</span>

  <span class="k">def</span> <span class="n">age</span> <span class="k">=</span> <span class="n">privateAge</span>
  <span class="k">def</span> <span class="n">age_=</span><span class="o">(</span><span class="n">newValue</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">newValue</span> <span class="o">&gt;</span> <span class="n">privateAge</span><span class="o">)</span> <span class="n">privateAge</span> <span class="k">=</span> <span class="n">newValue</span><span class="o">;</span> <span class="c1">// Can&#39;t get younger</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>The user of your class still accesses <span class="monospaced">fred.age</span>, but now Fred can’t get
younger:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">val</span> <span class="n">fred</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">Person</span>
<span class="n">fred</span><span class="o">.</span><span class="n">age</span> <span class="k">=</span> <span class="mi">30</span>
<span class="n">fred</span><span class="o">.</span><span class="n">age</span> <span class="k">=</span> <span class="mi">21</span>
<span class="n">println</span><span class="o">(</span><span class="n">fred</span><span class="o">.</span><span class="n">age</span><span class="o">)</span> <span class="c1">// 30</span>
</pre></div></div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph"><p>It may sound scary that Scala generates getter and setter methods for every
field. But you have some control over this process.</p></div>
<div class="ulist"><ul>
<li>
<p>
If the field is private, the getter and setter are private.
</p>
</li>
<li>
<p>
If the field is a <span class="monospaced">val</span>, only a getter is generated.
</p>
</li>
<li>
<p>
If you don’t want any getter or setter, declare the field as <span class="monospaced">private[this]</span>.
  (More on that in a few minutes.)
</p>
</li>
</ul></div>
</td>
</tr></table>
</div>
<div class="sect3">
<h4 id="_the_uniform_access_principle">The Uniform Access Principle</h4>
<div class="paragraph"><p>Bertrand Meyer, the inventor of the influential Eiffel language, formulated
the Uniform Access Principle. It states:</p></div>
<div class="paragraph"><p><em>All services offered by a module should be available through a uniform
notation, which does not betray whether they are implemented through
storage or through computation.</em></p></div>
<div class="paragraph"><p>In Scala, the caller of <span class="monospaced">fred.age</span> doesn’t know whether <span class="monospaced">age</span> is implemented
through a field or a method. (Of course, in the JVM, the service is always
implemented through a method, either synthesized or programmer-supplied.)</p></div>
</div>
</div>
<div class="sect2">
<h3 id="_properties_with_only_getters">Properties with Only Getters</h3>
<div class="paragraph"><p>Sometimes you want a read-only property with a getter but no setter. If the
value of the property never changes after the object has been constructed,
use a <span class="monospaced">val</span> field:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Message</span> <span class="o">{</span>
  <span class="k">val</span> <span class="n">timeStamp</span> <span class="k">=</span> <span class="k">new</span> <span class="n">java</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="nc">Date</span>
  <span class="o">...</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>Scala makes a <span class="monospaced">private final</span> field and a getter method, but no setter.</p></div>
<div class="paragraph"><p>Sometimes, however, you want a property that a client can’t set at will,
but that is mutated in some other way. The <span class="monospaced">Counter</span> class, above, is a
good example. Conceptually, the counter has a <span class="monospaced">current</span> property that is
updated when the <span class="monospaced">increment()</span> method is called, but there is no setter for
the property.</p></div>
<div class="paragraph"><p>You can’t implement such a property with a <span class="monospaced">val</span>, because a <span class="monospaced">val</span> never
changes. Instead, provide a private field and a property getter, like this:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Counter</span> <span class="o">{</span>
  <span class="k">private</span> <span class="k">var</span> <span class="n">value</span> <span class="k">=</span> <span class="mi">0</span>
  <span class="k">def</span> <span class="n">increment</span><span class="o">()</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="o">{</span> <span class="n">value</span> <span class="o">+=</span> <span class="mi">1</span> <span class="o">}</span>
  <span class="k">def</span> <span class="n">current</span> <span class="k">=</span> <span class="n">value</span> <span class="c1">// No () in declaration</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>Note that there are no <span class="monospaced">()</span> in the definition of the getter method.
Therefore, you <em>must</em> call the method without parentheses.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">val</span> <span class="n">n</span> <span class="k">=</span> <span class="n">myCounter</span><span class="o">.</span><span class="n">current</span> <span class="c1">// Calling myCounter.current() is a syntax error</span>
</pre></div></div></div>
<div class="paragraph"><p>To summarize, you have four choices for implementing properties:</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
<span class="monospaced">var foo</span>: Scala synthesizes a getter and a setter.
</p>
</li>
<li>
<p>
<span class="monospaced">val foo</span>: Scala synthesizes a getter.
</p>
</li>
<li>
<p>
You define methods <span class="monospaced">foo</span> and <span class="monospaced">foo_=.</span>
</p>
</li>
<li>
<p>
You define a method <span class="monospaced">foo</span>.
</p>
</li>
</ol></div>
</div>
<div class="sect2">
<h3 id="_lab_bank_account">Lab: Bank Account</h3>
<div class="paragraph"><p>Open <span class="monospaced">labs/src/main/scala/com/newcircle/classes/BankAccount.scala</span>. In it,
you&#8217;ll find an empty <span class="monospaced">BankAccount</span> class. Fill out the class, so that it has:</p></div>
<div class="ulist"><ul>
<li>
<p>
a <span class="monospaced">deposit</span> method. If the parameter is negative, this method should
  throw an <span class="monospaced">IllegalArgumentException</span>.
</p>
</li>
<li>
<p>
a <span class="monospaced">withdraw</span> method, which returns the amount actually withdrawn. If the
  caller attempts to withdraw more money than is in the account, the amount
  left in the account should be returned (and the account balanced zeroed).
</p>
</li>
<li>
<p>
a read-only property <span class="monospaced">balance</span>
</p>
</li>
</ul></div>
<div class="paragraph"><p>HINT: Use <span class="monospaced">BigDecimal</span>, not <span class="monospaced">Double</span>. (Why?)</p></div>
<div class="paragraph"><p>To test your solution, run this tester in SBT:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>&gt; test-only com.newcircle.tests.classes.BankAccountSpec</pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_object_private_fields">Object-private Fields</h3>
<div class="paragraph"><p>In Scala, as in Java or C++, a method can access the private fields of all
objects of its class. For example,</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Counter</span> <span class="o">{</span>
  <span class="k">private</span> <span class="k">var</span> <span class="n">value</span> <span class="k">=</span> <span class="mi">0</span>
  <span class="k">def</span> <span class="n">increment</span><span class="o">()</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="o">{</span> <span class="n">value</span> <span class="o">+=</span> <span class="mi">1</span> <span class="o">}</span>

  <span class="k">def</span> <span class="n">isLess</span><span class="o">(</span><span class="n">other</span> <span class="k">:</span> <span class="kt">Counter</span><span class="o">)</span> <span class="k">=</span> <span class="n">value</span> <span class="o">&lt;</span> <span class="n">other</span><span class="o">.</span><span class="n">value</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>Accessing <span class="monospaced">other.value</span> is legal because <span class="monospaced">other</span> is also a <span class="monospaced">Counter</span> object.</p></div>
<div class="paragraph"><p>Scala allows an even more severe access restriction, with the <span class="monospaced">private[this]</span>
qualifier:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">private</span><span class="o">[</span><span class="kt">this</span><span class="o">]</span> <span class="k">var</span> <span class="n">value</span> <span class="k">=</span> <span class="mi">0</span> <span class="c1">// Accessing someObject.value is not allowed</span>
</pre></div></div></div>
<div class="paragraph"><p>Now, the methods of the <span class="monospaced">Counter</span> class can only access the <span class="monospaced">value</span> field
of the current object, not of other objects of type <span class="monospaced">Counter</span>. This access
is sometimes called <span class="monospaced">object-private</span>, and it is common in some OO languages,
such as SmallTalk.</p></div>
<div class="paragraph"><p>With a class-private field, Scala generates private getter and setter
methods. However, for an object-private field, no getters and setters are
generated at all.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph"><p>Scala allows you to grant access rights to specific classes. The
<span class="monospaced">private[ClassName]</span> qualifier states that only methods of the given class
can access the given field. Here, the <span class="monospaced">ClassName</span> must be the name of the
class being defined or an enclosing class.</p></div>
<div class="paragraph"><p>In this case, the implementation will generate auxiliary getter and setter
methods that allow the enclosing class to access the field. These methods
will be public because the JVM does not have a fine-grained access control
system, and they will have implementation-dependent names.</p></div>
</td>
</tr></table>
</div>
</div>
<div class="sect2">
<h3 id="_bean_properties">Bean Properties</h3>
<div class="paragraph"><p>As you saw in the preceding sections, Scala provides getter and setter
methods for the fields that you define. However, the names of these methods
are not what Java tools expect. The JavaBeans specification
&lt;www.oracle.com/technetwork/java/javase/tech/index-jsp-138795.html&gt; defines
a Java property as a pair of <span class="monospaced">getFoo</span>/<span class="monospaced">setFoo</span> methods (or just a <span class="monospaced">getFoo</span>
method for a read-only property). Many Java tools rely on this naming
convention.</p></div>
<div class="paragraph"><p>When you annotate a Scala field with <span class="monospaced">@BeanProperty</span>, then such methods are
automatically generated. For example:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">import</span> <span class="nn">scala.beans.BeanProperty</span>

<span class="k">class</span> <span class="nc">Person</span> <span class="o">{</span>
  <span class="nd">@BeanProperty</span> <span class="k">var</span> <span class="n">name</span><span class="k">:</span> <span class="kt">String</span> <span class="o">=</span> <span class="s">&quot;...&quot;</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>generates four methods:</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
<span class="monospaced">name: String</span>
</p>
</li>
<li>
<p>
<span class="monospaced">name_=(newValue: String): Unit</span>
</p>
</li>
<li>
<p>
<span class="monospaced">getName(): String</span>
</p>
</li>
<li>
<p>
<span class="monospaced">setName(newValue: String): Unit</span>
</p>
</li>
</ol></div>
</div>
<div class="sect2">
<h3 id="_auxiliary_constructors">Auxiliary Constructors</h3>
<div class="paragraph"><p>As in Java or C++, a Scala class can have as many constructors as you like.
However, a Scala class has one constructor that is more important than all
the others, called the <em>primary constructor</em>. In addition, a class may have
any number of auxiliary constructors.</p></div>
<div class="paragraph"><p>We discuss auxiliary constructors first because they are easier to
understand. They are very similar to constructors in Java or C++, with just
two differences.</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
The auxiliary constructors are called <span class="monospaced">this</span>. (In Java or C++,
   constructors have the same name as the class—which is not so convenient if
   you rename the class.)
</p>
</li>
<li>
<p>
Each auxiliary constructor must start with a call to a previously
   defined auxiliary constructor or the primary constructor.
</p>
</li>
</ol></div>
<div class="paragraph"><p>Here is a class with two auxiliary constructors.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Person</span> <span class="o">{</span>
  <span class="k">private</span> <span class="k">var</span> <span class="n">name</span> <span class="k">=</span> <span class="s">&quot;&quot;</span>
  <span class="k">private</span> <span class="k">var</span> <span class="n">age</span> <span class="k">=</span> <span class="mi">0</span>

  <span class="k">def</span> <span class="k">this</span><span class="o">(</span><span class="n">name</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span> <span class="o">{</span> <span class="c1">// An auxiliary constructor</span>
    <span class="k">this</span><span class="o">()</span> <span class="c1">// Calls primary constructor</span>
    <span class="k">this</span><span class="o">.</span><span class="n">name</span> <span class="k">=</span> <span class="n">name</span>
  <span class="o">}</span>

  <span class="k">def</span> <span class="k">this</span><span class="o">(</span><span class="n">name</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">age</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span> <span class="o">{</span> <span class="c1">// Another auxiliary constructor</span>
    <span class="k">this</span><span class="o">(</span><span class="n">name</span><span class="o">)</span> <span class="c1">// Calls previous auxiliary constructor</span>
    <span class="k">this</span><span class="o">.</span><span class="n">age</span> <span class="k">=</span> <span class="n">age</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>We will look at the primary constructor in the next section. For now, it is
sufficient to know that a class for which you don’t define a primary
constructor has a primary constructor with no arguments.</p></div>
<div class="paragraph"><p>You can construct objects of this class in three ways:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">val</span> <span class="n">p1</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">Person</span> <span class="c1">// Primary constructor</span>
<span class="k">val</span> <span class="n">p2</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">Person</span><span class="o">(</span><span class="s">&quot;Fred&quot;</span><span class="o">)</span> <span class="c1">// First auxiliary constructor</span>
<span class="k">val</span> <span class="n">p3</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">Person</span><span class="o">(</span><span class="s">&quot;Fred&quot;</span><span class="o">,</span> <span class="mi">42</span><span class="o">)</span> <span class="c1">// Second auxiliary constructor</span>
</pre></div></div></div>
</div>
<div class="sect2">
<h3 id="_the_primary_constructor">The Primary Constructor</h3>
<div class="paragraph"><p>In Scala, every class has a primary constructor. The primary constructor is
not defined with a <span class="monospaced">this</span> method. Instead, it is interwoven with the class
definition.</p></div>
<div class="sect3">
<h4 id="_primary_constructor_parameters">Primary Constructor Parameters</h4>
<div class="paragraph"><p>The parameters of the primary constructor are placed immediately after
the class name.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Person</span><span class="o">(</span><span class="k">val</span> <span class="n">name</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="k">val</span> <span class="n">age</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span> <span class="o">{</span>
  <span class="c1">// Parameters of primary constructor in (...)</span>
  <span class="o">...</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>Parameters of the primary constructor turn into fields that are initialized
with the construction parameters. In our example, name and age become
fields of the <span class="monospaced">Person</span> class. A constructor call such as
<span class="monospaced">new Person("Fred", 42)</span> sets the <span class="monospaced">name</span> and <span class="monospaced">age</span> fields.</p></div>
<div class="paragraph"><p>Half a line of Scala is the equivalent of seven lines of Java:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Person</span> <span class="o">{</span> <span class="c1">// This is Java</span>
  <span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>
  <span class="kd">private</span> <span class="kt">int</span> <span class="n">age</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">Person</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">,</span> <span class="kt">int</span> <span class="n">age</span><span class="o">)</span> <span class="o">{</span>
     <span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
     <span class="k">this</span><span class="o">.</span><span class="na">age</span> <span class="o">=</span> <span class="n">age</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="kd">public</span> <span class="n">String</span> <span class="nf">name</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">name</span><span class="o">;</span> <span class="o">}</span>
  <span class="kd">public</span> <span class="kt">int</span> <span class="nf">age</span><span class="o">()</span> <span class="o">{</span> <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">age</span><span class="o">;</span> <span class="o">}</span>
  <span class="o">...</span>
<span class="o">}</span>
</pre></div></div></div>
</div>
<div class="sect3">
<h4 id="_primary_constructor_code">Primary Constructor Code</h4>
<div class="paragraph"><p>The primary constructor executes all statements in the class definition.
For example, in the following class</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Person</span><span class="o">(</span><span class="k">val</span> <span class="n">name</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="k">val</span> <span class="n">age</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">println</span><span class="o">(</span><span class="s">&quot;Just constructed another person&quot;</span><span class="o">)</span>
  <span class="k">def</span> <span class="n">description</span> <span class="k">=</span> <span class="n">name</span> <span class="o">+</span> <span class="s">&quot; is &quot;</span> <span class="o">+</span> <span class="n">age</span> <span class="o">+</span> <span class="s">&quot; years old&quot;</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>the <span class="monospaced">println</span> statement is a part of the primary constructor. It is
executed whenever an object is constructed.</p></div>
<div class="paragraph"><p>This is useful when you need to configure a field during construction. For
example:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">class</span> <span class="nc">MyProg</span> <span class="o">{</span>
  <span class="k">private</span> <span class="k">val</span> <span class="n">props</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">Properties</span>
  <span class="n">props</span><span class="o">.</span><span class="n">load</span><span class="o">(</span><span class="k">new</span> <span class="nc">FileReader</span><span class="o">(</span><span class="s">&quot;myprog.properties&quot;</span><span class="o">))</span>
    <span class="c1">// The statement above is a part of the primary constructor</span>
  <span class="o">...</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">If there are no parameters after the class name, then the class has a
primary constructor with no parameters. That constructor simply executes
all statements in the body of the class.</td>
</tr></table>
</div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph"><p>You can often eliminate auxiliary constructors by using default arguments
in the primary constructor. For example:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Person</span><span class="o">(</span><span class="k">val</span> <span class="n">name</span><span class="k">:</span> <span class="kt">String</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="o">,</span> <span class="k">val</span> <span class="n">age</span><span class="k">:</span> <span class="kt">Int</span> <span class="o">=</span> <span class="mi">0</span><span class="o">)</span>
</pre></div></div></div>
</td>
</tr></table>
</div>
<div class="paragraph"><p>Primary constructor parameters can have any of the following forms:</p></div>
<table class="tableblock frame-all grid-all"
style="
width:50%;
">
<col style="width:50%;">
<col style="width:50%;">
<thead>
<tr>
<th class="tableblock halign-left valign-top" > Primary Constructor Parameter        </th>
<th class="tableblock halign-left valign-top" > Generated Field/Methods</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">name: String</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">object-private field, or no field if no method uses <span class="monospaced">name</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">private val/var name: String</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">private field, private getter/setter</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">val/var name: String</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">private field, public getter/setter</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">@BeanProperty val/var name: String</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">private field, public Scala and JavaBeans getters/setters</p></td>
</tr>
</tbody>
</table>
<div class="paragraph"><p>This example:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Person</span><span class="o">(</span><span class="k">val</span> <span class="n">name</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="k">private</span> <span class="k">var</span> <span class="n">age</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span>
</pre></div></div></div>
<div class="paragraph"><p>declares and initializes fields</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">val</span> <span class="n">name</span><span class="k">:</span> <span class="kt">String</span>
<span class="k">private</span> <span class="k">var</span> <span class="n">age</span><span class="k">:</span> <span class="kt">Int</span>
</pre></div></div></div>
<div class="paragraph"><p>Construction parameters can also be regular method parameters, without
<span class="monospaced">val</span> or <span class="monospaced">var</span>. How these parameters are processed depends on their usage
inside the class.</p></div>
<div class="paragraph"><p><strong>If a parameter without <span class="monospaced">val</span> or <span class="monospaced">var</span> is used inside at least one method,
it becomes a field.</strong></p></div>
<div class="paragraph"><p>For example,</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Person</span><span class="o">(</span><span class="n">name</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">age</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">def</span> <span class="n">description</span> <span class="k">=</span> <span class="n">name</span> <span class="o">+</span> <span class="s">&quot; is &quot;</span> <span class="o">+</span> <span class="n">age</span> <span class="o">+</span> <span class="s">&quot; years old&quot;</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>declares and initializes immutable fields name and age that are
object-private.</p></div>
<div class="paragraph"><p>Such a field is the equivalent of a <span class="monospaced">private[this] val</span> field.</p></div>
<div class="paragraph"><p><strong>Otherwise, the parameter is not saved as a field.</strong></p></div>
<div class="paragraph"><p>It’s just a regular parameter that can be accessed in the code of the
primary constructor.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">When you think of the primary constructor’s parameters as class
parameters, parameters without <span class="monospaced">val</span> or <span class="monospaced">var</span> become easier to understand.
The scope of such a parameter is the entire class. Therefore, you can use
the parameter in methods. If you do, it is the compiler’s job to save it in
a field.</td>
</tr></table>
</div>
</div>
<div class="sect3">
<h4 id="_private_primary_constructors">Private Primary Constructors</h4>
<div class="paragraph"><p>To make the primary constructor private, place the <span class="monospaced">private</span> keyword as
follows:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Person</span> <span class="k">private</span><span class="o">(</span><span class="k">val</span> <span class="n">id</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span> <span class="o">{</span> <span class="o">...</span> <span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>A class user must then use an auxiliary constructor to construct a
<span class="monospaced">Person</span> object.</p></div>
</div>
</div>
<div class="sect2">
<h3 id="_lab_car">Lab: Car</h3>
<div class="paragraph"><p>Open <span class="monospaced">labs/src/main/scala/com/newcircle/classes/Car.scala</span>. In it,
you&#8217;ll find an empty <span class="monospaced">Car</span> class. Fill out the class, so that it has:</p></div>
<div class="ulist"><ul>
<li>
<p>
read-only properties for manufacturer (<span class="monospaced">String</span>), model name (<span class="monospaced">String</span>),
  and model year (<span class="monospaced">Int</span>)
</p>
</li>
<li>
<p>
a read-write property for the license plate
</p>
</li>
<li>
<p>
four constructors, supporting the following:
</p>
</li>
</ul></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">new</span> <span class="nc">Car</span><span class="o">(</span><span class="s">&quot;Ford&quot;</span><span class="o">,</span> <span class="s">&quot;Focus&quot;</span><span class="o">)</span> <span class="c1">// license plate defaults to &quot;&quot;, year defaults to -1</span>
<span class="k">new</span> <span class="nc">Car</span><span class="o">(</span><span class="s">&quot;Tesla&quot;</span><span class="o">,</span> <span class="s">&quot;S&quot;</span><span class="o">,</span> <span class="mi">2014</span><span class="o">)</span> <span class="c1">// license plate defaults to &quot;&quot;</span>
<span class="k">new</span> <span class="nc">Car</span><span class="o">(</span><span class="s">&quot;Toyota&quot;</span><span class="o">,</span> <span class="s">&quot;Prius&quot;</span><span class="o">,</span> <span class="mi">2013</span><span class="o">,</span> <span class="s">&quot;ABC-1234&quot;</span><span class="o">)</span>
<span class="k">new</span> <span class="nc">Car</span><span class="o">(</span><span class="s">&quot;Honda&quot;</span><span class="o">,</span> <span class="s">&quot;Civic&quot;</span><span class="o">,</span> <span class="s">&quot;GBD-9903&quot;</span><span class="o">)</span>
</pre></div></div></div>
<div class="paragraph"><p>Use three separate constructors (i.e., <em>don&#8217;t</em> use default parameters).</p></div>
<div class="paragraph"><p><strong>Question</strong>: Which constructor do you choose as your primary constructor? Why?</p></div>
<div class="paragraph"><p>To test your solution, run this tester in SBT:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>&gt; test-only com.newcircle.tests.classes.CarSpec</pre>
</div></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="lesson-06-objects">Objects</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_lesson_objectives_7">Lesson Objectives</h3>
<div class="paragraph"><p>In this short lesson, you will learn when to use the <span class="monospaced">object</span> construct in
Scala. Use it when you need a class with a single instance, or when you
want to find a home for miscellaneous values or functions.</p></div>
</div>
<div class="sect2">
<h3 id="_summary_5">Summary</h3>
<div class="ulist"><ul>
<li>
<p>
Use objects for singletons and utility methods.
</p>
</li>
<li>
<p>
A class can have a companion object with the same name.
</p>
</li>
<li>
<p>
Objects can extend classes or traits.
</p>
</li>
<li>
<p>
The <span class="monospaced">apply</span> method of an object is usually used for constructing new
  instances of the companion class.
</p>
</li>
<li>
<p>
To avoid the <span class="monospaced">main</span> method, use an object that extends the <span class="monospaced">App</span> trait.
</p>
</li>
<li>
<p>
You can implement enumerations by extending the <span class="monospaced">Enumeration</span> object.
</p>
</li>
</ul></div>
</div>
<div class="sect2">
<h3 id="_singletons">Singletons</h3>
<div class="paragraph"><p>Scala has no static methods or fields. Instead, you use the <span class="monospaced">object</span>
construct. An object defines a single instance of a class with the features
that you want. For example,</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">object</span> <span class="nc">Accounts</span> <span class="o">{</span>
  <span class="k">private</span> <span class="k">var</span> <span class="n">lastNumber</span> <span class="k">=</span> <span class="mi">0</span>
  <span class="k">def</span> <span class="n">newUniqueNumber</span><span class="o">()</span> <span class="k">=</span> <span class="o">{</span> <span class="n">lastNumber</span> <span class="o">+=</span> <span class="mi">1</span><span class="o">;</span> <span class="n">lastNumber</span> <span class="o">}</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>When you need a new unique account number in your application, call
<span class="monospaced">Accounts.newUniqueNumber()</span>.</p></div>
<div class="paragraph"><p>The constructor of an object is executed when the object is first used. In
our example, the <span class="monospaced">Accounts</span> constructor is executed with the first call to
<span class="monospaced">Accounts.newUniqueNumber()</span>.</p></div>
<div class="paragraph"><p><strong>If an object is never used, its constructor is not executed.</strong></p></div>
<div class="paragraph"><p>An object can have essentially all the features of a class. It can even
extend other classes or traits. There is just one exception: You cannot
provide constructor parameters.</p></div>
<div class="paragraph"><p>You use an object in Scala whenever you would have used a singleton object
in Java or C++:</p></div>
<div class="ulist"><ul>
<li>
<p>
As a home for utility functions or constants
</p>
</li>
<li>
<p>
When a single immutable instance can be shared efficiently
</p>
</li>
<li>
<p>
When a single instance is required to coordinate some service (the
  singleton design pattern)
</p>
</li>
</ul></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">Many people view the singleton design pattern with disdain. Scala
gives you the tools for both good and bad design, and it is up to you to
use them wisely.</td>
</tr></table>
</div>
</div>
<div class="sect2">
<h3 id="_lab_singleton_utility_object">Lab: Singleton Utility Object</h3>
<div class="paragraph"><p>Open <span class="monospaced">labs/src/main/scala/com/newcircle/objects/Conversions.scala</span>. In it,
write an object called <span class="monospaced">Conversions</span>. It must contain the following
functions:</p></div>
<div class="ulist"><ul>
<li>
<p>
<span class="monospaced">inchesToCentimeters</span>
</p>
</li>
<li>
<p>
<span class="monospaced">gallonsToLiters</span>
</p>
</li>
<li>
<p>
<span class="monospaced">milesToKilometers</span>
</p>
</li>
</ul></div>
<div class="paragraph"><p>To eliminate floating point round-off issues, use the Scala <span class="monospaced">BigDecimal</span>
class. You don&#8217;t need to import it, and Scala will handle conversions for
you:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>scala&gt; BigDecimal(10.30) * 30.2
res1: scala.math.BigDecimal = 311.06

scala&gt; BigDecimal(200.3235) * 2
res2: scala.math.BigDecimal = 400.6470</pre>
</div></div>
<div class="paragraph"><p>To save you some Googling, here are some conversion formulas:</p></div>
<div class="ulist"><ul>
<li>
<p>
1 inch = 2.54 centimeters
</p>
</li>
<li>
<p>
1 gallon = 3.7854118 liters
</p>
</li>
<li>
<p>
1 mile = 1.609344 kilometer
</p>
</li>
</ul></div>
<div class="paragraph"><p>To test your solution, run this tester in SBT:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>&gt; test-only com.newcircle.tests.objects.ConversionsSpec</pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_companion_objects_2">Companion Objects</h3>
<div class="paragraph"><p>In Java or C++, you often have a class with both instance methods and
static methods. In Scala, you achieve this by having a class and a
"companion" object of the same name. For example:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Account</span> <span class="o">{</span>
  <span class="k">val</span> <span class="n">id</span> <span class="k">=</span> <span class="nc">Account</span><span class="o">.</span><span class="n">newUniqueNumber</span><span class="o">()</span>
  <span class="k">private</span> <span class="k">var</span> <span class="n">balance</span> <span class="k">=</span> <span class="mf">0.0</span>
  <span class="k">def</span> <span class="n">deposit</span><span class="o">(</span><span class="n">amount</span><span class="k">:</span> <span class="kt">Double</span><span class="o">)</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="o">{</span> <span class="n">balance</span> <span class="o">+=</span> <span class="n">amount</span> <span class="o">}</span>
  <span class="o">...</span>
<span class="o">}</span>

<span class="k">object</span> <span class="nc">Account</span> <span class="o">{</span> <span class="c1">// The companion object</span>
  <span class="k">private</span> <span class="k">var</span> <span class="n">lastNumber</span> <span class="k">=</span> <span class="mi">0</span>
  <span class="k">private</span> <span class="k">def</span> <span class="n">newUniqueNumber</span><span class="o">()</span> <span class="k">=</span> <span class="o">{</span> <span class="n">lastNumber</span> <span class="o">+=</span> <span class="mi">1</span><span class="o">;</span> <span class="n">lastNumber</span> <span class="o">}</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>The class and its companion object can access each other’s private
features. <strong>They must be located in the same source file.</strong></p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">The companion object of a class is accessible, but it is not in
scope. For example, the <span class="monospaced">Account</span> class has to call
<span class="monospaced">Account.newUniqueNumber()</span> and not just <span class="monospaced">newUniqueNumber()</span> to invoke the
method of the companion object.</td>
</tr></table>
</div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph"><p>In the REPL, you must define the class and the object together in paste
mode. Type:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>:paste</pre>
</div></div>
<div class="paragraph"><p>Then type or paste both the class and object definitions, and type Ctrl+D.</p></div>
</td>
</tr></table>
</div>
</div>
<div class="sect2">
<h3 id="_lab_companion_objects">Lab: Companion Objects</h3>
<div class="paragraph"><p>Create <span class="monospaced">labs/src/main/scala/com/newcircle/objects/Point.scala</span>. Make sure
to use this <span class="monospaced">package</span> directive:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">package</span> <span class="nn">com.newcircle.objects</span>
</pre></div></div></div>
<div class="paragraph"><p>In that source file, define a <span class="monospaced">Point</span> class with a companion object so that
you can construct <span class="monospaced">Point</span> instances as <span class="monospaced">Point(3, 4)</span>, without using <span class="monospaced">new</span>.
The <span class="monospaced">Point</span> class should provide two read-only integer fields, <span class="monospaced">x</span> and <span class="monospaced">y</span>.</p></div>
<div class="paragraph"><p>To test your solution, run this tester in SBT:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>&gt; test-only com.newcircle.tests.objects.PointSpec</pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_objects_extending_a_class_or_trait">Objects Extending a Class or Trait</h3>
<div class="paragraph"><p>An <span class="monospaced">object</span> can extend a class and/or one or more traits. The result is an
object of a class that extends the given class and/or traits, and also has
all of the features specified in the object definition.</p></div>
<div class="paragraph"><p>One useful application is to specify default objects that can be shared.
For example, consider a class for undoable actions in a program.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">abstract</span> <span class="k">class</span> <span class="nc">UndoableAction</span><span class="o">(</span><span class="k">val</span> <span class="n">description</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">def</span> <span class="n">undo</span><span class="o">()</span><span class="k">:</span> <span class="kt">Unit</span>
  <span class="k">def</span> <span class="n">redo</span><span class="o">()</span><span class="k">:</span> <span class="kt">Unit</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>A useful default is the “do nothing” action. Of course, we only need one of
them.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">object</span> <span class="nc">DoNothingAction</span> <span class="k">extends</span> <span class="nc">UndoableAction</span><span class="o">(</span><span class="s">&quot;Do nothing&quot;</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">override</span> <span class="k">def</span> <span class="n">undo</span><span class="o">()</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="o">{}</span>
  <span class="k">override</span> <span class="k">def</span> <span class="n">redo</span><span class="o">()</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="o">{}</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>The <span class="monospaced">DoNothingAction</span> object can be shared across all places that need this
default.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">val</span> <span class="n">actions</span> <span class="k">=</span> <span class="nc">Map</span><span class="o">(</span><span class="s">&quot;open&quot;</span> <span class="o">-&gt;</span> <span class="nc">DoNothingAction</span><span class="o">,</span> <span class="s">&quot;save&quot;</span> <span class="o">-&gt;</span> <span class="nc">DoNothingAction</span><span class="o">,</span> <span class="o">...)</span>
  <span class="c1">// Open and save not yet implemented</span>
</pre></div></div></div>
</div>
<div class="sect2">
<h3 id="_the_span_class_monospaced_apply_span_method_2">The <span class="monospaced">apply</span> Method</h3>
<div class="paragraph"><p>It is common to have objects with an <span class="monospaced">apply</span> method. The <span class="monospaced">apply</span> method is
called for expressions of the form:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>Object(arg1, ..., argN)</pre>
</div></div>
<div class="paragraph"><p>Typically, such an <span class="monospaced">apply</span> method returns an object of the companion class.</p></div>
<div class="paragraph"><p>For example, the <span class="monospaced">Array</span> object defines <span class="monospaced">apply</span> methods that allow array
creation with expressions such as:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="nc">Array</span><span class="o">(</span><span class="s">&quot;Mary&quot;</span><span class="o">,</span> <span class="s">&quot;had&quot;</span><span class="o">,</span> <span class="s">&quot;a&quot;</span><span class="o">,</span> <span class="s">&quot;little&quot;</span><span class="o">,</span> <span class="s">&quot;lamb&quot;</span><span class="o">)</span>
</pre></div></div></div>
<div class="paragraph"><p>Why doesn’t one just use a constructor? Not having to use the <span class="monospaced">new</span> keyword
is handy for nested expressions, such as:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="nc">Array</span><span class="o">(</span><span class="nc">Array</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">7</span><span class="o">),</span> <span class="nc">Array</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="mi">9</span><span class="o">))</span>
</pre></div></div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Caution</div>
</td>
<td class="content">It is easy to confuse <span class="monospaced">Array(100)</span> and <span class="monospaced">new Array(100)</span>. The first
expression calls <span class="monospaced">apply(100)</span>, yielding an <span class="monospaced">Array[Int]</span> with a single
element, the integer 100. The second expression invokes the constructor
<span class="monospaced">this(100)</span>. The result is an <span class="monospaced">Array[Nothing]</span> with 100 <span class="monospaced">null</span> elements.</td>
</tr></table>
</div>
<div class="paragraph"><p>Here is an example of defining an <span class="monospaced">apply</span> method:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Account</span> <span class="k">private</span> <span class="o">(</span><span class="k">val</span> <span class="n">id</span><span class="k">:</span> <span class="kt">Int</span><span class="o">,</span> <span class="n">initialBalance</span><span class="k">:</span> <span class="kt">Double</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">private</span> <span class="k">var</span> <span class="n">balance</span> <span class="k">=</span> <span class="n">initialBalance</span>
  <span class="o">...</span>
<span class="o">}</span>

<span class="k">object</span> <span class="nc">Account</span> <span class="o">{</span> <span class="c1">// The companion object</span>
  <span class="k">def</span> <span class="n">apply</span><span class="o">(</span><span class="n">initialBalance</span><span class="k">:</span> <span class="kt">Double</span><span class="o">)</span> <span class="k">=</span>
    <span class="k">new</span> <span class="nc">Account</span><span class="o">(</span><span class="n">newUniqueNumber</span><span class="o">(),</span> <span class="n">initialBalance</span><span class="o">)</span>
  <span class="o">...</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>Now you can construct an account as</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">val</span> <span class="n">acct</span> <span class="k">=</span> <span class="nc">Account</span><span class="o">(</span><span class="mf">1000.0</span><span class="o">)</span>
</pre></div></div></div>
</div>
<div class="sect2">
<h3 id="_application_objects">Application Objects</h3>
<div class="paragraph"><p>Each Scala program must start with an object’s <span class="monospaced">main</span> method of type
<span class="monospaced">Array[String] =&gt; Unit</span>:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">object</span> <span class="nc">Hello</span> <span class="o">{</span>
  <span class="k">def</span> <span class="n">main</span><span class="o">(</span><span class="n">args</span><span class="k">:</span> <span class="kt">Array</span><span class="o">[</span><span class="kt">String</span><span class="o">])</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="o">{</span>
    <span class="n">println</span><span class="o">(</span><span class="s">&quot;Hello, World!&quot;</span><span class="o">)</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>Instead of providing a <span class="monospaced">main</span> method for your application, you can extend
the <span class="monospaced">App</span> trait and place the program code into the constructor body:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">object</span> <span class="nc">Hello</span> <span class="k">extends</span> <span class="nc">App</span> <span class="o">{</span>
  <span class="n">println</span><span class="o">(</span><span class="s">&quot;Hello, World!&quot;</span><span class="o">)</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>If you need the command-line arguments, you can get them from the <span class="monospaced">args</span>
property:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">object</span> <span class="nc">Hello</span> <span class="k">extends</span> <span class="nc">App</span> <span class="o">{</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">args</span><span class="o">.</span><span class="n">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">)</span>
    <span class="n">println</span><span class="o">(</span><span class="s">&quot;Hello, &quot;</span> <span class="o">+</span> <span class="n">args</span><span class="o">(</span><span class="mi">0</span><span class="o">))</span>
  <span class="k">else</span>
    <span class="n">println</span><span class="o">(</span><span class="s">&quot;Hello, World!&quot;</span><span class="o">)</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>If you invoke the application with the <span class="monospaced">scala.time</span> option set, then the
elapsed time is displayed when the program exits.</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>$ scalac Hello.scala
$ scala -Dscala.time Hello Fred
Hello, Fred
[total 4ms]</pre>
</div></div>
<div class="paragraph"><p>All this involves a bit of magic. The <span class="monospaced">App</span> trait extends another trait,
<span class="monospaced">DelayedInit</span>, that gets special handling from the compiler. All
initialization code of a class with that trait is moved into a <span class="monospaced">delayedInit</span>
method. The <span class="monospaced">main</span> of the <span class="monospaced">App</span> trait method captures the command-line
arguments, calls the <span class="monospaced">delayedInit</span> method, and optionally prints the elapsed
time.</p></div>
</div>
<div class="sect2">
<h3 id="_enumerations">Enumerations</h3>
<div class="paragraph"><p>Unlike Java or C++, Scala does not have enumerated types. However, the
standard library provides an <span class="monospaced">Enumeration</span> helper class that you can use to
produce enumerations.</p></div>
<div class="paragraph"><p>Define an object that extends the <span class="monospaced">Enumeration</span> class and initialize each
value in your enumeration with a call to the <span class="monospaced">Value</span> method. For example,</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">object</span> <span class="nc">TrafficLightColor</span> <span class="k">extends</span> <span class="nc">Enumeration</span> <span class="o">{</span>
  <span class="k">val</span> <span class="nc">Red</span><span class="o">,</span> <span class="nc">Yellow</span><span class="o">,</span> <span class="nc">Green</span> <span class="k">=</span> <span class="nc">Value</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>Here we define three fields, <span class="monospaced">Red</span>, <span class="monospaced">Yellow</span>, and <span class="monospaced">Green</span>, and initialize
each of them with a call to <span class="monospaced">Value</span>. This is a shortcut for:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">val</span> <span class="nc">Red</span> <span class="k">=</span> <span class="nc">Value</span>
<span class="k">val</span> <span class="nc">Yellow</span> <span class="k">=</span> <span class="nc">Value</span>
<span class="k">val</span> <span class="nc">Green</span> <span class="k">=</span> <span class="nc">Value</span>
</pre></div></div></div>
<div class="paragraph"><p>Each call to the <span class="monospaced">Value</span> method returns a new instance of an inner class,
also called <span class="monospaced">Value</span>.</p></div>
<div class="paragraph"><p>Alternatively, you can pass IDs, names, or both to the <span class="monospaced">Value</span> method:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">val</span> <span class="nc">Red</span>    <span class="k">=</span> <span class="nc">Value</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="s">&quot;Stop&quot;</span><span class="o">)</span>
<span class="k">val</span> <span class="nc">Yellow</span> <span class="k">=</span> <span class="nc">Value</span><span class="o">(</span><span class="mi">10</span><span class="o">)</span>   <span class="c1">// Name &quot;Yellow&quot;</span>
<span class="k">val</span> <span class="nc">Green</span>  <span class="k">=</span> <span class="nc">Value</span><span class="o">(</span><span class="s">&quot;Go&quot;</span><span class="o">)</span> <span class="c1">// ID 11</span>
</pre></div></div></div>
<div class="paragraph"><p>If not specified, the ID is one more than the previously assigned one,
starting with zero. The default name is the field name.</p></div>
<div class="paragraph"><p>You can now refer to the enumeration values as <span class="monospaced">TrafficLightColor.Red</span>,
<span class="monospaced">TrafficLightColor.Yellow</span>, and so on. If that gets too tedious, use a
statement:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">import</span> <span class="nn">TrafficLightColor._</span>
</pre></div></div></div>
<div class="paragraph"><p>Remember that the type of the enumeration is <span class="monospaced">TrafficLightColor.Value</span> and
not <span class="monospaced">TrafficLightColor</span>. <span class="monospaced">TrafficLightColor</span> is the type of the <em>object</em>
holding the values. Some people recommend that you add a type alias:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">object</span> <span class="nc">TrafficLightColor</span> <span class="k">extends</span> <span class="nc">Enumeration</span> <span class="o">{</span>
  <span class="k">type</span> <span class="kt">TrafficLightColor</span> <span class="o">=</span> <span class="nc">Value</span>
  <span class="k">val</span> <span class="nc">Red</span><span class="o">,</span> <span class="nc">Yellow</span><span class="o">,</span> <span class="nc">Green</span> <span class="k">=</span> <span class="nc">Value</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>Now the type of the enumeration is <span class="monospaced">TrafficLightColor.TrafficLightColor</span>,
which is only an improvement if you use an import statement. For example:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">import</span> <span class="nn">TrafficLightColor._</span>
<span class="k">def</span> <span class="n">doWhat</span><span class="o">(</span><span class="n">color</span><span class="k">:</span> <span class="kt">TrafficLightColor</span><span class="o">)</span> <span class="k">=</span> <span class="o">{</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">color</span> <span class="o">==</span> <span class="nc">Red</span><span class="o">)</span> <span class="s">&quot;stop&quot;</span>
  <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">color</span> <span class="o">==</span> <span class="nc">Yellow</span><span class="o">)</span> <span class="s">&quot;hurry up&quot;</span>
  <span class="k">else</span> <span class="s">&quot;go&quot;</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>The ID of an enumeration value is returned by the id method, and its name
by the <span class="monospaced">toString</span> method.</p></div>
<div class="paragraph"><p>The call <span class="monospaced">TrafficLightColor.values</span> yields a set of all values:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">for</span> <span class="o">(</span><span class="n">c</span> <span class="k">&lt;-</span> <span class="nc">TrafficLightColor</span><span class="o">.</span><span class="n">values</span><span class="o">)</span> <span class="n">println</span><span class="o">(</span><span class="n">c</span><span class="o">.</span><span class="n">id</span> <span class="o">+</span> <span class="s">&quot;: &quot;</span> <span class="o">+</span> <span class="n">c</span><span class="o">)</span>
</pre></div></div></div>
<div class="paragraph"><p>Finally, you can look up an enumeration value by its ID or name. Both of
the following yield the object <span class="monospaced">TrafficLightColor.Red</span>:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="nc">TrafficLightColor</span><span class="o">(</span><span class="mi">0</span><span class="o">)</span> <span class="c1">// Calls Enumeration.apply</span>
<span class="nc">TrafficLightColor</span><span class="o">.</span><span class="n">withName</span><span class="o">(</span><span class="s">&quot;Red&quot;</span><span class="o">)</span>
</pre></div></div></div>
</div>
<div class="sect2">
<h3 id="_lab_enumerations">Lab: Enumerations</h3>
<div class="paragraph"><p>Open <span class="monospaced">labs/src/main/scala/com/newcircle/objects/Enum.scala</span>.</p></div>
<div class="paragraph"><p>In that source file, define an enumeration called <span class="monospaced">PlayingCardSuit</span>,
describing the four playing card suits, such that the <span class="monospaced">toString</span> method
returns ♣, ♦, ♥, or ♠. The enumeration values should be called
<span class="monospaced">Clubs</span>, <span class="monospaced">Diamonds</span>, <span class="monospaced">Hearts</span> and <span class="monospaced">Spades</span>.</p></div>
<div class="paragraph"><p>You can specify the playing card strings with these Unicode escape sequences:</p></div>
<div class="ulist"><ul>
<li>
<p>
♣ - <span class="monospaced">"\u2663"</span>
</p>
</li>
<li>
<p>
♦ - <span class="monospaced">"\u2666"</span>
</p>
</li>
<li>
<p>
♥ - <span class="monospaced">"\u2665"</span>
</p>
</li>
<li>
<p>
♠ - <span class="monospaced">"\u2660"</span>
</p>
</li>
</ul></div>
<div class="paragraph"><p>To test your solution, run this tester in SBT:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>&gt; test-only com.newcircle.tests.objects.EnumSpec</pre>
</div></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="lesson-07-packages-and-imports">Packages and Imports</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_lesson_objectives_8">Lesson Objectives</h3>
<div class="paragraph"><p>In this lesson, you will learn how packages and import statements work in
Scala. Both packages and imports are more regular than in Java; they are
also a bit more flexible.</p></div>
</div>
<div class="sect2">
<h3 id="_summary_6">Summary</h3>
<div class="ulist"><ul>
<li>
<p>
Packages nest just like inner classes.
</p>
</li>
<li>
<p>
Package paths are not absolute.
</p>
</li>
<li>
<p>
A chain <span class="monospaced">x.y.z</span> in a <span class="monospaced">package</span> clause leaves the intermediate packages <span class="monospaced">x</span>
  and <span class="monospaced">x.y</span> invisible.
</p>
</li>
<li>
<p>
Package statements without braces at the top of the file extend to the
  entire file.
</p>
</li>
<li>
<p>
A <span class="monospaced">package</span> object can hold functions and variables.
</p>
</li>
<li>
<p>
Import statements can import packages, classes, and objects.
</p>
</li>
<li>
<p>
Import statements can be anywhere.
</p>
</li>
<li>
<p>
Import statements can rename and hide members.
</p>
</li>
<li>
<p>
<span class="monospaced">java.lang</span>, <span class="monospaced">scala</span>, and <span class="monospaced">Predef</span> are always imported.
</p>
</li>
</ul></div>
</div>
<div class="sect2">
<h3 id="_packages">Packages</h3>
<div class="paragraph"><p>Packages in Scala serve the same rol as packages in Java or namespaces in
C++: They allow you to manage names in a large program.</p></div>
<div class="paragraph"><p>To add items to a package, you can include them in package statements, such
as:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">package</span> <span class="nn">com</span> <span class="o">{</span>
  <span class="k">package</span> <span class="nn">horstmann</span> <span class="o">{</span>
    <span class="k">package</span> <span class="nn">impatient</span> <span class="o">{</span>
      <span class="k">class</span> <span class="nc">Employee</span>
      <span class="o">...</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>Then the class name <span class="monospaced">Employee</span> can be accessed anywhere as
<span class="monospaced">com.horstmann.impatient.Employee</span>.</p></div>
<div class="paragraph"><p>Unlike the definition of an object or a class, a package can be defined in
multiple files. The preceding code might be in a file <span class="monospaced">Employee.scala</span>, and
a file <span class="monospaced">Manager.scala</span> might contain:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">package</span> <span class="nn">com</span> <span class="o">{</span>
  <span class="k">package</span> <span class="nn">horstmann</span> <span class="o">{</span>
    <span class="k">package</span> <span class="nn">impatient</span> <span class="o">{</span>
      <span class="k">class</span> <span class="nc">Manager</span>
      <span class="o">...</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">Unlike Java, there is no enforced relationship between the directory
of the source file and the package. You don’t have to put <span class="monospaced">Employee.scala</span>
and <span class="monospaced">Manager.scala</span> into a <span class="monospaced">com/horstmann/impatient</span> directory.</td>
</tr></table>
</div>
<div class="paragraph"><p>Conversely, you can contribute to more than one package in a single file.
The file <span class="monospaced">Employee.scala</span> can contain:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">package</span> <span class="nn">com</span> <span class="o">{</span>
  <span class="k">package</span> <span class="nn">horstmann</span> <span class="o">{</span>
    <span class="k">package</span> <span class="nn">impatient</span> <span class="o">{</span>
      <span class="k">class</span> <span class="nc">Employee</span>
      <span class="o">...</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>

<span class="k">package</span> <span class="nn">org</span> <span class="o">{</span>
  <span class="k">package</span> <span class="nn">bigjava</span> <span class="o">{</span>
    <span class="k">class</span> <span class="nc">Counter</span>
    <span class="o">...</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div></div></div>
</div>
<div class="sect2">
<h3 id="_scope_rules">Scope Rules</h3>
<div class="paragraph"><p>In Scala, the scope rules for packages are more consistent than those in
Java. Scala packages nest just like all other scopes. You can access names
from the enclosing scope. For example,</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">package</span> <span class="nn">com</span> <span class="o">{</span>
  <span class="k">package</span> <span class="nn">horstmann</span> <span class="o">{</span>
    <span class="k">object</span> <span class="nc">Utils</span> <span class="o">{</span>
      <span class="k">def</span> <span class="n">percentOf</span><span class="o">(</span><span class="n">value</span><span class="k">:</span> <span class="kt">Double</span><span class="o">,</span> <span class="n">rate</span><span class="k">:</span> <span class="kt">Double</span><span class="o">)</span> <span class="k">=</span> <span class="n">value</span> <span class="o">*</span> <span class="n">rate</span> <span class="o">/</span> <span class="mi">100</span>
      <span class="o">...</span>
    <span class="o">}</span>

    <span class="k">package</span> <span class="nn">impatient</span> <span class="o">{</span>
      <span class="k">class</span> <span class="nc">Employee</span> <span class="o">{</span>
        <span class="o">...</span>
        <span class="k">def</span> <span class="n">giveRaise</span><span class="o">(</span><span class="n">rate</span><span class="k">:</span> <span class="kt">scala.Double</span><span class="o">)</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="o">{</span>
          <span class="n">salary</span> <span class="o">+=</span> <span class="nc">Utils</span><span class="o">.</span><span class="n">percentOf</span><span class="o">(</span><span class="n">salary</span><span class="o">,</span> <span class="n">rate</span><span class="o">)</span>
        <span class="o">}</span>
      <span class="o">}</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>Note the <span class="monospaced">Utils.percentOf</span> qualifier. The <span class="monospaced">Utils</span> class was defined in the
parent package. Everything in the parent package is in scope, and it is not
necessary to use <span class="monospaced">com.horstmann.Utils.percentOf</span>. (You could, though, if you
prefer. After all, <span class="monospaced">com</span> is also in scope.)</p></div>
</div>
<div class="sect2">
<h3 id="_scoping_conflicts">Scoping Conflicts</h3>
<div class="paragraph"><p><em>However</em>&#8230; Consider the following:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">package</span> <span class="nn">com</span> <span class="o">{</span>
  <span class="k">package</span> <span class="nn">horstmann</span> <span class="o">{</span>
    <span class="k">package</span> <span class="nn">impatient</span> <span class="o">{</span>
      <span class="k">class</span> <span class="nc">Manager</span> <span class="o">{</span>
        <span class="k">val</span> <span class="n">subordinates</span> <span class="k">=</span> <span class="k">new</span> <span class="n">collection</span><span class="o">.</span><span class="n">mutable</span><span class="o">.</span><span class="nc">ArrayBuffer</span><span class="o">[</span><span class="kt">Employee</span><span class="o">]</span>
        <span class="o">...</span>
      <span class="o">}</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>This code takes advantage of the fact that the scala package is always
imported. Therefore, the collection package is actually <span class="monospaced">scala.collection</span>.</p></div>
<div class="paragraph"><p>And now suppose someone introduces the following package, perhaps in a
different file:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">package</span> <span class="nn">com</span> <span class="o">{</span>
  <span class="k">package</span> <span class="nn">horstmann</span> <span class="o">{</span>
    <span class="k">package</span> <span class="nn">collection</span> <span class="o">{</span>
      <span class="o">...</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>Now the <span class="monospaced">Manager</span> class no longer compiles. It looks for a <span class="monospaced">mutable</span> member
inside the <span class="monospaced">com.horstmann.collection</span> package and doesn’t find it.</p></div>
<div class="paragraph"><p>The intent in the <span class="monospaced">Manager</span> class was the <span class="monospaced">collection</span> package in the
<strong>top-level <span class="monospaced">scala</span> package</strong>, not whatever collection subpackage happened to
be in some accessible scope.</p></div>
<div class="paragraph"><p>In Java, this problem can’t occur because package names are always
absolute, starting at the root of the package hierarchy. But in Scala,
package names are relative, just like inner class names.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">With inner classes, one doesn’t usually run into problems because all
the code is in one file, under control of whoever is in charge of that
file. But packages are open-ended. Anyone can contribute to a package at
any time.</td>
</tr></table>
</div>
<div class="paragraph"><p>One solution is to use absolute package names, starting with <span class="monospaced">_root_</span>:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">val</span> <span class="n">subordinates</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">_root_</span><span class="o">.</span><span class="n">scala</span><span class="o">.</span><span class="n">collection</span><span class="o">.</span><span class="n">mutable</span><span class="o">.</span><span class="nc">ArrayBuffer</span><span class="o">[</span><span class="kt">Employee</span><span class="o">]</span>
</pre></div></div></div>
<div class="paragraph"><p>Another approach is to use “chained” package clauses, as detailed in the
next section.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">Most programmers use complete paths for package names, without the
<span class="monospaced">_root_</span> prefix. This is safe as long as everyone avoids names <span class="monospaced">scala</span>, <span class="monospaced">java</span>,
<span class="monospaced">com</span>, <span class="monospaced">org</span>, and so on, for nested packages.</td>
</tr></table>
</div>
</div>
<div class="sect2">
<h3 id="_chained_package_clauses">Chained Package Clauses</h3>
<div class="paragraph"><p>A package clause can contain a "chain," or a path segment:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">package</span> <span class="nn">com.horstmann.impatient</span> <span class="o">{</span>
  <span class="c1">// Members of com and com.horstmann are not visible here</span>
  <span class="k">package</span> <span class="nn">people</span> <span class="o">{</span>
    <span class="k">class</span> <span class="nc">Person</span>
    <span class="o">...</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>Such a clause limits the visible members. Now a <span class="monospaced">com.horstmann.collection</span>
package would no longer be accessible as <span class="monospaced">collection</span>.</p></div>
</div>
<div class="sect2">
<h3 id="_top_of_file_notation">Top-of-file Notation</h3>
<div class="paragraph"><p>Instead of the nested notation that we have used up to now, you can have
<span class="monospaced">package</span> clauses at the top of the file, without braces, as in Java:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">package</span> <span class="nn">com.horstmann.impatient.people</span>

<span class="k">class</span> <span class="nc">Person</span>
<span class="o">...</span>
</pre></div></div></div>
<div class="paragraph"><p>You can also work your way down to the leaf-level package:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">package</span> <span class="nn">com.horstmann.impatient</span>
<span class="k">package</span> <span class="nn">people</span>

<span class="k">class</span> <span class="nc">Person</span>
<span class="o">...</span>
</pre></div></div></div>
<div class="paragraph"><p>This is equivalent to</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">package</span> <span class="nn">com.horstmann.impatient</span> <span class="o">{</span>
  <span class="k">package</span> <span class="nn">people</span> <span class="o">{</span>
    <span class="k">class</span> <span class="nc">Person</span>
    <span class="o">...</span>
    <span class="c1">// Until the end of the file</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>This is the preferred notation if all the code in the file belongs to the
same package (which is the usual case).</p></div>
<div class="paragraph"><p>Note that in the example above, everything in the file belongs to the
package <span class="monospaced">com.horstmann.impatient.people</span>, but the package
<span class="monospaced">com.horstmann.impatient</span> has also been opened up so you can refer to its
contents.</p></div>
</div>
<div class="sect2">
<h3 id="_package_objects">Package Objects</h3>
<div class="paragraph"><p>A package can contain classes, objects, and traits, but not the definitions
of functions or variables. That’s an unfortunate limitation of the Java
virtual machine. It would make more sense to add utility functions or
constants to a package, instead of some <span class="monospaced">Utils</span> object.</p></div>
<div class="paragraph"><p>Package objects address this limitation.</p></div>
<div class="paragraph"><p>Every package can have one <em>package object</em>. You define it in the parent
package, and it has the same name as the child package. For example,</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">package</span> <span class="nn">com.horstmann.impatient</span>

<span class="k">package</span> <span class="nn">object</span> <span class="n">people</span> <span class="o">{</span>
  <span class="k">val</span> <span class="n">defaultName</span> <span class="k">=</span> <span class="s">&quot;John Q. Public&quot;</span>
<span class="o">}</span>

<span class="k">package</span> <span class="nn">people</span> <span class="o">{</span>
  <span class="k">class</span> <span class="nc">Person</span> <span class="o">{</span>
    <span class="k">var</span> <span class="n">name</span> <span class="k">=</span> <span class="n">defaultName</span> <span class="c1">// A constant from the package</span>
  <span class="o">}</span>
  <span class="o">...</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>Note that the <span class="monospaced">defaultName</span> value didn’t need to be qualified, because it
was in the same package. Elsewhere, it is accessible as
<span class="monospaced">com.horstmann.impatient.people.defaultName</span>.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">It is a good idea to use the same naming scheme for source files. Put
the package object into a file
<span class="monospaced">com/horstmann/impatient/people/package.scala</span>. That way, anyone who wants
to add functions or variables to a package can find the package object
easily.</td>
</tr></table>
</div>
</div>
<div class="sect2">
<h3 id="_lab_package_object">Lab: Package object</h3>
<div class="paragraph"><p>Rewrite the <span class="monospaced">Conversions</span> object, from the previous lesson, so that the
functions are in a package object. Put the result in
<span class="monospaced">labs/src/main/scala/com/newcircle/packages/Conversions.scala</span>.</p></div>
<div class="paragraph"><p>The conversion functions should reside in the <span class="monospaced">com.newcircle.packages</span>
package, outside of any class or object.</p></div>
<div class="paragraph"><p>To test your solution, run this tester in SBT:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>&gt; test-only com.newcircle.tests.packages.ConversionsSpec</pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_package_visibility">Package Visibility</h3>
<div class="paragraph"><p>In Java, a class member that isn’t declared as <span class="monospaced">public</span>, <span class="monospaced">private</span>, or
<span class="monospaced">protected</span> is visible in the package containing the class. In Scala, you can
achieve the same effect with qualifiers. The following method is visible in
its own package:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">package</span> <span class="nn">com.horstmann.impatient.people</span>

<span class="k">class</span> <span class="nc">Person</span> <span class="o">{</span>
  <span class="k">private</span><span class="o">[</span><span class="kt">people</span><span class="o">]</span> <span class="k">def</span> <span class="n">description</span> <span class="k">=</span> <span class="s">&quot;A person with name &quot;</span> <span class="o">+</span> <span class="n">name</span>
  <span class="o">...</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>You can extend the visibility to an enclosing package:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">private</span><span class="o">[</span><span class="kt">impatient</span><span class="o">]</span> <span class="k">def</span> <span class="n">description</span> <span class="k">=</span> <span class="s">&quot;A person with name &quot;</span> <span class="o">+</span> <span class="n">name</span>
</pre></div></div></div>
</div>
<div class="sect2">
<h3 id="_imports">Imports</h3>
<div class="paragraph"><p>As with Java, imports let you use short names instead of long ones. With
the clause</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">import</span> <span class="nn">java.awt.Color</span>
</pre></div></div></div>
<div class="paragraph"><p>you can write <span class="monospaced">Color</span> in your code instead of <span class="monospaced">java.awt.Color</span>.</p></div>
<div class="paragraph"><p>That is the sole purpose of imports. If you don’t mind long names, you’ll
never need them.</p></div>
<div class="paragraph"><p>You can import all members of a package as</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">import</span> <span class="nn">java.awt._</span>
</pre></div></div></div>
<div class="paragraph"><p>This is the same as the * wildcard in Java.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">In Scala, * is a valid character for an identifier. You could define
a package com.horstmann.*.people, but please don’t.</td>
</tr></table>
</div>
<div class="paragraph"><p>You can also import all members of a class or object.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">import</span> <span class="nn">java.awt.Color._</span>
<span class="k">val</span> <span class="n">c1</span> <span class="k">=</span> <span class="nc">RED</span> <span class="c1">// Color.RED</span>
<span class="k">val</span> <span class="n">c2</span> <span class="k">=</span> <span class="n">decode</span><span class="o">(</span><span class="s">&quot;#ff0000&quot;</span><span class="o">)</span> <span class="c1">// Color.decode</span>
</pre></div></div></div>
<div class="paragraph"><p>This is like <span class="monospaced">import static</span> in Java. Java programmers seem to live in fear
of this variant, but in Scala it is commonly used.</p></div>
<div class="paragraph"><p>Once you import a package, you can access its subpackages with shorter
names. For example:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">import</span> <span class="nn">java.awt._</span>

<span class="k">def</span> <span class="n">handler</span><span class="o">(</span><span class="n">evt</span><span class="k">:</span> <span class="kt">event.ActionEvent</span><span class="o">)</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="o">{</span> <span class="c1">// java.awt.event.ActionEvent</span>
  <span class="o">...</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>The <span class="monospaced">event</span> package is a member of <span class="monospaced">java.awt</span>, and the import brings it
into scope.</p></div>
</div>
<div class="sect2">
<h3 id="_imports_can_be_anywhere">Imports Can Be Anywhere</h3>
<div class="paragraph"><p>In Scala, an import statement can be anywhere, not just at the top of a
file. The scope of the import statement extends until the end of the
enclosing block. For example,</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Manager</span> <span class="o">{</span>
  <span class="k">import</span> <span class="nn">scala.collection.mutable._</span>
  <span class="k">val</span> <span class="n">subordinates</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">ArrayBuffer</span><span class="o">[</span><span class="kt">Employee</span><span class="o">]</span>
  <span class="o">...</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>This is a very useful feature, particularly with wildcard imports. It is
always a bit worrisome to import lots of names from different sources. In
fact, some Java programmers dislike wildcard imports so much that they
never use them, but let their IDE generate long lists of imported classes.</p></div>
<div class="paragraph"><p>By putting the imports where they are needed, you can greatly reduce the
potential for conflicts.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">Nested imports are also useful when what you&#8217;re importing is part of the
internal implementation details of a function or class.</td>
</tr></table>
</div>
</div>
<div class="sect2">
<h3 id="_renaming_and_hiding_members">Renaming and Hiding Members</h3>
<div class="paragraph"><p>If you want to import a few members from a package, use a selector like this:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">import</span> <span class="nn">java.awt.</span><span class="o">{</span><span class="nc">Color</span><span class="o">,</span> <span class="nc">Font</span><span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>The selector syntax lets you rename members:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">import</span> <span class="nn">java.util.</span><span class="o">{</span><span class="nc">HashMap</span> <span class="k">=&gt;</span> <span class="nc">JavaHashMap</span><span class="o">}</span>
<span class="k">import</span> <span class="nn">scala.collection.mutable._</span>
</pre></div></div></div>
<div class="paragraph"><p>Now <span class="monospaced">JavaHashMap</span> is a <span class="monospaced">java.util.HashMap</span>, while plain <span class="monospaced">HashMap</span> is a
<span class="monospaced">scala.collection.mutable.HashMap</span>.</p></div>
<div class="paragraph"><p>The selector <span class="monospaced">HashMap =&gt; _</span> hides a member instead of renaming it. This is
only useful if you import others:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">import</span> <span class="nn">java.util.</span><span class="o">{</span><span class="nc">HashMap</span> <span class="k">=&gt;</span> <span class="k">_</span><span class="o">,</span> <span class="k">_</span><span class="o">}</span>
<span class="k">import</span> <span class="nn">scala.collection.mutable._</span>
</pre></div></div></div>
<div class="paragraph"><p>Now <span class="monospaced">HashMap</span> unambiguously refers to <span class="monospaced">scala.collection.mutable.HashMap</span>,
because <span class="monospaced">java.util.HashMap</span> is hidden.</p></div>
</div>
<div class="sect2">
<h3 id="_automatic_imports">Automatic Imports</h3>
<div class="paragraph"><p>Every Scala program implicitly starts with</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">import</span> <span class="nn">java.lang._</span>
<span class="k">import</span> <span class="nn">scala._</span>
<span class="k">import</span> <span class="nn">Predef._</span>
</pre></div></div></div>
<div class="paragraph"><p>As with Java programs, <span class="monospaced">java.lang</span> is always imported. Next, the <span class="monospaced">scala</span>
package is imported, but in a special way.</p></div>
<div class="paragraph"><p><em>Unlike all other imports</em>, this one is allowed to override the preceding
import. For example, <span class="monospaced">scala.StringBuilder</span> overrides
<span class="monospaced">java.lang.StringBuilder</span> instead of conflicting with it.</p></div>
<div class="paragraph"><p>Finally, the <span class="monospaced">Predef</span> object is imported. It contains quite a few useful
functions. (These could equally well have been placed into the <span class="monospaced">scala</span>
package object, but <span class="monospaced">Predef</span> was introduced before Scala had package
objects.)</p></div>
<div class="paragraph"><p>Since the <span class="monospaced">scala</span> package is imported by default, you never need to write
package names that start with scala. For example,</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>collection.mutable.HashMap</pre>
</div></div>
<div class="paragraph"><p>is just as good as</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>scala.collection.mutable.HashMap</pre>
</div></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="lesson-08-inheritance">Inheritance</h2>
<div class="sectionbody">
<div class="paragraph"><p>In this lesson, you will learn the most important ways in which
inheritance in Scala differs from its counterparts in Java and C++.</p></div>
<div class="paragraph"><p>Note that we <em>only</em> discuss the case in which a class inherits from
another class. In a little while, we will introduce traits.</p></div>
<div class="sect2">
<h3 id="_summary_7">Summary</h3>
<div class="ulist"><ul>
<li>
<p>
The <span class="monospaced">extends</span> and <span class="monospaced">final</span> keywords are as in Java.
</p>
</li>
<li>
<p>
You must use override when you override a method.
</p>
</li>
<li>
<p>
Only the primary constructor can call the primary superclass constructor.
</p>
</li>
<li>
<p>
You can override fields.
</p>
</li>
</ul></div>
</div>
<div class="sect2">
<h3 id="_extending_a_class">Extending a Class</h3>
<div class="paragraph"><p>You extend a class in Scala just like you would in Java: with the <span class="monospaced">extends</span>
keyword:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Employee</span> <span class="k">extends</span> <span class="nc">Person</span> <span class="o">{</span>
  <span class="k">var</span> <span class="n">salary</span><span class="k">:</span> <span class="err">0</span><span class="kt">.</span><span class="err">0</span>
  <span class="kt">...</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>As in Java:</p></div>
<div class="ulist"><ul>
<li>
<p>
You specify fields and methods that are new to the subclass or
  that override methods in the superclass.
</p>
</li>
<li>
<p>
You can declare a class <span class="monospaced">final</span> so that it cannot be extended. You can
  also declare individual methods or fields <span class="monospaced">final</span> so that they cannot be
  overridden.
</p>
</li>
</ul></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">This is different from Java, where a <span class="monospaced">final</span> field is immutable,
similar to <span class="monospaced">val</span> in Scala.</td>
</tr></table>
</div>
</div>
<div class="sect2">
<h3 id="_overriding_methods">Overriding Methods</h3>
<div class="paragraph"><p>In Scala, you must use the <span class="monospaced">override</span> modifier when you override a method
that isn’t abstract. For example,</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Person</span> <span class="o">{</span>
  <span class="o">...</span>
  <span class="k">override</span> <span class="k">def</span> <span class="n">toString</span> <span class="k">=</span> <span class="n">getClass</span><span class="o">.</span><span class="n">getName</span> <span class="o">+</span> <span class="s">&quot;[name=&quot;</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s">&quot;]&quot;</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>The <span class="monospaced">override</span> modifier can give useful error messages in a number of
common situations, such as:</p></div>
<div class="ulist"><ul>
<li>
<p>
When you misspell the name of the method that you are overriding
</p>
</li>
<li>
<p>
When you accidentally provide a wrong parameter type in the overriding method
</p>
</li>
<li>
<p>
When you introduce a new method in a superclass that clashes with a
  subclass method
</p>
</li>
</ul></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">In Java, you use the (optional) <span class="monospaced">@Override</span> annotation to signal an
override. In Scala, you use the <span class="monospaced">override</span> keyword, and it is <em>not</em> optional.</td>
</tr></table>
</div>
<div class="paragraph"><p>Invoking a superclass method in Scala works exactly like in Java, with the
keyword <span class="monospaced">super</span>:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Employee</span> <span class="k">extends</span> <span class="nc">Person</span> <span class="o">{</span>
  <span class="o">...</span>
  <span class="k">override</span> <span class="k">def</span> <span class="n">toString</span> <span class="k">=</span> <span class="k">super</span><span class="o">.</span><span class="n">toString</span> <span class="o">+</span> <span class="s">&quot;[salary=&quot;</span> <span class="o">+</span> <span class="n">salary</span> <span class="o">+</span> <span class="s">&quot;]&quot;</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>The call <span class="monospaced">super.toString</span> invokes the toString method of the
superclass—the <span class="monospaced">Person.toString</span> method, in this case.</p></div>
</div>
<div class="sect2">
<h3 id="_type_checks_and_casts">Type Checks and Casts</h3>
<div class="paragraph"><p>To test whether an object belongs to a given class, use the <span class="monospaced">isInstanceOf</span>
method. If the test succeeds, you can use the <span class="monospaced">asInstanceOf</span> method to
convert a reference to a subclass reference:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">if</span> <span class="o">(</span><span class="n">p</span><span class="o">.</span><span class="n">isInstanceOf</span><span class="o">[</span><span class="kt">Employee</span><span class="o">])</span> <span class="o">{</span>
  <span class="k">val</span> <span class="n">s</span> <span class="k">=</span> <span class="n">p</span><span class="o">.</span><span class="n">asInstanceOf</span><span class="o">[</span><span class="kt">Employee</span><span class="o">]</span> <span class="c1">// s has type Employee</span>
  <span class="o">...</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="ulist"><ul>
<li>
<p>
The <span class="monospaced">p.isInstanceOf[Employee]</span> test succeeds if <span class="monospaced">p</span> refers to an object of
  class <span class="monospaced">Employee</span> or its subclass (such as <span class="monospaced">Manager</span>).
</p>
</li>
<li>
<p>
If <span class="monospaced">p</span> is <span class="monospaced">null</span>, then <span class="monospaced">p.isInstanceOf[Employee]</span> returns <span class="monospaced">false</span> and
  <span class="monospaced">p.asInstanceOf[Employee]</span> returns <span class="monospaced">null</span>.
</p>
</li>
<li>
<p>
If <span class="monospaced">p</span> is not an <span class="monospaced">Employee</span>, then <span class="monospaced">p.asInstanceOf[Employee]</span> throws an
  exception.
</p>
</li>
</ul></div>
<div class="paragraph"><p>If you want to test whether <span class="monospaced">p</span> refers to an <span class="monospaced">Employee</span> object, but not a
subclass, use</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">if</span> <span class="o">(</span><span class="n">p</span><span class="o">.</span><span class="n">getClass</span> <span class="o">==</span> <span class="n">classOf</span><span class="o">[</span><span class="kt">Employee</span><span class="o">])</span>
</pre></div></div></div>
<div class="paragraph"><p>The <span class="monospaced">classOf</span> method is defined in the <span class="monospaced">scala.Predef</span> object that is always
imported.</p></div>
<div class="paragraph"><p>Here&#8217;s a comparison of Java and Scala type checks and casts.</p></div>
<table class="tableblock frame-all grid-all"
style="
width:50%;
">
<col style="width:50%;">
<col style="width:50%;">
<thead>
<tr>
<th class="tableblock halign-left valign-top" > Scala                 </th>
<th class="tableblock halign-left valign-top" > Java</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">obj.isInstanceOf[C]</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">obj instanceof C</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">obj.asInstanceOf[C]</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">(C) obj</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">classOf[C]</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">C.class</span></p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="title">Pattern matching, for the win</div>
<div class="paragraph"><p>Pattern matching is usually a better alternative to using type checks and
casts. For example:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="n">p</span> <span class="k">match</span> <span class="o">{</span>
  <span class="k">case</span> <span class="n">s</span><span class="k">:</span> <span class="kt">Employee</span> <span class="o">=&gt;</span> <span class="o">...</span> <span class="c1">// Process s as an Employee</span>
  <span class="k">case</span> <span class="k">_</span> <span class="k">=&gt;</span> <span class="o">...</span> <span class="c1">// p wasn&#39;t an Employee</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>We&#8217;ll discuss pattern matching in detail in an upcoming lesson.</p></div>
</td>
</tr></table>
</div>
</div>
<div class="sect2">
<h3 id="_protected_fields_and_methods">Protected Fields and Methods</h3>
<div class="paragraph"><p>As in Java or C++, you can declare a field or method as <span class="monospaced">protected</span>. Such a
member is accessible from any subclass, but not from other locations.</p></div>
<div class="paragraph"><p>Unlike in Java, a protected member is not visible throughout the package to
which the class belongs. (If you want this visibility, you can use the
<span class="monospaced">package</span> modifier, as noted in the previous lesson.)</p></div>
<div class="paragraph"><p>There is also a <span class="monospaced">protected[this]</span> variant that restricts access to the
current object, similar to the object-private <span class="monospaced">private[this]</span> construct.</p></div>
</div>
<div class="sect2">
<h3 id="_superclass_construction">Superclass Construction</h3>
<div class="paragraph"><p>Recall that a class has one primary constructor and any number of auxiliary
constructors, and that all auxiliary constructors must start with a call to
a preceding auxiliary constructor or the primary constructor.</p></div>
<div class="paragraph"><p>As a consequence, <strong>an auxiliary constructor can never invoke a superclass
constructor directly.</strong></p></div>
<div class="paragraph"><p>Only the primary constructor can call a superclass constructor.</p></div>
<div class="paragraph"><p>Recall that the primary constructor is intertwined with the class
definition. The call to the superclass constructor is similarly
intertwined. Here is an example:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Employee</span><span class="o">(</span><span class="n">name</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">age</span><span class="k">:</span> <span class="kt">Int</span><span class="o">,</span> <span class="k">val</span> <span class="n">salary</span> <span class="k">:</span> <span class="kt">Double</span><span class="o">)</span> <span class="k">extends</span>
  <span class="nc">Person</span><span class="o">(</span><span class="n">name</span><span class="o">,</span> <span class="n">age</span><span class="o">)</span>
</pre></div></div></div>
<div class="paragraph"><p>This defines a subclass and a primary constructor that calls the superclass
constructor.</p></div>
<div class="paragraph"><p>Intertwining the class and the constructor makes for very concise code.</p></div>
<div class="paragraph"><p>If it helps, think of the primary constructor parameters as parameters of
the class.</p></div>
<div class="paragraph"><p>Here, the <span class="monospaced">Employee</span> class has three parameters: <span class="monospaced">name</span>, <span class="monospaced">age</span>, and
<span class="monospaced">salary</span>, two of which it “passes” to the superclass.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Employee</span> <span class="kd">extends</span> <span class="n">Person</span> <span class="o">{</span> <span class="c1">// Java</span>
  <span class="kd">private</span> <span class="kt">double</span> <span class="n">salary</span><span class="o">;</span>
  <span class="kd">public</span> <span class="nf">Employee</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">,</span> <span class="kt">int</span> <span class="n">age</span><span class="o">,</span> <span class="kt">double</span> <span class="n">salary</span><span class="o">)</span> <span class="o">{</span>
    <span class="kd">super</span><span class="o">(</span><span class="n">name</span><span class="o">,</span> <span class="n">age</span><span class="o">);</span>
    <span class="k">this</span><span class="o">.</span><span class="na">salary</span> <span class="o">=</span> <span class="n">salary</span><span class="o">;</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">In a Scala constructor, you can never call <span class="monospaced">super(params)</span>, as you
would in Java, to call the superclass constructor.</td>
</tr></table>
</div>
<div class="paragraph"><p>A Scala class can extend a Java class. Its primary constructor must invoke
one of the constructors of the Java superclass. For example:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Square</span><span class="o">(</span><span class="n">x</span><span class="k">:</span> <span class="kt">Int</span><span class="o">,</span> <span class="n">y</span><span class="k">:</span> <span class="kt">Int</span><span class="o">,</span> <span class="n">width</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span> <span class="k">extends</span> <span class="n">java</span><span class="o">.</span><span class="n">awt</span><span class="o">.</span><span class="nc">Rectangle</span><span class="o">(</span><span class="n">x</span><span class="o">,</span> <span class="n">y</span><span class="o">,</span> <span class="n">width</span><span class="o">,</span> <span class="n">width</span><span class="o">)</span>
</pre></div></div></div>
</div>
<div class="sect2">
<h3 id="_overriding_fields">Overriding Fields</h3>
<div class="paragraph"><p>Recall that a field in Scala consists of a private field and
accessor/mutator methods. You can override a <span class="monospaced">val</span> (or a parameterless <span class="monospaced">def</span>)
with another <span class="monospaced">val</span> field of the same name. The subclass has a private field
and a public getter, and the getter overrides the superclass getter (or
method).</p></div>
<div class="paragraph"><p>For example:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Person</span><span class="o">(</span><span class="k">val</span> <span class="n">name</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">override</span> <span class="k">def</span> <span class="n">toString</span> <span class="k">=</span> <span class="n">getClass</span><span class="o">.</span><span class="n">getName</span> <span class="o">+</span> <span class="s">&quot;[name=&quot;</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s">&quot;]&quot;</span>
<span class="o">}</span>

<span class="k">class</span> <span class="nc">SecretAgent</span><span class="o">(</span><span class="n">codename</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">Person</span><span class="o">(</span><span class="n">codename</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">override</span> <span class="k">val</span> <span class="n">name</span> <span class="k">=</span> <span class="s">&quot;secret&quot;</span> <span class="c1">// Don&#39;t want to reveal name . . .</span>
  <span class="k">override</span> <span class="k">val</span> <span class="n">toString</span> <span class="k">=</span> <span class="s">&quot;secret&quot;</span> <span class="c1">// . . . or class name</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>This example shows the mechanics, but it is rather artificial. A more
common case is to override an abstract <span class="monospaced">def</span> with a <span class="monospaced">val</span>, like this:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">abstract</span> <span class="k">class</span> <span class="nc">Person</span> <span class="o">{</span>
  <span class="k">def</span> <span class="n">id</span><span class="k">:</span> <span class="kt">Int</span> <span class="c1">// Each person has an ID that is computed in some way</span>
  <span class="o">...</span>
<span class="o">}</span>

<span class="k">class</span> <span class="nc">Student</span><span class="o">(</span><span class="k">override</span> <span class="k">val</span> <span class="n">id</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">Person</span>
<span class="c1">// A student ID is simply provided in the constructor</span>
</pre></div></div></div>
<div class="sect3">
<h4 id="_restrictions">Restrictions</h4>
<div class="ulist"><ul>
<li>
<p>
A <span class="monospaced">def</span> can only override another <span class="monospaced">def</span>.
</p>
</li>
<li>
<p>
A <span class="monospaced">val</span> can only override another <span class="monospaced">val</span> or a parameterless <span class="monospaced">def</span>.
</p>
</li>
<li>
<p>
A <span class="monospaced">var</span> can only override an abstract <span class="monospaced">var</span>.
</p>
</li>
</ul></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Caution</div>
</td>
<td class="content">In previous lessons, we used a lot of <span class="monospaced">var</span> fields. We said that
it&#8217;s okay to use a <span class="monospaced">var</span>, because you can always change your mind and
reimplement it with your own custom getter/setter pair. <em>However</em>: The
programmers <em>extending</em> your class do not have that option. They <em>cannot</em>
override a <span class="monospaced">var</span> with a getter/setter pair. <strong>If you provide a <span class="monospaced">var</span>, all
subclasses are stuck with it.</strong></td>
</tr></table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_lab_subclassing">Lab: Subclassing</h3>
<div class="paragraph"><p>Open
<span class="monospaced">labs/src/main/scala/com/newcircle/inheritance/CheckingAccount.scala</span> and
make the <span class="monospaced">CheckingAccount</span> class extend the <span class="monospaced">BankAccount</span> class from a
previous lesson. Add the following behavior:</p></div>
<div class="ulist"><ul>
<li>
<p>
Each deposit should cost $1.00. Thus, if someone deposits $100.00 into an
  empty checking account, the resulting balance will be $99.00.
</p>
</li>
<li>
<p>
Each withdrawal should cost $1.00. If a checking account contains $99.00,
  someone withdraws $10, the result of the <span class="monospaced">withdraw</span> call will be 10.00,
  and the balance will drop to $88.00 (99.00 - 10.00 - 1.00).
</p>
</li>
<li>
<p>
An attempt to deposit will fail, throwing an
  <span class="monospaced">InsufficientFundsException</span> if the $1.00 fee cannot be charged. Thus,
  an attempt to deposit $0.50 into an empty checking account will fail.
</p>
</li>
<li>
<p>
An attempt to withdraw will fail, throwing an
  <span class="monospaced">InsufficientFundsException</span> if the $1.00 fee cannot be charged. Thus,
  an attempt to withdraw $10.00 from an account that only contains $10.00 will
  fail.
</p>
</li>
</ul></div>
<div class="paragraph"><p>To test your solution, run this tester in SBT:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>&gt; test-only com.newcircle.tests.inheritance.CheckingAccountSpec</pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_anonymous_subclasses">Anonymous Subclasses</h3>
<div class="paragraph"><p>As in Java, you make an instance of an anonymous subclass if you include a
block with definitions or overrides, such as:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">val</span> <span class="n">alien</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">Person</span><span class="o">(</span><span class="s">&quot;Fred&quot;</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">def</span> <span class="n">greeting</span> <span class="k">=</span> <span class="s">&quot;Greetings, Earthling! My name is Fred.&quot;</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>Technically, in Scala, this creates an object of a structural type. We will
discuss structural types later.</p></div>
<div class="paragraph"><p>In general, though, this kind of approach is rarely used in Scala (except when
interfacing with Java). Instead, in Scala, we use blocks of code.</p></div>
</div>
<div class="sect2">
<h3 id="_abstract_classes">Abstract Classes</h3>
<div class="paragraph"><p>As in Java, you can use the <span class="monospaced">abstract</span> keyword to denote a class that
cannot be instantiated, usually because one or more of its methods are not
defined. For example:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">abstract</span> <span class="k">class</span> <span class="nc">Person</span><span class="o">(</span><span class="k">val</span> <span class="n">name</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">def</span> <span class="n">id</span><span class="k">:</span> <span class="kt">Int</span> <span class="c1">// No method body. This is an abstract method.</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>In this case, every <span class="monospaced">Person</span> object has an ID, but we don’t know how to
compute it.</p></div>
<div class="paragraph"><p>Each concrete subclass of <span class="monospaced">Person</span> needs to specify an <span class="monospaced">id</span> method. In
Scala, unlike Java, you do not use the <span class="monospaced">abstract</span> keyword for an abstract
method. Instead, you simply omit its body.</p></div>
<div class="paragraph"><p>As in Java, a class with at least one abstract method <em>must</em> be declared
abstract.</p></div>
<div class="paragraph"><p>In a subclass, you <em>do not</em> need to use the <span class="monospaced">override</span> keyword when you
define a method that was abstract in the superclass.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Employee</span><span class="o">(</span><span class="n">name</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">Person</span><span class="o">(</span><span class="n">name</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">def</span> <span class="n">id</span> <span class="k">=</span> <span class="n">name</span><span class="o">.</span><span class="n">hashCode</span> <span class="c1">// override keyword not required</span>
<span class="o">}</span>
</pre></div></div></div>
</div>
<div class="sect2">
<h3 id="_abstract_fields">Abstract Fields</h3>
<div class="paragraph"><p>In addition to abstract methods, a class can also have abstract fields. An
abstract field is simply a field without an initial value. For example,</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">abstract</span> <span class="k">class</span> <span class="nc">Person</span> <span class="o">{</span>
  <span class="k">val</span> <span class="n">id</span><span class="k">:</span> <span class="kt">Int</span>      <span class="c1">// No initializer: This is an abstract field with an abstract getter method</span>
  <span class="k">var</span> <span class="n">name</span><span class="k">:</span> <span class="kt">String</span> <span class="c1">// Another abstract field, with abstract getter and setter methods</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>This class defines abstract getter methods for the <span class="monospaced">id</span> and <span class="monospaced">name</span> fields,
and an abstract setter for the <span class="monospaced">name</span> field.</p></div>
<div class="paragraph"><p>Concrete subclasses must provide concrete fields:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Employee</span><span class="o">(</span><span class="k">val</span> <span class="n">id</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">Person</span> <span class="o">{</span> <span class="c1">// Subclass has concrete id property</span>
  <span class="k">var</span> <span class="n">name</span> <span class="k">=</span> <span class="s">&quot;&quot;</span> <span class="c1">// and concrete name property</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>As with methods, no <span class="monospaced">override</span> keyword is required in the subclass when you
define a field that was abstract in the superclass.</p></div>
<div class="paragraph"><p>You can always customize an abstract field by using an anonymous type:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">val</span> <span class="n">fred</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">Person</span> <span class="o">{</span>
  <span class="k">val</span> <span class="n">id</span> <span class="k">=</span> <span class="mi">1729</span>
  <span class="k">var</span> <span class="n">name</span> <span class="k">=</span> <span class="s">&quot;Fred&quot;</span>
<span class="o">}</span>
</pre></div></div></div>
</div>
<div class="sect2">
<h3 id="_lab_abstract_classes">Lab: Abstract Classes</h3>
<div class="paragraph"><p>Open <span class="monospaced">labs/src/main/scala/com/newcircle/inheritance/Item.scala</span>. Create three
classes:</p></div>
<div class="ulist"><ul>
<li>
<p>
<span class="monospaced">Item</span> is abstract and specifies two abstract fields, <span class="monospaced">price</span> (<span class="monospaced">BigDecimal</span>)
  and <span class="monospaced">description</span>. (Hint: <span class="monospaced">price</span> will need to be a <span class="monospaced">def</span>.)
</p>
</li>
<li>
<p>
<span class="monospaced">SimpleItem</span> is a concrete implementation of <span class="monospaced">Item</span>, taking both
  <span class="monospaced">description</span> and <span class="monospaced">price</span> as constructor parameters.
</p>
</li>
<li>
<p>
<span class="monospaced">Bundle</span> is another concrete implementation of <span class="monospaced">Item</span>. It takes <span class="monospaced">description</span>
  and an array of <span class="monospaced">Item</span> objects as constructor parameters. It provides an
  <span class="monospaced">addItem</span> method that allows a caller to add items to the bundle. Its
  <span class="monospaced">price</span> field is the sum of the prices of all the items in the bundle.
</p>
</li>
</ul></div>
<div class="paragraph"><p>To test your solution, run this tester in SBT:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>&gt; test-only com.newcircle.tests.inheritance.ItemSpec</pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_construction_order_and_early_definitions">Construction Order and Early Definitions</h3>
<div class="paragraph"><p>When you override a <span class="monospaced">val</span> in a subclass and use the value in a superclass
constructor, the resulting behavior is unintuitive.</p></div>
<div class="sect3">
<h4 id="_the_problem">The problem</h4>
<div class="paragraph"><p>Here is an example. A creature can sense a part of its environment. For
simplicity, we assume the creature lives in a one-dimensional world, and
the sensory data are represented as integers. A default creature can see
ten units ahead.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Creature</span> <span class="o">{</span>
  <span class="k">val</span> <span class="n">range</span><span class="k">:</span> <span class="kt">Int</span> <span class="o">=</span> <span class="mi">10</span>
  <span class="k">val</span> <span class="n">env</span><span class="k">:</span> <span class="kt">Array</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">Array</span><span class="o">[</span><span class="kt">Int</span><span class="o">](</span><span class="n">range</span><span class="o">)</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>Ants, however, are near-sighted:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Ant</span> <span class="k">extends</span> <span class="nc">Creature</span> <span class="o">{</span>
  <span class="k">override</span> <span class="k">val</span> <span class="n">range</span> <span class="k">=</span> <span class="mi">2</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>Unfortunately, we now have a problem.</p></div>
<div class="paragraph"><p>The <span class="monospaced">range</span> value is used in the superclass constructor, and the superclass
constructor runs before the subclass constructor. Specifically, here is
what happens:</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
The <span class="monospaced">Ant</span> constructor calls the Creature constructor before doing its
   own construction.
</p>
</li>
<li>
<p>
The <span class="monospaced">Creature</span> constructor sets its <span class="monospaced">range</span> field to 10.
</p>
</li>
<li>
<p>
The <span class="monospaced">Creature</span> constructor, in order to initialize the <span class="monospaced">env</span> array, calls
   the <span class="monospaced">range()</span> getter.
</p>
</li>
<li>
<p>
That method is overridden to yield the (as yet uninitialized) <span class="monospaced">range</span> field
   of the <span class="monospaced">Ant</span> class.
</p>
</li>
<li>
<p>
The <span class="monospaced">range</span> method returns 0. (The initial value of all integer
   fields when an object is allocated.)
</p>
</li>
<li>
<p>
<span class="monospaced">env</span> is set to an array of length 0.
</p>
</li>
<li>
<p>
The <span class="monospaced">Ant</span> constructor continues, setting its range field to 2.
</p>
</li>
</ol></div>
<div class="paragraph"><p>Even though it appears as if <span class="monospaced">range</span> is either 10 or 2, <span class="monospaced">env</span> has been set
to an array of length 0.</p></div>
<div class="paragraph"><p><strong>MORAL</strong>: Do not rely on the value of a <span class="monospaced">val</span> in the body of a constructor.</p></div>
<div class="paragraph"><p>In Java, you have a similar issue when you call a method in a superclass
constructor. The method might be overridden in a subclass, and it might not
do what you want it to do.</p></div>
</div>
<div class="sect3">
<h4 id="_possible_solutions">Possible solutions</h4>
<div class="paragraph"><p>There are several remedies.</p></div>
<div class="ulist"><ul>
<li>
<p>
Declare the <span class="monospaced">val</span> as final. This is safe but not very flexible.
</p>
</li>
<li>
<p>
Declare the <span class="monospaced">val</span> as lazy in the superclass). This is safe but a bit
  inefficient.
</p>
</li>
<li>
<p>
Use the <em>early definition</em> syntax in the subclass. (See below.)
</p>
</li>
</ul></div>
</div>
<div class="sect3">
<h4 id="_the_early_definition_syntax">The Early Definition Syntax</h4>
<div class="paragraph"><p>The "early definition" syntax lets you initialize <span class="monospaced">val</span> fields of a
subclass before the superclass is executed.</p></div>
<div class="paragraph"><p>The syntax is extremely (<em>extremely</em>) ugly: You place the <span class="monospaced">val</span> fields in a
block after the <span class="monospaced">extends</span> keyword, like this:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Bug</span> <span class="k">extends</span> <span class="o">{</span>
  <span class="k">override</span> <span class="k">val</span> <span class="n">range</span> <span class="k">=</span> <span class="mi">2</span>
<span class="o">}</span> <span class="k">with</span> <span class="nc">Creature</span>
</pre></div></div></div>
<div class="paragraph"><p>Note the <span class="monospaced">with</span> keyword before the superclass name. This keyword is
normally used with traits, as we&#8217;ll see a couple lessons from now.</p></div>
<div class="paragraph"><p>The right-hand side of an early definition can only refer to previous early
definitions, not to other fields or methods of the class.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">You can debug construction order problems with the <span class="monospaced">-Xcheckinit</span>
compiler flag. This flag generates code that throws an exception (instead
of yielding the default value) when an uninitialized field is accessed.</td>
</tr></table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_the_scala_inheritance_hierarchy">The Scala Inheritance Hierarchy</h3>
<div class="paragraph"><p>Here&#8217;s the Scala inheritance hierarchy.</p></div>
<div class="imageblock">
<div class="content">
<img src="images/08-inheritance-hierarchy.png" alt="08-inheritance-hierarchy.png">
</div>
</div>
<div class="ulist"><ul>
<li>
<p>
The classes that correspond to primitive types in Java (e.g., <span class="monospaced">Int</span>,
  <span class="monospaced">Float</span>, etc.), as well as <span class="monospaced">Unit</span>, extend <span class="monospaced">AnyVal</span>.
</p>
</li>
<li>
<p>
All other classes extend the <span class="monospaced">AnyRef</span> class, which is a synonym for Java&#8217;s
  <span class="monospaced">Object</span> class.
</p>
</li>
<li>
<p>
Both <span class="monospaced">AnyVal</span> and <span class="monospaced">AnyRef</span> extend <span class="monospaced">Any</span>, at the root of the hierarchy.
</p>
</li>
<li>
<p>
All Scala classes implement the marker interface <span class="monospaced">ScalaObject</span>, which has
  no methods.
</p>
</li>
</ul></div>
<div class="paragraph"><p>The <span class="monospaced">Any</span> class defines methods <span class="monospaced">asInstanceOf</span>, <span class="monospaced">isInstanceOf</span> and the
(default) methods for hash codes and equality, which we&#8217;ll discuss in a
moment.</p></div>
<div class="paragraph"><p>The <span class="monospaced">AnyRef</span> class adds the (Java-style) monitor methods <span class="monospaced">wait</span>, <span class="monospaced">notify</span>,
and <span class="monospaced">notifyAll</span>. It also provides a <span class="monospaced">synchronized</span> method that takes a block of
code and corresponds to the Java <span class="monospaced">synchronized</span> keyword:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="n">account</span><span class="o">.</span><span class="n">synchronized</span> <span class="o">{</span> <span class="n">acccount</span><span class="o">.</span><span class="n">balance</span> <span class="o">+=</span> <span class="n">amount</span> <span class="o">}</span>
</pre></div></div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">As in Java, _stay away from <span class="monospaced">wait</span>, <span class="monospaced">notify</span> and <span class="monospaced">synchronized</span>.
There are better concurrency constructs.</td>
</tr></table>
</div>
<div class="sect3">
<h4 id="_span_class_monospaced_nothing_span_and_span_class_monospaced_null_span"><span class="monospaced">Nothing</span> and <span class="monospaced">Null</span></h4>
<div class="paragraph"><p>At the other end of the hierarchy are the <span class="monospaced">Nothing</span> and <span class="monospaced">Null</span> types.</p></div>
<div class="paragraph"><p><span class="monospaced">Null</span> is the type whose sole instance is the value <span class="monospaced">null</span>. You can assign
<span class="monospaced">null</span> to any reference, but not to one of the value types.</p></div>
<div class="paragraph"><p>For example, setting an <span class="monospaced">Int</span> to <span class="monospaced">null</span> is not possible. This is better
than in Java, where it would be possible to set an <span class="monospaced">Integer</span> wrapper to
<span class="monospaced">null</span>.</p></div>
<div class="paragraph"><p>The <span class="monospaced">Nothing</span> type has no instances. It is occasionally useful for generic
constructs. For example, the empty list <span class="monospaced">Nil</span> has type <span class="monospaced">List[Nothing]</span>,
which is a subtype of <span class="monospaced">List[T]</span> for any <span class="monospaced">T</span>.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Caution</div>
</td>
<td class="content">
<div class="paragraph"><p>The <span class="monospaced">Nothing</span> type is not at all the same as <span class="monospaced">void</span> in Java or C++. In
Scala, <span class="monospaced">void</span> is represented by the <span class="monospaced">Unit</span> type, the type with the sole
value (). Note that <span class="monospaced">Unit</span> is <em>not</em> a supertype of any other type. However,
the compiler still allows any value to be replaced by a (). Consider:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">def</span> <span class="n">printAny</span><span class="o">(</span><span class="n">x</span><span class="k">:</span> <span class="kt">Any</span><span class="o">)</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="o">{</span> <span class="n">println</span><span class="o">(</span><span class="n">x</span><span class="o">)</span> <span class="o">}</span>
<span class="k">def</span> <span class="n">printUnit</span><span class="o">(</span><span class="n">x</span><span class="k">:</span> <span class="kt">Unit</span><span class="o">)</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="o">{</span> <span class="n">println</span><span class="o">(</span><span class="n">x</span><span class="o">)</span> <span class="o">}</span>
<span class="n">printAny</span><span class="o">(</span><span class="s">&quot;Hello&quot;</span><span class="o">)</span>  <span class="c1">// Prints Hello</span>
<span class="n">printUnit</span><span class="o">(</span><span class="s">&quot;Hello&quot;</span><span class="o">)</span> <span class="c1">// Replaces &quot;Hello&quot; with () and calls printUnit(()), which prints ()</span>
</pre></div></div></div>
</td>
</tr></table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_object_equality">Object Equality</h3>
<div class="paragraph"><p>In Scala, the <span class="monospaced">eq</span> method of the <span class="monospaced">AnyRef</span> class checks whether two
references refer to the same object. The <span class="monospaced">equals</span> method in <span class="monospaced">AnyRef</span> calls
<span class="monospaced">eq</span>.</p></div>
<div class="paragraph"><p>When you implement a class, you should consider overriding the <span class="monospaced">equals</span>
method to provide a natural notion of equality for your situation.</p></div>
<div class="paragraph"><p>For example, consider this class:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Item</span><span class="o">(</span><span class="k">val</span> <span class="n">description</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="k">val</span> <span class="n">price</span><span class="k">:</span> <span class="kt">Double</span><span class="o">)</span>
</pre></div></div></div>
<div class="paragraph"><p>In this case, you might want to consider two items equal if they have the
same description and price. Here is an appropriate <span class="monospaced">equals</span> method:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">final</span> <span class="k">override</span> <span class="k">def</span> <span class="n">equals</span><span class="o">(</span><span class="n">other</span><span class="k">:</span> <span class="kt">Any</span><span class="o">)</span> <span class="k">=</span> <span class="o">{</span>
  <span class="k">val</span> <span class="n">that</span> <span class="k">=</span> <span class="n">other</span><span class="o">.</span><span class="n">asInstanceOf</span><span class="o">[</span><span class="kt">Item</span><span class="o">]</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">that</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="kc">false</span>
  <span class="k">else</span> <span class="n">description</span> <span class="o">==</span> <span class="n">that</span><span class="o">.</span><span class="n">description</span> <span class="o">&amp;&amp;</span> <span class="n">price</span> <span class="o">==</span> <span class="n">that</span><span class="o">.</span><span class="n">price</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">The method is defined as <span class="monospaced">final</span> because it is generally <em>very</em>
difficult to correctly extend equality in a subclass.</td>
</tr></table>
</div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Caution</div>
</td>
<td class="content">
<div class="paragraph"><p>Be sure to define <span class="monospaced">equals</span> with parameter type <span class="monospaced">Any</span>. The following
is not correct:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">final</span> <span class="k">def</span> <span class="n">equals</span><span class="o">(</span><span class="n">other</span><span class="k">:</span> <span class="kt">Item</span><span class="o">)</span> <span class="k">=</span> <span class="o">...</span>
</pre></div></div></div>
<div class="paragraph"><p>That is a <em>different</em> method, and it does <em>not</em> override <span class="monospaced">AnyDef.equals</span>.</p></div>
</td>
</tr></table>
</div>
<div class="paragraph"><p>Just as in Java, when you define your own <span class="monospaced">equals</span> method, be sure to
define your own <span class="monospaced">hashCode</span> method, as well. The hash code should be
computed <em>only</em> from the fields used by <span class="monospaced">equals</span>. For example, in our
<span class="monospaced">Item</span> class, the following is one valid implemention of <span class="monospaced">hashCode</span>:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">final</span> <span class="k">override</span> <span class="k">def</span> <span class="n">hashCode</span> <span class="k">=</span> <span class="o">(</span><span class="mi">13</span> <span class="o">*</span> <span class="n">description</span><span class="o">.</span><span class="n">hashCode</span><span class="o">)</span> <span class="o">+</span> <span class="o">(</span><span class="mi">17</span> <span class="o">*</span> <span class="n">price</span><span class="o">.</span><span class="n">hashCode</span><span class="o">)</span>
</pre></div></div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">You are not <em>required</em> to override <span class="monospaced">equals</span> and <span class="monospaced">hashCode</span>. For many
classes, it is appropriate to consider distinct objects unequal. For
example, if you have two distinct input streams or radio buttons, you will
never consider them equal.</td>
</tr></table>
</div>
<div class="sect3">
<h4 id="_there_8217_s_no_need_to_call_span_class_monospaced_eq_span_or_span_class_monospaced_equals_span_directly">There&#8217;s no need to call <span class="monospaced">eq</span> or <span class="monospaced">equals</span> directly</h4>
<div class="paragraph"><p>In an application program, you don&#8217;t generally call <span class="monospaced">eq</span> or <span class="monospaced">equals</span>. Just
use the <span class="monospaced">==</span> operator. For reference types, using <span class="monospaced">==</span> automatically invokes
<span class="monospaced">equals</span>, after doing the appropriate check for <span class="monospaced">null</span> operands.</p></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="lesson-09-files-and-regular-expressions">Files and Regular Expressions</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_lesson_objectives_9">Lesson Objectives</h3>
<div class="paragraph"><p>In this lesson, you will learn how to carry out common file processing
tasks, such as reading all lines or words from a file or reading a file
containing numbers.</p></div>
<div class="paragraph"><p>We&#8217;ll also delve into regular expressions.</p></div>
</div>
<div class="sect2">
<h3 id="_summary_8">Summary</h3>
<div class="ulist"><ul>
<li>
<p>
<span class="monospaced">Source.fromFile(...).getLines.toArray</span> yields all lines of a file.
</p>
</li>
<li>
<p>
<span class="monospaced">Source.fromFile(...).mkString</span> yields the file contents as a string.
</p>
</li>
<li>
<p>
To convert a string into a number, use the <span class="monospaced">toInt</span> or <span class="monospaced">toDouble</span> method.
</p>
</li>
<li>
<p>
Use the Java <span class="monospaced">PrintWriter</span> to write text files.
</p>
</li>
<li>
<p>
<span class="monospaced">"regex".r</span> is a <span class="monospaced">Regex</span> object.
</p>
</li>
<li>
<p>
Use """&#8230;""" if your regular expression contains backslashes or quotes.
</p>
</li>
<li>
<p>
If a regex pattern has groups, you can extract their contents using the
  syntax for <span class="monospaced">(regex(var1, ...,varn) &lt;- string)</span>.
</p>
</li>
</ul></div>
</div>
<div class="sect2">
<h3 id="_reading_lines">Reading Lines</h3>
<div class="paragraph"><p>To read all lines from a file, call the <span class="monospaced">getLines</span> method on a
<span class="monospaced">scala.io.Source</span> object:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">import</span> <span class="nn">scala.io.Source</span>
<span class="k">val</span> <span class="n">source</span> <span class="k">=</span> <span class="nc">Source</span><span class="o">.</span><span class="n">fromFile</span><span class="o">(</span><span class="s">&quot;myfile.txt&quot;</span><span class="o">,</span> <span class="s">&quot;UTF-8&quot;</span><span class="o">)</span>
  <span class="c1">// The first argument can be a string or a java.io.File</span>
  <span class="c1">// You can omit the encoding if you know that the file uses</span>
  <span class="c1">// the default platform encoding</span>
<span class="k">val</span> <span class="n">lineIterator</span> <span class="k">=</span> <span class="n">source</span><span class="o">.</span><span class="n">getLines</span>
</pre></div></div></div>
<div class="paragraph"><p>The result is an iterator that lazily reads the lines from the file. (We&#8217;ll
discuss iterators in more depth in a later lesson.). You can use it to
process the lines one at a time:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">for</span> <span class="o">(</span><span class="n">l</span> <span class="k">&lt;-</span> <span class="n">lineIterator</span><span class="o">)</span> <span class="n">process</span> <span class="n">l</span>
</pre></div></div></div>
<div class="paragraph"><p>Or you can put the lines into an array or array buffer by applying the
<span class="monospaced">toArray</span> or <span class="monospaced">toBuffer</span> method to the iterator:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">val</span> <span class="n">lines</span> <span class="k">=</span> <span class="n">source</span><span class="o">.</span><span class="n">getLines</span><span class="o">.</span><span class="n">toArray</span>
</pre></div></div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Caution</div>
</td>
<td class="content">Doing so can be problematic on large files.</td>
</tr></table>
</div>
<div class="paragraph"><p>Sometimes, you just want to read an entire file into a string. That’s even
simpler:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">val</span> <span class="n">contents</span> <span class="k">=</span> <span class="n">source</span><span class="o">.</span><span class="n">mkString</span>
</pre></div></div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Caution</div>
</td>
<td class="content">Be sure to call <span class="monospaced">close</span> when you finish with the <span class="monospaced">Source</span> object.</td>
</tr></table>
</div>
</div>
<div class="sect2">
<h3 id="_reading_characters">Reading Characters</h3>
<div class="paragraph"><p>To read individual characters from a file, you can use a <span class="monospaced">Source</span> object
directly as an iterator, since the <span class="monospaced">Source</span> class extends <span class="monospaced">Iterator[Char]</span>:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">for</span> <span class="o">(</span><span class="n">c</span> <span class="k">&lt;-</span> <span class="n">source</span><span class="o">)</span> <span class="n">process</span> <span class="n">c</span>
</pre></div></div></div>
<div class="paragraph"><p>If you want to be able to peek at a character without consuming it, call
the <span class="monospaced">buffered</span> method on the source object. Then you can peek at the next
input character with the <span class="monospaced">head</span> method without consuming it.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">val</span> <span class="n">source</span> <span class="k">=</span> <span class="nc">Source</span><span class="o">.</span><span class="n">fromFile</span><span class="o">(</span><span class="s">&quot;myfile.txt&quot;</span><span class="o">,</span> <span class="s">&quot;UTF-8&quot;</span><span class="o">)</span>
<span class="k">val</span> <span class="n">iter</span> <span class="k">=</span> <span class="n">source</span><span class="o">.</span><span class="n">buffered</span>
<span class="k">while</span> <span class="o">(</span><span class="n">iter</span><span class="o">.</span><span class="n">hasNext</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">iter</span><span class="o">.</span><span class="n">head</span> <span class="n">is</span> <span class="n">nice</span><span class="o">)</span>
    <span class="n">process</span> <span class="n">iter</span><span class="o">.</span><span class="n">next</span>
  <span class="k">else</span>
    <span class="o">...</span>
<span class="o">}</span>
<span class="n">source</span><span class="o">.</span><span class="n">close</span><span class="o">()</span>
</pre></div></div></div>
</div>
<div class="sect2">
<h3 id="_lab_reading_a_file">Lab: Reading a file</h3>
<div class="paragraph"><p>Open <span class="monospaced">labs/src/main/scala/com/newcircle/files/ReverseFile.scala</span>.
Replace the contents of the <span class="monospaced">reverseFile</span> function so that it opens a file,
reads the lines, reverses the order of the lines (so that the last line of
the file is first, the first line is last, etc.) , and returns an array
with the reversed lines.</p></div>
<div class="paragraph"><p>To test your solution, run this tester in SBT:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>&gt; test-only com.newcircle.tests.files.ReverseFileSpec</pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_reading_tokens_and_numbers">Reading Tokens and Numbers</h3>
<div class="paragraph"><p>Here is a quick-and-dirty way of reading all whitespace-separated tokens in
a source:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">val</span> <span class="n">tokens</span> <span class="k">=</span> <span class="n">source</span><span class="o">.</span><span class="n">mkString</span><span class="o">.</span><span class="n">split</span><span class="o">(</span><span class="s">&quot;\\s+&quot;</span><span class="o">)</span>
</pre></div></div></div>
<div class="paragraph"><p>To convert a string into a number, use the <span class="monospaced">toInt</span> or <span class="monospaced">toDouble</span> method. For
example, if you have a file containing floating-point numbers, you can read
them all into an array:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">val</span> <span class="n">numbers</span> <span class="k">=</span> <span class="k">for</span> <span class="o">(</span><span class="n">w</span> <span class="k">&lt;-</span> <span class="n">tokens</span><span class="o">)</span> <span class="k">yield</span> <span class="n">w</span><span class="o">.</span><span class="n">toDouble</span>
</pre></div></div></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">val</span> <span class="n">numbers</span> <span class="k">=</span> <span class="n">tokens</span><span class="o">.</span><span class="n">map</span><span class="o">(</span><span class="k">_</span><span class="o">.</span><span class="n">toDouble</span><span class="o">)</span>
</pre></div></div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">Remember: You can always use the <span class="monospaced">java.util.Scanner</span> class to process
a file that contains a mixture of text and numbers.</td>
</tr></table>
</div>
<div class="paragraph"><p>Finally, note that you can read numbers from the console:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="n">print</span><span class="o">(</span><span class="s">&quot;How old are you? &quot;</span><span class="o">)</span>
<span class="c1">// Console is imported by default, so you don&#39;t need to qualify print and readInt</span>
<span class="k">val</span> <span class="n">age</span> <span class="k">=</span> <span class="n">readInt</span><span class="o">()</span>
<span class="c1">// Or use readDouble or readLong</span>
</pre></div></div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Caution</div>
</td>
<td class="content">These methods assume that the next input line contains a single
number, without leading or trailing whitespace. Otherwise, a
<span class="monospaced">NumberFormatException</span> occurs.</td>
</tr></table>
</div>
</div>
<div class="sect2">
<h3 id="_reading_from_urls_and_other_sources">Reading from URLs and Other Sources</h3>
<div class="paragraph"><p>The <span class="monospaced">Source</span> object has methods to read from sources other than files:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">val</span> <span class="n">source1</span> <span class="k">=</span> <span class="nc">Source</span><span class="o">.</span><span class="n">fromURL</span><span class="o">(</span><span class="s">&quot;http://horstmann.com&quot;</span><span class="o">,</span> <span class="s">&quot;UTF-8&quot;</span><span class="o">)</span>
<span class="k">val</span> <span class="n">source2</span> <span class="k">=</span> <span class="nc">Source</span><span class="o">.</span><span class="n">fromString</span><span class="o">(</span><span class="s">&quot;Hello, World!&quot;</span><span class="o">)</span>
<span class="c1">// Reads from the given string—useful for debugging</span>
<span class="k">val</span> <span class="n">source3</span> <span class="k">=</span> <span class="nc">Source</span><span class="o">.</span><span class="n">stdin</span>
<span class="c1">// Reads from standard input</span>
<span class="k">val</span> <span class="n">source4</span> <span class="k">=</span> <span class="nc">Source</span><span class="o">.</span><span class="n">fromFile</span><span class="o">(</span><span class="k">new</span> <span class="n">java</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="nc">File</span><span class="o">(</span><span class="s">&quot;/tmp/foo.txt&quot;</span><span class="o">))</span>
<span class="c1">// Reads from a file</span>
<span class="k">val</span> <span class="n">source5</span> <span class="k">=</span> <span class="nc">Source</span><span class="o">.</span><span class="n">fromInputStream</span><span class="o">(</span><span class="k">new</span> <span class="n">java</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="nc">FileInputStream</span><span class="o">(</span><span class="s">&quot;/tmp/foo&quot;</span><span class="o">))</span>
<span class="c1">// Reads from a Java InputStream</span>
</pre></div></div></div>
<div class="paragraph"><p>There are other possibilities, as well.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Caution</div>
</td>
<td class="content">When you read from a URL, you need to know the character set in
advance, perhaps from an HTTP header. See
&lt;www.w3.org/International/O-charset&gt; for more information.</td>
</tr></table>
</div>
</div>
<div class="sect2">
<h3 id="_reading_binary_files">Reading Binary Files</h3>
<div class="paragraph"><p>Scala has no provision for reading binary files. You’ll need to use the
Java library. Here is how you can read a file into a byte array:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">val</span> <span class="n">file</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">File</span><span class="o">(</span><span class="n">filename</span><span class="o">)</span>
<span class="k">val</span> <span class="n">in</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">FileInputStream</span><span class="o">(</span><span class="n">file</span><span class="o">)</span>
<span class="k">val</span> <span class="n">bytes</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">Array</span><span class="o">[</span><span class="kt">Byte</span><span class="o">](</span><span class="n">file</span><span class="o">.</span><span class="n">length</span><span class="o">.</span><span class="n">toInt</span><span class="o">)</span>
<span class="n">in</span><span class="o">.</span><span class="n">read</span><span class="o">(</span><span class="n">bytes</span><span class="o">)</span>
<span class="n">in</span><span class="o">.</span><span class="n">close</span><span class="o">()</span>
</pre></div></div></div>
</div>
<div class="sect2">
<h3 id="_writing_text_files">Writing Text Files</h3>
<div class="paragraph"><p>Scala has no built-in support for writing files. To write a text file, use
a <span class="monospaced">java.io.PrintWriter</span>:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">val</span> <span class="n">out</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">PrintWriter</span><span class="o">(</span><span class="s">&quot;numbers.txt&quot;</span><span class="o">)</span>
<span class="k">for</span> <span class="o">(</span><span class="n">i</span> <span class="k">&lt;-</span> <span class="mi">1</span> <span class="n">to</span> <span class="mi">100</span><span class="o">)</span> <span class="n">out</span><span class="o">.</span><span class="n">println</span><span class="o">(</span><span class="n">i</span><span class="o">)</span>
<span class="n">out</span><span class="o">.</span><span class="n">close</span><span class="o">()</span>
</pre></div></div></div>
<div class="paragraph"><p>Everything works as expected, except for the <span class="monospaced">printf</span> method. When you pass a
number to <span class="monospaced">printf</span>, the compiler will complain that you need to convert it to
an <span class="monospaced">AnyRef</span>:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="n">out</span><span class="o">.</span><span class="n">printf</span><span class="o">(</span><span class="s">&quot;%6d %10.2f&quot;</span><span class="o">,</span>
           <span class="n">quantity</span><span class="o">.</span><span class="n">asInstanceOf</span><span class="o">[</span><span class="kt">AnyRef</span><span class="o">],</span> <span class="n">price</span><span class="o">.</span><span class="n">asInstanceOf</span><span class="o">[</span><span class="kt">AnyRef</span><span class="o">])</span> <span class="c1">// Ugh</span>
</pre></div></div></div>
<div class="paragraph"><p>Solution: use the <span class="monospaced">format</span> method of the <span class="monospaced">String</span> class:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="n">out</span><span class="o">.</span><span class="n">print</span><span class="o">(</span><span class="s">&quot;%6d %10.2f&quot;</span><span class="o">.</span><span class="n">format</span><span class="o">(</span><span class="n">quantity</span><span class="o">,</span> <span class="n">price</span><span class="o">))</span>
</pre></div></div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">The <span class="monospaced">printf</span> method of the Scala <span class="monospaced">Console</span> class does not suffer from
this problem. You can use:</td>
</tr></table>
</div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="n">printf</span><span class="o">(</span><span class="s">&quot;%6d %10.2f&quot;</span><span class="o">,</span> <span class="n">quantity</span><span class="o">,</span> <span class="n">price</span><span class="o">)</span>
</pre></div></div></div>
<div class="paragraph"><p>for printing a message to the console.</p></div>
</div>
<div class="sect2">
<h3 id="_regular_expressions">Regular Expressions</h3>
<div class="paragraph"><p>When you process input, you often want to use regular expressions to
analyze it. The <span class="monospaced">scala.util.matching.Regex</span> class makes this simple. To
construct a Regex object, use the <span class="monospaced">r</span> method of the String class:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">val</span> <span class="n">numPattern</span> <span class="k">=</span> <span class="s">&quot;[0-9]+&quot;</span><span class="o">.</span><span class="n">r</span>
</pre></div></div></div>
<div class="paragraph"><p>If the regular expression contains backslashes or quotation marks, then it
is a good idea to use the "raw" string syntax:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">val</span> <span class="n">wsnumwsPattern</span> <span class="k">=</span> <span class="s">&quot;&quot;&quot;\s+[0-9]+\s+&quot;&quot;&quot;</span><span class="o">.</span><span class="n">r</span>
<span class="c1">// A bit easier to read than &quot;\\s+[0-9]+\\s+&quot;.r</span>
</pre></div></div></div>
<div class="paragraph"><p>The findAllIn method returns an iterator through all matches. You can use it in a for loop:</p></div>
<div class="paragraph"><p>The <span class="monospaced">findAllIn</span> method returns an iterator through all matches. You can use
it in a for loop:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">for</span> <span class="o">(</span><span class="n">matchString</span> <span class="k">&lt;-</span> <span class="n">numPattern</span><span class="o">.</span><span class="n">findAllIn</span><span class="o">(</span><span class="s">&quot;99 bottles, 98 bottles&quot;</span><span class="o">))</span>
  <span class="n">process</span> <span class="n">matchString</span>
</pre></div></div></div>
<div class="paragraph"><p>or turn the iterator into an array:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">val</span> <span class="n">matches</span> <span class="k">=</span> <span class="n">numPattern</span><span class="o">.</span><span class="n">findAllIn</span><span class="o">(</span><span class="s">&quot;99 bottles, 98 bottles&quot;</span><span class="o">).</span><span class="n">toArray</span>
<span class="c1">// Array(99, 98)</span>
</pre></div></div></div>
<div class="paragraph"><p>To find the first match anywhere in a string, use <span class="monospaced">findFirstIn</span>. You get an
<span class="monospaced">Option[String]</span>. (We&#8217;ll discuss options shortly.)</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">val</span> <span class="n">m1</span> <span class="k">=</span> <span class="n">wsnumwsPattern</span><span class="o">.</span><span class="n">findFirstIn</span><span class="o">(</span><span class="s">&quot;99 bottles, 98 bottles&quot;</span><span class="o">)</span>
<span class="c1">// Some(&quot; 98 &quot;)</span>
</pre></div></div></div>
<div class="paragraph"><p>To check whether the beginning of a string matches, use <span class="monospaced">findPrefixOf</span>:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="n">numPattern</span><span class="o">.</span><span class="n">findPrefixOf</span><span class="o">(</span><span class="s">&quot;99 bottles, 98 bottles&quot;</span><span class="o">)</span>
<span class="c1">// Some(99)</span>
<span class="n">wsnumwsPattern</span><span class="o">.</span><span class="n">findPrefixOf</span><span class="o">(</span><span class="s">&quot;99 bottles, 98 bottles&quot;</span><span class="o">)</span>
<span class="c1">// None</span>
</pre></div></div></div>
<div class="paragraph"><p>You can replace the first match, or all matches:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="n">numPattern</span><span class="o">.</span><span class="n">replaceFirstIn</span><span class="o">(</span><span class="s">&quot;99 bottles, 98 bottles&quot;</span><span class="o">,</span> <span class="s">&quot;XX&quot;</span><span class="o">)</span>
<span class="c1">// &quot;XX bottles, 98 bottles&quot;</span>
<span class="n">numPattern</span><span class="o">.</span><span class="n">replaceAllIn</span><span class="o">(</span><span class="s">&quot;99 bottles, 98 bottles&quot;</span><span class="o">,</span> <span class="s">&quot;XX&quot;</span><span class="o">)</span>
<span class="c1">// &quot;XX bottles, XX bottles&quot;</span>
</pre></div></div></div>
</div>
<div class="sect2">
<h3 id="_regular_expression_syntax">Regular Expression Syntax</h3>
<div class="paragraph"><p>Scala supports the same regular expression patterns as Java. For
details on the regular expression pattern syntax, see
<a href="http://docs.oracle.com/javase/7/docs/api/java/util/regex/Pattern.html">http://docs.oracle.com/javase/7/docs/api/java/util/regex/Pattern.html</a></p></div>
</div>
<div class="sect2">
<h3 id="_regular_expression_groups">Regular Expression Groups</h3>
<div class="paragraph"><p>Groups are useful to get subexpressions of regular expressions. Add
parentheses around the subexpressions that you want to extract:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">val</span> <span class="n">pattern</span> <span class="k">=</span> <span class="s">&quot;([0-9]+) ([a-z]+)&quot;</span><span class="o">.</span><span class="n">r</span>
</pre></div></div></div>
<div class="paragraph"><p>To match the groups, use the regular expression object as an “extractor”,
like this:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">val</span> <span class="n">pattern</span><span class="o">(</span><span class="n">num</span><span class="o">,</span> <span class="n">item</span><span class="o">)</span> <span class="k">=</span> <span class="s">&quot;99 bottles&quot;</span>
<span class="c1">// Sets num to &quot;99&quot;, item to &quot;bottles&quot;</span>
</pre></div></div></div>
<div class="paragraph"><p>(More on extractors later.)</p></div>
<div class="paragraph"><p>If you want to extract groups from multiple matches, use a <span class="monospaced">for</span> statement
like this:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">for</span> <span class="o">(</span><span class="n">pattern</span><span class="o">(</span><span class="n">num</span><span class="o">,</span> <span class="n">item</span><span class="o">)</span> <span class="k">&lt;-</span> <span class="n">pattern</span><span class="o">.</span><span class="n">findAllIn</span><span class="o">(</span><span class="s">&quot;99 bottles, 98 bottles&quot;</span><span class="o">))</span>
  <span class="n">process</span> <span class="n">num</span> <span class="n">and</span> <span class="n">item</span>
</pre></div></div></div>
</div>
<div class="sect2">
<h3 id="_lab_reading_and_parsing_a_file">Lab: Reading and parsing a file</h3>
<div class="paragraph"><p>Open <span class="monospaced">labs/src/main/scala/com/newcircle/files/NonCommentLines.scala</span>.
Replace the contents of the <span class="monospaced">readNonCommentLines</span> function so that it opens
a file, reads the lines, skips all lines whose first non-blank character is
a "#" (i.e., a comment line), and returns the lines that aren&#8217;t comments.
Use a regular expression to match the comment lines.</p></div>
<div class="paragraph"><p>To test your solution, run this tester in SBT:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>&gt; test-only com.newcircle.tests.files.NonCommentLinesSpec</pre>
</div></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="lesson-10-traits">Traits</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_lesson_objectives_10">Lesson Objectives</h3>
<div class="paragraph"><p>In this lesson, you will learn how to work with traits. A class extends one
or more traits in order to take advantage of the services that the traits
provide. A trait may require that implementing classes support certain
features. However, unlike Java interfaces, Scala traits can supply default
implementations for these features, which makes them far more useful.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">Java 8 adds default method implementations to interfaces, which makes
Java interfaces more like Scala traits. But Scala traits still have more
capabilities.</td>
</tr></table>
</div>
</div>
<div class="sect2">
<h3 id="_summary_9">Summary</h3>
<div class="ulist"><ul>
<li>
<p>
A class can implement any number of traits.
</p>
</li>
<li>
<p>
Traits can require that implementing classes have certain fields,
  methods, or superclasses.
</p>
</li>
<li>
<p>
Unlike Java interfaces, a Scala trait can provide implementations of
  methods and fields.
</p>
</li>
<li>
<p>
When you layer multiple traits, the order matters: The trait whose methods
  execute <em>first</em> goes to the back.
</p>
</li>
</ul></div>
</div>
<div class="sect2">
<h3 id="_why_no_multiple_inheritance">Why No Multiple Inheritance?</h3>
<div class="paragraph"><p>Scala, like Java, does not allow a class to inherit from multiple
superclasses. At first, this seems like an unfortunate restriction. Why
shouldn’t a class extend multiple classes? Some programming languages, in
particular C++, allow multiple inheritance—but at a surprisingly high cost.</p></div>
<div class="paragraph"><p>Multiple inheritance works fine when you combine classes that have nothing
in common. But if these classes have common methods or fields, thorny
issues come up. With multiple inheritance, you can find yourself with the
<em>diamond inheritance problem</em>.</p></div>
<div class="imageblock">
<div class="content">
<img src="images/10-diamond-inheritance.png" alt="10-diamond-inheritance.png">
</div>
</div>
<div class="paragraph"><p>We only want one <span class="monospaced">name</span> field inside a <span class="monospaced">TeachingAssistant</span>, not two. How do
the fields get merged? How does the field get constructed?</p></div>
<div class="paragraph"><p>Java designers were so afraid of these complexities that they took a very
restrictive approach:</p></div>
<div class="ulist"><ul>
<li>
<p>
A class can extend only one superclass.
</p>
</li>
<li>
<p>
A class can implement any number of interfaces, but interfaces can have
  only abstract methods and no fields.
</p>
</li>
</ul></div>
<div class="paragraph"><p>You often want to implement some methods in terms of others, but you cannot
do that in a Java interface. It is therefore common in Java to provide both
an interface and an abstract base class, but that just kicks the can down
the road. What if you need to extend two of those abstract base classes?</p></div>
<div class="paragraph"><p>Scala has traits instead of interfaces. A trait can have both abstract and
concrete methods, and a class can implement multiple traits. This neatly
solves the problem of Java interfaces. You will see in the following
sections how Scala deals with the perils of conflicting methods and fields.</p></div>
</div>
<div class="sect2">
<h3 id="_traits_as_interfaces">Traits as Interfaces</h3>
<div class="paragraph"><p>A Scala trait can work just like a Java interface:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">trait</span> <span class="nc">Logger</span> <span class="o">{</span>
  <span class="k">def</span> <span class="n">log</span><span class="o">(</span><span class="n">msg</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span><span class="k">:</span> <span class="kt">Unit</span> <span class="c1">// abstract method</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>A subclass can then provide the implementation:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">class</span> <span class="nc">ConsoleLogger</span> <span class="k">extends</span> <span class="nc">Logger</span> <span class="o">{</span>
  <span class="k">def</span> <span class="n">log</span><span class="o">(</span><span class="n">msg</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="o">{</span>
    <span class="n">println</span><span class="o">(</span><span class="n">msg</span><span class="o">)</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>Two things to note:</p></div>
<div class="ulist"><ul>
<li>
<p>
When implementing a single trait, use <span class="monospaced">extends</span>, just as you would with
  a class. There is no <span class="monospaced">implements</span> keyword.
</p>
</li>
<li>
<p>
There&#8217;s no need to supply <span class="monospaced">override</span> when overriding an abstract method
  of a trait.
</p>
</li>
</ul></div>
<div class="sect3">
<h4 id="_extending_multiple_traits">Extending multiple traits</h4>
<div class="paragraph"><p>If you need more than one trait, add the others using the <span class="monospaced">with</span> keyword:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">class</span> <span class="nc">ConsoleLogger</span> <span class="k">extends</span> <span class="nc">Logger</span> <span class="k">with</span> <span class="nc">Cloneable</span> <span class="k">with</span> <span class="nc">Serializable</span>
</pre></div></div></div>
<div class="paragraph"><p>Note that we&#8217;re using two Java interfaces here, <span class="monospaced">Cloneable</span> and <span class="monospaced">Serializable</span>,
as if they were traits. Any Java interface can be used as a trait.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">It may seem odd that you use the <span class="monospaced">extends</span> keyword before the first
trait but with before all the others. But that’s not the way that Scala
thinks about it. In Scala, <span class="monospaced">Logger with Cloneable with Serializable</span> is the
entity that the class extends.</td>
</tr></table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_traits_with_concrete_implementations">Traits with Concrete Implementations</h3>
<div class="paragraph"><p>In Scala, the methods of a trait need not be abstract. For example, we can
make our <span class="monospaced">ConsoleLogger</span> into a trait:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">trait</span> <span class="nc">ConsoleLogger</span> <span class="o">{</span>
  <span class="k">def</span> <span class="n">log</span><span class="o">(</span><span class="n">msg</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="o">{</span> <span class="n">println</span><span class="o">(</span><span class="n">msg</span><span class="o">)</span> <span class="o">}</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>The <span class="monospaced">ConsoleLogger</span> trait provides a method with an implementation.</p></div>
<div class="paragraph"><p>Here is an example of using this trait:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">class</span> <span class="nc">SavingsAccount</span> <span class="k">extends</span> <span class="nc">Account</span> <span class="k">with</span> <span class="nc">ConsoleLogger</span> <span class="o">{</span>
  <span class="k">def</span> <span class="n">withdraw</span><span class="o">(</span><span class="n">amount</span><span class="k">:</span> <span class="kt">Double</span><span class="o">)</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">amount</span> <span class="o">&gt;</span> <span class="n">balance</span><span class="o">)</span> <span class="n">log</span><span class="o">(</span><span class="s">&quot;Insufficient funds&quot;</span><span class="o">)</span>
    <span class="k">else</span> <span class="n">balance</span> <span class="o">-=</span> <span class="n">amount</span>
  <span class="o">}</span>
  <span class="o">...</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>Note the difference between Scala and Java. The <span class="monospaced">SavingsAccount</span> picks up a
concrete implementation from the <span class="monospaced">ConsoleLogger</span> trait. This would not be
possible with traditional a Java interface.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">It <em>is</em> possible with a Java 8 interface, using default methods.
See <a href="http://docs.oracle.com/javase/tutorial/java/IandI/defaultmethods.html">http://docs.oracle.com/javase/tutorial/java/IandI/defaultmethods.html</a></td>
</tr></table>
</div>
<div class="paragraph"><p>In Scala (and other programming languages that allow this), we say that the
<span class="monospaced">ConsoleLogger</span> functionality is <em>mixed in</em> with the <span class="monospaced">SavingsAccount</span> class.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Caution</div>
</td>
<td class="content">There is one disadvantage of having traits with concrete behavior.
When a trait changes, all classes that mix in that trait must be
recompiled.</td>
</tr></table>
</div>
</div>
<div class="sect2">
<h3 id="_objects_with_traits">Objects with Traits</h3>
<div class="paragraph"><p>You can add a trait to an individual object when you construct it. In this
example, let&#8217;s use the <span class="monospaced">Logged</span> trait that is defined in the standard Scala
library. It’s like our <span class="monospaced">Logger</span>, except that it comes with a do-nothing
implementation:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">trait</span> <span class="nc">Logged</span> <span class="o">{</span>
  <span class="k">def</span> <span class="n">log</span><span class="o">(</span><span class="n">msg</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="o">{</span> <span class="o">}</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>Let’s use that trait in a class definition:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">class</span> <span class="nc">SavingsAccount</span> <span class="k">extends</span> <span class="nc">Account</span> <span class="k">with</span> <span class="nc">Logged</span> <span class="o">{</span>
  <span class="k">def</span> <span class="n">withdraw</span><span class="o">(</span><span class="n">amount</span><span class="k">:</span> <span class="kt">Double</span><span class="o">)</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">amount</span> <span class="o">&gt;</span> <span class="n">balance</span><span class="o">)</span> <span class="n">log</span><span class="o">(</span><span class="s">&quot;Insufficient funds&quot;</span><span class="o">)</span>
    <span class="k">else</span> <span class="o">...</span>
  <span class="o">}</span>
  <span class="o">...</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>Now, nothing gets logged, which might seem pointless. But you can "mix in"
a better logger when constructing an object. The standard <span class="monospaced">ConsoleLogger</span>
extends the <span class="monospaced">Logged</span> trait:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">trait</span> <span class="nc">ConsoleLogger</span> <span class="k">extends</span> <span class="nc">Logged</span> <span class="o">{</span>
  <span class="k">override</span> <span class="k">def</span> <span class="n">log</span><span class="o">(</span><span class="n">msg</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="o">{</span> <span class="n">println</span><span class="o">(</span><span class="n">msg</span><span class="o">)</span> <span class="o">}</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>You can add this trait when constructing an object:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">val</span> <span class="n">acct</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">SavingsAccount</span> <span class="k">with</span> <span class="nc">ConsoleLogger</span>
</pre></div></div></div>
<div class="paragraph"><p>When calling log on the acct object, the <span class="monospaced">log</span> method of the <span class="monospaced">ConsoleLogger</span>
trait executes.</p></div>
<div class="paragraph"><p>Of course, another object can add in a different trait:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">val</span> <span class="n">acct2</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">SavingsAccount</span> <span class="k">with</span> <span class="nc">FileLogger</span>
</pre></div></div></div>
</div>
<div class="sect2">
<h3 id="_layered_traits">Layered Traits</h3>
<div class="paragraph"><p>You can add, to a class or an object, multiple traits that invoke each
other starting with the <em>last one</em>. This is useful when you need to
transform a value in stages.</p></div>
<div class="paragraph"><p>Here is a simple example. Suppose we want to add a timestamp to all log
messages.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">trait</span> <span class="nc">TimestampLogger</span> <span class="k">extends</span> <span class="nc">Logged</span> <span class="o">{</span>
  <span class="k">override</span> <span class="k">def</span> <span class="n">log</span><span class="o">(</span><span class="n">msg</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="o">{</span>
    <span class="k">super</span><span class="o">.</span><span class="n">log</span><span class="o">(</span><span class="k">new</span> <span class="n">java</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="nc">Date</span><span class="o">()</span> <span class="o">+</span> <span class="s">&quot; &quot;</span> <span class="o">+</span> <span class="n">msg</span><span class="o">)</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>Also, suppose we want to truncate the overly chatty log messages like this:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">trait</span> <span class="nc">ShortLogger</span> <span class="k">extends</span> <span class="nc">Logged</span> <span class="o">{</span>
  <span class="k">val</span> <span class="n">maxLength</span> <span class="k">=</span> <span class="mi">15</span> <span class="c1">// See Section 10.8 on fields in traits</span>
  <span class="k">override</span> <span class="k">def</span> <span class="n">log</span><span class="o">(</span><span class="n">msg</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="o">{</span>
    <span class="k">super</span><span class="o">.</span><span class="n">log</span><span class="o">(</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">msg</span><span class="o">.</span><span class="n">length</span> <span class="o">&lt;=</span> <span class="n">maxLength</span><span class="o">)</span> <span class="n">msg</span> <span class="k">else</span> <span class="n">msg</span><span class="o">.</span><span class="n">substring</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="n">maxLength</span> <span class="o">-</span> <span class="mi">3</span><span class="o">)</span> <span class="o">+</span> <span class="s">&quot;...&quot;</span><span class="o">)</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>Note that each of the <span class="monospaced">log</span> methods passes a modified message to <span class="monospaced">super.log</span>.</p></div>
<div class="sect3">
<h4 id="_traits_and_span_class_monospaced_super_span">Traits and <span class="monospaced">super</span></h4>
<div class="paragraph"><p>With traits, <span class="monospaced">super</span> does not have the same meaning as it does with
classes. (If it did, then these traits would be useless. They extend
<span class="monospaced">Logged</span>, whose <span class="monospaced">log</span> method does nothing.)</p></div>
<div class="paragraph"><p>Instead, <span class="monospaced">super</span> is interpreted to mean "the next trait in the trait hierarchy",
which depends on the order the traits were added. Generally, traits are
processed back to front.</p></div>
<div class="paragraph"><p>Consider this example:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">val</span> <span class="n">acct</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">SavingsAccount</span> <span class="k">with</span> <span class="nc">ConsoleLogger</span> <span class="k">with</span> <span class="nc">ShortLogger</span> <span class="k">with</span> <span class="nc">TimestampLogger</span>
</pre></div></div></div>
<div class="paragraph"><p>In that example, the call to <span class="monospaced">log</span> within <span class="monospaced">acct.withdraw</span>:</p></div>
<div class="ulist"><ul>
<li>
<p>
first calls <span class="monospaced">Timestamp.log</span>, which adds the timestamp. <span class="monospaced">Timestamp.log</span>
  calls <span class="monospaced">super.log</span> &#8230;
</p>
</li>
<li>
<p>
&#8230; which invokes <span class="monospaced">Shortlogger.log</span>, trimming the log message. Then,
  <span class="monospaced">ShortLogger.log</span> calls <span class="monospaced">super.log</span> &#8230;
</p>
</li>
<li>
<p>
&#8230; which invokes <span class="monospaced">ConsoleLogger.log</span>, dumping the result to standard output.
</p>
</li>
</ul></div>
<div class="paragraph"><p>To see why the order matters, compare the following two examples:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">val</span> <span class="n">acct1</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">SavingsAccount</span> <span class="k">with</span> <span class="nc">ConsoleLogger</span> <span class="k">with</span> <span class="nc">TimestampLogger</span> <span class="k">with</span> <span class="nc">ShortLogger</span>
<span class="k">val</span> <span class="n">acct2</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">SavingsAccount</span> <span class="k">with</span> <span class="nc">ConsoleLogger</span> <span class="k">with</span> <span class="nc">ShortLogger</span> <span class="k">with</span> <span class="nc">TimestampLogger</span>
</pre></div></div></div>
<div class="paragraph"><p>If we overdraw acct1, we get a message:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>Sun Feb 06 17:45:45 ICT 2011 Insufficient...</pre>
</div></div>
<div class="paragraph"><p>As you can see, the <span class="monospaced">ShortLogger.log</span> method was called first, and its call
to <span class="monospaced">super.log</span> called the <span class="monospaced">TimestampLogger</span>.</p></div>
<div class="paragraph"><p>However, overdrawing <span class="monospaced">acct2</span> yields</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>Sun Feb 06 1...</pre>
</div></div>
<div class="paragraph"><p>Here, the <span class="monospaced">TimestampLogger</span> appeared last in the list of traits. Its <span class="monospaced">log</span>
message was called first, and the result was subsequently shortened.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">With traits, you cannot tell from the source code which method is
invoked by <span class="monospaced">super.someMethod</span>. The exact method depends on the ordering of
the traits in the object or class that uses them. This makes <span class="monospaced">super</span> far
more flexible than in plain old inheritance.</td>
</tr></table>
</div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">If you need to control which trait’s method is invoked, you can
specify it in brackets: <span class="monospaced">super[ConsoleLogger].log(...)</span>. The specified type
must be an immediate supertype; you can’t access traits or classes that are
further away in the inheritance hierarchy.</td>
</tr></table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_overriding_abstract_methods_in_traits">Overriding Abstract Methods in Traits</h3>
<div class="paragraph"><p>Let’s go back to our Logger <span class="monospaced">trait</span>, where we provide no implementation to
the <span class="monospaced">log</span> method.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">trait</span> <span class="nc">Logger</span> <span class="o">{</span>
  <span class="k">def</span> <span class="n">log</span><span class="o">(</span><span class="n">msg</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span><span class="k">:</span> <span class="kt">Unit</span> <span class="c1">// This method is abstract</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>Now let’s extend this trait with a timestamp trait, as in the preceding
section. Unfortunately, the <span class="monospaced">TimestampLogger</span> class no longer compiles.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">trait</span> <span class="nc">TimestampLogger</span> <span class="k">extends</span> <span class="nc">Logger</span> <span class="o">{</span>
  <span class="k">override</span> <span class="k">def</span> <span class="n">log</span><span class="o">(</span><span class="n">msg</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="o">{</span> <span class="c1">// Overrides an abstract method</span>
    <span class="k">super</span><span class="o">.</span><span class="n">log</span><span class="o">(</span><span class="k">new</span> <span class="n">java</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="nc">Date</span><span class="o">()</span> <span class="o">+</span> <span class="s">&quot; &quot;</span> <span class="o">+</span> <span class="n">msg</span><span class="o">)</span> <span class="c1">// Is super.log defined?</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>The compiler flags the call to <span class="monospaced">super.log</span> as an error.</p></div>
<div class="paragraph"><p>Under normal inheritance rules, this call could never be correct: the
<span class="monospaced">Logger.log</span> method has no implementation.</p></div>
<div class="paragraph"><p>But, as we saw in the preceding section, there is no way of knowing which
<span class="monospaced">log</span> method is actually being called. It depends on the order in which
traits are mixed in.</p></div>
<div class="paragraph"><p>Scala takes the position that <span class="monospaced">TimestampLogger.log</span> is still abstract. It
requires a concrete <span class="monospaced">log</span> method to be mixed in. You therefore need to tag
the method with the <span class="monospaced">abstract</span> keyword and the <span class="monospaced">override</span> keyword, like
this:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">abstract</span> <span class="k">override</span> <span class="k">def</span> <span class="n">log</span><span class="o">(</span><span class="n">msg</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="o">{</span>
  <span class="k">super</span><span class="o">.</span><span class="n">log</span><span class="o">(</span><span class="k">new</span> <span class="n">java</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="nc">Date</span><span class="o">()</span> <span class="o">+</span> <span class="s">&quot; &quot;</span> <span class="o">+</span> <span class="n">msg</span><span class="o">)</span>
<span class="o">}</span>
</pre></div></div></div>
</div>
<div class="sect2">
<h3 id="_traits_for_rich_interfaces">Traits for Rich Interfaces</h3>
<div class="paragraph"><p>A trait can have many utility methods that depend on a few abstract ones.
One example is the Scala <span class="monospaced">Iterator</span> trait that defines dozens of methods in
terms of the abstract <span class="monospaced">next</span> and <span class="monospaced">hasNext</span> methods.</p></div>
<div class="paragraph"><p>Let us enrich our logging API.</p></div>
<div class="paragraph"><p>Usually, a logging API lets you specify a level for each log message to
distinguish informational messages from warnings or errors. We can easily
add this capability without forcing any policy for the destination of
logging messages.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">trait</span> <span class="nc">Logger</span> <span class="o">{</span>
  <span class="k">def</span> <span class="n">log</span><span class="o">(</span><span class="n">msg</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span><span class="k">:</span> <span class="kt">Unit</span>
  <span class="k">def</span> <span class="n">info</span><span class="o">(</span><span class="n">msg</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="o">{</span> <span class="n">log</span><span class="o">(</span><span class="s">&quot;INFO: &quot;</span> <span class="o">+</span> <span class="n">msg</span><span class="o">)</span> <span class="o">}</span>
  <span class="k">def</span> <span class="n">warn</span><span class="o">(</span><span class="n">msg</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="o">{</span> <span class="n">log</span><span class="o">(</span><span class="s">&quot;WARN: &quot;</span> <span class="o">+</span> <span class="n">msg</span><span class="o">)</span> <span class="o">}</span>
  <span class="k">def</span> <span class="n">severe</span><span class="o">(</span><span class="n">msg</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="o">{</span> <span class="n">log</span><span class="o">(</span><span class="s">&quot;SEVERE: &quot;</span> <span class="o">+</span> <span class="n">msg</span><span class="o">)</span> <span class="o">}</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>Note the combination of abstract and concrete methods.</p></div>
<div class="paragraph"><p>A class that uses the <span class="monospaced">Logger</span> trait can now call any of these logging
messages, for example:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">class</span> <span class="nc">SavingsAccount</span> <span class="k">extends</span> <span class="nc">Account</span> <span class="k">with</span> <span class="nc">Logger</span> <span class="o">{</span>
  <span class="k">def</span> <span class="n">withdraw</span><span class="o">(</span><span class="n">amount</span><span class="k">:</span> <span class="kt">Double</span><span class="o">)</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">amount</span> <span class="o">&gt;</span> <span class="n">balance</span><span class="o">)</span> <span class="n">severe</span><span class="o">(</span><span class="s">&quot;Insufficient funds&quot;</span><span class="o">)</span>
    <span class="k">else</span> <span class="o">...</span>
  <span class="o">}</span>
  <span class="o">...</span>
  <span class="k">override</span> <span class="k">def</span> <span class="n">log</span><span class="o">(</span><span class="n">msg</span><span class="k">:</span><span class="kt">String</span><span class="o">)</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="o">{</span> <span class="n">println</span><span class="o">(</span><span class="n">msg</span><span class="o">)</span> <span class="o">}</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>This use of concrete and abstract methods in a trait is <em>very</em> common in
Scala.</p></div>
<div class="paragraph"><p>In Java, you would need to declare an interface and a separate class
extending the interface (such as <span class="monospaced">Collection/AbstractCollection</span> or
<span class="monospaced">MouseListener/MouseAdapter</span>).</p></div>
</div>
<div class="sect2">
<h3 id="_concrete_fields_in_traits">Concrete Fields in Traits</h3>
<div class="paragraph"><p>A field in a trait can be concrete or abstract. If you supply an initial
value, the field is concrete.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">trait</span> <span class="nc">ShortLogger</span> <span class="k">extends</span> <span class="nc">Logged</span> <span class="o">{</span>
  <span class="k">val</span> <span class="n">maxLength</span> <span class="k">=</span> <span class="mi">15</span> <span class="c1">// A concrete field</span>
  <span class="o">...</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>A class that mixes in this trait acquires a <span class="monospaced">maxLength</span> field. In general,
a class gets a field for each concrete field in one of its traits. These
fields are not inherited; they are actually <em>added</em> to the subclass. This
may seem a subtle distinction, but it is important.</p></div>
<div class="paragraph"><p>Let&#8217;s look at the process more closely.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">class</span> <span class="nc">SavingsAccount</span> <span class="k">extends</span> <span class="nc">Account</span> <span class="k">with</span> <span class="nc">ConsoleLogger</span> <span class="k">with</span> <span class="nc">ShortLogger</span> <span class="o">{</span>
  <span class="k">var</span> <span class="n">interest</span> <span class="k">=</span> <span class="mf">0.0</span>
  <span class="k">def</span> <span class="n">withdraw</span><span class="o">(</span><span class="n">amount</span><span class="k">:</span> <span class="kt">Double</span><span class="o">)</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">amount</span> <span class="o">&gt;</span> <span class="n">balance</span><span class="o">)</span> <span class="n">log</span><span class="o">(</span><span class="s">&quot;Insufficient funds&quot;</span><span class="o">)</span>
    <span class="k">else</span> <span class="o">...</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>Note that our subclass has an <span class="monospaced">interest</span> field. That’s a plain old field in
the subclass.</p></div>
<div class="paragraph"><p>Now, suppose <span class="monospaced">Account</span> has a field.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Account</span> <span class="o">{</span>
  <span class="k">var</span> <span class="n">balance</span> <span class="k">=</span> <span class="mf">0.0</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>The <span class="monospaced">SavingsAccount</span> class <em>inherits</em> that field in the usual way. A
<span class="monospaced">SavingsAccount</span> object is made up of all the fields of its superclasses,
together with any fields in the subclass. You can think of a
<span class="monospaced">SavingsAcccount</span> object as "starting out" with a superclass object.</p></div>
<div class="imageblock">
<div class="content">
<img src="images/10-fields1.png" alt="10-fields1.png">
</div>
<div class="title">Figure 1. Fields from a trait are placed in the subclass</div>
</div>
<div class="paragraph"><p>In the JVM, a class can only extend one superclass, so the trait fields
can’t be inherited in the same way. Instead, the <span class="monospaced">maxLength</span> field is added
to the <span class="monospaced">SavingsAccount</span> class, next to the <span class="monospaced">interest</span> field.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">You can think of concrete trait fields as "assembly instructions" for the
classes that use the trait. Any such fields become fields of the class.</td>
</tr></table>
</div>
</div>
<div class="sect2">
<h3 id="_abstract_fields_in_traits">Abstract Fields in Traits</h3>
<div class="paragraph"><p>An uninitialized field in a trait is abstract and must be overridden in a
concrete subclass.</p></div>
<div class="paragraph"><p>For example, the following <span class="monospaced">maxLength</span> field is abstract:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">trait</span> <span class="nc">ShortLogger</span> <span class="k">extends</span> <span class="nc">Logged</span> <span class="o">{</span>
  <span class="k">val</span> <span class="n">maxLength</span><span class="k">:</span> <span class="kt">Int</span> <span class="c1">// An abstract field</span>
  <span class="k">override</span> <span class="k">def</span> <span class="n">log</span><span class="o">(</span><span class="n">msg</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="o">{</span>
    <span class="k">super</span><span class="o">.</span><span class="n">log</span><span class="o">(</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">msg</span><span class="o">.</span><span class="n">length</span> <span class="o">&lt;=</span> <span class="n">maxLength</span><span class="o">)</span> <span class="n">msg</span> <span class="k">else</span> <span class="n">msg</span><span class="o">.</span><span class="n">substring</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="n">maxLength</span> <span class="o">-</span> <span class="mi">3</span><span class="o">)</span> <span class="o">+</span> <span class="s">&quot;...&quot;</span><span class="o">)</span>
         <span class="c1">// The maxLength field is used in the implementation</span>
  <span class="o">}</span>
  <span class="o">...</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>When you use this trait in a concrete class, you <em>must</em> supply the
<span class="monospaced">maxLength</span> field:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">class</span> <span class="nc">SavingsAccount</span> <span class="k">extends</span> <span class="nc">Account</span> <span class="k">with</span> <span class="nc">ConsoleLogger</span> <span class="k">with</span> <span class="nc">ShortLogger</span> <span class="o">{</span>
  <span class="k">val</span> <span class="n">maxLength</span> <span class="k">=</span> <span class="mi">20</span> <span class="c1">// No override necessary</span>
  <span class="o">...</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>Now all logging messages are truncated after 20 characters.</p></div>
<div class="paragraph"><p>This way of supplying values for trait parameters is particularly handy
when you construct objects on the fly. Let’s go back to our original
savings account:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">class</span> <span class="nc">SavingsAccount</span> <span class="k">extends</span> <span class="nc">Account</span> <span class="k">with</span> <span class="nc">Logged</span> <span class="o">{</span> <span class="o">...</span> <span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>Now, we can truncate the messages in an instance as follows:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">val</span> <span class="n">acct</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">SavingsAccount</span> <span class="k">with</span> <span class="nc">ConsoleLogger</span> <span class="k">with</span> <span class="nc">ShortLogger</span> <span class="o">{</span>
  <span class="k">val</span> <span class="n">maxLength</span> <span class="k">=</span> <span class="mi">20</span>
<span class="o">}</span>
</pre></div></div></div>
</div>
<div class="sect2">
<h3 id="_trait_construction_order">Trait Construction Order</h3>
<div class="paragraph"><p>Just like classes, traits can have primary constructors, made up of field
initializations and other statements in the trait’s body. For example,</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">trait</span> <span class="nc">FileLogger</span> <span class="k">extends</span> <span class="nc">Logger</span> <span class="o">{</span>
  <span class="k">val</span> <span class="n">out</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">PrintWriter</span><span class="o">(</span><span class="s">&quot;app.log&quot;</span><span class="o">)</span> <span class="c1">// Part of the trait&#39;s constructor</span>
  <span class="n">out</span><span class="o">.</span><span class="n">println</span><span class="o">(</span><span class="s">&quot;# &quot;</span> <span class="o">+</span> <span class="k">new</span> <span class="nc">Date</span><span class="o">().</span><span class="n">toString</span><span class="o">)</span> <span class="c1">// Also part of the constructor</span>

  <span class="k">def</span> <span class="n">log</span><span class="o">(</span><span class="n">msg</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="o">{</span> <span class="n">out</span><span class="o">.</span><span class="n">println</span><span class="o">(</span><span class="n">msg</span><span class="o">);</span> <span class="n">out</span><span class="o">.</span><span class="n">flush</span><span class="o">()</span> <span class="o">}</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>These statements are executed during construction of any object
incorporating the trait.</p></div>
<div class="paragraph"><p>Constructors execute in the following order:</p></div>
<div class="ulist"><ul>
<li>
<p>
The superclass constructor is called first.
</p>
</li>
<li>
<p>
Trait constructors are executed after the superclass constructor but
  before the class constructor.
</p>
</li>
<li>
<p>
Traits are constructed left-to-right.
</p>
</li>
<li>
<p>
Within each trait, the parents get constructed first.
</p>
</li>
<li>
<p>
If multiple traits share a common parent, and that parent has already
  been constructed, it is not constructed again.
</p>
</li>
<li>
<p>
After all traits are constructed, the subclass is constructed.
</p>
</li>
</ul></div>
<div class="paragraph"><p>For example, consider this class:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">class</span> <span class="nc">SavingsAccount</span> <span class="k">extends</span> <span class="nc">Account</span> <span class="k">with</span> <span class="nc">FileLogger</span> <span class="k">with</span> <span class="nc">ShortLogger</span>
</pre></div></div></div>
<div class="paragraph"><p>The constructors execute in the following order:</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
<span class="monospaced">Account</span> (the superclass).
</p>
</li>
<li>
<p>
<span class="monospaced">Logger</span> (the parent of the first trait).
</p>
</li>
<li>
<p>
<span class="monospaced">FileLogger</span> (the first trait).
</p>
</li>
<li>
<p>
<span class="monospaced">ShortLogger</span> (the second trait). Note that its Logger parent has
   already been constructed.
</p>
</li>
<li>
<p>
<span class="monospaced">SavingsAccount</span> (the class).
</p>
</li>
</ol></div>
</div>
<div class="sect2">
<h3 id="_initializing_trait_fields">Initializing Trait Fields</h3>
<div class="paragraph"><p>Traits cannot have constructor parameters. Every trait has a single
parameterless constructor.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">Interestingly, the absence of constructor parameters is the only
technical difference between traits and classes. Otherwise, traits can have
all the features of classes, such as concrete and abstract fields and
superclasses.</td>
</tr></table>
</div>
<div class="paragraph"><p>This limitation can be a problem for traits that need some customization to
be useful. Consider a file logger. We would like to specify the log file,
but we can’t use a construction parameter:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">val</span> <span class="n">acct</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">SavingsAccount</span> <span class="k">with</span> <span class="nc">FileLogger</span><span class="o">(</span><span class="s">&quot;myapp.log&quot;</span><span class="o">)</span>
<span class="c1">// Error: Can&#39;t have constructor parameters for traits</span>
</pre></div></div></div>
<div class="paragraph"><p>We saw one possible approach in the preceding section. The <span class="monospaced">FileLogger</span>
trait can have an abstract field for the filename.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">trait</span> <span class="nc">FileLogger</span> <span class="k">extends</span> <span class="nc">Logger</span> <span class="o">{</span>
  <span class="k">val</span> <span class="n">filename</span><span class="k">:</span> <span class="kt">String</span>
  <span class="k">val</span> <span class="n">out</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">PrintStream</span><span class="o">(</span><span class="n">filename</span><span class="o">)</span>
  <span class="k">def</span> <span class="n">log</span><span class="o">(</span><span class="n">msg</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="o">{</span> <span class="n">out</span><span class="o">.</span><span class="n">println</span><span class="o">(</span><span class="n">msg</span><span class="o">);</span> <span class="n">out</span><span class="o">.</span><span class="n">flush</span><span class="o">()</span> <span class="o">}</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>A class using this trait can override the <span class="monospaced">filename</span> field. Unfortunately,
there is a pitfall. The straightforward approach does not work:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">val</span> <span class="n">acct</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">SavingsAccount</span> <span class="k">with</span> <span class="nc">FileLogger</span> <span class="o">{</span>
  <span class="k">val</span> <span class="n">filename</span> <span class="k">=</span> <span class="s">&quot;myapp.log&quot;</span> <span class="c1">// Does not work</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>The problem is the construction order.</p></div>
<div class="paragraph"><p>The <span class="monospaced">FileLogger</span> constructor runs before the subclass constructor. Here,
the subclass is a bit hard to see.</p></div>
<div class="ulist"><ul>
<li>
<p>
The <span class="monospaced">new</span> statement constructs an instance of an anonymous class
  extending <span class="monospaced">SavingsAccount</span> (the superclass) with the <span class="monospaced">FileLogger</span> trait.
</p>
</li>
<li>
<p>
The initialization of <span class="monospaced">filename</span> only happens in the anonymous subclass.
  Actually, it doesn’t happen at all: Before the subclass gets its turn, a
  null pointer exception is thrown in the <span class="monospaced">FileLogger</span> constructor.
</p>
</li>
</ul></div>
<div class="paragraph"><p>One remedy is an obscure feature that we described earlier: early
definition. Here is the correct version:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">val</span> <span class="n">acct</span> <span class="k">=</span> <span class="k">new</span> <span class="o">{</span> <span class="c1">// Early definition block after new</span>
  <span class="k">val</span> <span class="n">filename</span> <span class="k">=</span> <span class="s">&quot;myapp.log&quot;</span>
<span class="o">}</span> <span class="k">with</span> <span class="nc">SavingsAccount</span> <span class="k">with</span> <span class="nc">FileLogger</span>
</pre></div></div></div>
<div class="paragraph"><p>It’s not pretty, but it solves the problem. The early definition happens
before the regular construction sequence. When the <span class="monospaced">FileLogger</span> is
constructed, the filename field is initialized.</p></div>
<div class="paragraph"><p>If you need to do the same in a class, the syntax looks like this:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">class</span> <span class="nc">SavingsAccount</span> <span class="k">extends</span> <span class="o">{</span> <span class="c1">// Early definition block after extends</span>
  <span class="k">val</span> <span class="n">filename</span> <span class="k">=</span> <span class="s">&quot;savings.log&quot;</span>
<span class="o">}</span> <span class="k">with</span> <span class="nc">Account</span> <span class="k">with</span> <span class="nc">FileLogger</span> <span class="o">{</span>
  <span class="o">...</span> <span class="c1">// SavingsAccount implementation</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>Another alternative is to use a lazy value in the <span class="monospaced">FileLogger</span> constructor,
like this:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">trait</span> <span class="nc">FileLogger</span> <span class="k">extends</span> <span class="nc">Logger</span> <span class="o">{</span>
  <span class="k">val</span> <span class="n">filename</span><span class="k">:</span> <span class="kt">String</span>
  <span class="k">lazy</span> <span class="k">val</span> <span class="n">out</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">PrintStream</span><span class="o">(</span><span class="n">filename</span><span class="o">)</span>
  <span class="k">def</span> <span class="n">log</span><span class="o">(</span><span class="n">msg</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="o">{</span> <span class="n">out</span><span class="o">.</span><span class="n">println</span><span class="o">(</span><span class="n">msg</span><span class="o">)</span> <span class="o">}</span> <span class="c1">// No override needed</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>Then, the <span class="monospaced">out</span> field is initialized when it is first used. At that time,
the <span class="monospaced">filename</span> field will have been set.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Caution</div>
</td>
<td class="content">Remember, lazy values are somewhat inefficient since they are
checked for initialization before every use.</td>
</tr></table>
</div>
</div>
<div class="sect2">
<h3 id="_lab_traits_1">Lab: Traits 1</h3>
<div class="paragraph"><p>Open <span class="monospaced">labs/src/main/scala/com/newcircle/traits/IntQueue.scala</span>.</p></div>
<div class="paragraph"><p>You are to complete the <span class="monospaced">BasicIntQueue</span> class and implement the
<span class="monospaced">SquaringIntQueue</span> and <span class="monospaced">NegatingIntQueue</span> traits.</p></div>
<div class="paragraph"><p>To test your solution, run this tester in SBT:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>&gt; test-only com.newcircle.tests.traits.IntQueueSpec</pre>
</div></div>
<div class="paragraph"><p>After your tests work, type <span class="monospaced">console</span> at the SBT prompt. You&#8217;ll get a Scala
REPL. Type the following:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>scala> <strong>import com.newcircle.traits._</strong>

scala> <strong>val q1 = new BasicIntQueue with SquaringIntQueue with NegatingIntQueue</strong>

scala> <strong>val q2 = new BasicIntQueue with NegatingIntQueue with SquaringIntQueue</strong>

scala> <strong>q1.put(20)</strong>

scala> <strong>q2.put(20)</strong>

scala> <strong>q1.contents</strong>
res2: ?

scala> <strong>q2.contents</strong>
res3: ?</pre>
</div></div>
<div class="paragraph"><p>What do <span class="monospaced">res2</span> and <span class="monospaced">res3</span> end up containing? Why?</p></div>
</div>
<div class="sect2">
<h3 id="_traits_extending_classes">Traits Extending Classes</h3>
<div class="paragraph"><p>We&#8217;ve already seen that traits can extend other traits. This is quite common.</p></div>
<div class="paragraph"><p>Less common, however, is having a trait extend a class. That class then
becomes the <em>superclass</em> of any class that mixes the trait in.</p></div>
<div class="paragraph"><p>Consider:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">trait</span> <span class="nc">LoggedException</span> <span class="k">extends</span> <span class="nc">Exception</span> <span class="k">with</span> <span class="nc">Logged</span> <span class="o">{</span>
  <span class="k">def</span> <span class="n">log</span><span class="o">()</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="o">{</span> <span class="n">log</span><span class="o">(</span><span class="n">getMessage</span><span class="o">())</span> <span class="o">}</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>In this case, the <span class="monospaced">LoggedException</span> trait extends the <span class="monospaced">Exception</span> <em>class</em>.</p></div>
<div class="paragraph"><p>A <span class="monospaced">LoggedException</span> provides a <span class="monospaced">log</span> method to log the exception&#8217;s message.
Note that the <span class="monospaced">log</span> method calls the <span class="monospaced">getMessage</span> method that is inherited
from the <span class="monospaced">Exception</span> superclass.</p></div>
<div class="paragraph"><p>Now let&#8217;s use our trait:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">class</span> <span class="nc">UnhappyException</span> <span class="k">extends</span> <span class="nc">LoggedException</span> <span class="o">{</span> <span class="c1">// This class extends a trait</span>
  <span class="k">override</span> <span class="k">def</span> <span class="n">getMessage</span><span class="o">()</span> <span class="k">=</span> <span class="s">&quot;arggh!&quot;</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>The superclass of the <span class="monospaced">LoggedException</span> trait becomes the superclass of
<span class="monospaced">UnhappyException</span>.</p></div>
<div class="imageblock">
<div class="content">
<img src="images/10-exception1.png" alt="10-exception1.png">
</div>
</div>
<div class="paragraph"><p>What if our class already extends another class? That’s OK, as long as it’s
a subclass of the trait’s superclass. For example,</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">class</span> <span class="nc">UnhappyException</span> <span class="k">extends</span> <span class="nc">IOException</span> <span class="k">with</span> <span class="nc">LoggedException</span>
</pre></div></div></div>
<div class="paragraph"><p>Here <span class="monospaced">UnhappyException</span> extends <span class="monospaced">IOException</span>, which already extends
<span class="monospaced">Exception</span>. When mixing in the trait, its superclass is already present,
and there is no need to add it.</p></div>
<div class="paragraph"><p>However, if our class extends an unrelated class, then it is not possible
to mix in the trait. For example, you cannot form the following class:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">class</span> <span class="nc">UnhappyFrame</span> <span class="k">extends</span> <span class="nc">JFrame</span> <span class="k">with</span> <span class="nc">LoggedException</span> <span class="c1">// Error: Unrelated superclasses</span>
</pre></div></div></div>
<div class="paragraph"><p>It would be impossible to add both <span class="monospaced">JFrame</span> and <span class="monospaced">Exception</span> as superclasses.</p></div>
</div>
<div class="sect2">
<h3 id="_lab_traits_2">Lab: Traits 2</h3>
<div class="paragraph"><p>Open <span class="monospaced">labs/src/main/scala/com/newcircle/traits/IterableInputStream.scala</span>.</p></div>
<div class="paragraph"><p>Let&#8217;s take a quick look at it:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">package</span> <span class="nn">com.newcircle.traits</span>

<span class="k">import</span> <span class="nn">java.io.InputStream</span>
<span class="k">import</span> <span class="nn">scala.collection.</span><span class="o">{</span><span class="nc">Iterable</span><span class="o">,</span> <span class="nc">Iterator</span><span class="o">}</span>

<span class="cm">/** Implement a class called IterableInputStream that mixes</span>
<span class="cm">  * java.io.InputStream with scala.collection.Iterable.</span>
<span class="cm">  */</span>
<span class="k">class</span> <span class="nc">IterableInputStream</span><span class="o">(</span><span class="n">str</span><span class="k">:</span> <span class="kt">InputStream</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">Iterable</span><span class="o">[</span><span class="kt">Byte</span><span class="o">]</span> <span class="cm">/* ... */</span> <span class="o">{</span>
  <span class="c1">// You need to provide an implementation of this method.</span>
  <span class="k">def</span> <span class="n">iterator</span><span class="k">:</span> <span class="kt">Iterator</span><span class="o">[</span><span class="kt">Byte</span><span class="o">]</span> <span class="k">=</span> <span class="o">{</span>
    <span class="nc">Array</span><span class="o">.</span><span class="n">empty</span><span class="o">[</span><span class="kt">Byte</span><span class="o">].</span><span class="n">iterator</span> <span class="c1">// replace with actual implementation</span>
  <span class="o">}</span>

  <span class="cm">/** If you don&#39;t provide this, the default toString() method will run your</span>
<span class="cm">    * iterator.</span>
<span class="cm">    */</span>
  <span class="k">override</span> <span class="k">def</span> <span class="n">toString</span> <span class="k">=</span> <span class="o">{</span>
    <span class="s">s&quot;IterableInputStream&lt;</span><span class="si">${</span><span class="nc">System</span><span class="o">.</span><span class="n">identityHashCode</span><span class="o">(</span><span class="k">this</span><span class="o">)</span><span class="si">}</span><span class="s">&gt;&quot;</span>
  <span class="o">}</span>
<span class="o">}</span>

<span class="k">class</span> <span class="nc">InputStreamIterator</span><span class="o">(</span><span class="n">stream</span><span class="k">:</span> <span class="kt">InputStream</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">Iterator</span><span class="o">[</span><span class="kt">Byte</span><span class="o">]</span> <span class="o">{</span>
  <span class="k">def</span> <span class="n">hasNext</span><span class="k">:</span> <span class="kt">Boolean</span> <span class="o">=</span> <span class="o">{</span>
    <span class="kc">false</span> <span class="c1">// replace with actual implementation</span>
  <span class="o">}</span>
  <span class="k">def</span> <span class="n">next</span><span class="o">()</span><span class="k">:</span> <span class="kt">Byte</span> <span class="o">=</span> <span class="o">{</span>
    <span class="mi">0</span> <span class="c1">// replace with actual implementation</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>You&#8217;re creating an <span class="monospaced">IterableInputStream</span> that mixes together a Java
<span class="monospaced">InputStream</span> and a Scala <span class="monospaced">Iterable</span>. Doing so permits this kind of code:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">import</span> <span class="nn">java.io.FileInputStream</span>
<span class="k">import</span> <span class="nn">com.newcircle.traits.IterableInputStream</span>

<span class="k">for</span> <span class="o">(</span><span class="n">byte</span> <span class="k">&lt;-</span> <span class="k">new</span> <span class="nc">IterableInputStream</span><span class="o">(</span><span class="k">new</span> <span class="nc">FileInputStream</span><span class="o">(</span><span class="s">&quot;/tmp/foo.txt&quot;</span><span class="o">)))</span>
  <span class="n">println</span><span class="o">(</span><span class="n">byte</span><span class="o">.</span><span class="n">asInstanceOf</span><span class="o">[</span><span class="kt">Char</span><span class="o">])</span>
</pre></div></div></div>
<div class="paragraph"><p>To test your solution, run this tester in SBT:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>&gt; test-only com.newcircle.tests.traits.IterableInputStream</pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_self_types">Self Types</h3>
<div class="paragraph"><p>When a trait extends a class, there is a guarantee that the superclass is
present in any class mixing in the trait. Scala has an alternate mechanism
for guaranteeing this: <em>self types</em>.</p></div>
<div class="paragraph"><p>When a trait starts out with</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>self: Type =&gt;</pre>
</div></div>
<div class="paragraph"><p>then it can only be mixed into a subclass of the given type.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content"><span class="monospaced">self</span> is not a keyword. You can use any name you like. Most people use <span class="monospaced">self</span>, though.</td>
</tr></table>
</div>
<div class="paragraph"><p>Let’s use this feature for our <span class="monospaced">LoggedException</span>:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">trait</span> <span class="nc">LoggedException</span> <span class="k">extends</span> <span class="nc">Logged</span> <span class="o">{</span>
  <span class="n">self</span><span class="k">:</span> <span class="kt">Exception</span> <span class="o">=&gt;</span>
    <span class="k">def</span> <span class="n">log</span><span class="o">()</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="o">{</span> <span class="n">log</span><span class="o">(</span><span class="n">getMessage</span><span class="o">())</span> <span class="o">}</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p><strong>However</strong>&#8230; The trait does <em>not</em> extend the <span class="monospaced">Exception</span> class. Instead, it
has a self type of <span class="monospaced">Exception</span>. That means it can only be mixed into
subclasses of <span class="monospaced">Exception</span>.</p></div>
<div class="paragraph"><p>In the trait’s methods, we can call any methods of the self type. For
example, the call to <span class="monospaced">getMessage()</span> in the <span class="monospaced">log</span> method is valid, since we
know that <span class="monospaced">this</span> <em>must</em> be an <span class="monospaced">Exception</span>.</p></div>
<div class="paragraph"><p>If you try to mix the trait into a class that doesn’t conform to the self
type, an error occurs.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">val</span> <span class="n">f</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">JFrame</span> <span class="k">with</span> <span class="nc">LoggedException</span>
<span class="c1">// Error: JFrame isn&#39;t a subtype of Exception, the self type of LoggedException</span>
</pre></div></div></div>
<div class="sect3">
<h4 id="_isn_8217_t_this_the_same_as_having_the_trait_inherit_from_something_else">Isn&#8217;t this the same as having the trait inherit from something else?</h4>
<div class="paragraph"><p>A trait with a self type is <em>similar</em> to a trait with a supertype. In both
cases, it is ensured that a type is present in a class that mixes in the
trait.</p></div>
<div class="paragraph"><p>There are a few situations where the self type notation is more flexible
than traits with supertypes.</p></div>
<div class="ulist"><ul>
<li>
<p>
Self types can handle circular dependencies between traits. This can
  happen if you have two traits that need each other.
</p>
</li>
<li>
<p>
Self types can also handle structural types. Structural types are types
  that merely specify the <em>methods</em> that a class must have, without naming
  the class. Here is the <span class="monospaced">LoggedException</span> using a structural type:
</p>
</li>
</ul></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">trait</span> <span class="nc">LoggedException</span> <span class="k">extends</span> <span class="nc">Logged</span> <span class="o">{</span>
  <span class="k">this:</span> <span class="o">{</span> <span class="kt">def</span> <span class="kt">getMessage</span><span class="o">()</span> <span class="kt">:</span> <span class="kt">String</span> <span class="o">}</span> <span class="o">=&gt;</span>
    <span class="k">def</span> <span class="n">log</span><span class="o">()</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="o">{</span> <span class="n">log</span><span class="o">(</span><span class="n">getMessage</span><span class="o">())</span> <span class="o">}</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>The trait can be mixed into <em>any</em> class that has a <span class="monospaced">getMessage</span> method.</p></div>
<div class="paragraph"><p>We&#8217;ll discuss structural types in more detail later.</p></div>
</div>
</div>
<div class="sect2">
<h3 id="_what_happens_under_the_hood">What Happens under the Hood</h3>
<div class="paragraph"><p>Scala needs to translate traits into classes and interfaces of the JVM.
It&#8217;s not absolutely <em>necessary</em> to know how this is done, but it can be
helpful for understanding how traits work.</p></div>
<div class="paragraph"><p>A trait that has only abstract methods is simply turned into a Java
interface. For example,</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">trait</span> <span class="nc">Logger</span> <span class="o">{</span>
  <span class="k">def</span> <span class="n">log</span><span class="o">(</span><span class="n">msg</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span><span class="k">:</span> <span class="kt">Unit</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>turns into</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="n">public</span> <span class="n">interface</span> <span class="nc">Logger</span> <span class="o">{</span> <span class="c1">// Generated Java interface</span>
  <span class="n">void</span> <span class="n">log</span><span class="o">(</span><span class="nc">String</span> <span class="n">msg</span><span class="o">);</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>If a trait has concrete methods, a companion class is created whose static
methods hold the code of the trait’s methods. For example,</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">trait</span> <span class="nc">ConsoleLogger</span> <span class="k">extends</span> <span class="nc">Logger</span> <span class="o">{</span>
  <span class="k">def</span> <span class="n">log</span><span class="o">(</span><span class="n">msg</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="o">{</span> <span class="n">println</span><span class="o">(</span><span class="n">msg</span><span class="o">)</span> <span class="o">}</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>turns into</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="n">public</span> <span class="n">interface</span> <span class="nc">ConsoleLogger</span> <span class="k">extends</span> <span class="nc">Logger</span> <span class="o">{</span> <span class="c1">// Generated Java interface</span>
  <span class="n">void</span> <span class="n">log</span><span class="o">(</span><span class="nc">String</span> <span class="n">msg</span><span class="o">);</span>
<span class="o">}</span>

<span class="n">public</span> <span class="k">class</span> <span class="nc">ConsoleLogger$class</span> <span class="o">{</span> <span class="c1">// Generated Java companion class</span>
  <span class="n">public</span> <span class="n">static</span> <span class="n">void</span> <span class="n">log</span><span class="o">(</span><span class="nc">ConsoleLogger</span> <span class="n">self</span><span class="o">,</span> <span class="nc">String</span> <span class="n">msg</span><span class="o">)</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="o">{</span>
    <span class="n">println</span><span class="o">(</span><span class="n">msg</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>These companion classes don’t have any fields. Fields in traits yield
abstract getters and setters in the interface. When a class implements the
trait, the fields are added to that class.</p></div>
<div class="paragraph"><p>For example,</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">trait</span> <span class="nc">ShortLogger</span> <span class="k">extends</span> <span class="nc">Logger</span> <span class="o">{</span>
  <span class="k">val</span> <span class="n">maxLength</span> <span class="k">=</span> <span class="mi">15</span> <span class="c1">// A concrete field</span>
  <span class="o">...</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>is translated to</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="n">public</span> <span class="n">interface</span> <span class="nc">ShortLogger</span> <span class="k">extends</span> <span class="nc">Logger</span><span class="o">{</span>
  <span class="n">public</span> <span class="k">abstract</span> <span class="n">int</span> <span class="n">maxLength</span><span class="o">();</span>
  <span class="n">public</span> <span class="k">abstract</span> <span class="n">void</span> <span class="n">weird_prefix$maxLength_$eq</span><span class="o">(</span><span class="n">int</span><span class="o">);</span>
  <span class="o">...</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>The weird setter is needed to initialize the field. This happens in an
initialization method of the companion class:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="n">public</span> <span class="k">class</span> <span class="nc">ShortLogger$class</span> <span class="o">{</span>
  <span class="n">public</span> <span class="n">void</span> <span class="nc">$init</span><span class="n">$</span><span class="o">(</span><span class="nc">ShortLogger</span> <span class="n">self</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">self</span><span class="o">.</span><span class="n">weird_prefix$maxLength_$eq</span><span class="o">(</span><span class="mi">15</span><span class="o">)</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>When the trait is mixed into a class, the class gets a <span class="monospaced">maxLength</span> field with
a getter and setter. The constructors of that class will call the
initialization method.</p></div>
<div class="paragraph"><p>If a trait extends a superclass, the companion class does not inherit that
superclass. Instead, any class implementing the trait extends the
superclass.</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="lesson-11-operators">Operators</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_lesson_objectives_11">Lesson Objectives</h3>
<div class="paragraph"><p>In this lesson, we&#8217;ll look at how you can implement your own operators:
methods with the same syntax as the familiar mathematical operators.</p></div>
<div class="paragraph"><p>Operators are often used to build domain-specific languages (DSLs),
minilanguages embedded inside Scala. Implicit conversions (type conversion
functions that are applied automatically) are another tool facilitating the
creation of domain-specific languages. This lesson also discusses the
special methods apply, update, and unapply.</p></div>
</div>
<div class="sect2">
<h3 id="_summary_10">Summary</h3>
<div class="paragraph"><p>Identifiers contain either alphanumeric or operator characters.</p></div>
<div class="ulist"><ul>
<li>
<p>
Unary and binary operators are method calls.
</p>
</li>
<li>
<p>
Operator precedence depends on the first character, associativity on the last.
</p>
</li>
<li>
<p>
The apply and update methods are called when evaluating expr(args).
</p>
</li>
<li>
<p>
Extractors extract tuples or sequences of values from an input
</p>
</li>
</ul></div>
</div>
<div class="sect2">
<h3 id="_identifiers">Identifiers</h3>
<div class="paragraph"><p>The names of variables, functions, classes, and so on are collectively
called <em>identifiers</em>. In Scala, you have more choices for forming
identifiers than in Java.</p></div>
<div class="paragraph"><p>Of course, you can follow the time-honored pattern: sequences of
alphanumeric characters, starting with an alphabetic character or an
underscore, such as <span class="monospaced">fred12</span> or <span class="monospaced">_Wilma</span>.</p></div>
<div class="paragraph"><p>As in Java, Unicode characters are allowed. For example, <span class="monospaced">José</span> or <span class="monospaced">σoϕÓς</span>
are valid identifiers.</p></div>
<div class="paragraph"><p>In addition, you can use any sequence of operator characters:</p></div>
<div class="ulist"><ul>
<li>
<p>
ASCII characters other than letters, digits, underscore, parentheses
  <span class="monospaced">()[]{}</span>, or delimiters <span class="monospaced">.,;'</span>"<span class="monospaced">. In other words, any of
  `!#%&amp;*+-/:&lt;=&gt;?@\^|~</span>
</p>
</li>
<li>
<p>
Unicode mathematical symbols or other symbols from the Unicode categories
  Sm and So.
</p>
</li>
</ul></div>
<div class="paragraph"><p>For example, <span class="monospaced">**</span> and <span class="monospaced">√</span> are valid identifiers. With the definition</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">val</span> <span class="o">√</span> <span class="k">=</span> <span class="n">scala</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span> <span class="k">_</span>
</pre></div></div></div>
<div class="paragraph"><p>you can write <span class="monospaced">√(2)</span> to compute a square root. This may be a good idea,
provided one’s programming environment makes it easy to type the symbol.
It can also be overused.</p></div>
<div class="paragraph"><p>Finally, you can include just about any sequence of characters in
backquotes. For example,</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">val</span> <span class="n">`val`</span> <span class="k">=</span> <span class="mi">42</span>
</pre></div></div></div>
<div class="paragraph"><p>That example is silly, but backquotes can sometimes be an "escape hatch."
For example, in Scala, <span class="monospaced">yield</span> is a reserved word, but you may need to access
a Java method of the same name. Backquotes to the rescue:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="nc">Thread</span><span class="o">.</span><span class="n">`yield`</span><span class="o">()</span>
</pre></div></div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Caution</div>
</td>
<td class="content">
<div class="paragraph"><p>Scala permits wide latitude in function names, but the capability can
lead to code that&#8217;s hard to read. For example, I&#8217;ve seen code like the
following:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">for</span> <span class="o">{</span> <span class="n">response</span>   <span class="k">&lt;-</span> <span class="o">?</span> <span class="o">&lt;~</span> <span class="n">userServices</span><span class="o">.</span><span class="n">login</span><span class="o">(</span><span class="n">request</span><span class="o">()</span>
      <span class="n">user</span>       <span class="k">&lt;-</span> <span class="o">?</span> <span class="o">&lt;~</span> <span class="n">response</span><span class="o">.</span><span class="n">user</span>
      <span class="n">session</span>    <span class="k">&lt;-</span> <span class="o">?</span> <span class="o">&lt;~</span> <span class="n">response</span><span class="o">.</span><span class="n">session</span>
      <span class="n">addresses</span>  <span class="k">&lt;-</span> <span class="o">?</span> <span class="o">&lt;*</span> <span class="n">userAddressRepo</span><span class="o">.</span><span class="n">allFor</span><span class="o">(</span><span class="n">user</span><span class="o">.</span><span class="n">id</span><span class="o">)</span> <span class="o">}</span>
  <span class="k">yield</span> <span class="o">...</span>
</pre></div></div></div>
<div class="paragraph"><p>That&#8217;s a simple example, in fact. Imagine replacing some of the above with
Unicode operators, instead:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">for</span> <span class="o">{</span> <span class="n">response</span>  <span class="k">←</span> <span class="o">?</span> <span class="o">↢</span> <span class="n">userServices</span><span class="o">.</span><span class="n">login</span><span class="o">(</span><span class="n">request</span><span class="o">()</span>
      <span class="n">user</span>      <span class="k">←</span> <span class="o">?</span> <span class="o">↢</span> <span class="n">response</span><span class="o">.</span><span class="n">user</span>
      <span class="n">session</span>   <span class="k">←</span> <span class="o">?</span> <span class="o">↢</span> <span class="n">response</span><span class="o">.</span><span class="n">session</span>
      <span class="n">addresses</span> <span class="k">←</span> <span class="o">?</span> <span class="o">↚</span> <span class="n">userAddressRepo</span><span class="o">.∀(</span><span class="n">user</span><span class="o">.</span><span class="n">id</span><span class="o">)</span> <span class="o">}</span>
  <span class="k">yield</span> <span class="o">...</span>
</pre></div></div></div>
<div class="paragraph"><p>Scala permits such code. Is it more readable or less readable?</p></div>
<div class="paragraph"><p>Moral: Just because you <em>can</em> do something doesn&#8217;t necessarily mean
you <em>should</em>.</p></div>
</td>
</tr></table>
</div>
</div>
<div class="sect2">
<h3 id="_infix_operators">Infix Operators</h3>
<div class="paragraph"><p>You can write</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>a identifier b</pre>
</div></div>
<div class="paragraph"><p>where <span class="monospaced">identifier</span> denotes a method with two parameters (one implicit, one
explicit). For example, the expression</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>1 to 10</pre>
</div></div>
<div class="paragraph"><p>is actually a method call</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>1.to(10)</pre>
</div></div>
<div class="paragraph"><p>This is called an <em>infix</em> expression because the operator is between the
arguments. The operator can contain letters, as in <span class="monospaced">to</span>, or it can contain
operator characters. For example,</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>1 -&gt; 10</pre>
</div></div>
<div class="paragraph"><p>is a method call</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>1 .-&gt;(10)</pre>
</div></div>
<div class="paragraph"><p>To define an operator in your own class, simply define a method whose name
is that of the desired operator. For example, here is a Fraction class that
multiplies two fractions according to the law</p></div>
<div class="paragraph"><p><em>(n1 / d1) × (n2 / d2) = (n1n2 / d1d2)</em></p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Fraction</span><span class="o">(</span><span class="n">n</span><span class="k">:</span> <span class="kt">Int</span><span class="o">,</span> <span class="n">d</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">private</span> <span class="n">int</span> <span class="n">num</span> <span class="k">=</span> <span class="o">...</span>
  <span class="k">private</span> <span class="n">int</span> <span class="n">den</span> <span class="k">=</span> <span class="o">...</span>
  <span class="o">...</span>
  <span class="k">def</span> <span class="o">*(</span><span class="n">other</span><span class="k">:</span> <span class="kt">Fraction</span><span class="o">)</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">Fraction</span><span class="o">(</span><span class="n">num</span> <span class="o">*</span> <span class="n">other</span><span class="o">.</span><span class="n">num</span><span class="o">,</span> <span class="n">den</span> <span class="o">*</span> <span class="n">other</span><span class="o">.</span><span class="n">den</span><span class="o">)</span>
<span class="o">}</span>
</pre></div></div></div>
</div>
<div class="sect2">
<h3 id="_unary_operators">Unary Operators</h3>
<div class="paragraph"><p>Infix operators are binary operators: they have two parameters. An operator
with one parameter is called a <em>unary</em> operator. If it follows the
argument, it is a <em>postfix</em> operator. The expression</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>a identifier</pre>
</div></div>
<div class="paragraph"><p>is the same as the method call <span class="monospaced">a.identifier()</span>. For example,</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="mi">1</span> <span class="n">toString</span>
</pre></div></div></div>
<div class="paragraph"><p>is the same as</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="mf">1.</span><span class="n">toString</span><span class="o">()</span>
</pre></div></div></div>
<div class="paragraph"><p>The four operators <span class="monospaced">+</span>, <span class="monospaced">-</span>, <span class="monospaced">!</span>, <span class="monospaced">~</span> are allowed as prefix operators, appearing
before their arguments. They are converted into calls to methods with the
name <span class="monospaced">unary_operator</span>. For example,</p></div>
<div class="paragraph"><p><span class="monospaced">-a</span></p></div>
<div class="paragraph"><p>means the same as <span class="monospaced">a.unary_-</span>.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph"><p>As of Scala 2.10, you get a compiler warning if you use the postfix syntax:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>$ <strong>scala -feature</strong>
Welcome to Scala version 2.11.7 (Java HotSpot(TM) 64-Bit Server VM, Java 1.8.0_05).
Type in expressions to have them evaluated.
Type :help for more information.

scala> <strong>1 toString</strong>
console:8: warning: postfix operator toString should be enabled
by making the implicit value scala.language.postfixOps visible.
This can be achieved by adding the import clause <em>import scala.language.postfixOps</em>
or by setting the compiler option -language:postfixOps.
See the Scala docs for value scala.language.postfixOps for a discussion
why the feature should be explicitly enabled.
              1 toString
                ^</pre>
</div></div>
<div class="paragraph"><p>This warning is easily removed, as described in the error message.</p></div>
<div class="paragraph"><p>Why was this added? The rationale, outlined in Scala SIP 18
("SIP" stands for "Scala Improvement Process" and is the Scala equivalent of
a Java JCP.)</p></div>
<div class="paragraph"><p><em>The Scala language defines a range of powerful abstractions that enable
the construction of high-level libraries and DSLs. As with every powerful
feature, these have to be used with care and responsibility. With the
increasing adoption of Scala in mainstream programming, we have seen rising
demands for better guidance. Not every Scala programmer needs to make use
of every specialized tool in Scala’s arsenal to write libraries or DSLs. I
therefore propose a scheme where some of the more advanced and contentious
language features have to be enabled explicitly, typically using an import
&#8230; The hope is that this will provide a good balance between the wish to
provide the most powerful abstraction facilities possible and the wish to
control of these features by making their usage more explicit.</em></p></div>
</td>
</tr></table>
</div>
</div>
<div class="sect2">
<h3 id="_assignment_operators">Assignment Operators</h3>
<div class="paragraph"><p>An assignment operator has the form operator=, and the expression</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="n">a</span> <span class="n">operator</span><span class="k">=</span> <span class="n">b</span>
</pre></div></div></div>
<div class="paragraph"><p>means the same as</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="n">a</span> <span class="k">=</span> <span class="n">a</span> <span class="n">operator</span> <span class="n">b</span>
</pre></div></div></div>
<div class="paragraph"><p>For example, <span class="monospaced">a += b</span> is equivalent to <span class="monospaced">a = a + b</span>.</p></div>
<div class="paragraph"><p>There are a few technical details.</p></div>
<div class="ulist"><ul>
<li>
<p>
<span class="monospaced">&lt;=</span>, <span class="monospaced">&gt;=</span>, and <span class="monospaced">!=</span> are not assignment operators.
</p>
</li>
<li>
<p>
An operator starting with an <span class="monospaced">=</span> is never an assignment operator (<span class="monospaced">==</span>, <span class="monospaced">===</span>,
  <span class="monospaced">=/=</span>, and so on).
</p>
</li>
<li>
<p>
If <span class="monospaced">a</span> has a method called <span class="monospaced">operator=</span>, then that method is called directly.
</p>
</li>
</ul></div>
</div>
<div class="sect2">
<h3 id="_precedence">Precedence</h3>
<div class="paragraph"><p>When you have two or more operators in a row without parentheses, the ones
with higher precedence are executed first. For example, in the expression</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>1 + 2 * 3</pre>
</div></div>
<div class="paragraph"><p>the <span class="monospaced">*</span> operator is evaluated first.</p></div>
<div class="paragraph"><p>Languages such as Java and C++ have a fixed number of operators, and the
language standard decrees which have precedence over which. Scala can have
arbitrary operators, so it uses a scheme that works for all operators,
while also giving the familiar precedence order to the standard ones.</p></div>
<div class="paragraph"><p>Except for assignment operators, the precedence is determined by the first
character of the operator.</p></div>
<table class="tableblock frame-all grid-all"
style="
width:50%;
">
<col style="width:100%;">
<tbody>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Highest precedence: An operator character other than those below</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">* / %</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">+ -</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">:</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">&lt; &gt;</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">! =</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">&amp;</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">^</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">|</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">A character that is not an operator character</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Lowest precedence: Assignment operators</p></td>
</tr>
</tbody>
</table>
<div class="paragraph"><p>Characters in the same row yield operators with the same precedence. For
example, <span class="monospaced">+</span> and <span class="monospaced">-&gt;</span> have the same precedence.</p></div>
<div class="paragraph"><p>Postfix operators have lower precedence than infix operators:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>a infixOp b postfixOp</pre>
</div></div>
<div class="paragraph"><p>is the same as</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>(a infixOp b) postfixOp</pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_associativity">Associativity</h3>
<div class="paragraph"><p>When you have a sequence of operators of the same precedence, the
associativity determines whether they are evaluated left-to-right or
right-to-left. For example, in the expression <span class="monospaced">17 – 2 – 9</span>, one computes
<span class="monospaced">(17 – 2) – 9</span>. The <span class="monospaced">–</span> operator is left-associative.</p></div>
<div class="paragraph"><p>In Scala, all operators are left-associative except for</p></div>
<div class="ulist"><ul>
<li>
<p>
Operators that end in a colon (:)
</p>
</li>
<li>
<p>
Assignment operators
</p>
</li>
</ul></div>
<div class="paragraph"><p>In particular, the <span class="monospaced">::</span> operator for constructing lists is right-associative.
For example,</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="mi">1</span> <span class="o">::</span> <span class="mi">2</span> <span class="o">::</span> <span class="nc">Nil</span>
</pre></div></div></div>
<div class="paragraph"><p>means</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="mi">1</span> <span class="o">::</span> <span class="o">(</span><span class="mi">2</span> <span class="o">::</span> <span class="nc">Nil</span><span class="o">)</span>
</pre></div></div></div>
<div class="paragraph"><p>This is as it should be: We first need to form the list containing 2, and
that list becomes the tail of the list whose head is 1.</p></div>
<div class="paragraph"><p>A right-associative binary operator is a method of its second argument. For
example,</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="mi">2</span> <span class="o">::</span> <span class="nc">Nil</span>
</pre></div></div></div>
<div class="paragraph"><p>means</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="nc">Nil</span><span class="o">.::(</span><span class="mi">2</span><span class="o">)</span>
</pre></div></div></div>
</div>
<div class="sect2">
<h3 id="_lab_operators">Lab: Operators</h3>
<div class="paragraph"><p>One way to write a class with methods that "enrich" another class is as
follows:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">import</span> <span class="nn">scala.util.Random</span>

<span class="k">implicit</span> <span class="k">class</span> <span class="nc">MyStringStuff</span><span class="o">(</span><span class="k">val</span> <span class="n">str</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">def</span> <span class="n">shuffle</span> <span class="k">=</span> <span class="nc">Random</span><span class="o">.</span><span class="n">shuffle</span><span class="o">(</span><span class="n">str</span><span class="o">.</span><span class="n">toList</span><span class="o">).</span><span class="n">mkString</span><span class="o">(</span><span class="s">&quot;&quot;</span><span class="o">)</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>If that class is in scope, then all its methods will effectively be added
to any <span class="monospaced">String</span> object in the same scope. For example:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>scala> <strong>:paste</strong>
// Entering paste mode (ctrl-D to finish)

<strong>import scala.util.Random</strong>

<strong>implicit class MyStringStuff(val str: String) {</strong>
  <strong>def shuffle = Random.shuffle(str.toList).mkString("")</strong>
<strong>}</strong>
^D
// Exiting paste mode, now interpreting.

import scala.util.Random
defined class MyStringStuff

scala> <strong>"This is a string".shuffle</strong>
res0: String = gTi siaihsn t rs</pre>
</div></div>
<div class="paragraph"><p>Open <span class="monospaced">labs/src/main/scala/com/newcircle/operators/StrCompare.scala</span>.
In it, you&#8217;ll find just such an implicit class, called <span class="monospaced">MyRichString</span>.
Add a <span class="monospaced">&lt;=&gt;</span> operator to the class. The operator should behave like the
<span class="monospaced">String.compareTo</span> method.</p></div>
<div class="paragraph"><p>To test your solution, run this tester in SBT:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>&gt; test-only com.newcircle.tests.operators.StrCompareSpec</pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_the_span_class_monospaced_apply_span_and_span_class_monospaced_update_span_methods">The <span class="monospaced">apply</span> and <span class="monospaced">update</span> Methods</h3>
<div class="paragraph"><p>Scala lets you extend the function call syntax</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>f(arg1, arg2, ...)</pre>
</div></div>
<div class="paragraph"><p>to values other than functions. If <span class="monospaced">f</span> is not a function or method, then
this expression is equivalent to the call</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>f.apply(arg1, arg2, ...)</pre>
</div></div>
<div class="paragraph"><p>unless it occurs to the left of an assignment. The expression</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>f(arg1, arg2, ...) = value</pre>
</div></div>
<div class="paragraph"><p>corresponds to the call</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>f.update(arg1, arg2, ..., value)</pre>
</div></div>
<div class="paragraph"><p>This mechanism is used in arrays and maps. For example,</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">val</span> <span class="n">scores</span> <span class="k">=</span> <span class="k">new</span> <span class="n">scala</span><span class="o">.</span><span class="n">collection</span><span class="o">.</span><span class="n">mutable</span><span class="o">.</span><span class="nc">HashMap</span><span class="o">[</span><span class="kt">String</span>, <span class="kt">Int</span><span class="o">]</span>
<span class="n">scores</span><span class="o">(</span><span class="s">&quot;Bob&quot;</span><span class="o">)</span> <span class="k">=</span> <span class="mi">100</span> <span class="c1">// Calls scores.update(&quot;Bob&quot;, 100)</span>
<span class="k">val</span> <span class="n">bobsScore</span> <span class="k">=</span> <span class="n">scores</span><span class="o">(</span><span class="s">&quot;Bob&quot;</span><span class="o">)</span> <span class="c1">// Calls scores.apply(&quot;Bob&quot;)</span>
</pre></div></div></div>
<div class="paragraph"><p>The <span class="monospaced">apply</span> method is also commonly used in companion objects to construct
objects without calling <span class="monospaced">new</span>. For example, consider a <span class="monospaced">Fraction</span> class.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Fraction</span><span class="o">(</span><span class="n">n</span><span class="k">:</span> <span class="kt">Int</span><span class="o">,</span> <span class="n">d</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span> <span class="o">{</span>
  <span class="o">...</span>
<span class="o">}</span>

<span class="k">object</span> <span class="nc">Fraction</span> <span class="o">{</span>
  <span class="k">def</span> <span class="n">apply</span><span class="o">(</span><span class="n">n</span><span class="k">:</span> <span class="kt">Int</span><span class="o">,</span> <span class="n">d</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">Fraction</span><span class="o">(</span><span class="n">n</span><span class="o">,</span> <span class="n">d</span><span class="o">)</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>Because of the <span class="monospaced">apply</span> method, we can construct a fraction as
<span class="monospaced">Fraction(3, 4)</span> instead of <span class="monospaced">new Fraction(3, 4)</span>.</p></div>
<div class="paragraph"><p>That sounds like a small thing, but if you have many <span class="monospaced">Fraction</span> values, it
is a welcome improvement:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">val</span> <span class="n">result</span> <span class="k">=</span> <span class="nc">Fraction</span><span class="o">(</span><span class="mi">3</span><span class="o">,</span> <span class="mi">4</span><span class="o">)</span> <span class="o">*</span> <span class="nc">Fraction</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="mi">5</span><span class="o">)</span>
</pre></div></div></div>
</div>
<div class="sect2">
<h3 id="_extractors">Extractors</h3>
<div class="paragraph"><p>An extractor is an object with an <span class="monospaced">unapply</span> method. Think of the <span class="monospaced">unapply</span>
method as being the opposite of the <span class="monospaced">apply</span> method of a companion object.</p></div>
<div class="ulist"><ul>
<li>
<p>
An <span class="monospaced">apply</span> method takes construction parameters and turns them into an
  object.
</p>
</li>
<li>
<p>
An <span class="monospaced">unapply</span> method takes an object and extracts values from
  it, usually the values from which the object was constructed.
</p>
</li>
</ul></div>
<div class="paragraph"><p>Consider the <span class="monospaced">Fraction</span> class from the preceding section. The <span class="monospaced">apply</span>
method makes a fraction from a numerator and denominator. An <span class="monospaced">unapply</span>
method retrieves the numerator and denominator. You can use it in a
variable definition:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">var</span> <span class="nc">Fraction</span><span class="o">(</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">)</span> <span class="k">=</span> <span class="nc">Fraction</span><span class="o">(</span><span class="mi">3</span><span class="o">,</span> <span class="mi">4</span><span class="o">)</span> <span class="o">*</span> <span class="nc">Fraction</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="mi">5</span><span class="o">)</span>
<span class="c1">// a, b are initialized with the numerator and denominator of the result</span>
</pre></div></div></div>
<div class="paragraph"><p>or a pattern match:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">case</span> <span class="nc">Fraction</span><span class="o">(</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="o">...</span> <span class="c1">// a, b are bound to the numerator and denominator</span>
</pre></div></div></div>
<div class="paragraph"><p>(We&#8217;ll talk more about pattern matching later.)</p></div>
<div class="paragraph"><p>In general, a pattern match can fail. Therefore, the <span class="monospaced">unapply</span> method returns
an <span class="monospaced">Option</span> containing a tuple with one value for each matched variable. In
our case, we return an <span class="monospaced">Option[(Int, Int)]</span>.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">object</span> <span class="nc">Fraction</span> <span class="o">{</span>
  <span class="k">def</span> <span class="n">unapply</span><span class="o">(</span><span class="n">input</span><span class="k">:</span> <span class="kt">Fraction</span><span class="o">)</span> <span class="k">=</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">input</span><span class="o">.</span><span class="n">den</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="nc">None</span> <span class="k">else</span> <span class="nc">Some</span><span class="o">((</span><span class="n">input</span><span class="o">.</span><span class="n">num</span><span class="o">,</span> <span class="n">input</span><span class="o">.</span><span class="n">den</span><span class="o">))</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>Just to show the possibility, this method returns <span class="monospaced">None</span> when the denominator
is zero, indicating no match.</p></div>
<div class="sect3">
<h4 id="_other_uses_for_span_class_monospaced_unapply_span">Other uses for <span class="monospaced">unapply</span></h4>
<div class="paragraph"><p>In the preceding example, the <span class="monospaced">apply</span> and <span class="monospaced">unapply</span> methods are inverses of one
another. However, that is not a requirement. You can use extractors to
extract information from an object of any type.</p></div>
<div class="paragraph"><p>For example, suppose you want to extract first and last names from a string:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">val</span> <span class="n">author</span> <span class="k">=</span> <span class="s">&quot;Cay Horstmann&quot;</span>
<span class="k">val</span> <span class="nc">Name</span><span class="o">(</span><span class="n">first</span><span class="o">,</span> <span class="n">last</span><span class="o">)</span> <span class="k">=</span> <span class="n">author</span> <span class="c1">// Calls Name.unapply(author)</span>
</pre></div></div></div>
<div class="paragraph"><p>So, let&#8217;s make <span class="monospaced">Name</span> object with an <span class="monospaced">unapply</span> method that returns an
<span class="monospaced">Option[(String, String)]</span>. If the match succeeds, it&#8217;ll return a pair with
the first and last name. The components of the pair will be bound to the
variables in the pattern. Otherwise, it&#8217;ll return <span class="monospaced">None</span>.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">object</span> <span class="nc">Name</span> <span class="o">{</span>
  <span class="k">def</span> <span class="n">unapply</span><span class="o">(</span><span class="n">input</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span> <span class="k">=</span> <span class="o">{</span>
    <span class="k">val</span> <span class="n">pos</span> <span class="k">=</span> <span class="n">input</span><span class="o">.</span><span class="n">indexOf</span><span class="o">(</span><span class="s">&quot; &quot;</span><span class="o">)</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">pos</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="o">)</span> <span class="nc">None</span>
    <span class="k">else</span> <span class="nc">Some</span><span class="o">((</span><span class="n">input</span><span class="o">.</span><span class="n">substring</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="n">pos</span><span class="o">),</span> <span class="n">input</span><span class="o">.</span><span class="n">substring</span><span class="o">(</span><span class="n">pos</span> <span class="o">+</span> <span class="mi">1</span><span class="o">)))</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">In this example, there&#8217;s no <span class="monospaced">Name</span> class. The <span class="monospaced">Name</span> <em>object</em> is an
extractor for <span class="monospaced">String</span> objects.</td>
</tr></table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_extractors_with_one_or_no_arguments">Extractors with One or No Arguments</h3>
<div class="paragraph"><p>In Scala, there are no tuples with just one component. If the <span class="monospaced">unapply</span>
method extracts a single value, it should just return an <span class="monospaced">Option</span> of the
target type. For example,</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">object</span> <span class="nc">Number</span> <span class="o">{</span>
  <span class="k">def</span> <span class="n">unapply</span><span class="o">(</span><span class="n">input</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span><span class="k">:</span> <span class="kt">Option</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="k">=</span>
    <span class="k">try</span> <span class="o">{</span>
      <span class="nc">Some</span><span class="o">(</span><span class="nc">Integer</span><span class="o">.</span><span class="n">parseInt</span><span class="o">(</span><span class="n">input</span><span class="o">.</span><span class="n">trim</span><span class="o">))</span>
    <span class="o">}</span>
    <span class="k">catch</span> <span class="o">{</span>
      <span class="k">case</span> <span class="n">ex</span><span class="k">:</span> <span class="kt">NumberFormatException</span> <span class="o">=&gt;</span> <span class="nc">None</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>With this extractor, you can extract a number from a string:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">val</span> <span class="nc">Number</span><span class="o">(</span><span class="n">n</span><span class="o">)</span> <span class="k">=</span> <span class="s">&quot;1729&quot;</span>
</pre></div></div></div>
<div class="paragraph"><p>An extractor can just test its input without extracting any value. In that
case, the <span class="monospaced">unapply</span> method should return a <span class="monospaced">Boolean</span>:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">object</span> <span class="nc">IsCompound</span> <span class="o">{</span>
  <span class="k">def</span> <span class="n">unapply</span><span class="o">(</span><span class="n">input</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span> <span class="k">=</span> <span class="n">input</span><span class="o">.</span><span class="n">contains</span><span class="o">(</span><span class="s">&quot; &quot;</span><span class="o">)</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>You can use this extractor to add a test to a pattern:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="n">author</span> <span class="k">match</span> <span class="o">{</span>
  <span class="k">case</span> <span class="nc">Name</span><span class="o">(</span><span class="n">first</span><span class="o">,</span> <span class="n">last</span> <span class="k">@</span> <span class="nc">IsCompound</span><span class="o">())</span> <span class="k">=&gt;</span> <span class="o">...</span>
    <span class="c1">// Matches if the author is Peter van der Linden</span>
  <span class="k">case</span> <span class="nc">Name</span><span class="o">(</span><span class="n">first</span><span class="o">,</span> <span class="n">last</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="o">...</span>
<span class="o">}</span>
</pre></div></div></div>
</div>
<div class="sect2">
<h3 id="_the_span_class_monospaced_unapplyseq_span_method">The <span class="monospaced">unapplySeq</span> Method</h3>
<div class="paragraph"><p>To extract an arbitrary <em>sequence</em> of values, the method needs to be called
<span class="monospaced">unapplySeq</span>. It returns an <span class="monospaced">Option[Seq[A]]</span>, where <span class="monospaced">A</span> is the type of the
extracted values. For example, a <span class="monospaced">Name</span> extractor can produce a sequence of
the name’s components:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">object</span> <span class="nc">Name</span> <span class="o">{</span>
  <span class="k">def</span> <span class="n">unapplySeq</span><span class="o">(</span><span class="n">input</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span><span class="k">:</span> <span class="kt">Option</span><span class="o">[</span><span class="kt">Seq</span><span class="o">[</span><span class="kt">String</span><span class="o">]]</span> <span class="k">=</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">input</span><span class="o">.</span><span class="n">trim</span> <span class="o">==</span> <span class="s">&quot;&quot;</span><span class="o">)</span> <span class="nc">None</span> <span class="k">else</span> <span class="nc">Some</span><span class="o">(</span><span class="n">input</span><span class="o">.</span><span class="n">trim</span><span class="o">.</span><span class="n">split</span><span class="o">(</span><span class="s">&quot;\\s+&quot;</span><span class="o">))</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>Now you can match for any number of variables:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="n">author</span> <span class="k">match</span> <span class="o">{</span>
  <span class="k">case</span> <span class="nc">Name</span><span class="o">(</span><span class="n">first</span><span class="o">,</span> <span class="n">last</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="o">...</span>
  <span class="k">case</span> <span class="nc">Name</span><span class="o">(</span><span class="n">first</span><span class="o">,</span> <span class="n">middle</span><span class="o">,</span> <span class="n">last</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="o">...</span>
  <span class="k">case</span> <span class="nc">Name</span><span class="o">(</span><span class="n">first</span><span class="o">,</span> <span class="s">&quot;van&quot;</span><span class="o">,</span> <span class="s">&quot;der&quot;</span><span class="o">,</span> <span class="n">last</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="o">...</span>
  <span class="o">...</span>
<span class="o">}</span>
</pre></div></div></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="lesson-12-higher-order-functions">Higher-order Functions</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_lesson_objectives_12">Lesson Objectives</h3>
<div class="paragraph"><p>Scala mixes object oriented and functional features. In a functional
programming language, functions are first-class citizens that can be passed
around and manipulated just like any other data types. This is very useful
whenever you want to pass some detail action to an algorithm. In a
functional language, you just wrap that detail into a function that you
pass as a parameter. In this lesson, you will see how to be productive
with functions that use or return functions.</p></div>
</div>
<div class="sect2">
<h3 id="_summary_11">Summary</h3>
<div class="ulist"><ul>
<li>
<p>
Functions are "first-class citizens" in Scala, just like numbers.
</p>
</li>
<li>
<p>
You can create anonymous functions, usually to give them to other functions.
</p>
</li>
<li>
<p>
A function argument specifies behavior that should be executed later.
</p>
</li>
<li>
<p>
Many collection methods take function parameters, applying a function to
  the values of the collection.
</p>
</li>
<li>
<p>
There are syntax shortcuts that allow you to express function parameters
  in a way that is short and easy to read.
</p>
</li>
<li>
<p>
You can create functions that operate on blocks of code and look much
  like the built-in control statements.
</p>
</li>
</ul></div>
</div>
<div class="sect2">
<h3 id="_functions_as_values">Functions as Values</h3>
<div class="paragraph"><p>In Scala, a function is a "first-class citizen," just like a number. You
can store a function in a variable:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">import</span> <span class="nn">scala.math._</span>
<span class="k">val</span> <span class="n">num</span> <span class="k">=</span> <span class="mf">3.14</span>
<span class="k">val</span> <span class="n">fun</span> <span class="k">=</span> <span class="n">ceil</span> <span class="k">_</span>
</pre></div></div></div>
<div class="paragraph"><p>This code sets <span class="monospaced">num</span> to <span class="monospaced">3.14</span> and <span class="monospaced">fun</span> to the <span class="monospaced">ceil</span> function.</p></div>
<div class="paragraph"><p>The <span class="monospaced">_</span> behind the <span class="monospaced">ceil</span> function indicates that you really meant the
function, and you didn’t just forget to supply the arguments.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content"><em>Technically</em>, the <span class="monospaced">_</span> turns the <span class="monospaced">ceil</span> <em>method</em> into a function. In
Scala, you cannot manipulate methods, only functions.</td>
</tr></table>
</div>
<div class="paragraph"><p>When you try this code in the REPL, the type of <span class="monospaced">num</span> is <span class="monospaced">Double</span>. The type
of <span class="monospaced">fun</span> is reported as <span class="monospaced">(Double) =&gt; Double</span>, a function receiving and
returning a <span class="monospaced">Double</span>.</p></div>
<div class="paragraph"><p>What can you do with a function? Two things:</p></div>
<div class="ulist"><ul>
<li>
<p>
Call it.
</p>
</li>
<li>
<p>
Pass it around, by storing it in a variable or giving it to a function as
  a parameter.
</p>
</li>
</ul></div>
<div class="paragraph"><p>Here is how to call the function stored in fun:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="n">fun</span><span class="o">(</span><span class="n">num</span><span class="o">)</span> <span class="c1">// 4.0</span>
</pre></div></div></div>
<div class="paragraph"><p>As you can see, you use the normal function call syntax. The only
difference is that <span class="monospaced">fun</span> is a variable containing a function, not a fixed
function.</p></div>
<div class="paragraph"><p>Here is how you can give <span class="monospaced">fun</span> to another function:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="nc">Array</span><span class="o">(</span><span class="mf">3.14</span><span class="o">,</span> <span class="mf">1.42</span><span class="o">,</span> <span class="mf">2.0</span><span class="o">).</span><span class="n">map</span><span class="o">(</span><span class="n">fun</span><span class="o">)</span> <span class="c1">// Array(4.0, 2.0, 2.0)</span>
</pre></div></div></div>
<div class="paragraph"><p>The <span class="monospaced">Array.map</span> method accepts a function, applies it to all values in an
array, and returns a new array with the values returned by the function. (It
<em>maps</em> the values in the array to other values.)</p></div>
<div class="paragraph"><p>In this lesson, you will see many other methods that accept functions as
parameters.</p></div>
</div>
<div class="sect2">
<h3 id="_anonymous_functions">Anonymous Functions</h3>
<div class="paragraph"><p>In Scala, you don’t have to give a name to each function, just like you
don’t have to give a name to each number. Here is an anonymous function:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="o">(</span><span class="n">x</span><span class="k">:</span> <span class="kt">Double</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">x</span>
</pre></div></div></div>
<div class="paragraph"><p>This function multiplies its argument by 3.</p></div>
<div class="paragraph"><p>Of course, you can store this function in a variable:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">val</span> <span class="n">triple</span> <span class="k">=</span> <span class="o">(</span><span class="n">x</span><span class="k">:</span> <span class="kt">Double</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">x</span>
</pre></div></div></div>
<div class="paragraph"><p>That’s just as if you had used a <span class="monospaced">def</span>:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">def</span> <span class="n">triple</span><span class="o">(</span><span class="n">x</span><span class="k">:</span> <span class="kt">Double</span><span class="o">)</span> <span class="k">=</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">x</span>
</pre></div></div></div>
<div class="paragraph"><p>But you don’t have to name the function. You can just pass it to another
function:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="nc">Array</span><span class="o">(</span><span class="mf">3.14</span><span class="o">,</span> <span class="mf">1.42</span><span class="o">,</span> <span class="mf">2.0</span><span class="o">).</span><span class="n">map</span><span class="o">((</span><span class="n">x</span><span class="k">:</span> <span class="kt">Double</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">x</span><span class="o">)</span>
<span class="c1">// Array(9.42, 4.26, 6.0)</span>
</pre></div></div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph"><p>If you prefer, you can enclose the function argument in braces instead of
parentheses:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="nc">Array</span><span class="o">(</span><span class="mf">3.14</span><span class="o">,</span> <span class="mf">1.42</span><span class="o">,</span> <span class="mf">2.0</span><span class="o">).</span><span class="n">map</span> <span class="o">{</span> <span class="o">(</span><span class="n">x</span><span class="k">:</span> <span class="kt">Double</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">x</span> <span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>This is common when a method is used in infix notation (without the dot).</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="nc">Array</span><span class="o">(</span><span class="mf">3.14</span><span class="o">,</span> <span class="mf">1.42</span><span class="o">,</span> <span class="mf">2.0</span><span class="o">)</span> <span class="n">map</span> <span class="o">{</span> <span class="o">(</span><span class="n">x</span><span class="k">:</span> <span class="kt">Double</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">x</span> <span class="o">}</span>
</pre></div></div></div>
</td>
</tr></table>
</div>
</div>
<div class="sect2">
<h3 id="_functions_with_function_parameters">Functions with Function Parameters</h3>
<div class="paragraph"><p>In this section, you will see how to implement a function that takes
another function as a parameter. Here is an example:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">def</span> <span class="n">valueAtOneQuarter</span><span class="o">(</span><span class="n">f</span><span class="k">:</span> <span class="o">(</span><span class="kt">Double</span><span class="o">)</span> <span class="o">=&gt;</span> <span class="nc">Double</span><span class="o">)</span> <span class="k">=</span> <span class="n">f</span><span class="o">(</span><span class="mf">0.25</span><span class="o">)</span>
</pre></div></div></div>
<div class="paragraph"><p>Note that the parameter can be any function receiving and returning a
<span class="monospaced">Double</span>. The <span class="monospaced">valueAtOneQuarter</span> function computes the value of that function
at 0.25.</p></div>
<div class="paragraph"><p>For example,</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="n">valueAtOneQuarter</span><span class="o">(</span><span class="n">ceil</span> <span class="k">_</span><span class="o">)</span> <span class="c1">// 1.0</span>
<span class="n">valueAtOneQuarter</span><span class="o">(</span><span class="n">sqrt</span> <span class="k">_</span><span class="o">)</span> <span class="c1">// 0.5 (because 0.5 × 0.5 = 0.25)</span>
</pre></div></div></div>
<div class="paragraph"><p>What is the type of <span class="monospaced">valueAtOneQuarter</span>? It is a function with one parameter,
so its type is written as:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="o">(</span><span class="n">parameterType</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="n">resultType</span>
</pre></div></div></div>
<div class="paragraph"><p><span class="monospaced">resultType</span> is clearly <span class="monospaced">Double</span>, and <span class="monospaced">parameterType</span> is already given in
the function header as <span class="monospaced">(Double) =&gt; Double</span>. Therefore, the type of
<span class="monospaced">valueAtOneQuarter</span> is</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="o">((</span><span class="nc">Double</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="nc">Double</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="nc">Double</span>
</pre></div></div></div>
<div class="paragraph"><p>Since <span class="monospaced">valueAtOneQuarter</span> is a function that receives a function, it is
called a <em>higher-order function</em>.</p></div>
<div class="paragraph"><p>With higher-order functions, you are parameterizing a function with
<em>behavior</em>.</p></div>
<div class="paragraph"><p>A higher-order function can also <em>produce</em> a function:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">def</span> <span class="n">mulBy</span><span class="o">(</span><span class="n">factor</span> <span class="k">:</span> <span class="kt">Double</span><span class="o">)</span> <span class="k">=</span> <span class="o">(</span><span class="n">x</span> <span class="k">:</span> <span class="kt">Double</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="n">factor</span> <span class="o">*</span> <span class="n">x</span>
</pre></div></div></div>
<div class="paragraph"><p>For example, <span class="monospaced">mulBy(3)</span> returns the function <span class="monospaced">(x : Double) =&gt; 3 * x</span>, which
we&#8217;ve already seen in the preceding section. The power of <span class="monospaced">mulBy</span> is that
it can deliver functions that multiply by any amount:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">val</span> <span class="n">quintuple</span> <span class="k">=</span> <span class="n">mulBy</span><span class="o">(</span><span class="mi">5</span><span class="o">)</span>
<span class="n">quintuple</span><span class="o">(</span><span class="mi">20</span><span class="o">)</span> <span class="c1">// 100</span>
</pre></div></div></div>
<div class="paragraph"><p>The <span class="monospaced">mulBy</span> function has a parameter of type <span class="monospaced">Double</span>, and it returns a
function of type <span class="monospaced">(Double) =&gt; Double</span>. Therefore, its type is</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="o">(</span><span class="nc">Double</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="o">((</span><span class="nc">Double</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="nc">Double</span><span class="o">)</span>
</pre></div></div></div>
</div>
<div class="sect2">
<h3 id="_lab_higher_order_functions">Lab: Higher-Order Functions</h3>
<div class="paragraph"><p>Open <span class="monospaced">labs/src/main/scala/com/newcircle/higher/Values.scala</span>.
Fill in the <span class="monospaced">values</span> function.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">def</span> <span class="n">values</span><span class="o">(</span><span class="n">fun</span><span class="k">:</span> <span class="o">(</span><span class="kt">Int</span><span class="o">)</span> <span class="o">=&gt;</span> <span class="nc">Int</span><span class="o">,</span> <span class="n">low</span><span class="k">:</span> <span class="kt">Int</span><span class="o">,</span> <span class="n">high</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span>
</pre></div></div></div>
<div class="paragraph"><p>It takes a function, a lower bound, and an upper bound, and it produces an
array of tuples.</p></div>
<div class="paragraph"><p>An example will clarify how <span class="monospaced">values</span> should work:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="n">values</span><span class="o">(</span><span class="n">x</span> <span class="k">=&gt;</span> <span class="n">x</span> <span class="o">*</span> <span class="n">x</span><span class="o">,</span> <span class="o">-</span><span class="mi">2</span><span class="o">,</span> <span class="mi">2</span><span class="o">)</span> <span class="c1">// yields: (-2, 4), (-1, 1), (0, 0), (1, 1), (2, 4)</span>
<span class="n">values</span><span class="o">(</span><span class="n">x</span> <span class="k">=&gt;</span> <span class="n">x</span> <span class="o">-</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">4</span><span class="o">)</span>  <span class="c1">// yields: (0, -1), (1, 0), (2, 1), (3, 2), (4, 3)</span>
</pre></div></div></div>
<div class="paragraph"><p>To test your solution, run this tester in SBT:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>&gt; test-only com.newcircle.tests.higher.ValuesSpec</pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_parameter_inference">Parameter Inference</h3>
<div class="paragraph"><p>When you pass an anonymous function to another function or method, Scala
helps you out by deducing types when possible. For example, you don’t have
to write</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="n">valueAtOneQuarter</span><span class="o">((</span><span class="n">x</span><span class="k">:</span> <span class="kt">Double</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">x</span><span class="o">)</span> <span class="c1">// 0.75</span>
</pre></div></div></div>
<div class="paragraph"><p>Since the <span class="monospaced">valueAtOneQuarter</span> method knows that you will pass in a
<span class="monospaced">(Double) =&gt; Double</span> function, you can just write:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="n">valueAtOneQuarter</span><span class="o">((</span><span class="n">x</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">x</span><span class="o">)</span>
</pre></div></div></div>
<div class="paragraph"><p>As a special bonus, for a function that has just one parameter, you can
omit the () around the parameter:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="n">valueAtOneQuarter</span><span class="o">(</span><span class="n">x</span> <span class="k">=&gt;</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">x</span><span class="o">)</span>
</pre></div></div></div>
<div class="paragraph"><p>It gets better. If a parameter occurs only once on the right-hand side of
the <span class="monospaced">=&gt;</span>, you can replace it with an underscore:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="n">valueAtOneQuarter</span><span class="o">(</span><span class="mi">3</span> <span class="o">*</span> <span class="k">_</span><span class="o">)</span>
</pre></div></div></div>
<div class="paragraph"><p>This is the ultimate in comfort, and it is also pretty easy to read: a
function that multiplies something by 3.</p></div>
<div class="paragraph"><p>Keep in mind that these shortcuts only work when the parameter types are
known.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">val</span> <span class="n">fun</span> <span class="k">=</span> <span class="mi">3</span> <span class="o">*</span> <span class="k">_</span> <span class="c1">// Error: Can&#39;t infer types</span>
<span class="k">val</span> <span class="n">fun</span> <span class="k">=</span> <span class="mi">3</span> <span class="o">*</span> <span class="o">(</span><span class="k">_:</span> <span class="kt">Double</span><span class="o">)</span> <span class="c1">// OK</span>
<span class="k">val</span> <span class="n">fun</span><span class="k">:</span> <span class="o">(</span><span class="kt">Double</span><span class="o">)</span> <span class="o">=&gt;</span> <span class="nc">Double</span> <span class="k">=</span> <span class="mi">3</span> <span class="o">*</span> <span class="k">_</span> <span class="c1">// OK because we specified the type for fun</span>
</pre></div></div></div>
</div>
<div class="sect2">
<h3 id="_useful_higher_order_functions">Useful Higher-Order Functions</h3>
<div class="paragraph"><p>A good way of becoming comfortable with higher-order functions is to
practice with some common (and obviously useful) methods in the Scala
collections library that take function parameters.</p></div>
<div class="sect3">
<h4 id="_span_class_monospaced_map_span"><span class="monospaced">map</span></h4>
<div class="paragraph"><p>We&#8217;ve seen <span class="monospaced">map</span>, which applies a function to all elements of a collection
and returns the result. Here is a quick way of producing a collection
containing <span class="monospaced">0.1, 0.2, ..., 0.9</span>:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="o">(</span><span class="mi">1</span> <span class="n">to</span> <span class="mi">9</span><span class="o">).</span><span class="n">map</span><span class="o">(</span><span class="mf">0.1</span> <span class="o">*</span> <span class="k">_</span><span class="o">)</span>
</pre></div></div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">This is <em>very</em> common. If you need a sequence of values, see if you can
transform it from a simpler one.</td>
</tr></table>
</div>
</div>
<div class="sect3">
<h4 id="_span_class_monospaced_foreach_span"><span class="monospaced">foreach</span></h4>
<div class="paragraph"><p>Here&#8217;s an interesting combination of <span class="monospaced">map</span> with another common function,
<span class="monospaced">foreach</span>:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="o">(</span><span class="mi">1</span> <span class="n">to</span> <span class="mi">9</span><span class="o">).</span><span class="n">map</span><span class="o">(</span><span class="s">&quot;*&quot;</span> <span class="o">*</span> <span class="k">_</span><span class="o">).</span><span class="n">foreach</span><span class="o">(</span><span class="n">println</span> <span class="k">_</span><span class="o">)</span>
</pre></div></div></div>
<div class="paragraph"><p>Like <span class="monospaced">map</span>, <span class="monospaced">foreach</span> is a higher-order function. Unlike <span class="monospaced">map</span>, however,
<span class="monospaced">foreach</span> doesn&#8217;t return a value. It simply executes whatever function it
receives once for every element in the array (or collection).</p></div>
<div class="paragraph"><p>Take a moment, and try that in the REPL. What does it do?</p></div>
</div>
<div class="sect3">
<h4 id="_span_class_monospaced_filter_span"><span class="monospaced">filter</span></h4>
<div class="paragraph"><p>The <span class="monospaced">filter</span> method yields all elements that match a particular condition.
The condition is expressed as a function that receives an element and returns
<span class="monospaced">true</span> if the element is to be kept or <span class="monospaced">false</span> if it is to be discarded.
<span class="monospaced">filtered</span> returns the new (filtered) array or collection.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="c1">// Get only the even numbers</span>
<span class="o">(</span><span class="mi">1</span> <span class="n">to</span> <span class="mi">9</span><span class="o">).</span><span class="n">filter</span><span class="o">(</span><span class="k">_</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="c1">// 2, 4, 6, 8</span>
</pre></div></div></div>
</div>
<div class="sect3">
<h4 id="_span_class_monospaced_reduceleft_span"><span class="monospaced">reduceLeft</span></h4>
<div class="paragraph"><p><span class="monospaced">reduceLeft</span> takes a <em>binary</em> function (a function that takes two parameters)
and applies it to every element of a sequence, going from left to right.</p></div>
<div class="paragraph"><p>This:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="o">(</span><span class="mi">1</span> <span class="n">to</span> <span class="mi">5</span><span class="o">).</span><span class="n">reduceLeft</span><span class="o">(</span><span class="k">_</span> <span class="o">*</span> <span class="k">_</span><span class="o">)</span>
</pre></div></div></div>
<div class="paragraph"><p>is the same as:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="mi">1</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">*</span> <span class="mi">5</span>
</pre></div></div></div>
<div class="paragraph"><p>Actually, it&#8217;s <em>really</em> this:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="o">((((</span><span class="mi">1</span> <span class="o">*</span> <span class="mi">2</span><span class="o">)</span> <span class="o">*</span> <span class="mi">3</span><span class="o">)</span> <span class="o">*</span> <span class="mi">4</span><span class="o">)</span> <span class="o">*</span> <span class="mi">5</span><span class="o">)</span>
</pre></div></div></div>
<div class="paragraph"><p>Note the compact form of the multiplication function: <span class="monospaced">_ * _</span>. Each
underscore denotes a separate parameter.</p></div>
<div class="paragraph"><p>A binary function is also useful when sorting:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="n">println</span><span class="o">(</span><span class="s">&quot;Mary had a little lamb&quot;</span><span class="o">.</span><span class="n">split</span><span class="o">(</span><span class="s">&quot; &quot;</span><span class="o">).</span><span class="n">sortWith</span><span class="o">(</span><span class="k">_</span><span class="o">.</span><span class="n">length</span> <span class="o">&lt;</span> <span class="k">_</span><span class="o">.</span><span class="n">length</span><span class="o">))</span>
<span class="c1">// Array(a, had, Mary, lamb, little)</span>
</pre></div></div></div>
</div>
</div>
<div class="sect2">
<h3 id="_lab_span_class_monospaced_reduceleft_span">Lab: <span class="monospaced">reduceLeft</span></h3>
<div class="paragraph"><p>Open <span class="monospaced">labs/src/main/scala/com/newcircle/higher/ReduceLeft.scala</span>.
Fill in the <span class="monospaced">max</span> function, using <span class="monospaced">reduceLeft</span>.</p></div>
<div class="paragraph"><p>To test your solution, run this tester in SBT:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>&gt; test-only com.newcircle.tests.higher.ReduceLeftSpec</pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_closures">Closures</h3>
<div class="paragraph"><p>In Scala, you can define a function inside any scope:</p></div>
<div class="ulist"><ul>
<li>
<p>
in a package
</p>
</li>
<li>
<p>
in a class
</p>
</li>
<li>
<p>
even inside another function or method
</p>
</li>
</ul></div>
<div class="paragraph"><p>In the body of a function, you can access any variables from an enclosing
scope. That may not sound so remarkable, but note that your function may be
called when the variable is no longer in scope.</p></div>
<div class="paragraph"><p>Let&#8217;s look again at the <span class="monospaced">mulBy</span> function from above:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">def</span> <span class="n">mulBy</span><span class="o">(</span><span class="n">factor</span> <span class="k">:</span> <span class="kt">Double</span><span class="o">)</span> <span class="k">=</span> <span class="o">(</span><span class="n">x</span> <span class="k">:</span> <span class="kt">Double</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="n">factor</span> <span class="o">*</span> <span class="n">x</span>
</pre></div></div></div>
<div class="paragraph"><p>Consider these calls:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">val</span> <span class="n">triple</span> <span class="k">=</span> <span class="n">mulBy</span><span class="o">(</span><span class="mi">3</span><span class="o">)</span>
<span class="k">val</span> <span class="n">half</span> <span class="k">=</span> <span class="n">mulBy</span><span class="o">(</span><span class="mf">0.5</span><span class="o">)</span>
<span class="n">println</span><span class="o">(</span><span class="n">triple</span><span class="o">(</span><span class="mi">14</span><span class="o">)</span> <span class="o">+</span> <span class="s">&quot; &quot;</span> <span class="o">+</span> <span class="n">half</span><span class="o">(</span><span class="mi">14</span><span class="o">))</span> <span class="c1">// Prints 42 7</span>
</pre></div></div></div>
<div class="paragraph"><p>Let’s look at them in slow motion.</p></div>
<div class="ulist"><ul>
<li>
<p>
The first call to <span class="monospaced">mulBy</span> sets the parameter variable <span class="monospaced">factor</span> to 3. That
  variable is referenced in the body of the function
  <span class="monospaced">(x : Double) =&gt; factor  * x</span>, which is stored in <span class="monospaced">triple</span>.
  Then the parameter variable <span class="monospaced">factor</span> is popped off the runtime stack.
</p>
</li>
<li>
<p>
Next, <span class="monospaced">mulBy</span> is called again, now with <span class="monospaced">factor</span> set to 0.5. That
  variable is referenced in the body of the function
  <span class="monospaced">(x : Double) =&gt; factor  * x</span>, which is stored in <span class="monospaced">half</span>.
</p>
</li>
</ul></div>
<div class="paragraph"><p>Each of the returned functions has its own setting for <span class="monospaced">factor</span>.</p></div>
<div class="paragraph"><p>Such a function is called a <em>closure</em>. A closure consists of code together
with the definitions of any nonlocal variables that the code uses.</p></div>
<div class="paragraph"><p>It doesn’t really matter how a closure is implemented. It is the job of the
Scala compiler to ensure that your functions can access nonlocal variables.</p></div>
</div>
<div class="sect2">
<h3 id="_sam_conversions">SAM Conversions</h3>
<div class="paragraph"><p>In Scala, you pass a function as a parameter whenever you want to tell
another function what to do.</p></div>
<div class="paragraph"><p>Prior to version 1.8, Java did not have functions, and version 1.8 isn&#8217;t
widely adopted yet. So a Java programmer has to work harder to achieve the
same effect.</p></div>
<div class="paragraph"><p>In Java, one typically puts actions into a class implementing an interface,
then gives an instance of that class to another method.</p></div>
<div class="paragraph"><p>Many times, these interfaces have a <em>single abstract method</em>. They are
called SAM types in Java.</p></div>
<div class="paragraph"><p>For example, suppose we want to increment a counter when a button is clicked.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">var</span> <span class="n">counter</span> <span class="k">=</span> <span class="mi">0</span>

<span class="k">val</span> <span class="n">button</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">JButton</span><span class="o">(</span><span class="s">&quot;Increment&quot;</span><span class="o">)</span>
<span class="n">button</span><span class="o">.</span><span class="n">addActionListener</span><span class="o">(</span><span class="k">new</span> <span class="nc">ActionListener</span> <span class="o">{</span>
  <span class="k">override</span> <span class="k">def</span> <span class="n">actionPerformed</span><span class="o">(</span><span class="n">event</span><span class="k">:</span> <span class="kt">ActionEvent</span><span class="o">)</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="o">{</span>
    <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>
  <span class="o">}</span>
<span class="o">})</span>
</pre></div></div></div>
<div class="paragraph"><p>That’s a lot of boilerplate! It would be nice if we could just pass a
function to <span class="monospaced">addActionListener</span>, like this:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="n">button</span><span class="o">.</span><span class="n">addActionListener</span><span class="o">((</span><span class="n">event</span><span class="k">:</span> <span class="kt">ActionEvent</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span><span class="o">)</span>
</pre></div></div></div>
<div class="paragraph"><p>To enable this syntax, you need to provide an <em>implicit conversion</em>. We
will discuss these conversions in detail in later, but you can easily add
one without studying all the details.</p></div>
<div class="paragraph"><p>The following conversion turns a function into an <span class="monospaced">ActionListener</span> instance:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">implicit</span> <span class="k">def</span> <span class="n">makeAction</span><span class="o">(</span><span class="n">action</span><span class="k">:</span> <span class="o">(</span><span class="kt">ActionEvent</span><span class="o">)</span> <span class="o">=&gt;</span> <span class="nc">Unit</span><span class="o">)</span> <span class="k">=</span>
  <span class="k">new</span> <span class="nc">ActionListener</span> <span class="o">{</span>
    <span class="k">override</span> <span class="k">def</span> <span class="n">actionPerformed</span><span class="o">(</span><span class="n">event</span><span class="k">:</span> <span class="kt">ActionEvent</span><span class="o">)</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="o">{</span> <span class="n">action</span><span class="o">(</span><span class="n">event</span><span class="o">)</span> <span class="o">}</span>
  <span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>Simply place this function with your user interface code, and you can pass
any <span class="monospaced">(ActionEvent) =&gt; Unit</span> function where an <span class="monospaced">ActionListener</span> object is
expected.</p></div>
</div>
<div class="sect2">
<h3 id="_currying">Currying</h3>
<div class="paragraph"><p><em>Currying</em> is the process of turning a function that takes two arguments
into a function that takes one argument. That function returns a function
that consumes the second argument.</p></div>
<div class="paragraph"><p>Okay, what the heck does that mean?</p></div>
<div class="paragraph"><p>An example will help clarify things. This function takes two arguments:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">def</span> <span class="n">mul</span><span class="o">(</span><span class="n">x</span><span class="k">:</span> <span class="kt">Int</span><span class="o">,</span> <span class="n">y</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span> <span class="k">=</span> <span class="n">x</span> <span class="o">*</span> <span class="n">y</span>
</pre></div></div></div>
<div class="paragraph"><p>This function takes one argument, yielding a function that takes one argument:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">def</span> <span class="n">mulOneAtATime</span><span class="o">(</span><span class="n">x</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span> <span class="k">=</span> <span class="o">(</span><span class="n">y</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="n">x</span> <span class="o">*</span> <span class="n">y</span>
</pre></div></div></div>
<div class="paragraph"><p>To multiply two numbers, you call</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="n">mulOneAtATime</span><span class="o">(</span><span class="mi">6</span><span class="o">)(</span><span class="mi">7</span><span class="o">)</span>
</pre></div></div></div>
<div class="paragraph"><p>Strictly speaking, the result of <span class="monospaced">mulOneAtATime(6)</span> is the function</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="o">(</span><span class="n">y</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="mi">6</span> <span class="o">*</span> <span class="n">y</span>
</pre></div></div></div>
<div class="paragraph"><p><em>That</em> function is applied to 7, yielding 42.</p></div>
<div class="paragraph"><p>There is a shortcut for defining such curried functions in Scala:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">def</span> <span class="n">mulOneAtATime</span><span class="o">(</span><span class="n">x</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)(</span><span class="n">y</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span> <span class="k">=</span> <span class="n">x</span> <span class="o">*</span> <span class="n">y</span>
</pre></div></div></div>
<div class="paragraph"><p>Note that there are multiple parameter lists, each with one parameter,
instead of multiple parameters in a single parameter list.</p></div>
<div class="paragraph"><p>Sometimes, you want to use currying for a function parameter so that the
type inferencer has more information.</p></div>
<div class="paragraph"><p>Here is a typical example. The <span class="monospaced">corresponds</span> method can compare whether two
sequences are the same under some comparison criterion. For example,</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">val</span> <span class="n">a</span> <span class="k">=</span> <span class="nc">Array</span><span class="o">(</span><span class="s">&quot;Hello&quot;</span><span class="o">,</span> <span class="s">&quot;World&quot;</span><span class="o">)</span>
<span class="k">val</span> <span class="n">b</span> <span class="k">=</span> <span class="nc">Array</span><span class="o">(</span><span class="s">&quot;hello&quot;</span><span class="o">,</span> <span class="s">&quot;world&quot;</span><span class="o">)</span>
<span class="n">a</span><span class="o">.</span><span class="n">corresponds</span><span class="o">(</span><span class="n">b</span><span class="o">)(</span><span class="k">_</span><span class="o">.</span><span class="n">equalsIgnoreCase</span><span class="o">(</span><span class="k">_</span><span class="o">))</span>
</pre></div></div></div>
<div class="paragraph"><p>Note that the function <span class="monospaced">_.equalsIgnoreCase(_)</span> is passed as a curried
parameter, in a separate set of <span class="monospaced">(...)</span>. When you look into the Scaladoc,
you will see that <span class="monospaced">corresponds</span> is declared as</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">def</span> <span class="n">corresponds</span><span class="o">[</span><span class="kt">B</span><span class="o">](</span><span class="n">that</span><span class="k">:</span> <span class="kt">Seq</span><span class="o">[</span><span class="kt">B</span><span class="o">])(</span><span class="n">p</span><span class="k">:</span> <span class="o">(</span><span class="kt">A</span><span class="o">,</span> <span class="kt">B</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="nc">Boolean</span><span class="o">)</span><span class="k">:</span> <span class="kt">Boolean</span>
</pre></div></div></div>
<div class="paragraph"><p>The <span class="monospaced">that</span> sequence and the predicate function <span class="monospaced">p</span> are separate curried
parameters. The type inferencer can figure out what <span class="monospaced">B</span> is from the type of
<span class="monospaced">that</span>, and then it can use that information when analyzing the function that
is passed for <span class="monospaced">p</span>.</p></div>
<div class="paragraph"><p>In our example, <span class="monospaced">that</span> is a <span class="monospaced">String</span> sequence. Therefore, the predicate is
expected to have type <span class="monospaced">(String, String) =&gt; Boolean</span>. With that information,
the compiler can accept <span class="monospaced">_.equalsIgnoreCase(_)</span> as a shortcut for
<span class="monospaced">(a: String, b: String) =&gt; a.equalsIgnoreCase(b)</span>.</p></div>
</div>
<div class="sect2">
<h3 id="_control_abstractions">Control Abstractions</h3>
<div class="paragraph"><p>Scala, you can model a sequence of statements as a function with no
parameters or return value. For example, here is a function that runs some
code in a thread:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">def</span> <span class="n">runInThread</span><span class="o">(</span><span class="n">block</span><span class="k">:</span> <span class="o">()</span> <span class="o">=&gt;</span> <span class="nc">Unit</span><span class="o">)</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="o">{</span>
  <span class="k">new</span> <span class="nc">Thread</span> <span class="o">{</span>
    <span class="k">override</span> <span class="k">def</span> <span class="n">run</span><span class="o">()</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="o">{</span> <span class="n">block</span><span class="o">()</span> <span class="o">}</span>
  <span class="o">}.</span><span class="n">start</span><span class="o">()</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>The code is given as a function of type <span class="monospaced">() =&gt; Unit</span>. Here&#8217;s a call
to the function:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="n">runInThread</span> <span class="o">{</span> <span class="o">()</span> <span class="k">=&gt;</span>
  <span class="n">println</span><span class="o">(</span><span class="s">&quot;Hi&quot;</span><span class="o">)</span>
  <span class="nc">Thread</span><span class="o">.</span><span class="n">sleep</span><span class="o">(</span><span class="mi">10000</span><span class="o">)</span>
  <span class="n">println</span><span class="o">(</span><span class="s">&quot;Bye&quot;</span><span class="o">)</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>There are two things to note:</p></div>
<div class="ulist"><ul>
<li>
<p>
The (last) parameter can be passed with "{}", instead of "()", which looks
  very natural.
</p>
</li>
<li>
<p>
You need to supply an unsightly <span class="monospaced">() =&gt;</span>
</p>
</li>
</ul></div>
<div class="paragraph"><p>To avoid the <span class="monospaced">() =&gt;</span> in the call, use the <em>call by name</em> notation: Omit the
<span class="monospaced">()</span>, but not the <span class="monospaced">=&gt;</span>, in the parameter declaration and in the call to the
parameter function:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">def</span> <span class="n">runInThread</span><span class="o">(</span><span class="n">block</span><span class="k">:</span> <span class="o">=&gt;</span> <span class="nc">Unit</span><span class="o">)</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="o">{</span>
  <span class="k">new</span> <span class="nc">Thread</span> <span class="o">{</span>
    <span class="k">override</span> <span class="k">def</span> <span class="n">run</span><span class="o">()</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="o">{</span> <span class="n">block</span> <span class="o">}</span>
  <span class="o">}.</span><span class="n">start</span><span class="o">()</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>Then the call simply becomes</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="n">runInThread</span> <span class="o">{</span>
  <span class="n">println</span><span class="o">(</span><span class="s">&quot;Hi&quot;</span><span class="o">)</span>
  <span class="nc">Thread</span><span class="o">.</span><span class="n">sleep</span><span class="o">(</span><span class="mi">10000</span><span class="o">)</span>
  <span class="n">println</span><span class="o">(</span><span class="s">&quot;Bye&quot;</span><span class="o">)</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>This looks pretty nice, and it allows Scala programmers to build <em>control
abstractions</em>: functions that look like they are language keywords. For
example, we can implement a function that provides an <span class="monospaced">until</span> statement:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">def</span> <span class="n">until</span><span class="o">(</span><span class="n">condition</span><span class="k">:</span> <span class="o">=&gt;</span> <span class="nc">Boolean</span><span class="o">)(</span><span class="n">block</span><span class="k">:</span> <span class="o">=&gt;</span> <span class="nc">Unit</span><span class="o">)</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="o">{</span>
  <span class="k">if</span> <span class="o">(!</span><span class="n">condition</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">block</span>
    <span class="n">until</span><span class="o">(</span><span class="n">condition</span><span class="o">)(</span><span class="n">block</span><span class="o">)</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>Here is how you use <span class="monospaced">until</span>:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">var</span> <span class="n">x</span> <span class="k">=</span> <span class="mi">10</span>
<span class="n">until</span> <span class="o">(</span><span class="n">x</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">x</span> <span class="o">-=</span> <span class="mi">1</span>
  <span class="n">println</span><span class="o">(</span><span class="n">x</span><span class="o">)</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>The technical term for such a function parameter is a <em>call-by-name parameter</em>.</p></div>
<div class="paragraph"><p>Unlike a regular (or call-by-value) parameter, the parameter expression is
not evaluated when the function is called. After all, we don’t want <span class="monospaced">x ==
0</span> to evaluate to false in the call to <span class="monospaced">until</span>. Instead, the expression
becomes the body of a function with no arguments. That function is passed
as a parameter.</p></div>
<div class="paragraph"><p>Look carefully at the <span class="monospaced">until</span> function definition.</p></div>
<div class="paragraph"><p>It is <strong>curried</strong>: It first consumes the condition, then the block as a
second parameter. Without currying, the call would look like this:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="n">until</span><span class="o">(</span><span class="n">x</span> <span class="o">==</span> <span class="mi">0</span><span class="o">,</span> <span class="o">{</span> <span class="o">...</span> <span class="o">})</span>
</pre></div></div></div>
<div class="paragraph"><p>which wouldn’t be as pretty.</p></div>
</div>
<div class="sect2">
<h3 id="_the_return_expression">The return Expression</h3>
<div class="paragraph"><p>In Scala, you don’t use a <span class="monospaced">return</span> statement to return function values. The
return value of a function is simply the value of the function body.</p></div>
<div class="paragraph"><p>However, you <em>can</em> use <span class="monospaced">return</span> to return a value from an anonymous
function to an enclosing named function. This is useful in control
abstractions. For example, consider this function:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">def</span> <span class="n">indexOf</span><span class="o">(</span><span class="n">str</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">ch</span><span class="k">:</span> <span class="kt">Char</span><span class="o">)</span><span class="k">:</span> <span class="kt">Int</span> <span class="o">=</span> <span class="o">{</span>
  <span class="k">var</span> <span class="n">i</span> <span class="k">=</span> <span class="mi">0</span>
  <span class="n">until</span> <span class="o">(</span><span class="n">i</span> <span class="o">==</span> <span class="n">str</span><span class="o">.</span><span class="n">length</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">str</span><span class="o">(</span><span class="n">i</span><span class="o">)</span> <span class="o">==</span> <span class="n">ch</span><span class="o">)</span> <span class="k">return</span> <span class="n">i</span>
    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
  <span class="o">}</span>
  <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>Here, the anonymous function</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="o">{</span> <span class="k">if</span> <span class="o">(</span><span class="n">str</span><span class="o">(</span><span class="n">i</span><span class="o">)</span> <span class="o">==</span> <span class="n">ch</span><span class="o">)</span> <span class="k">return</span> <span class="n">i</span><span class="o">;</span>  <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span> <span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>is passed to <span class="monospaced">until</span>. When the <span class="monospaced">return</span> expression is executed, the
enclosing named function <span class="monospaced">indexOf</span> terminates and returns the given value.</p></div>
<div class="paragraph"><p>If you use <span class="monospaced">return</span> inside a named function, you <em>must</em> to specify the
function&#8217;s return type. For example, in the <span class="monospaced">indexOf</span> function above, the
compiler was not able to infer that it returns an <span class="monospaced">Int</span>.</p></div>
<div class="paragraph"><p>The control flow is achieved with a special exception that is thrown by the
<span class="monospaced">return</span> expression in the anonymous function, passed out of the <span class="monospaced">until</span>
function, and caught in the <span class="monospaced">indexOf</span> function.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Caution</div>
</td>
<td class="content">If the exception is caught in a <span class="monospaced">try</span> block before being delivered to
the named function, then the value will <em>not</em> be returned.</td>
</tr></table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="lesson-13-collections">Collections</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_lesson_objectives_13">Lesson Objectives</h3>
<div class="paragraph"><p>In this lesson, you will learn about the Scala collections library from a
library user’s point of view. In addition to arrays and maps, which you
have already encountered, you will see other useful collection types. There
are many methods that can be applied to collections, and this lesson
presents them in an orderly way.</p></div>
</div>
<div class="sect2">
<h3 id="_summary_12">Summary</h3>
<div class="ulist"><ul>
<li>
<p>
All collections extend the <span class="monospaced">Iterable</span> trait.
</p>
</li>
<li>
<p>
The three major categories of collections are sequences, sets, and maps.
</p>
</li>
<li>
<p>
Scala has mutable and immutable versions of most collections.
</p>
</li>
<li>
<p>
A Scala list is either empty, or it has a head and a tail which is again
  a list.
</p>
</li>
<li>
<p>
Sets are unordered collections.
</p>
</li>
<li>
<p>
Use a <span class="monospaced">LinkedHashSet</span> to retain the insertion order or a SortedSet to
  iterate in sorted order.
</p>
</li>
<li>
<p>
<span class="monospaced">+</span> adds an element to an unordered collection; <span class="monospaced">+:</span> and <span class="monospaced">:+</span> prepend or
  append to a sequence; <span class="monospaced">++</span> concatenates two collections; <span class="monospaced">-</span> and <span class="monospaced">--</span>
  remove elements.
</p>
</li>
<li>
<p>
The <span class="monospaced">Iterable</span> and <span class="monospaced">Seq</span> traits have dozens of useful methods for common
  operations. Check them out before writing tedious loops.
</p>
</li>
<li>
<p>
Mapping, folding, and zipping are useful techniques for applying a
  function or operation to the elements of a collection.
</p>
</li>
</ul></div>
</div>
<div class="sect2">
<h3 id="_the_main_collections_traits">The Main Collections Traits</h3>
<div class="imageblock">
<div class="content">
<img src="images/13-collections1.png" alt="13-collections1.png">
</div>
<div class="title">Figure 2. Key traits in the Scala collections hierarcy</div>
</div>
<div class="paragraph"><p>We&#8217;ve already seen the <span class="monospaced">Iterable</span> and <span class="monospaced">Iterator</span> classes, briefly.</p></div>
<div class="paragraph"><p>Formally, an <span class="monospaced">Iterable</span> is any collection that can yield an <span class="monospaced">Iterator</span> with
which you can access all elements in the collection:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">val</span> <span class="n">coll</span> <span class="k">=</span> <span class="o">...</span> <span class="c1">// some Iterable</span>
<span class="k">val</span> <span class="n">iter</span> <span class="k">=</span> <span class="n">coll</span><span class="o">.</span><span class="n">iterator</span>
<span class="k">while</span> <span class="o">(</span><span class="n">iter</span><span class="o">.</span><span class="n">hasNext</span><span class="o">)</span>
   <span class="k">do</span> <span class="n">something</span> <span class="k">with</span> <span class="n">iter</span><span class="o">.</span><span class="n">next</span><span class="o">()</span>
</pre></div></div></div>
<div class="paragraph"><p>This is the most basic way of traversing a collection. However, as you will
see throughout this lesson, usually there are more convenient ways.</p></div>
<div class="ulist"><ul>
<li>
<p>
A <span class="monospaced">Seq</span> is an ordered sequence of values, such as an array or list. An
  <span class="monospaced">IndexedSeq</span> allows fast random access through an integer index. For
  example, an <span class="monospaced">ArrayBuffer</span> is indexed but a linked list is not.
</p>
</li>
<li>
<p>
A <span class="monospaced">Set</span> is an unordered collection of values. In a <span class="monospaced">SortedSet</span>, elements
  are always visited in sorted order.
</p>
</li>
<li>
<p>
A <span class="monospaced">Map</span> is a set of (<em>key, value</em>) pairs. A <span class="monospaced">SortedMap</span> visits the
  entries as sorted by the keys.
</p>
</li>
</ul></div>
<div class="paragraph"><p>This hierarchy is similar to that in Java, with a couple of welcome
improvements:</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Maps are a part of the hierarchy and not a separate hierarchy.
</p>
</li>
<li>
<p>
<span class="monospaced">IndexedSeq</span> is the supertype of arrays but not of lists, allowing you to
   tell the two apart.
</p>
</li>
</ol></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">Being able to tell the difference between <span class="monospaced">Seq</span> and <span class="monospaced">IndexedSeq</span> is
important. In Java, both <span class="monospaced">ArrayList</span> and <span class="monospaced">LinkedList</span> implement a common
<span class="monospaced">List</span> interface, making it difficult to write efficient code when random
access is preferred, for example when searching in a sorted sequence. This
was a flawed design decision in the original Java collections framework. In
a later version, a marker interface <span class="monospaced">RandomAccess</span> was added to deal with
this problem.</td>
</tr></table>
</div>
<div class="paragraph"><p>Each Scala collection trait or class has a companion object with an <span class="monospaced">apply</span>
method, allowing construction of the corresponding collection without using
<span class="monospaced">new</span>:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="nc">Iterable</span><span class="o">(</span><span class="mh">0xFF</span><span class="o">,</span> <span class="mh">0xFF00</span><span class="o">,</span> <span class="mh">0xFF0000</span><span class="o">)</span>
<span class="nc">Set</span><span class="o">(</span><span class="nc">Color</span><span class="o">.</span><span class="nc">RED</span><span class="o">,</span> <span class="nc">Color</span><span class="o">.</span><span class="nc">GREEN</span><span class="o">,</span> <span class="nc">Color</span><span class="o">.</span><span class="nc">BLUE</span><span class="o">)</span>
<span class="nc">Map</span><span class="o">(</span><span class="nc">Color</span><span class="o">.</span><span class="nc">RED</span> <span class="o">-&gt;</span> <span class="mh">0xFF0000</span><span class="o">,</span> <span class="nc">Color</span><span class="o">.</span><span class="nc">GREEN</span> <span class="o">-&gt;</span> <span class="mh">0xFF00</span><span class="o">,</span> <span class="nc">Color</span><span class="o">.</span><span class="nc">BLUE</span> <span class="o">-&gt;</span> <span class="mh">0xFF</span><span class="o">)</span>
<span class="nc">SortedSet</span><span class="o">(</span><span class="s">&quot;Hello&quot;</span><span class="o">,</span> <span class="s">&quot;World&quot;</span><span class="o">)</span>
</pre></div></div></div>
<div class="paragraph"><p>This is called the <em>uniform creation principle</em>.</p></div>
</div>
<div class="sect2">
<h3 id="_mutable_and_immutable_collections">Mutable and Immutable Collections</h3>
<div class="paragraph"><p>Scala supports both mutable and immutable collections.</p></div>
<div class="ulist"><ul>
<li>
<p>
An immutable collection can never change, so you can safely share a
  reference to it, even in a multithreaded program.
</p>
</li>
<li>
<p>
A mutable collection <em>can</em> change, so sharing it among threads might
  require locking for safety.
</p>
</li>
</ul></div>
<div class="paragraph"><p>For example, there is a <span class="monospaced">scala.collection.mutable.Map</span> and a
<span class="monospaced">scala.collection.immutable.Map</span>. Both have a common supertype
<span class="monospaced">scala.collection.Map</span> (which, of course, contains no mutation operations).</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">When you have a reference to a <span class="monospaced">scala.collection.immutable.Map</span>, you
know that <em>nobody</em> can change the map. If you have a <span class="monospaced">scala.collection.Map</span>,
then <em>you</em> can’t change it, but someone else might.</td>
</tr></table>
</div>
<div class="paragraph"><p>Scala gives a preference to immutable collections. The companion objects in
the <span class="monospaced">scala.collection package</span> produce immutable collections. For example:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="n">scala</span><span class="o">.</span><span class="n">collection</span><span class="o">.</span><span class="nc">Map</span><span class="o">(</span><span class="s">&quot;Hello&quot;</span> <span class="o">-&gt;</span> <span class="mi">42</span><span class="o">)</span> <span class="c1">// this produces an immutable map.</span>
</pre></div></div></div>
<div class="paragraph"><p>Also, the <span class="monospaced">scala</span> package and the <span class="monospaced">Predef</span> object, which are always
imported, have type aliases <span class="monospaced">List</span>, <span class="monospaced">Set</span>, and <span class="monospaced">Map</span> that refer to the
immutable traits. For example, <span class="monospaced">Predef.Map</span> is the same as
<span class="monospaced">scala.collection.immutable.Map</span>.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph"><p>With the statement</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">import</span> <span class="nn">scala.collection.mutable</span>
</pre></div></div></div>
<div class="paragraph"><p>you can get an immutable map as <span class="monospaced">Map</span> and a mutable one as <span class="monospaced">mutable.Map</span>.</p></div>
<div class="paragraph"><p>You can also use this approach:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">import</span> <span class="nn">scala.collection.mutable.</span><span class="o">{</span><span class="nc">Map</span> <span class="k">=&gt;</span> <span class="nc">MutableMap</span><span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>That approach allows you to use <span class="monospaced">Map</span> for an immutable map and <span class="monospaced">MutableMap</span>
for a mutable one.</p></div>
</td>
</tr></table>
</div>
<div class="paragraph"><p>If you had no prior experience with immutable collections, you may wonder
how you can do useful work with them. The key is that you can create new
collections out of old ones. For example, if <span class="monospaced">numbers</span> is an immutable set,
then</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="n">numbers</span> <span class="o">+</span> <span class="mi">9</span>
</pre></div></div></div>
<div class="paragraph"><p>is a <em>new</em> set containing contents of <span class="monospaced">numbers</span> together with 9. If 9 was
already in the set, you just get a reference to the old set. This is
particularly natural in recursive computations. For example, here we
compute the set of all digits of an integer:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">def</span> <span class="n">digits</span><span class="o">(</span><span class="n">n</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span><span class="k">:</span> <span class="kt">Set</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="k">=</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">n</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="o">)</span> <span class="n">digits</span><span class="o">(-</span><span class="n">n</span><span class="o">)</span>
  <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">n</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="o">)</span> <span class="nc">Set</span><span class="o">(</span><span class="n">n</span><span class="o">)</span>
  <span class="k">else</span> <span class="n">digits</span><span class="o">(</span><span class="n">n</span> <span class="o">/</span> <span class="mi">10</span><span class="o">)</span> <span class="o">+</span> <span class="o">(</span><span class="n">n</span> <span class="o">%</span> <span class="mi">10</span><span class="o">)</span>
</pre></div></div></div>
<div class="paragraph"><p>This method starts out with a set containing a single digit. At each step,
another digit is added. However, adding the digit doesn’t mutate a set.
Instead, in each step, a new set is constructed.</p></div>
</div>
<div class="sect2">
<h3 id="_sequences">Sequences</h3>
<div class="imageblock">
<div class="content">
<img src="images/13-immutable-sequences.png" alt="13-immutable-sequences.png">
</div>
<div class="title">Figure 3. The most important immutable sequences</div>
</div>
<div class="paragraph"><p>A <span class="monospaced">Vector</span> is the immutable equivalent of an <span class="monospaced">ArrayBuffer</span>: an indexed
sequence with fast random access.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">Vectors are implemented as trees where each node has up to 32
children. For a vector with one million elements, one needs four layers of
nodes. (Since 103 ≈ 210, 106 ≈ 324.) Accessing an element in such a list
will take 4 hops, whereas in a linked list it would take an average of
500,000.</td>
</tr></table>
</div>
<div class="paragraph"><p>We saw the <span class="monospaced">Range</span> class earlier. A <span class="monospaced">Range</span> represents an integer sequence,
such as <span class="monospaced">0,1,2,3,4,5,6,7,8,9</span> or <span class="monospaced">10,20,30</span>. For efficiency, a <span class="monospaced">Range</span>
object doesn’t store all sequence values; it just stores the start, end,
and increment. You construct <span class="monospaced">Range</span> objects with the <span class="monospaced">to</span> and <span class="monospaced">until</span>
methods.</p></div>
<div class="paragraph"><p>We will discuss lists in the next section and streams in a few minutes.</p></div>
<div class="imageblock">
<div class="content">
<img src="images/13-mutable-sequences.png" alt="13-mutable-sequences.png">
</div>
<div class="title">Figure 4. Mutable sequences</div>
</div>
<div class="paragraph"><p>We discussed array buffers earlier. Stacks, queues, and priority queues are
standard data structures that are useful for implementing certain
algorithms. If you are familiar with these structures, the Scala
implementations won’t surprise you.</p></div>
<div class="paragraph"><p>The linked list classes, on the other hand, are a bit different from the
linked lists that you may have encountered in Java, C++, or a data
structures course. We will discuss them in the next section.</p></div>
</div>
<div class="sect2">
<h3 id="_lists">Lists</h3>
<div class="paragraph"><p>In Scala, a list is either <span class="monospaced">Nil</span> (that is, empty) or an object with a head
element and a tail that is again a list. For example, consider the list</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">val</span> <span class="n">digits</span> <span class="k">=</span> <span class="nc">List</span><span class="o">(</span><span class="mi">4</span><span class="o">,</span> <span class="mi">2</span><span class="o">)</span>
</pre></div></div></div>
<div class="paragraph"><p>The value of <span class="monospaced">digits.head</span> is 4, and <span class="monospaced">digits.tail</span> is List(2). Moreover,
<span class="monospaced">digits.tail.head</span> is 2 and <span class="monospaced">digits.tail.tail</span> is <span class="monospaced">Nil</span>.</p></div>
<div class="paragraph"><p>The <span class="monospaced">::</span> operator makes a new list from a given head and tail. For example,</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="mi">9</span> <span class="o">::</span> <span class="nc">List</span><span class="o">(</span><span class="mi">4</span><span class="o">,</span> <span class="mi">2</span><span class="o">)</span>
</pre></div></div></div>
<div class="paragraph"><p>is <span class="monospaced">List(9, 4, 2)</span>. You can also write that list as</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="mi">9</span> <span class="o">::</span> <span class="mi">4</span> <span class="o">::</span> <span class="mi">2</span> <span class="o">::</span> <span class="nc">Nil</span>
</pre></div></div></div>
<div class="paragraph"><p>Note that <span class="monospaced">::</span> is right-associative. With the <span class="monospaced">::</span> operator, lists are
constructed from the end.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="mi">9</span> <span class="o">::</span> <span class="o">(</span><span class="mi">4</span> <span class="o">::</span> <span class="o">(</span><span class="mi">2</span> <span class="o">::</span> <span class="nc">Nil</span><span class="o">))</span>
</pre></div></div></div>
<div class="paragraph"><p>In Java or C++, one uses an iterator to traverse a linked list. You can do
this in Scala as well, but it is often more natural to use recursion. For
example, the following function computes the sum of all elements in a
linked list of integers:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">def</span> <span class="n">sum</span><span class="o">(</span><span class="n">lst</span><span class="k">:</span> <span class="kt">List</span><span class="o">[</span><span class="kt">Int</span><span class="o">])</span><span class="k">:</span> <span class="kt">Int</span> <span class="o">=</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">lst</span> <span class="o">==</span> <span class="nc">Nil</span><span class="o">)</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">lst</span><span class="o">.</span><span class="n">head</span> <span class="o">+</span> <span class="n">sum</span><span class="o">(</span><span class="n">lst</span><span class="o">.</span><span class="n">tail</span><span class="o">)</span>
</pre></div></div></div>
<div class="paragraph"><p>Or, if you prefer, you can use pattern matching:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">def</span> <span class="n">sum</span><span class="o">(</span><span class="n">lst</span><span class="k">:</span> <span class="kt">List</span><span class="o">[</span><span class="kt">Int</span><span class="o">])</span><span class="k">:</span> <span class="kt">Int</span> <span class="o">=</span> <span class="n">lst</span> <span class="k">match</span> <span class="o">{</span>
  <span class="k">case</span> <span class="nc">Nil</span> <span class="k">=&gt;</span> <span class="mi">0</span>
  <span class="k">case</span> <span class="n">h</span> <span class="o">::</span> <span class="n">t</span> <span class="k">=&gt;</span> <span class="n">h</span> <span class="o">+</span> <span class="n">sum</span><span class="o">(</span><span class="n">t</span><span class="o">)</span> <span class="c1">// h is lst.head, t is lst.tail</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>Note the <span class="monospaced">::</span> operator in the second pattern. It “destructures” the list
into head and tail.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">Recursion works so naturally because the tail of a list is again a list.</td>
</tr></table>
</div>
<div class="paragraph"><p>However, before you get too excited about using recursion for summing,
note that the Scala library has a <span class="monospaced">sum</span> method:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="nc">List</span><span class="o">(</span><span class="mi">9</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="mi">2</span><span class="o">).</span><span class="n">sum</span> <span class="c1">// Yields 15</span>
</pre></div></div></div>
</div>
<div class="sect2">
<h3 id="_mutable_lists">Mutable Lists</h3>
<div class="paragraph"><p>The mutable <span class="monospaced">LinkedList</span> works like the immutable <span class="monospaced">List</span>, except that you
can modify the head by assigning to the <span class="monospaced">elem</span> reference, and the tail by
assigning to the <span class="monospaced">next</span> reference.</p></div>
<div class="paragraph"><p>For example, this loop changes all negative values to zero:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">val</span> <span class="n">lst</span> <span class="k">=</span> <span class="n">scala</span><span class="o">.</span><span class="n">collection</span><span class="o">.</span><span class="n">mutable</span><span class="o">.</span><span class="nc">LinkedList</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="o">-</span><span class="mi">2</span><span class="o">,</span> <span class="mi">7</span><span class="o">,</span> <span class="o">-</span><span class="mi">9</span><span class="o">)</span>
<span class="k">var</span> <span class="n">cur</span> <span class="k">=</span> <span class="n">lst</span>
<span class="k">while</span> <span class="o">(</span><span class="n">cur</span> <span class="o">!=</span> <span class="nc">Nil</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">cur</span><span class="o">.</span><span class="n">elem</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="o">)</span> <span class="n">cur</span><span class="o">.</span><span class="n">elem</span> <span class="k">=</span> <span class="mi">0</span>
  <span class="n">cur</span> <span class="k">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">next</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>This loop removes every second element from the list:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">var</span> <span class="n">cur</span> <span class="k">=</span> <span class="n">lst</span>
<span class="k">while</span> <span class="o">(</span><span class="n">cur</span> <span class="o">!=</span> <span class="nc">Nil</span> <span class="o">&amp;&amp;</span> <span class="n">cur</span><span class="o">.</span><span class="n">next</span> <span class="o">!=</span> <span class="nc">Nil</span><span class="o">)</span> <span class="o">{</span>
  <span class="n">cur</span><span class="o">.</span><span class="n">next</span> <span class="k">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">next</span><span class="o">.</span><span class="n">next</span>
  <span class="n">cur</span> <span class="k">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">next</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>Here, the variable <span class="monospaced">cur</span> works as an iterator, but it actually has type
<span class="monospaced">LinkedList</span>.</p></div>
<div class="paragraph"><p><strong>Note that you do <em>not</em> assign to <span class="monospaced">head</span> and <span class="monospaced">tail</span>.</strong></p></div>
<div class="paragraph"><p>There is also a <span class="monospaced">DoubleLinkedList</span>, with a mutable <span class="monospaced">prev</span> reference.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Caution</div>
</td>
<td class="content">If you want to make a list node the last node in the list, you
<em>cannot</em> set the <span class="monospaced">next</span> reference to <span class="monospaced">Nil</span>. Instead, set it to
<span class="monospaced">LinkedList.empty</span>. Do not set it to <span class="monospaced">null</span>, or you will get a null pointer
error when traversing the linked list.</td>
</tr></table>
</div>
</div>
<div class="sect2">
<h3 id="_sets">Sets</h3>
<div class="paragraph"><p>A set is a collection of distinct elements. Trying to add an existing
element has no effect. For example,</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="nc">Set</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">1</span><span class="o">)</span> <span class="o">+</span> <span class="mi">1</span>
</pre></div></div></div>
<div class="paragraph"><p>is the same as Set(2, 0, 1).</p></div>
<div class="paragraph"><p>Unlike lists, sets do not retain the order in which elements are inserted.
By default, sets are implemented as hash sets in which elements are
organized by the value of the <span class="monospaced">hashCode</span> method. (In Scala, as in Java, every
object has a <span class="monospaced">hashCode</span> method.)</p></div>
<div class="paragraph"><p>For example, if you iterate over</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="nc">Set</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="mi">5</span><span class="o">,</span> <span class="mi">6</span><span class="o">)</span>
</pre></div></div></div>
<div class="paragraph"><p>the elements are visited in the order</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>5 1 6 2 3 4</pre>
</div></div>
<div class="paragraph"><p>See for yourself:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>scala> <strong>Set(1, 2, 3, 4, 5, 6)</strong>
res0: scala.collection.immutable.Set[Int] = Set(5, 1, 6, 2, 3, 4)</pre>
</div></div>
<div class="paragraph"><p>You may wonder why sets don’t retain the element order. It turns out that
you can find elements much faster if you allow sets to reorder their
elements. Finding an element in a hash set is much faster than in an array
or list.</p></div>
<div class="paragraph"><p>A linked hash set remembers the order in which elements were inserted. It
keeps a linked list for this purpose. For example,</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>scala> scala.collection.mutable.LinkedHashSet(1, 2, 3, 4, 5, 6)
res2: scala.collection.mutable.LinkedHashSet[Int] = Set(1, 2, 3, 4, 5, 6)</pre>
</div></div>
<div class="paragraph"><p>If you want to iterate over elements in sorted order, use a sorted set:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>scala> <strong>import scala.util.Random</strong>
import scala.util.Random

scala> <strong>scala.collection.immutable.SortedSet(6, 4, 3, 1, 2, 5)</strong>
res3: scala.collection.immutable.SortedSet[Int] = TreeSet(1, 2, 3, 4, 5, 6)</pre>
</div></div>
<div class="paragraph"><p>Sorted sets are implemented as red-black trees.</p></div>
<div class="paragraph"><p>A bit set is an implementation of a set of nonnegative integers as a
sequence of bits. The <em>i</em><sup>th</sup> bit is 1 if <em>i</em> is present in the set. This
is an efficient implementation as long as the maximum element is not too
large. Scala provides both mutable and immutable <span class="monospaced">BitSet</span> classes.</p></div>
<div class="paragraph"><p>The <span class="monospaced">contains</span> method checks whether a set contains a given value. The
<span class="monospaced">subsetOf</span> method checks whether all elements of a set are contained in
another set.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">val</span> <span class="n">digits</span> <span class="k">=</span> <span class="nc">Set</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">7</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">9</span><span class="o">)</span>
<span class="n">digits</span> <span class="n">contains</span> <span class="mi">0</span> <span class="c1">// false</span>
<span class="nc">Set</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">)</span> <span class="n">subsetOf</span> <span class="n">digits</span> <span class="c1">// true</span>
</pre></div></div></div>
<div class="paragraph"><p>The <span class="monospaced">union</span>, <span class="monospaced">intersect</span>, and <span class="monospaced">diff</span> methods carry out the usual set
operations. If you prefer, you can write them as <span class="monospaced">|</span>, <span class="monospaced">&amp;</span>, and <span class="monospaced">&amp;~</span>. You
can also write <span class="monospaced">union</span> as <span class="monospaced">++</span> and <span class="monospaced">difference</span> as <span class="monospaced">--</span>.</p></div>
<div class="paragraph"><p>For example:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">val</span> <span class="n">primes</span> <span class="k">=</span> <span class="nc">Set</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">5</span><span class="o">,</span> <span class="mi">7</span><span class="o">)</span>
<span class="n">digits</span> <span class="n">union</span> <span class="n">primes</span> <span class="c1">// yields Set(1, 2, 3, 5, 7, 9)</span>
<span class="n">digits</span> <span class="o">&amp;</span> <span class="n">primes</span>     <span class="c1">// yields Set(2, 7)</span>
<span class="n">digits</span> <span class="o">--</span> <span class="n">primes</span>    <span class="c1">// yields Set(1, 9)</span>
</pre></div></div></div>
</div>
<div class="sect2">
<h3 id="_operators_for_adding_or_removing_elements">Operators for Adding or Removing Elements</h3>
<div class="paragraph"><p>Here are the various operators and collection types.</p></div>
<table class="tableblock frame-all grid-all"
style="
width:90%;
">
<col style="width:33%;">
<col style="width:33%;">
<col style="width:33%;">
<thead>
<tr>
<th class="tableblock halign-left valign-top" > Operator   </th>
<th class="tableblock halign-left valign-top" > Collection Type </th>
<th class="tableblock halign-left valign-top" > Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">coll :+ elem</span><br>
  <span class="monospaced">elem +: coll</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">Seq</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">A collection of the same type as <span class="monospaced">coll</span> to which <span class="monospaced">elem</span> has been appended
or prepended.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">coll + elem</span><br>
  <span class="monospaced">coll + (e1, e2, ...)</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">Seq, Map</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">A collection of the same type as <span class="monospaced">coll</span> to which the given elements have been
added.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">coll - elem</span><br>
  <span class="monospaced">coll - (e1, e2, ...)</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">Seq, Map, ArrayBuffer</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">A collection of the same type as <span class="monospaced">coll</span> from which the given elements have been
removed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">coll1 ++ coll2</span><br>
  <span class="monospaced">coll2 ++: coll1</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">Iterable</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">A collection of the same type as <span class="monospaced">coll1</span>, containing the elements
of both collections.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">coll1 -- coll2</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">Seq, Map, ArrayBuffer</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">A collection of the same type as <span class="monospaced">coll1</span>, from which the elements of
<span class="monospaced">coll2</span> have been removed. (For sequences, use <span class="monospaced">diff</span>.)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">elem :: lst</span><br>
  <span class="monospaced">lst2 :::: lst</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">List</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">A list with the given element or given list prepended to <span class="monospaced">lst</span>. Same as
<span class="monospaced">+:</span> and <span class="monospaced">++:</span>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">list1 ::: list2</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">List</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Same as <span class="monospaced">list1 ++: list2</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">set1 | set2</span><br>
  <span class="monospaced">set1 &amp; set2</span><br>
  <span class="monospaced">set1 &amp;~ set2</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">Set</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Set union, intersection, and difference. <span class="monospaced">|</span> is the same as <span class="monospaced">++</span>, and
<span class="monospaced">&amp;~</span> is the same as <span class="monospaced">--</span>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">coll += elem</span><br>
  <span class="monospaced">coll += (e1, e2, ...)</span><br>
  <span class="monospaced">coll ++= coll2</span><br>
  <span class="monospaced">coll -= elem</span><br>
  <span class="monospaced">coll -= (e1, e2, ...)</span><br>
  <span class="monospaced">coll --= coll2</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Mutable collections</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Modifies <span class="monospaced">coll</span> by adding or removing the given elements.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">elem +=: coll</span><br>
  <span class="monospaced">coll2 ++=: coll</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">ArrayBuffer</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Modifies <span class="monospaced">coll</span> by prepending the given element or collection.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph"><p>Generally, <span class="monospaced">+</span> is used for adding an element to an unordered collection,
and <span class="monospaced">+:</span> and <span class="monospaced">:+</span> add an element to the beginning or end of an ordered
collection.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="nc">Vector</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">)</span> <span class="o">:+</span> <span class="mi">5</span> <span class="c1">// Yields Vector(1, 2, 3, 5)</span>
<span class="mi">1</span> <span class="o">+:</span> <span class="nc">Vector</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">)</span> <span class="c1">// Yields Vector(1, 1, 2, 3)</span>
</pre></div></div></div>
<div class="paragraph"><p>Note that <span class="monospaced">+:</span>, like all operators ending in a colon, is <em>right-associative</em>,
and that it is a method of the right operand.</p></div>
<div class="paragraph"><p>These operators return new collections (of the same type as the original
ones) without modifying the original. Mutable collections have a <span class="monospaced">+=</span>
operator that mutates the left-hand side. For example,</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">val</span> <span class="n">numbers</span> <span class="k">=</span> <span class="nc">ArrayBuffer</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">)</span>
<span class="n">numbers</span> <span class="o">+=</span> <span class="mi">5</span> <span class="c1">// Adds 5 to numbers</span>
</pre></div></div></div>
<div class="paragraph"><p>With an immutable collection, you can use <span class="monospaced">+=</span> or <span class="monospaced">:+=</span> with a <span class="monospaced">var</span>, like
this:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">var</span> <span class="n">numbers</span> <span class="k">=</span> <span class="nc">Set</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">)</span>
<span class="n">numbers</span> <span class="o">+=</span> <span class="mi">5</span> <span class="c1">// Sets numbers to the immutable set numbers + 5</span>
<span class="k">var</span> <span class="n">numberVector</span> <span class="k">=</span> <span class="nc">Vector</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">)</span>
<span class="n">numberVector</span> <span class="o">:+=</span> <span class="mi">5</span> <span class="c1">// += does not work since vectors don&#39;t have a + operator</span>
</pre></div></div></div>
<div class="paragraph"><p>To remove an element, use the <span class="monospaced">-</span> operator:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="nc">Set</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">)</span> <span class="o">-</span> <span class="mi">2</span> <span class="c1">// Yields Set(1, 3)</span>
</pre></div></div></div>
<div class="paragraph"><p>You can add multiple elements with the ++ operator:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="n">coll</span> <span class="o">++</span> <span class="n">coll2</span>
</pre></div></div></div>
<div class="paragraph"><p>yields a collection of the same type as <span class="monospaced">coll</span> that contains both <span class="monospaced">coll</span> and
<span class="monospaced">coll2</span>. Similarly, the <span class="monospaced">--</span> operator removes multiple elements.</p></div>
</div>
<div class="sect2">
<h3 id="_important_methods_of_the_span_class_monospaced_iterable_span_trait">Important Methods of the <span class="monospaced">Iterable</span> Trait</h3>
<table class="tableblock frame-all grid-all"
style="
width:90%;
">
<caption class="title">Table 1. Important methods of the <span class="monospaced">Iterable</span> trait</caption>
<col style="width:50%;">
<col style="width:50%;">
<thead>
<tr>
<th class="tableblock halign-left valign-top" > Methods                </th>
<th class="tableblock halign-left valign-top" > Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">head, last, headOption, lastOption</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Returns the first or last element; or, that element as an <span class="monospaced">Option</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">tail, init</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Returns everything but the first or last element</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">length, isEmpty</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Returns the length, or <span class="monospaced">true</span> if the length is zero</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">map(f), foreach(f), flatMap(f), collect(pf)</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Applies a function to all elements.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">reduceLeft(op), reduceRight(op), foldLeft(init)(op), foldRight(init)(op)</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Applies a binary operation to all elements in a given order.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">reduce(op), fold(init)(op), aggregate(init)(op, combineOp)</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Applies a binary operation to all elements in arbitrary order.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">sum, product, max, min</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Returns the sum or product (assuming the element type can be converted to
<span class="monospaced">Numeric</span>) or the maximum and minimum (assuming the element type can be
converted to <span class="monospaced">Ordered</span>).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">count(pred)</span><br>
  <span class="monospaced">forall(pred)</span><br>
  <span class="monospaced">exists(pred)</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">count of elements fulfilling the predicate<br>
<span class="monospaced">true</span> if all elements fulfill the predicate<br>
<span class="monospaced">true</span> if at least one element matches the predicate.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">filter(pred)</span><br>
  <span class="monospaced">filterNot(pred)</span><br>
  <span class="monospaced">partition(pred)</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Returns all elements fulfilling the predicate.<br>
Returns all elements not fulfilling the predicate.<br>
Returns a pair of both.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">takeWhile(pred)</span><br>
  <span class="monospaced">dropWhile(pred)</span><br>
  <span class="monospaced">span(pred)</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Returns the first elements fulfilling <span class="monospaced">pred</span>.<br>
Returns the all but first elements fulfilling <span class="monospaced">pred</span>.<br>
Returns a pair of both.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">take(n)</span><br>
  <span class="monospaced">drop(n)</span><br>
  <span class="monospaced">splitAt(n)</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Returns the first <span class="monospaced">n</span> elements.
Returns all but the first <span class="monospaced">n</span> elements.
Returns a pair of both.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">takeRight(n)</span><br>
  <span class="monospaced">dropRight(n)</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Return the last <span class="monospaced">n</span> elements.
Return all but the last <span class="monospaced">n</span> elements.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">slice(from, to)</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Returns the elements in the range <span class="monospaced">from</span> until <span class="monospaced">to</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">zip(coll2)</span><br>
  <span class="monospaced">zipAll(coll2, fill, fill2)</span><br>
  <span class="monospaced">zipWithIndex</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Returns pairs of elements from this collection and another. (More in a bit.)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">grouped(n)</span><br>
  <span class="monospaced">sliding(n)</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Returns iterators of subcollections of length <span class="monospaced">n</span>. <span class="monospaced">grouped</span> yields
elements with index <span class="monospaced">0 until n</span>, then with index <span class="monospaced">n until 2 * n</span>, etc.
<span class="monospaced">sliding</span> yields elements with index <span class="monospaced">0 until n</span>, then with index
<span class="monospaced">1 until n + 1</span>, and so on.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">mkString(before, between, after)</span><br>
  <span class="monospaced">addString(sb, before, between, after)</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Makes a string of all elements,
adding the given strings before the first, between each, and after the last
element. The second method appends the resulting string to a <span class="monospaced">StringBuilder</span>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">toIterable</span><br>
  <span class="monospaced">toSeq</span><br>
  <span class="monospaced">toIndexedSeq</span><br>
  <span class="monospaced">toArray</span><br>
  <span class="monospaced">toList</span><br>
  <span class="monospaced">toStream</span><br>
  <span class="monospaced">toSet</span><br>
  <span class="monospaced">toMap</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Converts the collection to a collection of the specified type.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">copyToArray(arr)</span><br>
  <span class="monospaced">copyToArray(arr, start, length)</span><br>
  <span class="monospaced">copyToBuffer(buf)</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Copy elements to an array or buffer.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_important_methods_of_the_span_class_monospaced_seq_span_trait">Important Methods of the <span class="monospaced">Seq</span> Trait</h3>
<div class="paragraph"><p>The <span class="monospaced">Seq</span> trait adds more methods. Here are the important ones.</p></div>
<table class="tableblock frame-all grid-all"
style="
width:90%;
">
<caption class="title">Table 2. Important methods of the <span class="monospaced">Seq</span> trait</caption>
<col style="width:50%;">
<col style="width:50%;">
<thead>
<tr>
<th class="tableblock halign-left valign-top" > Method  </th>
<th class="tableblock halign-left valign-top" > Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">contains(elem)</span>, <span class="monospaced">containsSlice(seq)</span><br>
  <span class="monospaced">startsWith(seq)</span>, <span class="monospaced">endsWith(seq)</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Returns <span class="monospaced">true</span> if this sequences contains the given element or sequence.<br>
Returns <span class="monospaced">true</span> if this sequence starts or ends with the given sequence.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">indexOf(elem), lastIndexOf(elem), indexOfSlice(seq), lastIndexOfSlice(seq)</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Returns the index of the first or last occurrence of the given element or
element sequence.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">indexWhere(pred)</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Returns the index of the first element that fulfills <span class="monospaced">pred</span>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">prefixLength(pred), segmentLength(pred, n)</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Returns the length of the longest sequence of elements that fulfill <span class="monospaced">pred</span>,
starting with either <span class="monospaced">0</span> or <span class="monospaced">n</span>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">padTo(n, fill)</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Returns a copy of this sequence, with <span class="monospaced">fill</span> appended until the length is <span class="monospaced">n</span>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">intersect(seq), diff(seq)</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Returns the "multiset" intersection or differences of the sequences. For
instance, if <span class="monospaced">a</span> contains five 1s and <span class="monospaced">b</span> contains two 1s, then
<span class="monospaced">a intersect b</span> contains two 1s (the smaller count), and <span class="monospaced">a diff b</span> contains
three 1s (the difference).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">reverse</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Returns the reverse of this sequence.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">sorted, sortWith(lessThan), sortBy(f)</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">The sequence sorted using element sorting, a binary <span class="monospaced">lessThan</span> function,
or a function <span class="monospaced">f</span> that maps each element to an ordered type (or key).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">permutations, combinations(n)</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Returns an iterator over all permutations or combinations (subsequences of
length <span class="monospaced">n</span>).</p></td>
</tr>
</tbody>
</table>
<div class="paragraph"><p>These methods <em>never</em> mutate a collection. They return a collection of the
same type as the original. This is sometimes called the "uniform return
type" principal.</p></div>
</div>
<div class="sect2">
<h3 id="_mapping_a_function">Mapping a Function</h3>
<div class="paragraph"><p>You may want to transform all elements of a collection. The <span class="monospaced">map</span> method
applies a function to a collection and yields a collection of the results.</p></div>
<div class="paragraph"><p>For example, given a list of strings:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">val</span> <span class="n">names</span> <span class="k">=</span> <span class="nc">List</span><span class="o">(</span><span class="s">&quot;Peter&quot;</span><span class="o">,</span> <span class="s">&quot;Paul&quot;</span><span class="o">,</span> <span class="s">&quot;Mary&quot;</span><span class="o">)</span>
</pre></div></div></div>
<div class="paragraph"><p>you get a list of the uppercased strings as:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="n">names</span><span class="o">.</span><span class="n">map</span><span class="o">(</span><span class="k">_</span><span class="o">.</span><span class="n">toUpperCase</span><span class="o">)</span> <span class="c1">// List(&quot;PETER&quot;, &quot;PAUL&quot;, &quot;MARY&quot;)</span>
</pre></div></div></div>
<div class="paragraph"><p>This is exactly the same as:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">for</span> <span class="o">(</span><span class="n">n</span> <span class="k">&lt;-</span> <span class="n">names</span><span class="o">)</span> <span class="k">yield</span> <span class="n">n</span><span class="o">.</span><span class="n">toUpperCase</span>
</pre></div></div></div>
<div class="paragraph"><p>If the function yields a collection instead of a single value, you may want
to concatenate all results. In that case, use <span class="monospaced">flatMap</span>. For example,
consider:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">def</span> <span class="n">ulcase</span><span class="o">(</span><span class="n">s</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span> <span class="k">=</span> <span class="nc">Vector</span><span class="o">(</span><span class="n">s</span><span class="o">.</span><span class="n">toUpperCase</span><span class="o">(),</span> <span class="n">s</span><span class="o">.</span><span class="n">toLowerCase</span><span class="o">())</span>
</pre></div></div></div>
<div class="paragraph"><p>Then <span class="monospaced">names.map(ulcase)</span> is</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="nc">List</span><span class="o">(</span><span class="nc">Vector</span><span class="o">(</span><span class="s">&quot;PETER&quot;</span><span class="o">,</span> <span class="s">&quot;peter&quot;</span><span class="o">),</span> <span class="nc">Vector</span><span class="o">(</span><span class="s">&quot;PAUL&quot;</span><span class="o">,</span> <span class="s">&quot;paul&quot;</span><span class="o">),</span> <span class="nc">Vector</span><span class="o">(</span><span class="s">&quot;MARY&quot;</span><span class="o">,</span>
<span class="s">&quot;mary&quot;</span><span class="o">))</span>
</pre></div></div></div>
<div class="paragraph"><p>but <span class="monospaced">names.flatMap(ulcase)</span> is</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="nc">List</span><span class="o">(</span><span class="s">&quot;PETER&quot;</span><span class="o">,</span> <span class="s">&quot;peter&quot;</span><span class="o">,</span> <span class="s">&quot;PAUL&quot;</span><span class="o">,</span> <span class="s">&quot;paul&quot;</span><span class="o">,</span> <span class="s">&quot;MARY&quot;</span><span class="o">,</span> <span class="s">&quot;mary&quot;</span><span class="o">)</span>
</pre></div></div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">If you use <span class="monospaced">flatMap</span> with a function that returns an <span class="monospaced">Option</span>, the
resulting collection contains all values <em>v</em> for which the function returns
<span class="monospaced">Some(v)</span>.</td>
</tr></table>
</div>
<div class="paragraph"><p>The <span class="monospaced">collect</span> method works with partial functions, functions that may not be
defined for all inputs. It yields a collection of all function values of
the arguments on which it is defined. For example,</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="s">&quot;-3+4&quot;</span><span class="o">.</span><span class="n">collect</span> <span class="o">{</span>
  <span class="k">case</span> <span class="sc">&#39;+&#39;</span> <span class="k">=&gt;</span> <span class="mi">1</span>
  <span class="k">case</span> <span class="sc">&#39;-&#39;</span> <span class="k">=&gt;</span> <span class="o">-</span><span class="mi">1</span>
<span class="o">}</span> <span class="c1">// yields Vector(-1, 1)</span>
</pre></div></div></div>
<div class="paragraph"><p>Finally, if you just want to apply a function for its side effect and don’t
care about the function values, use <span class="monospaced">foreach</span>:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="n">names</span><span class="o">.</span><span class="n">foreach</span><span class="o">(</span><span class="n">println</span><span class="o">)</span>
</pre></div></div></div>
</div>
<div class="sect2">
<h3 id="_reducing">Reducing</h3>
<div class="paragraph"><p>The <span class="monospaced">map</span> method applies a unary function to all elements of a collection.</p></div>
<div class="paragraph"><p>The methods that we discuss in this section combine elements with a
<em>binary</em> function. The call <span class="monospaced">c.reduceLeft(op)</span> applies <span class="monospaced">op</span> to successive
elements, like this:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>              .
             .
            .
           op
          /  \
        op   coll(3)
       /  \
      op   coll(2)
     /  \
coll(0)  coll(1)</pre>
</div></div>
<div class="paragraph"><p>For example,</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="nc">List</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">7</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">9</span><span class="o">).</span><span class="n">reduceLeft</span><span class="o">(</span><span class="k">_</span> <span class="o">-</span> <span class="k">_</span><span class="o">)</span>
</pre></div></div></div>
<div class="paragraph"><p>is</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>         -
       /   \
      -     9
    /   \
   -      2
 /   \
1     7</pre>
</div></div>
<div class="paragraph"><p>or</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>((1 - 7) - 2) - 9 = 1 - 7 - 2 - 9 = -17</pre>
</div></div>
<div class="paragraph"><p>The <span class="monospaced">reduceRight</span> method does the same, but it starts with the end of the
collection. For example,</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="nc">List</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">7</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">9</span><span class="o">).</span><span class="n">reduceRight</span><span class="o">(</span><span class="k">_</span> <span class="o">-</span> <span class="k">_</span><span class="o">)</span>
</pre></div></div></div>
<div class="paragraph"><p>is</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>1 - (7 - (2 - 9)) = 1 - 7 + 2 - 9 = -13</pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_lab_span_class_monospaced_reduceleft_span_2">Lab: <span class="monospaced">reduceLeft</span></h3>
<div class="paragraph"><p>Open <span class="monospaced">labs/src/main/scala/com/newcircle/collections/MkString1.scala</span> and
implement the <span class="monospaced">mkString1</span> function, using <span class="monospaced">reduceLeft</span>. (Hint: You may also
find <span class="monospaced">map</span> to be useful.) It should behave like this:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">val</span> <span class="n">collection</span> <span class="k">=</span> <span class="c1">// some Scala collection, of anything</span>
<span class="k">val</span> <span class="n">s1</span> <span class="k">=</span> <span class="n">collection</span><span class="o">.</span><span class="n">mkString</span><span class="o">(</span><span class="s">&quot; &quot;</span><span class="o">)</span>
<span class="k">val</span> <span class="n">s2</span> <span class="k">=</span> <span class="nc">MkString1</span><span class="o">.</span><span class="n">mkString1</span><span class="o">(</span><span class="n">collection</span><span class="o">,</span> <span class="s">&quot; &quot;</span><span class="o">)</span>

<span class="n">s1</span> <span class="o">==</span> <span class="n">s2</span> <span class="c1">// should be true</span>
</pre></div></div></div>
<div class="paragraph"><p>To test your solution, run this tester in SBT:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>&gt; test-only com.newcircle.tests.collections.MkStringSpec1</pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_folding">Folding</h3>
<div class="paragraph"><p>Often, it is useful to start the computation with an initial element other
than the initial element of a collection. The call coll.foldLeft(init)(op)
computes</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>            .
           .
          .
         op
        /  \
      op   coll(2)
     /  \
    op   coll(1)
   /  \
init   coll(0)</pre>
</div></div>
<div class="paragraph"><p>For example,</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="nc">List</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">7</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">9</span><span class="o">).</span><span class="n">foldLeft</span><span class="o">(</span><span class="mi">0</span><span class="o">)(</span><span class="k">_</span> <span class="o">-</span> <span class="k">_</span><span class="o">)</span>
</pre></div></div></div>
<div class="paragraph"><p>is</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>0 - 1 - 7 - 2 - 9 = -19</pre>
</div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">The initial value and the operator are separate "curried" parameters
so that Scala can use the type of the initial value for type inference in
the operator. For example, in <span class="monospaced">List(1, 7, 2, 9).foldLeft("")(_ + _)</span>, the
initial value is a string, so the operator must be a function
<span class="monospaced">(String, Int) =&gt; String</span>.</td>
</tr></table>
</div>
<div class="paragraph"><p>You can also write the <span class="monospaced">foldLeft</span> operation with the <span class="monospaced">/:</span> operator, like this:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="o">(</span><span class="mi">0</span> <span class="o">/:</span> <span class="nc">List</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">7</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">9</span><span class="o">))(</span><span class="k">_</span> <span class="o">-</span> <span class="k">_</span><span class="o">)</span>
</pre></div></div></div>
<div class="paragraph"><p>The <span class="monospaced">/:</span> is supposed to remind you of the shape of the tree. With the
<span class="monospaced">/:</span>, the initial value is the first operand.</p></div>
<div class="paragraph"><p>There&#8217;s a <span class="monospaced">foldRight</span> (or <span class="monospaced">\\:</span>) variant, as well, computing:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>      .
       .
        .
        op
       /  \
coll(n-3)  op
          /  \
   coll(n-2)  op
             /  \
      coll(n-1)  init</pre>
</div></div>
<div class="sect3">
<h4 id="_this_is_confusing_how_is_it_at_all_useful">This is confusing! How is it at all useful?</h4>
<div class="paragraph"><p>Folding is sometimes attractive as a replacement for a loop. Suppose, for
example, we want to count the frequencies of the letters in a string. One
way is to visit each letter and update a mutable map:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">val</span> <span class="n">freq</span> <span class="k">=</span> <span class="n">scala</span><span class="o">.</span><span class="n">collection</span><span class="o">.</span><span class="n">mutable</span><span class="o">.</span><span class="nc">Map</span><span class="o">[</span><span class="kt">Char</span>, <span class="kt">Int</span><span class="o">]()</span>
<span class="k">for</span> <span class="o">(</span><span class="n">c</span> <span class="k">&lt;-</span> <span class="s">&quot;Mississippi&quot;</span><span class="o">)</span>
  <span class="n">freq</span><span class="o">(</span><span class="n">c</span><span class="o">)</span> <span class="k">=</span> <span class="n">freq</span><span class="o">.</span><span class="n">getOrElse</span><span class="o">(</span><span class="n">c</span><span class="o">,</span> <span class="mi">0</span><span class="o">)</span> <span class="o">+</span> <span class="mi">1</span>
<span class="c1">// Now freq is Map(&#39;i&#39; -&gt; 4, &#39;M&#39; -&gt; 1, &#39;s&#39; -&gt; 4, &#39;p&#39; -&gt; 2)</span>
</pre></div></div></div>
<div class="paragraph"><p>Here&#8217;s the <span class="monospaced">foldLeft</span> implementation:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">val</span> <span class="n">emptyFreq</span> <span class="k">=</span> <span class="nc">Map</span><span class="o">[</span><span class="kt">Char</span>, <span class="kt">Int</span><span class="o">]()</span>
<span class="o">(</span><span class="n">emptyFreq</span> <span class="n">foldLeft</span> <span class="s">&quot;Mississippi&quot;</span><span class="o">)</span> <span class="o">{</span>
  <span class="o">(</span><span class="n">map</span><span class="o">,</span> <span class="n">ch</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="n">map</span> <span class="o">+</span> <span class="o">(</span><span class="n">ch</span> <span class="o">-&gt;</span> <span class="o">(</span><span class="n">map</span><span class="o">.</span><span class="n">getOrElse</span><span class="o">(</span><span class="n">c</span><span class="o">,</span> <span class="mi">0</span><span class="o">)</span> <span class="o">+</span> <span class="mi">1</span><span class="o">))</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>So, why do this, instead of the arguably more readable loop? The main impetus
is usually to remove mutable data. A fold-based implementation is a pure
transformation.</p></div>
</div>
</div>
<div class="sect2">
<h3 id="_lab_span_class_monospaced_foldleft_span">Lab: <span class="monospaced">foldLeft</span></h3>
<div class="paragraph"><p>Open <span class="monospaced">labs/src/main/scala/com/newcircle/collections/MkString2.scala</span> and
implement the <span class="monospaced">mkString2</span> function. This function should behave <em>exactly</em>
like <span class="monospaced">mkString1</span> from above, but you must implement it using <span class="monospaced">foldLeft</span>.</p></div>
<div class="paragraph"><p><strong>Hint:</strong> You will also want to use the <span class="monospaced">drop</span> function, or something similar.
(Why?)</p></div>
<div class="paragraph"><p>To test your solution, run this tester in SBT:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>&gt; test-only com.newcircle.tests.collections.MkString2</pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_scanning">Scanning</h3>
<div class="paragraph"><p>The <span class="monospaced">scanLeft</span> and <span class="monospaced">scanRight</span> functions combine folding and mapping.
You get a collection of <em>all</em> intermediate results.</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>scala> <strong>(1 to 10).scanLeft(0)(_ + _)</strong>
res0: scala.collection.immutable.IndexedSeq[Int] = Vector(0, 1, 3, 6, 10, 15, 21, 28, 36, 45, 55)</pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_zipping_2">Zipping</h3>
<div class="paragraph"><p>The reducing, folding and scanning methods apply an operation to adjacent
elements in the same collection. Sometimes, you have two collections, and
you want to combine corresponding elements.</p></div>
<div class="paragraph"><p>For example, suppose you have a list of product prices and corresponding
quantities:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">val</span> <span class="n">prices</span> <span class="k">=</span> <span class="nc">List</span><span class="o">(</span><span class="mf">5.0</span><span class="o">,</span> <span class="mf">20.0</span><span class="o">,</span> <span class="mf">9.95</span><span class="o">)</span>
<span class="k">val</span> <span class="n">quantities</span> <span class="k">=</span> <span class="nc">List</span><span class="o">(</span><span class="mi">10</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">1</span><span class="o">)</span>
</pre></div></div></div>
<div class="paragraph"><p>The <span class="monospaced">zip</span> method lets you combine them into a list of pairs. For example,</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>scala> <strong>val prices = List(5.0, 20.0, 9.95)</strong>
prices: List[Double] = List(5.0, 20.0, 9.95)

scala> <strong>val quantities = List(10, 2, 1)</strong>
quantities: List[Int] = List(10, 2, 1)

scala> <strong>prices zip quantities</strong>
res0: List[(Double, Int)] = List((5.0,10), (20.0,2), (9.95,1))</pre>
</div></div>
<div class="paragraph"><p>The method is called "zip" because it combines the two collections like the
teeth of a zipper.</p></div>
<div class="paragraph"><p>Let&#8217;s chain a <span class="monospaced">map</span> on the end of the <span class="monospaced">zip</span> operation:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>scala> <strong>(prices zip quantities) map { p => p._1</strong> * <strong>p._2 }</strong>
res1: List[Double] = List(15.0, 22.0, 10.95)</pre>
</div></div>
<div class="paragraph"><p>By adding <span class="monospaced">sum</span> to the chain, we can calculate the total price of all items:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>scala> <strong>(prices zip quantities) map { p => p._1</strong> * <strong>p._2 } sum</strong>
res2: Double = 99.95</pre>
</div></div>
<div class="paragraph"><p>If one collection is shorter than the other, the extras are tossed out:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>scala> <strong>List(5.0, 20.0, 9.95) zip List(10, 2)</strong>
res3: List[(Double, Int)] = List((5.0,10), (20.0,2))</pre>
</div></div>
<div class="paragraph"><p>The <span class="monospaced">zipAll</span> method lets you specify defaults for the shorter list:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>scala> <strong>List(5.0, 20.0, 9.95).zipAll(List(10, 2), 0.0, 1)</strong>
res4: List[(Double, Int)] = List((5.0,10), (20.0,2), (9.95,3), (10.0,3))</pre>
</div></div>
<div class="paragraph"><p>In this example, the <span class="monospaced">0.0</span> is the default value if the primary collection is
the short one, and the <span class="monospaced">1</span> is the default value if the passed-in collection
is the short one.</p></div>
<div class="paragraph"><p>The <span class="monospaced">zipWithIndex</span> method returns a list of pairs where the second element of
each pair is the index of each element:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>scala> <strong>"Scala".zipWithIndex</strong>
res5: scala.collection.immutable.IndexedSeq[(Char, Int)] = Vector((S,0), (c,1), (a,2), (l,3), (a,4))</pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_lab_line_numbers">Lab: Line numbers</h3>
<div class="paragraph"><p>Open <span class="monospaced">labs/src/main/scala/com/newcircle/collections/LineNumbers.scala</span> and
implement the <span class="monospaced">printNumberedLines</span> function. The function must take a
<span class="monospaced">Source</span>, read it line-by-line, and print each line (using <span class="monospaced">println</span>) with
its line number. Line numbers start at 1, not 0.</p></div>
<div class="paragraph"><p>For example, given this input:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>Voluptatum
dolores
consequuntur
optio
est
sed
Ratione
dolores
et
eveniet
commodi
aut
at</pre>
</div></div>
<div class="paragraph"><p>it should print:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>0: Voluptatum
1: dolores
2: consequuntur
3: optio
4: est
5: sed
6: Ratione
7: dolores
8: et
9: eveniet
10: commodi
11: aut
12: at</pre>
</div></div>
<div class="paragraph"><p>To test your solution, run this tester in SBT:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>&gt; test-only com.newcircle.tests.collections.LineNumbersSpec</pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_iterators">Iterators</h3>
<div class="paragraph"><p>You can obtain an iterator from a collection with the <span class="monospaced">iterator</span> method. This
isn’t as common as in Java or C++ because you can usually get what you need
more easily with one of the methods from the preceding sections.</p></div>
<div class="paragraph"><p>However, iterators are useful for collections that are expensive for <em>lazy
evaluation</em>. For example, <span class="monospaced">Source.fromFile</span> yields an <span class="monospaced">iterator</span> because it
might not be efficient to read an entire file into memory. There are a few
<span class="monospaced">Iterable</span> methods that yield an <span class="monospaced">iterator</span>, such as <span class="monospaced">grouped</span> or <span class="monospaced">sliding</span>.</p></div>
<div class="paragraph"><p>When you have an iterator, you can iterate over the elements with the <span class="monospaced">next</span>
and <span class="monospaced">hasNext</span> methods.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">while</span> <span class="o">(</span><span class="n">iter</span><span class="o">.</span><span class="n">hasNext</span><span class="o">)</span>
   <span class="k">do</span> <span class="n">something</span> <span class="k">with</span> <span class="n">iter</span><span class="o">.</span><span class="n">next</span><span class="o">()</span>
</pre></div></div></div>
<div class="paragraph"><p>If you prefer, you can use a <span class="monospaced">for</span> loop instead:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">for</span> <span class="o">(</span><span class="n">elem</span> <span class="k">&lt;-</span> <span class="n">iter</span><span class="o">)</span>
   <span class="k">do</span> <span class="n">something</span> <span class="k">with</span> <span class="n">elem</span>
</pre></div></div></div>
<div class="paragraph"><p>Both loops end up moving the iterator to the end of the collection, after
which it is no longer usable.</p></div>
<div class="paragraph"><p>The <span class="monospaced">Iterator</span> class defines a number of methods that work identically to
the methods on collections. In particular, all <span class="monospaced">Iterable</span> methods listed in
the previously shown <span class="monospaced">Iterable</span> table are available, except for: <span class="monospaced">head</span>,
<span class="monospaced">headOption</span>, <span class="monospaced">last</span>, <span class="monospaced">lastOption</span>, <span class="monospaced">tail</span>, <span class="monospaced">init</span>, <span class="monospaced">takeRight</span>, <span class="monospaced">dropRight</span>.</p></div>
<div class="paragraph"><p>After calling a method such as <span class="monospaced">map</span>, <span class="monospaced">filter</span>, <span class="monospaced">count</span>, <span class="monospaced">sum</span>, or even
<span class="monospaced">length</span>, the iterator is at the end of the collection, and you can’t use
it again. With other methods, such as <span class="monospaced">find</span> or <span class="monospaced">take</span>, the iterator is
past the found element or the taken ones.</p></div>
<div class="paragraph"><p>If you find it too tedious to work with an <span class="monospaced">iterator</span>, you can use a method
such as <span class="monospaced">toArray</span>, <span class="monospaced">toIterable</span>, <span class="monospaced">toSeq</span>, <span class="monospaced">toSet</span>, or <span class="monospaced">toMap</span> to copy the
values into a collection.</p></div>
</div>
<div class="sect2">
<h3 id="_streams">Streams</h3>
<div class="paragraph"><p>In the preceding sections, you saw that an iterator is a lazy alternative
to a collection. You get the elements as you need them. If you don’t need
any more elements, you don’t pay for the expense of computing the remaining
ones.</p></div>
<div class="paragraph"><p>However, iterators are fragile. Each call to <span class="monospaced">next</span> mutates the iterator.</p></div>
<div class="paragraph"><p><em>Streams</em> offer an immutable alternative. A stream is an immutable list in
which the tail is computed lazily—that is, only when you ask for it.</p></div>
<div class="paragraph"><p>Here is a typical example:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">def</span> <span class="n">numsFrom</span><span class="o">(</span><span class="n">n</span><span class="k">:</span> <span class="kt">BigInt</span><span class="o">)</span><span class="k">:</span> <span class="kt">Stream</span><span class="o">[</span><span class="kt">BigInt</span><span class="o">]</span> <span class="k">=</span> <span class="n">n</span> <span class="o">#::</span> <span class="n">numsFrom</span><span class="o">(</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="o">)</span>
</pre></div></div></div>
<div class="paragraph"><p>The <span class="monospaced">#::</span> operator is like the <span class="monospaced">::</span> operator for lists, but it constructs a
stream.</p></div>
<div class="paragraph"><p>When you call</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">val</span> <span class="n">tenOrMore</span> <span class="k">=</span> <span class="n">numsFrom</span><span class="o">(</span><span class="mi">10</span><span class="o">)</span>
</pre></div></div></div>
<div class="paragraph"><p>you get a stream object that is displayed as</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>Stream(10, ?)</pre>
</div></div>
<div class="paragraph"><p>The tail is unevaluated. If you call</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="n">tenOrMore</span><span class="o">.</span><span class="n">tail</span><span class="o">.</span><span class="n">tail</span><span class="o">.</span><span class="n">tail</span>
</pre></div></div></div>
<div class="paragraph"><p>you get</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>Stream(13, ?)</pre>
</div></div>
<div class="paragraph"><p>Stream methods are executed lazily:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">val</span> <span class="n">squares</span> <span class="k">=</span> <span class="n">numsFrom</span><span class="o">(</span><span class="mi">1</span><span class="o">).</span><span class="n">map</span><span class="o">(</span><span class="n">x</span> <span class="k">=&gt;</span> <span class="n">x</span> <span class="o">*</span> <span class="n">x</span><span class="o">)</span> <span class="c1">// yields: Stream(1, ?)</span>
</pre></div></div></div>
<div class="paragraph"><p>You have to call <span class="monospaced">squares.tail</span> to force evaluation of the next entry.</p></div>
<div class="paragraph"><p>If you want to get more than one answer, you can invoke <span class="monospaced">take</span> followed by
<span class="monospaced">force</span>, which <span class="monospaced">forces</span> evaluation of all values. For example:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="n">squares</span><span class="o">.</span><span class="n">take</span><span class="o">(</span><span class="mi">5</span><span class="o">).</span><span class="n">force</span> <span class="c1">// yields Stream(1, 4, 9, 16, 25)</span>
</pre></div></div></div>
<div class="paragraph"><p>Of course, you don’t want to call:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="n">squares</span><span class="o">.</span><span class="n">force</span> <span class="c1">// No!</span>
</pre></div></div></div>
<div class="paragraph"><p>That call would attempt to evaluate all members of an infinite stream,
causing an <span class="monospaced">OutOfMemoryError</span>.</p></div>
<div class="paragraph"><p>You can construct a stream from an iterator. For example, the
<span class="monospaced">Source.getLines</span> method returns an <span class="monospaced">Iterator[String]</span>. With that iterator,
you can only visit the lines once. A stream caches the visited lines so you
can revisit them:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">val</span> <span class="n">words</span> <span class="k">=</span> <span class="nc">Source</span><span class="o">.</span><span class="n">fromFile</span><span class="o">(</span><span class="s">&quot;/usr/share/dict/words&quot;</span><span class="o">).</span><span class="n">getLines</span><span class="o">.</span><span class="n">toStream</span>
<span class="n">words</span>     <span class="c1">// Stream(A, ?)</span>
<span class="n">words</span><span class="o">(</span><span class="mi">5</span><span class="o">)</span>  <span class="c1">// Aachen</span>
<span class="n">words</span>     <span class="c1">// Stream(A, A&#39;s, AOL, AOL&#39;s, Aachen, ?)</span>
</pre></div></div></div>
</div>
<div class="sect2">
<h3 id="_lazy_views">Lazy Views</h3>
<div class="paragraph"><p>In the preceding section, you saw that stream methods are computed lazily,
delivering results only when they are needed. You can get a similar effect
with other collections by applying the <span class="monospaced">view</span> method. This method yields a
collection on which methods are applied lazily. For example,</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">import</span> <span class="nn">scala.math.pow</span>

<span class="k">val</span> <span class="n">powers</span> <span class="k">=</span> <span class="o">(</span><span class="mi">0</span> <span class="n">until</span> <span class="mi">1000</span><span class="o">).</span><span class="n">view</span><span class="o">.</span><span class="n">map</span><span class="o">(</span><span class="n">pow</span><span class="o">(</span><span class="mi">10</span><span class="o">,</span> <span class="k">_</span><span class="o">))</span>
</pre></div></div></div>
<div class="paragraph"><p>yields a collection that is unevaluated. (Unlike a stream, not even the
first element is evaluated.) When you call</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="n">powers</span><span class="o">(</span><span class="mi">100</span><span class="o">)</span>
</pre></div></div></div>
<div class="paragraph"><p>then <span class="monospaced">pow(10, 100)</span> is computed, but the other powers are not.</p></div>
<div class="paragraph"><p>Unlike streams, these views do not cache any values. If you call
<span class="monospaced">powers(100)</span> again, <span class="monospaced">pow(10, 100)</span> is <em>recomputed</em>.</p></div>
<div class="paragraph"><p>As with streams, use the <span class="monospaced">force</span> method to force evaluation of a lazy view.
You get back a collection of the same type as the original.</p></div>
<div class="paragraph"><p>Lazy views can be beneficial if a large collection is transformed in
multiple ways, because it avoids building up large intermediate
collections. For example, compare</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="o">(</span><span class="mi">0</span> <span class="n">to</span> <span class="mi">1000</span><span class="o">).</span><span class="n">map</span><span class="o">(</span><span class="n">pow</span><span class="o">(</span><span class="mi">10</span><span class="o">,</span> <span class="k">_</span><span class="o">)).</span><span class="n">map</span><span class="o">(</span><span class="mi">1</span> <span class="o">/</span> <span class="k">_</span><span class="o">)</span>
</pre></div></div></div>
<div class="paragraph"><p>with</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="o">(</span><span class="mi">0</span> <span class="n">to</span> <span class="mi">1000</span><span class="o">).</span><span class="n">view</span><span class="o">.</span><span class="n">map</span><span class="o">(</span><span class="n">pow</span><span class="o">(</span><span class="mi">10</span><span class="o">,</span> <span class="k">_</span><span class="o">)).</span><span class="n">map</span><span class="o">(</span><span class="mi">1</span> <span class="o">/</span> <span class="k">_</span><span class="o">).</span><span class="n">force</span>
</pre></div></div></div>
<div class="paragraph"><p>The former computes a collection of the powers of 10, then applies the
reciprocal to all of them. The latter computes a view that remembers both
map operations. When evaluation is forced, both operations are applied to
each element, without building an intermediate collection.</p></div>
</div>
<div class="sect2">
<h3 id="_interoperability_with_java_collections">Interoperability with Java Collections</h3>
<div class="paragraph"><p>At times you may need to use a Java collection, and you will likely miss
the rich set of methods that you get with Scala collections. Conversely,
you may want to build up a Scala collection and then pass it to Java code.
The <span class="monospaced">JavaConversions</span> object provides a set of conversions between Scala and
Java collections.</p></div>
<div class="paragraph"><p>Give the target value an explicit type to trigger the conversion. For example:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">import</span> <span class="nn">scala.collection.JavaConversions._</span>
<span class="k">val</span> <span class="n">props</span><span class="k">:</span> <span class="kt">scala.collection.mutable.Map</span><span class="o">[</span><span class="kt">String</span>, <span class="kt">String</span><span class="o">]</span> <span class="k">=</span> <span class="nc">System</span><span class="o">.</span><span class="n">getProperties</span><span class="o">()</span>
</pre></div></div></div>
<div class="paragraph"><p>If you are worried about unwanted implicit conversions, just import the
ones you need. For example,</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">import</span> <span class="nn">scala.collection.JavaConversions.propertiesAsScalaMap</span>
</pre></div></div></div>
<div class="paragraph"><p>Here are some handy conversion charts:</p></div>
<table class="tableblock frame-all grid-all"
style="
width:50%;
">
<caption class="title">Table 3. Conversions from Scala Collections to Java Collections</caption>
<col style="width:33%;">
<col style="width:33%;">
<col style="width:33%;">
<thead>
<tr>
<th class="tableblock halign-left valign-top" > Implicit Function       </th>
<th class="tableblock halign-left valign-top" > From type in <span class="monospaced">scala.collection</span> </th>
<th class="tableblock halign-left valign-top" > To type in <span class="monospaced">java.util</span></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">asJavaCollection</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">Iterable</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">Collection</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">asJavaIterable</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">Iterable</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">Iterable</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">asJavaIterator</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">Iterator</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">Iterator</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">asJavaEnumeration</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">Iterator</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">Enumeration</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">seqAsJavaList</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">Seq</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">List</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">mutableSeqAsJavaList</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">mutable.Seq</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">List</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">bufferAsJavaList</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">mutable.Buffer</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">List</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">setAsJavaSet</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">Set</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">Set</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">mutableSetAsJavaSet</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">mutable.Set</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">Set</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">mapAsJavaMap</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">Map</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">Map</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">mutableMapAsJavaMap</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">mutable.Map</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">Map</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">asJavaDictionary</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">Map</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">Dictionary</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">asJavaConcurrentMap</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">mutable.ConcurrentMap</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">concurrent.ConcurrentMap</span></p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all"
style="
width:50%;
">
<caption class="title">Table 4. Conversions from Java Collections to Scala Collections</caption>
<col style="width:33%;">
<col style="width:33%;">
<col style="width:33%;">
<thead>
<tr>
<th class="tableblock halign-left valign-top" > Implicit Function            </th>
<th class="tableblock halign-left valign-top" > From type in <span class="monospaced">java.util</span>   </th>
<th class="tableblock halign-left valign-top" > To type in <span class="monospaced">scala.collection</span></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">collectionAsScalaIterable</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">Collection</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">Iterable</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">iterableAsScalaIterable</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">Iterable</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">Iterable</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">asScalaIterator</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">Iterator</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">Iterator</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">enumerationAsScalaIterator</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">Enumeration</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">Iterator</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">asScalaBuffer</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">List</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">mutable.Buffer</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">asScalaSet</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">Set</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">mutable.Set</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">mapAsScalaMap</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">Map</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">mutable.Map</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">dictionaryAsScalaMap</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">Dictionary</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">mutable.Map</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">propertiesAsScalaMap</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">Properties</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">mutable.Map</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">asScalaConcurrentMap</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">concurrent.ConcurrentMap</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">mutable.ConcurrentMap</span></p></td>
</tr>
</tbody>
</table>
<div class="paragraph"><p>The conversions yield wrappers that let you use the target interface to
access the original type. For example, if you use</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">val</span> <span class="n">props</span><span class="k">:</span> <span class="kt">scala.collection.mutable.Map</span><span class="o">[</span><span class="kt">String</span>, <span class="kt">String</span><span class="o">]</span> <span class="k">=</span> <span class="nc">System</span><span class="o">.</span><span class="n">getProperties</span><span class="o">()</span>
</pre></div></div></div>
<div class="paragraph"><p>then <span class="monospaced">props</span> is a Scala <span class="monospaced">Map</span> wrapper whose methods call the methods of the
underlying Java object. If you call</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="n">props</span><span class="o">(</span><span class="s">&quot;com.horstmann.scala&quot;</span><span class="o">)</span> <span class="k">=</span> <span class="s">&quot;impatient&quot;</span>
</pre></div></div></div>
<div class="paragraph"><p>then the wrapper calls <span class="monospaced">put("com.horstmann.scala", "impatient")</span> on the
underlying <span class="monospaced">Properties</span> object.</p></div>
</div>
<div class="sect2">
<h3 id="_lab_conversions">Lab: Conversions</h3>
<div class="paragraph"><p>Open <span class="monospaced">labs/src/main/scala/com/newcircle/collections/Props.scala</span> and
implement the <span class="monospaced">properties</span> function. The function must return the
Java system properties as an <em>immutable</em> map.</p></div>
<div class="paragraph"><p>To test your solution, run this tester in SBT:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>&gt; test-only com.newcircle.tests.collections.PropMapSpec</pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_threadsafe_collections">Threadsafe Collections</h3>
<div class="paragraph"><p>When you access a mutable collection in multiple threads, you need to make
sure that you don’t mutate it in one thread at the same time that other
threads access it. The Scala library provides six traits that you can mix
in with collections to synchronize their operations:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>SynchronizedBuffer
SynchronizedMap
SynchronizedPriorityQueue
SynchronizedQueue
SynchronizedSet
SynchronizedStack</pre>
</div></div>
<div class="paragraph"><p>For example, the following constructs a map with synchronized operations:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">val</span> <span class="n">scores</span> <span class="k">=</span> <span class="k">new</span> <span class="n">scala</span><span class="o">.</span><span class="n">collection</span><span class="o">.</span><span class="n">mutable</span><span class="o">.</span><span class="nc">HashMap</span><span class="o">[</span><span class="kt">String</span>, <span class="kt">Int</span><span class="o">]</span> <span class="k">with</span>
  <span class="n">scala</span><span class="o">.</span><span class="n">collection</span><span class="o">.</span><span class="n">mutable</span><span class="o">.</span><span class="nc">SynchronizedMap</span><span class="o">[</span><span class="kt">String</span>, <span class="kt">Int</span><span class="o">]</span>
</pre></div></div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Caution</div>
</td>
<td class="content">Before using these mix-ins, be sure to understand what they do and
do not do. In the preceding example, you can be sure that the <span class="monospaced">scores</span> map
won’t be damaged. Any of its operations will run to completion before
another thread can execute another operation. However, concurrently
mutating or iterating over the collection is <em>still</em> not safe and will
likely lead to errors in your code.</td>
</tr></table>
</div>
<div class="paragraph"><p>You are generally better off using one of the classes of the
<span class="monospaced">java.util.concurrent</span> package. For example, use a <span class="monospaced">ConcurrentHashMap</span> or
<span class="monospaced">ConcurrentSkipListMap</span> if multiple threads share a map. These collections
are more efficient than a map that simply synchronizes all its methods.</p></div>
<div class="paragraph"><p>Even better, stick with immutable data structures, and you don&#8217;t have to
synchronize anything.</p></div>
</div>
<div class="sect2">
<h3 id="_parallel_collections">Parallel Collections</h3>
<div class="paragraph"><p>It is hard to write correct concurrent programs, yet concurrency is often
required nowadays to keep all processors of a computer busy. Scala offers a
particularly attractive solution for tasks that manipulate large
collections. Such tasks often parallelize naturally.</p></div>
<div class="paragraph"><p>For example, to compute the sum of all elements, multiple threads can
concurrently compute the sums of different sections; in the end, these
partial results are summed up. Of course it is troublesome to schedule
these concurrent activities manually. But, with Scala, you don’t have to.
If <span class="monospaced">coll</span> is a large collection, then</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="n">coll</span><span class="o">.</span><span class="n">par</span><span class="o">.</span><span class="n">sum</span>
</pre></div></div></div>
<div class="paragraph"><p>computes the sum concurrently. The <span class="monospaced">par</span> method produces a parallel
implementation of the collection. That implementation parallelizes the
collection methods whenever possible. For example,</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="n">coll</span><span class="o">.</span><span class="n">par</span><span class="o">.</span><span class="n">count</span><span class="o">(</span><span class="k">_</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span>
</pre></div></div></div>
<div class="paragraph"><p>counts the even numbers in <span class="monospaced">coll</span> by evaluating the predicate on
subcollections in parallel and combining the results.</p></div>
<div class="paragraph"><p>For arrays, buffers, hash tables, and balanced trees, the parallel
implementations reuse the implementation of the underlying collection,
which is very efficient.</p></div>
<div class="paragraph"><p>You can parallelize a for loop by applying <span class="monospaced">.par</span> to the collection over
which you iterate, like this:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">for</span> <span class="o">(</span><span class="n">i</span> <span class="k">&lt;-</span> <span class="o">(</span><span class="mi">0</span> <span class="n">until</span> <span class="mi">100</span><span class="o">).</span><span class="n">par</span><span class="o">)</span> <span class="n">print</span><span class="o">(</span><span class="n">i</span> <span class="o">+</span> <span class="s">&quot; &quot;</span><span class="o">)</span>
</pre></div></div></div>
<div class="paragraph"><p>Try it out in the REPL: The numbers are printed in the order they are
produced by the threads working on the task.</p></div>
<div class="paragraph"><p>In a <span class="monospaced">for/yield</span> loop, the results are assembled in order. Try this:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">for</span> <span class="o">(</span><span class="n">i</span> <span class="k">&lt;-</span> <span class="o">(</span><span class="mi">0</span> <span class="n">until</span> <span class="mi">100</span><span class="o">).</span><span class="n">par</span><span class="o">)</span> <span class="k">yield</span> <span class="n">i</span> <span class="o">+</span> <span class="s">&quot; &quot;</span>
</pre></div></div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Caution</div>
</td>
<td class="content">
<div class="paragraph"><p>If parallel computations mutate shared variables, the result is unpredictable. For example, do not update a shared counter:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">var</span> <span class="n">count</span> <span class="k">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="o">(</span><span class="n">c</span> <span class="k">&lt;-</span> <span class="n">coll</span><span class="o">.</span><span class="n">par</span><span class="o">)</span> <span class="o">{</span> <span class="k">if</span> <span class="o">(</span><span class="n">c</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span> <span class="o">}</span> <span class="c1">// Error!</span>
</pre></div></div></div>
</td>
</tr></table>
</div>
<div class="paragraph"><p>The parallel collections returned by the <span class="monospaced">par</span> method belong to types that
extend the <span class="monospaced">ParSeq</span>, <span class="monospaced">ParSet</span>, or <span class="monospaced">ParMap</span> traits, all of which are subtypes of
<span class="monospaced">ParIterable</span>.</p></div>
<div class="paragraph"><p><strong>These are not subtypes of <span class="monospaced">Iterable</span>!</strong> You cannot pass a parallel
collection to a method that expects an <span class="monospaced">Iterable</span>, <span class="monospaced">Seq</span>, <span class="monospaced">Set</span>, or <span class="monospaced">Map</span>.</p></div>
<div class="paragraph"><p>You can convert a parallel collection back to a serial one with the <span class="monospaced">ser</span>
method, or you can implement methods that take parameters of generic types
<span class="monospaced">GenIterable</span>, <span class="monospaced">GenSeq</span>, <span class="monospaced">GenSet</span>, or <span class="monospaced">GenMap</span>.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph"><p>Not all methods can be parallelized. For example, <span class="monospaced">reduceLeft</span> and
<span class="monospaced">reduceRight</span> require that each operator is applied in sequence. There is
an alternate method, <span class="monospaced">reduce</span>, that operates on parts of the collection and
combines the results. For this to work, the operator must be associative.
That is, the following must be true:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>(a op b) op c = a op (b op c).</pre>
</div></div>
<div class="paragraph"><p>(e.g., Addition is associative but subtraction is not:<br>
<span class="monospaced">(a – b) – c ≠ a – (b – c)</span>.)</p></div>
<div class="paragraph"><p>Similarly, there is a <span class="monospaced">fold</span> method that operates on parts of the
collection. Unfortunately, it is not as flexible as <span class="monospaced">foldLeft</span> or
<span class="monospaced">foldRight</span>, because <em>both</em> arguments of the operator must be elements.</p></div>
<div class="paragraph"><p>To solve this problem, there is an even more general <span class="monospaced">aggregate</span> that applies
an operator to parts of the collection, and then uses another operator to
combine the results. For example:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="n">str</span><span class="o">.</span><span class="n">par</span><span class="o">.</span><span class="n">aggregate</span><span class="o">(</span><span class="nc">Set</span><span class="o">[</span><span class="kt">Char</span><span class="o">]())(</span><span class="k">_</span> <span class="o">+</span> <span class="k">_</span><span class="o">,</span> <span class="k">_</span> <span class="o">++</span> <span class="k">_</span><span class="o">)</span>
</pre></div></div></div>
<div class="paragraph"><p>is the equivalent of</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="n">str</span><span class="o">.</span><span class="n">foldLeft</span><span class="o">(</span><span class="nc">Set</span><span class="o">[</span><span class="kt">Char</span><span class="o">]())(</span><span class="k">_</span> <span class="o">+</span> <span class="k">_</span><span class="o">)</span>
</pre></div></div></div>
<div class="paragraph"><p>forming a set of all distinct characters in str.</p></div>
</td>
</tr></table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="lesson-14-pattern-matching">Pattern Matching and Case Classes</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_lesson_objectives_14">Lesson Objectives</h3>
<div class="paragraph"><p>Scala has a powerful pattern matching mechanism that has a number of
applications: switch statements, type inquiry, and "destructuring" (getting
at the parts of complex expressions). In addition, Scala provides case
classes, which are optimized to work with pattern matching.</p></div>
</div>
<div class="sect2">
<h3 id="_summary_13">Summary</h3>
<div class="ulist"><ul>
<li>
<p>
The match expression is a better switch, without fall-through.
</p>
</li>
<li>
<p>
If no pattern matches, a <span class="monospaced">MatchError</span> is thrown. Use the <span class="monospaced">case _</span> pattern
  to avoid that.
</p>
</li>
<li>
<p>
A pattern can include an arbitrary condition, called a <em>guard</em>.
</p>
</li>
<li>
<p>
You can match on the type of an expression; prefer this over
  <span class="monospaced">isInstanceOf</span>/<span class="monospaced">asInstanceOf</span>.
</p>
</li>
<li>
<p>
You can match patterns of arrays, tuples, and case classes, and bind
  parts of the pattern to variables.
</p>
</li>
<li>
<p>
In a <span class="monospaced">for</span> expression, nonmatches are silently skipped.
</p>
</li>
<li>
<p>
A case class is a class for which the compiler automatically produces the
  methods that are needed for pattern matching.
</p>
</li>
<li>
<p>
The common superclass in a case class hierarchy should be sealed.
</p>
</li>
<li>
<p>
Use the <span class="monospaced">Option</span> type for values that may or may not be present. It&#8217;s
  safer than using <span class="monospaced">null</span>.
</p>
</li>
</ul></div>
</div>
<div class="sect2">
<h3 id="_a_better_switch">A Better Switch</h3>
<div class="paragraph"><p>Here is the equivalent of the C-style switch statement in Scala:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">var</span> <span class="n">sign</span> <span class="k">=</span> <span class="o">...</span>
<span class="k">val</span> <span class="n">ch</span><span class="k">:</span> <span class="kt">Char</span> <span class="o">=</span> <span class="o">...</span>

<span class="n">ch</span> <span class="k">match</span> <span class="o">{</span>
  <span class="k">case</span> <span class="sc">&#39;+&#39;</span> <span class="k">=&gt;</span> <span class="n">sign</span> <span class="k">=</span> <span class="mi">1</span>
  <span class="k">case</span> <span class="sc">&#39;-&#39;</span> <span class="k">=&gt;</span> <span class="n">sign</span> <span class="k">=</span> <span class="o">-</span><span class="mi">1</span>
  <span class="k">case</span> <span class="k">_</span>   <span class="k">=&gt;</span> <span class="n">sign</span> <span class="k">=</span> <span class="mi">0</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>The equivalent of <span class="monospaced">default</span> is the catch-all <span class="monospaced">case _</span> pattern. It is a good
idea to have such a catch-all pattern. If no pattern matches, a <span class="monospaced">MatchError</span>
is thrown.</p></div>
<div class="paragraph"><p>Unlike the <span class="monospaced">switch</span> statement, Scala pattern matching does not suffer from
the "fall-through" problem. (In C and its derivatives, you must use
explicit <span class="monospaced">break</span> statements to exit a switch at the end of each branch, or
you will fall through to the next branch. This is annoying and
error-prone.)</p></div>
<div class="paragraph"><p>Similar to <span class="monospaced">if</span>, <span class="monospaced">match</span> is an expression, not a statement. The preceding
code can be simplified to</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">val</span> <span class="n">sign</span> <span class="k">=</span> <span class="n">ch</span> <span class="k">match</span> <span class="o">{</span>
  <span class="k">case</span> <span class="sc">&#39;+&#39;</span> <span class="k">=&gt;</span> <span class="mi">1</span>
  <span class="k">case</span> <span class="sc">&#39;-&#39;</span> <span class="k">=&gt;</span> <span class="o">-</span><span class="mi">1</span>
  <span class="k">case</span> <span class="k">_</span>   <span class="k">=&gt;</span> <span class="mi">0</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>You can use the <span class="monospaced">match</span> statement with any types, not just numbers. For
example:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="n">color</span> <span class="k">match</span> <span class="o">{</span>
  <span class="k">case</span> <span class="nc">Color</span><span class="o">.</span><span class="nc">RED</span> <span class="k">=&gt;</span> <span class="o">...</span>
  <span class="k">case</span> <span class="nc">Color</span><span class="o">.</span><span class="nc">BLACK</span> <span class="k">=&gt;</span> <span class="o">...</span>
  <span class="o">...</span>
<span class="o">}</span>
</pre></div></div></div>
</div>
<div class="sect2">
<h3 id="_guards">Guards</h3>
<div class="paragraph"><p>Suppose we want to extend our example to match all digits. In a C-style
<span class="monospaced">switch</span> statement, you would simply add multiple case labels:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">switch</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">case</span> <span class="sc">&#39;0&#39;</span><span class="o">:</span>
  <span class="k">case</span> <span class="sc">&#39;1&#39;</span><span class="o">:</span>
  <span class="p">...</span>
  <span class="k">case</span> <span class="sc">&#39;9&#39;</span><span class="o">:</span>
  <span class="p">...</span>
<span class="p">}</span>
</pre></div></div></div>
<div class="paragraph"><p>(Except that, of course, you can’t use &#8230; but must write out all ten cases
explicitly.) In Scala, you add a guard clause to a pattern, like this:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="n">ch</span> <span class="k">match</span> <span class="o">{</span>
  <span class="k">case</span> <span class="sc">&#39;+&#39;</span> <span class="k">=&gt;</span> <span class="n">sign</span> <span class="k">=</span> <span class="mi">1</span>
  <span class="k">case</span> <span class="sc">&#39;-&#39;</span> <span class="k">=&gt;</span> <span class="n">sign</span> <span class="k">=</span> <span class="o">-</span><span class="mi">1</span>
  <span class="k">case</span> <span class="k">_</span> <span class="k">if</span> <span class="nc">Character</span><span class="o">.</span><span class="n">isDigit</span><span class="o">(</span><span class="n">ch</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="n">digit</span> <span class="k">=</span> <span class="nc">Character</span><span class="o">.</span><span class="n">digit</span><span class="o">(</span><span class="n">ch</span><span class="o">,</span> <span class="mi">10</span><span class="o">)</span>
  <span class="k">case</span> <span class="k">_</span> <span class="k">=&gt;</span> <span class="n">sign</span> <span class="k">=</span> <span class="mi">0</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>The guard clause can be any Boolean condition.</p></div>
<div class="paragraph"><p>Note that patterns are always matched top-to-bottom. If the pattern with
the guard clause doesn’t match, the catch-all pattern is attempted.</p></div>
</div>
<div class="sect2">
<h3 id="_variables_in_patterns">Variables in Patterns</h3>
<div class="paragraph"><p>If the <span class="monospaced">case</span> keyword is followed by a variable name, then the match
expression is assigned to that variable. For example:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="n">str</span><span class="o">(</span><span class="n">i</span><span class="o">)</span> <span class="k">match</span> <span class="o">{</span>
  <span class="k">case</span> <span class="sc">&#39;+&#39;</span> <span class="k">=&gt;</span> <span class="n">sign</span> <span class="k">=</span> <span class="mi">1</span>
  <span class="k">case</span> <span class="sc">&#39;-&#39;</span> <span class="k">=&gt;</span> <span class="n">sign</span> <span class="k">=</span> <span class="o">-</span><span class="mi">1</span>
  <span class="k">case</span> <span class="n">ch</span>  <span class="k">=&gt;</span> <span class="n">digit</span> <span class="k">=</span> <span class="nc">Character</span><span class="o">.</span><span class="n">digit</span><span class="o">(</span><span class="n">ch</span><span class="o">,</span> <span class="mi">10</span><span class="o">)</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>You can think of <span class="monospaced">case _</span> as a special case of this feature, where the
variable name is <span class="monospaced">_</span>.</p></div>
<div class="paragraph"><p>You can use the variable name in a guard:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="n">str</span><span class="o">(</span><span class="n">i</span><span class="o">)</span> <span class="k">match</span> <span class="o">{</span>
  <span class="k">case</span> <span class="n">ch</span> <span class="k">if</span> <span class="nc">Character</span><span class="o">.</span><span class="n">isDigit</span><span class="o">(</span><span class="n">ch</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="n">digit</span> <span class="k">=</span> <span class="nc">Character</span><span class="o">.</span><span class="n">digit</span><span class="o">(</span><span class="n">ch</span><span class="o">,</span> <span class="mi">10</span><span class="o">)</span>
  <span class="o">...</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Caution</div>
</td>
<td class="content">
<div class="paragraph"><p>Unfortunately, variable patterns can conflict with constant expressions:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">import</span> <span class="nn">scala.math._</span>
<span class="n">x</span> <span class="k">match</span> <span class="o">{</span>
  <span class="k">case</span> <span class="nc">Pi</span> <span class="k">=&gt;</span> <span class="o">...</span>
  <span class="o">...</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>How does Scala know that <span class="monospaced">Pi</span> is a constant, not a variable? The rule is
that a variable must start with a lowercase letter.</p></div>
<div class="paragraph"><p>If you have a lowercase constant, enclose it in backquotes:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">import</span> <span class="nn">java.io.File._</span>
<span class="n">str</span> <span class="k">match</span> <span class="o">{</span>
  <span class="k">case</span> <span class="n">`pathSeparator`</span> <span class="k">=&gt;</span> <span class="o">...</span>
  <span class="o">...</span>
<span class="o">}</span>
</pre></div></div></div>
</td>
</tr></table>
</div>
</div>
<div class="sect2">
<h3 id="_type_patterns">Type Patterns</h3>
<div class="paragraph"><p>You can match on the type of an expression, for example:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="n">obj</span> <span class="k">match</span> <span class="o">{</span>
  <span class="k">case</span> <span class="n">x</span><span class="k">:</span> <span class="kt">Int</span> <span class="o">=&gt;</span> <span class="n">x</span>
  <span class="k">case</span> <span class="n">s</span><span class="k">:</span> <span class="kt">String</span> <span class="o">=&gt;</span> <span class="nc">Integer</span><span class="o">.</span><span class="n">parseInt</span><span class="o">(</span><span class="n">s</span><span class="o">)</span>
  <span class="k">case</span> <span class="k">_:</span> <span class="kt">BigInt</span> <span class="o">=&gt;</span> <span class="nc">Int</span><span class="o">.</span><span class="nc">MaxValue</span>
  <span class="k">case</span> <span class="k">_</span> <span class="k">=&gt;</span> <span class="mi">0</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>In Scala, this form is preferred over using the <span class="monospaced">isInstanceOf</span> operator.</p></div>
<div class="paragraph"><p>Note the variable names in the patterns. In the first pattern, the match is
bound to <span class="monospaced">x</span> as an <span class="monospaced">Int</span>, and in the second pattern, it is bound to <span class="monospaced">s</span> as a
<span class="monospaced">String</span>. No <span class="monospaced">asInstanceOf</span> casts are needed!</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Caution</div>
</td>
<td class="content">
<div class="paragraph"><p>When you match against a type, you <em>must</em> supply a variable name.
Otherwise, you match the object:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="n">obj</span> <span class="k">match</span> <span class="o">{</span>
  <span class="k">case</span> <span class="k">_:</span> <span class="kt">BigInt</span> <span class="o">=&gt;</span> <span class="nc">Int</span><span class="o">.</span><span class="nc">MaxValue</span> <span class="c1">// Matches any object of type BigInt</span>
  <span class="k">case</span> <span class="nc">BigInt</span>    <span class="k">=&gt;</span> <span class="o">-</span><span class="mi">1</span>           <span class="c1">// Matches the BigInt object of type Class</span>
<span class="o">}</span>
</pre></div></div></div>
</td>
</tr></table>
</div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Caution</div>
</td>
<td class="content">
<div class="paragraph"><p>Matches occur at runtime, and generic types are erased in the Java virtual
machine. For that reason, you cannot make a type match for a specific <span class="monospaced">Map</span>
type.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">case</span> <span class="n">m</span><span class="k">:</span> <span class="kt">Map</span><span class="o">[</span><span class="kt">String</span>, <span class="kt">Int</span><span class="o">]</span> <span class="k">=&gt;</span> <span class="o">...</span> <span class="c1">// Don&#39;t do this.</span>
</pre></div></div></div>
<div class="paragraph"><p>You can match a generic map:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">case</span> <span class="n">m</span><span class="k">:</span> <span class="kt">Map</span><span class="o">[</span><span class="k">_</span>, <span class="k">_</span><span class="o">]</span> <span class="k">=&gt;</span> <span class="o">...</span> <span class="c1">// OK</span>
</pre></div></div></div>
<div class="paragraph"><p>However, arrays are not erased. You can match an <span class="monospaced">Array[Int]</span>.</p></div>
</td>
</tr></table>
</div>
</div>
<div class="sect2">
<h3 id="_matching_arrays_lists_and_tuples">Matching Arrays, Lists, and Tuples</h3>
<div class="paragraph"><p>To match an array against its contents, use <span class="monospaced">Array</span> expressions in the
patterns, like this:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="n">arr</span> <span class="k">match</span> <span class="o">{</span>
  <span class="k">case</span> <span class="nc">Array</span><span class="o">(</span><span class="mi">0</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="s">&quot;0&quot;</span>
  <span class="k">case</span> <span class="nc">Array</span><span class="o">(</span><span class="n">x</span><span class="o">,</span> <span class="n">y</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="n">x</span> <span class="o">+</span> <span class="s">&quot; &quot;</span> <span class="o">+</span> <span class="n">y</span>
  <span class="k">case</span> <span class="nc">Array</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="k">_</span><span class="o">*)</span> <span class="k">=&gt;</span> <span class="s">&quot;0 ...&quot;</span>
  <span class="k">case</span> <span class="k">_</span> <span class="k">=&gt;</span> <span class="s">&quot;something else&quot;</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>The first pattern matches the array containing 0. The second pattern
matches any array with two elements, and it binds the variables <span class="monospaced">x</span> and <span class="monospaced">y</span>
to the elements. The third pattern matches any array starting with zero.</p></div>
<div class="paragraph"><p>You can match lists in the same way, with <span class="monospaced">List</span> expressions. Alternatively,
you can use the <span class="monospaced">::</span> operator:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="n">lst</span> <span class="k">match</span> <span class="o">{</span>
  <span class="k">case</span> <span class="mi">0</span> <span class="o">::</span> <span class="nc">Nil</span> <span class="k">=&gt;</span> <span class="s">&quot;0&quot;</span>
  <span class="k">case</span> <span class="n">x</span> <span class="o">::</span> <span class="n">y</span> <span class="o">::</span> <span class="nc">Nil</span> <span class="k">=&gt;</span> <span class="n">x</span> <span class="o">+</span> <span class="s">&quot; &quot;</span> <span class="o">+</span> <span class="n">y</span>
  <span class="k">case</span> <span class="mi">0</span> <span class="o">::</span> <span class="n">tail</span> <span class="k">=&gt;</span> <span class="s">&quot;0 ...&quot;</span>
  <span class="k">case</span> <span class="k">_</span> <span class="k">=&gt;</span> <span class="s">&quot;something else&quot;</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>With tuples, use the tuple notation in the pattern:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="n">pair</span> <span class="k">match</span> <span class="o">{</span>
  <span class="k">case</span> <span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="k">_</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="s">&quot;0 ...&quot;</span>
  <span class="k">case</span> <span class="o">(</span><span class="n">y</span><span class="o">,</span> <span class="mi">0</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="n">y</span> <span class="o">+</span> <span class="s">&quot; 0&quot;</span>
  <span class="k">case</span> <span class="k">_</span> <span class="k">=&gt;</span> <span class="s">&quot;neither is 0&quot;</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>Again, note how the variables are bound to parts of the list or tuple.
Since these bindings give you easy access to parts of a complex structure,
this operation is called <em>destructuring</em>.</p></div>
</div>
<div class="sect2">
<h3 id="_extractors_2">Extractors</h3>
<div class="paragraph"><p>In the preceding section, you have seen how patterns can match arrays,
lists, and tuples. These capabilities are provided by extractors: objects
with an <span class="monospaced">unapply</span> or <span class="monospaced">unapplySeq</span> method that extract values from an
object.</p></div>
<div class="paragraph"><p>(We talked about extractors earlier.) The <span class="monospaced">unapply</span> method is provided to
extract a fixed number of objects, while <span class="monospaced">unapplySeq</span> extracts a sequence
whose length can vary.</p></div>
<div class="paragraph"><p>For example, consider the expression:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="n">arr</span> <span class="k">match</span> <span class="o">{</span>
  <span class="k">case</span> <span class="nc">Array</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="n">x</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="o">...</span>
  <span class="o">...</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>The <span class="monospaced">Array</span> companion object is an extractor: It defines an <span class="monospaced">unapplySeq</span>
method. That method is called with the <em>expression that is being matched</em>,
not with what appears to be the parameters in the pattern.</p></div>
<div class="paragraph"><p><span class="monospaced">Array.unapplySeq(arr)</span> yields a sequence of values, namely the values in
the array. The first value is compared with zero, and the second one is
assigned to <span class="monospaced">x</span>.</p></div>
<div class="sect3">
<h4 id="_regular_expression_as_extractors">Regular Expression as Extractors</h4>
<div class="paragraph"><p>Regular expressions provide another good use of extractors. When a regular
expression has groups, you can match each group with an extractor pattern.
For example:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">val</span> <span class="n">pattern</span> <span class="k">=</span> <span class="s">&quot;([0-9]+) ([a-z]+)&quot;</span><span class="o">.</span><span class="n">r</span>
<span class="s">&quot;99 bottles&quot;</span> <span class="k">match</span> <span class="o">{</span>
  <span class="k">case</span> <span class="n">pattern</span><span class="o">(</span><span class="n">num</span><span class="o">,</span> <span class="n">item</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="o">...</span>
    <span class="c1">// Sets num to &quot;99&quot;, item to &quot;bottles&quot;</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>The call <span class="monospaced">pattern.unapplySeq("99 bottles")</span> yields a sequence of strings
that match the groups. These are assigned to the variables <span class="monospaced">num</span> and
<span class="monospaced">item</span>.</p></div>
<div class="paragraph"><p>Note that here the extractor isn’t a companion object but an instantiated
regular expression object.</p></div>
</div>
</div>
<div class="sect2">
<h3 id="_patterns_in_variable_declarations">Patterns in Variable Declarations</h3>
<div class="paragraph"><p>In the preceding sections, you have seen how patterns can contain
variables. You can use these patterns inside variable declarations. For
example,</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">val</span> <span class="o">(</span><span class="n">x</span><span class="o">,</span> <span class="n">y</span><span class="o">)</span> <span class="k">=</span> <span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">)</span>
</pre></div></div></div>
<div class="paragraph"><p>simultaneously defines <span class="monospaced">x</span> as <span class="monospaced">1</span> and <span class="monospaced">y</span> as <span class="monospaced">2</span>. That is useful for
functions that return a pair:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">val</span> <span class="o">(</span><span class="n">q</span><span class="o">,</span> <span class="n">r</span><span class="o">)</span> <span class="k">=</span> <span class="nc">BigInt</span><span class="o">(</span><span class="mi">10</span><span class="o">)</span> <span class="o">/%</span> <span class="mi">3</span>
</pre></div></div></div>
<div class="paragraph"><p>The <span class="monospaced">/%</span> method returns a pair containing the quotient and the remainder,
which are captured in the variables <span class="monospaced">q</span> and <span class="monospaced">r</span>.</p></div>
<div class="paragraph"><p>The same syntax works for any patterns with variable names:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">val</span> <span class="nc">Array</span><span class="o">(</span><span class="n">first</span><span class="o">,</span> <span class="n">second</span><span class="o">,</span> <span class="k">_</span><span class="o">*)</span> <span class="k">=</span> <span class="n">arr</span>
</pre></div></div></div>
<div class="paragraph"><p>assigns the first and second element of the array <span class="monospaced">arr</span> to the variables
<span class="monospaced">first</span> and <span class="monospaced">second</span>.</p></div>
</div>
<div class="sect2">
<h3 id="_patterns_in_span_class_monospaced_for_span_expressions">Patterns in <span class="monospaced">for</span> Expressions</h3>
<div class="paragraph"><p>You can use patterns with variables in for comprehensions. For each
traversed value, the variables are bound. This makes it possible to
traverse a map:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">import</span> <span class="nn">scala.collection.JavaConversions.propertiesAsScalaMap</span>
<span class="c1">// Converts Java Properties to a Scala map—just to get an interesting example</span>
<span class="k">for</span> <span class="o">((</span><span class="n">k</span><span class="o">,</span> <span class="n">v</span><span class="o">)</span> <span class="k">&lt;-</span> <span class="nc">System</span><span class="o">.</span><span class="n">getProperties</span><span class="o">())</span>
  <span class="n">println</span><span class="o">(</span><span class="n">k</span> <span class="o">+</span> <span class="s">&quot; -&gt; &quot;</span> <span class="o">+</span> <span class="n">v</span><span class="o">)</span>
</pre></div></div></div>
<div class="paragraph"><p>For each <span class="monospaced">(key, value)</span> pair in the map, <span class="monospaced">k</span> is bound to the key and <span class="monospaced">v</span> to
the value.</p></div>
<div class="paragraph"><p>In a <span class="monospaced">for</span> comprehension, match failures are silently ignored. For example,
the following loop prints all keys with empty value, skipping over all
others:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">for</span> <span class="o">((</span><span class="n">k</span><span class="o">,</span> <span class="s">&quot;&quot;</span><span class="o">)</span> <span class="k">&lt;-</span> <span class="nc">System</span><span class="o">.</span><span class="n">getProperties</span><span class="o">())</span>
  <span class="n">println</span><span class="o">(</span><span class="n">k</span><span class="o">)</span>
</pre></div></div></div>
<div class="paragraph"><p>You can also use a guard. Note that the <span class="monospaced">if</span> goes after the &#8592; symbol:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">for</span> <span class="o">((</span><span class="n">k</span><span class="o">,</span> <span class="n">v</span><span class="o">)</span> <span class="k">&lt;-</span> <span class="nc">System</span><span class="o">.</span><span class="n">getProperties</span><span class="o">()</span> <span class="k">if</span> <span class="n">v</span> <span class="o">==</span> <span class="s">&quot;&quot;</span><span class="o">)</span>
  <span class="n">println</span><span class="o">(</span><span class="n">k</span><span class="o">)</span>
</pre></div></div></div>
</div>
<div class="sect2">
<h3 id="_lab_pattern_matching_1">Lab: Pattern Matching 1</h3>
<div class="paragraph"><p>Open <span class="monospaced">labs/src/main/scala/com/newcircle/patterns/PatternMatch1.scala</span>. Let&#8217;s
take a look at it for a moment:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">package</span> <span class="nn">com.newcircle.patterns</span>

<span class="k">import</span> <span class="nn">scala.reflect.ClassTag</span>

<span class="c1">// The Manifest bit is Scala reflection &quot;magic&quot;, allowing type information</span>
<span class="c1">// that Java normally erases to be accessed at runtime. Don&#39;t worry about it</span>
<span class="c1">// right now. We&#39;ll see more of it shortly.</span>
<span class="k">object</span> <span class="nc">PatternMatch1</span> <span class="o">{</span>

  <span class="k">def</span> <span class="n">swapFirstTwo</span><span class="o">[</span><span class="kt">T:</span> <span class="kt">Manifest</span><span class="o">](</span><span class="n">a</span><span class="k">:</span> <span class="kt">Array</span><span class="o">[</span><span class="kt">T</span><span class="o">])</span><span class="k">:</span> <span class="kt">Array</span><span class="o">[</span><span class="kt">T</span><span class="o">]</span> <span class="k">=</span> <span class="o">{</span>
    <span class="n">a</span> <span class="c1">// replace with actual implementation</span>
  <span class="o">}</span>

<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>Using pattern matching, implement the <span class="monospaced">swapFirstTwo</span> function. It must:</p></div>
<div class="ulist"><ul>
<li>
<p>
work for an empty array
</p>
</li>
<li>
<p>
work for a 1-element array
</p>
</li>
<li>
<p>
work for a 2-element array
</p>
</li>
<li>
<p>
work for an <em>n</em>-element array
</p>
</li>
<li>
<p>
work for arrays of any type
</p>
</li>
</ul></div>
<div class="paragraph"><p>To test your solution, run this tester in SBT:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>&gt; test-only com.newcircle.tests.patterns.PatternMatch1Spec</pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_case_classes">Case Classes</h3>
<div class="paragraph"><p>Case classes are a special kind of classes that are optimized for use in
pattern matching (though they have other benefits, as well). In this
example, we have two case classes that extend a regular (noncase) class:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">abstract</span> <span class="k">class</span> <span class="nc">Amount</span>
<span class="k">case</span> <span class="k">class</span> <span class="nc">Dollar</span><span class="o">(</span><span class="n">value</span><span class="k">:</span> <span class="kt">Double</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">Amount</span>
<span class="k">case</span> <span class="k">class</span> <span class="nc">Currency</span><span class="o">(</span><span class="n">value</span><span class="k">:</span> <span class="kt">Double</span><span class="o">,</span> <span class="n">unit</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">Amount</span>
</pre></div></div></div>
<div class="paragraph"><p>You can also have case objects for singletons:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">case</span> <span class="k">object</span> <span class="nc">NoAmount</span> <span class="k">extends</span> <span class="nc">Amount</span>
</pre></div></div></div>
<div class="paragraph"><p>When we have an object of type <span class="monospaced">Amount</span>, we can use pattern matching to
match the <span class="monospaced">amount</span> type and bind the property values to variables:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="n">amt</span> <span class="k">match</span> <span class="o">{</span>
  <span class="k">case</span> <span class="nc">Dollar</span><span class="o">(</span><span class="n">v</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="s">&quot;$&quot;</span> <span class="o">+</span> <span class="n">v</span>
  <span class="k">case</span> <span class="nc">Currency</span><span class="o">(</span><span class="k">_</span><span class="o">,</span> <span class="n">u</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="s">&quot;Oh noes, I got &quot;</span> <span class="o">+</span> <span class="n">u</span>
  <span class="k">case</span> <span class="nc">NoAmount</span> <span class="k">=&gt;</span> <span class="s">&quot;&quot;</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">Use <span class="monospaced">()</span> with case class instances, no parentheses with case objects.</td>
</tr></table>
</div>
<div class="paragraph"><p>When you declare a case class, several things happen automatically.</p></div>
<div class="ulist"><ul>
<li>
<p>
Each of the constructor parameters becomes a <span class="monospaced">val</span> unless it is explicitly
  declared as a <span class="monospaced">var</span> (which is not recommended).
</p>
</li>
<li>
<p>
Scala automatically generates a companion object with an <span class="monospaced">apply</span> method
  that lets you construct objects without new, such as <span class="monospaced">Dollar(29.95)</span> or
  <span class="monospaced">Currency(29.95, "EUR")</span>.
</p>
</li>
<li>
<p>
Scala also generates an <span class="monospaced">unapply</span> method, making pattern matching work.
  (You don’t really need to know these details to use case classes for
  pattern matching.)
</p>
</li>
<li>
<p>
Methods <span class="monospaced">toString</span>, <span class="monospaced">equals</span>, <span class="monospaced">hashCode</span>, and <span class="monospaced">copy</span> are generated unless
  they are explicitly provided.
</p>
</li>
</ul></div>
<div class="paragraph"><p>Otherwise, case classes are just like any other classes. You can add
methods and fields to them, extend them, and so on.</p></div>
</div>
<div class="sect2">
<h3 id="_the_copy_method_and_named_parameters">The copy Method and Named Parameters</h3>
<div class="paragraph"><p>The <span class="monospaced">copy</span> method of a case class makes a new object with the same values
as an existing one. For example,</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">val</span> <span class="n">amt</span> <span class="k">=</span> <span class="nc">Currency</span><span class="o">(</span><span class="mf">29.95</span><span class="o">,</span> <span class="s">&quot;EUR&quot;</span><span class="o">)</span>
<span class="k">val</span> <span class="n">price</span> <span class="k">=</span> <span class="n">amt</span><span class="o">.</span><span class="n">copy</span><span class="o">()</span> <span class="c1">// a clone</span>
</pre></div></div></div>
<div class="paragraph"><p>By itself, that isn’t very useful. After all, a <span class="monospaced">Currency</span> object is
immutable, and one can just share the object reference. However, you can
use named parameters to modify some of the properties:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">val</span> <span class="n">price</span> <span class="k">=</span> <span class="n">amt</span><span class="o">.</span><span class="n">copy</span><span class="o">(</span><span class="n">value</span> <span class="k">=</span> <span class="mf">19.95</span><span class="o">)</span> <span class="c1">// Currency(19.95, &quot;EUR&quot;)</span>
</pre></div></div></div>
<div class="paragraph"><p>or</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">val</span> <span class="n">price</span> <span class="k">=</span> <span class="n">amt</span><span class="o">.</span><span class="n">copy</span><span class="o">(</span><span class="n">unit</span> <span class="k">=</span> <span class="s">&quot;CHF&quot;</span><span class="o">)</span> <span class="c1">// Currency(29.95, &quot;CHF&quot;)</span>
</pre></div></div></div>
</div>
<div class="sect2">
<h3 id="_infix_notation_in_case_clauses">Infix Notation in case Clauses</h3>
<div class="paragraph"><p>When an <span class="monospaced">unapply</span> method yields a pair, you can use infix notation in the
<span class="monospaced">case</span> clause. In particular, you can use infix notation with a case class
that has two parameters. For example:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="n">amt</span> <span class="k">match</span> <span class="o">{</span>
  <span class="k">case</span> <span class="n">a</span> <span class="nc">Currency</span> <span class="n">u</span> <span class="k">=&gt;</span> <span class="o">...</span>
<span class="o">}</span>
<span class="c1">// Same as case Currency(a, u)</span>
</pre></div></div></div>
<div class="paragraph"><p>Of course, that is a silly (and not very readable) example.</p></div>
<div class="paragraph"><p>The feature is meant for matching sequences. For example, every <span class="monospaced">List</span> object
is either <span class="monospaced">Nil</span> or an object of the case class <span class="monospaced">::</span>, defined as</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">case</span> <span class="k">class</span> <span class="nc">::</span><span class="o">[</span><span class="kt">E</span><span class="o">](</span><span class="n">head</span><span class="k">:</span> <span class="kt">B</span><span class="o">,</span> <span class="n">tail</span><span class="k">:</span> <span class="kt">List</span><span class="o">[</span><span class="kt">E</span><span class="o">])</span> <span class="k">extends</span> <span class="nc">List</span><span class="o">[</span><span class="kt">E</span><span class="o">]</span>
</pre></div></div></div>
<div class="paragraph"><p>Therefore, you can write</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="n">lst</span> <span class="k">match</span> <span class="o">{</span> <span class="k">case</span> <span class="n">h</span> <span class="o">::</span> <span class="n">t</span> <span class="k">=&gt;</span> <span class="o">...</span> <span class="o">}</span>
<span class="c1">// Same as case ::(h, t), which calls ::.unapply(lst)</span>
</pre></div></div></div>
<div class="paragraph"><p>These infix expressions are easier to read when you have more than one. For
example,</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="n">result</span> <span class="k">match</span> <span class="o">{</span> <span class="k">case</span> <span class="n">first</span> <span class="o">::</span> <span class="n">second</span> <span class="o">::</span> <span class="n">rest</span> <span class="k">=&gt;</span> <span class="o">...</span> <span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>is nicer than <span class="monospaced">case ::(first, ::(second, rest))</span></p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">Remember, if the operator ends in a colon, then it associates
right-to-left.</td>
</tr></table>
</div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph"><p>Infix notation works with any <span class="monospaced">unapply</span> method that returns a pair. Here is
an example:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">case</span> <span class="k">object</span> <span class="nc">+:</span> <span class="o">{</span>
  <span class="k">def</span> <span class="n">unapply</span><span class="o">[</span><span class="kt">T</span><span class="o">](</span><span class="n">input</span><span class="k">:</span> <span class="kt">List</span><span class="o">[</span><span class="kt">T</span><span class="o">])</span> <span class="k">=</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">input</span><span class="o">.</span><span class="n">isEmpty</span><span class="o">)</span> <span class="nc">None</span> <span class="k">else</span> <span class="nc">Some</span><span class="o">((</span><span class="n">input</span><span class="o">.</span><span class="n">head</span><span class="o">,</span> <span class="n">input</span><span class="o">.</span><span class="n">tail</span><span class="o">))</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>Now you can destructure lists using <span class="monospaced">+:</span>.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="mi">1</span> <span class="o">+:</span> <span class="mi">7</span> <span class="o">+:</span> <span class="mi">2</span> <span class="o">+:</span> <span class="mi">9</span> <span class="o">+:</span> <span class="nc">Nil</span> <span class="k">match</span> <span class="o">{</span>
  <span class="k">case</span> <span class="n">first</span> <span class="o">+:</span> <span class="n">second</span> <span class="o">+:</span> <span class="n">rest</span> <span class="k">=&gt;</span> <span class="n">first</span> <span class="o">+</span> <span class="n">second</span> <span class="o">+</span> <span class="n">rest</span><span class="o">.</span><span class="n">length</span>
<span class="o">}</span>
</pre></div></div></div>
</td>
</tr></table>
</div>
</div>
<div class="sect2">
<h3 id="_matching_nested_structures">Matching Nested Structures</h3>
<div class="paragraph"><p>Case classes are often used for nested structures. Consider, for example,
items that a store sells. Sometimes, we bundle items together for a
discount.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">abstract</span> <span class="k">class</span> <span class="nc">Item</span>
<span class="k">case</span> <span class="k">class</span> <span class="nc">Article</span><span class="o">(</span><span class="n">description</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">price</span><span class="k">:</span> <span class="kt">Double</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">Item</span>
<span class="k">case</span> <span class="k">class</span> <span class="nc">Bundle</span><span class="o">(</span><span class="n">description</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">discount</span><span class="k">:</span> <span class="kt">Double</span><span class="o">,</span> <span class="n">items</span><span class="k">:</span> <span class="kt">Item*</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">Item</span>
</pre></div></div></div>
<div class="paragraph"><p>Not having to use <span class="monospaced">new</span> makes it easy to specify nested objects:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="nc">Bundle</span><span class="o">(</span><span class="s">&quot;Father&#39;s day special&quot;</span><span class="o">,</span> <span class="mf">20.0</span><span class="o">,</span>
  <span class="nc">Article</span><span class="o">(</span><span class="s">&quot;Scala for the Impatient&quot;</span><span class="o">,</span> <span class="mf">39.95</span><span class="o">),</span>
  <span class="nc">Bundle</span><span class="o">(</span><span class="s">&quot;Anchor Distillery Sampler&quot;</span><span class="o">,</span> <span class="mf">10.0</span><span class="o">,</span>
    <span class="nc">Article</span><span class="o">(</span><span class="s">&quot;Old Potrero Straight Rye Whiskey&quot;</span><span class="o">,</span> <span class="mf">79.95</span><span class="o">),</span>
    <span class="nc">Article</span><span class="o">(</span><span class="s">&quot;Junípero Gin&quot;</span><span class="o">,</span> <span class="mf">32.95</span><span class="o">)))</span>
</pre></div></div></div>
<div class="paragraph"><p>Patterns can match specific nestings. For instance:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">case</span> <span class="nc">Bundle</span><span class="o">(</span><span class="k">_</span><span class="o">,</span> <span class="k">_</span><span class="o">,</span> <span class="nc">Article</span><span class="o">(</span><span class="n">descr</span><span class="o">,</span> <span class="k">_</span><span class="o">),</span> <span class="k">_</span><span class="o">*)</span> <span class="k">=&gt;</span> <span class="o">...</span>
</pre></div></div></div>
<div class="paragraph"><p>binds <span class="monospaced">descr</span> to the description of the first article in a bundle.</p></div>
<div class="paragraph"><p>You can bind a nested value to a variable with the <span class="monospaced">@</span> notation:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">case</span> <span class="nc">Bundle</span><span class="o">(</span><span class="k">_</span><span class="o">,</span> <span class="k">_</span><span class="o">,</span> <span class="n">art</span> <span class="k">@</span> <span class="nc">Article</span><span class="o">(</span><span class="k">_</span><span class="o">,</span> <span class="k">_</span><span class="o">),</span> <span class="n">rest</span> <span class="k">@</span> <span class="k">_</span><span class="o">*)</span> <span class="k">=&gt;</span> <span class="o">...</span>
</pre></div></div></div>
<div class="paragraph"><p>Now <span class="monospaced">art</span> is the first article in a bundle and <span class="monospaced">rest</span> is the sequence of the
other items.</p></div>
<div class="paragraph"><p>Note that the <span class="monospaced">_*</span> is required in this example. The pattern</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">case</span> <span class="nc">Bundle</span><span class="o">(</span><span class="k">_</span><span class="o">,</span> <span class="k">_</span><span class="o">,</span> <span class="n">art</span> <span class="k">@</span> <span class="nc">Article</span><span class="o">(</span><span class="k">_</span><span class="o">,</span> <span class="k">_</span><span class="o">),</span> <span class="n">rest</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="o">...</span>
</pre></div></div></div>
<div class="paragraph"><p>would match a bundle with an article and exactly one additional item, bound
to <span class="monospaced">rest</span>.</p></div>
<div class="paragraph"><p>Here is a more concrete example, a function that computes the price of an
item:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">def</span> <span class="n">price</span><span class="o">(</span><span class="n">it</span><span class="k">:</span> <span class="kt">Item</span><span class="o">)</span><span class="k">:</span> <span class="kt">Double</span> <span class="o">=</span> <span class="n">it</span> <span class="k">match</span> <span class="o">{</span>
  <span class="k">case</span> <span class="nc">Article</span><span class="o">(</span><span class="k">_</span><span class="o">,</span> <span class="n">p</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="n">p</span>
  <span class="k">case</span> <span class="nc">Bundle</span><span class="o">(</span><span class="k">_</span><span class="o">,</span> <span class="n">disc</span><span class="o">,</span> <span class="n">its</span> <span class="k">@</span> <span class="k">_</span><span class="o">*)</span> <span class="k">=&gt;</span> <span class="n">its</span><span class="o">.</span><span class="n">map</span><span class="o">(</span><span class="n">price</span> <span class="k">_</span><span class="o">).</span><span class="n">sum</span> <span class="o">-</span> <span class="n">disc</span>
<span class="o">}</span>
</pre></div></div></div>
</div>
<div class="sect2">
<h3 id="_are_case_classes_evil">Are Case Classes Evil?</h3>
<div class="paragraph"><p>The example in the preceding section can enrage OO purists.</p></div>
<div class="ulist"><ul>
<li>
<p>
Shouldn’t price be a method of the superclass?
</p>
</li>
<li>
<p>
Shouldn’t each subclass override it?
</p>
</li>
<li>
<p>
Isn’t polymorphism better than making a switch on each type?
</p>
</li>
</ul></div>
<div class="paragraph"><p>In many situations, yes. If someone comes up with another kind of <span class="monospaced">Item</span>,
one needs to revisit all those match clauses. In such a situation, case
classes are not the right solution.</p></div>
<div class="paragraph"><p>Case classes work well for structures whose makeup doesn’t change. For
example, the Scala <span class="monospaced">List</span> is implemented with case classes. Simplifying
things a bit, a list is essentially</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">abstract</span> <span class="k">class</span> <span class="nc">List</span>
<span class="k">case</span> <span class="k">object</span> <span class="nc">Nil</span> <span class="k">extends</span> <span class="nc">List</span>
<span class="k">case</span> <span class="k">class</span> <span class="nc">::</span><span class="o">(</span><span class="n">head</span><span class="k">:</span> <span class="kt">Any</span><span class="o">,</span> <span class="n">tail</span><span class="k">:</span> <span class="kt">List</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">List</span>
</pre></div></div></div>
<div class="paragraph"><p>A list is either empty, or it has a head and a tail (which may be empty or
not). Nobody is ever going to add a third case.</p></div>
<div class="paragraph"><p>When they are appropriate, case classes are quite convenient, for the
following reasons:</p></div>
<div class="ulist"><ul>
<li>
<p>
Pattern matching often leads to more concise code than inheritance.
</p>
</li>
<li>
<p>
It is easier to read compound objects that are constructed without new.
</p>
</li>
<li>
<p>
You get <span class="monospaced">toString</span>, <span class="monospaced">equals</span>, <span class="monospaced">hashCode</span>, and <span class="monospaced">copy</span> for free.
</p>
</li>
</ul></div>
<div class="paragraph"><p>For certain kinds of classes, case classes give you exactly the right
semantics. Some people call them value classes. For example, consider the
<span class="monospaced">Currency</span> class:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">case</span> <span class="k">class</span> <span class="nc">Currency</span><span class="o">(</span><span class="n">value</span><span class="k">:</span> <span class="kt">Double</span><span class="o">,</span> <span class="n">unit</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span>
</pre></div></div></div>
<div class="paragraph"><p>A <span class="monospaced">Currency(10, "EUR")</span> is the same as any other <span class="monospaced">Currency(10, "EUR")</span>, and
that’s how <span class="monospaced">equals</span> and <span class="monospaced">hashCode</span> are implemented. Typically, such classes
are immutable.</p></div>
<div class="paragraph"><p>Case classes with variable fields are somewhat suspect, at least with
respect to the hash code. With mutable classes, one should always derive
the hash code from fields that are never mutated, such as an ID.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Caution</div>
</td>
<td class="content">The <span class="monospaced">toString</span>, <span class="monospaced">equals</span>, <span class="monospaced">hashCode</span>, and <span class="monospaced">copy</span> methods are <em>not</em>
generated for case classes that extend other case classes. You get a
compiler warning if one case class inherits from another. A future version
of Scala may outlaw such inheritance altogether. If you need multiple
levels of inheritance to factor out common behavior of case classes, make
only the leaves of the inheritance tree into case classes.</td>
</tr></table>
</div>
</div>
<div class="sect2">
<h3 id="_sealed_classes">Sealed Classes</h3>
<div class="paragraph"><p>When you use pattern matching with case classes, you would like the
compiler to check that you exhausted all alternatives. You achieve this by
declaring the common superclass as sealed:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">sealed</span> <span class="k">abstract</span> <span class="k">class</span> <span class="nc">Amount</span>
<span class="k">case</span> <span class="k">class</span> <span class="nc">Dollar</span><span class="o">(</span><span class="n">value</span><span class="k">:</span> <span class="kt">Double</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">Amount</span>
<span class="k">case</span> <span class="k">class</span> <span class="nc">Currency</span><span class="o">(</span><span class="n">value</span><span class="k">:</span> <span class="kt">Double</span><span class="o">,</span> <span class="n">unit</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">Amount</span>
</pre></div></div></div>
<div class="paragraph"><p>All subclasses of a sealed class must be defined in the same file as the
class itself. For example, if someone wants to add another class for euros,</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">case</span> <span class="k">class</span> <span class="nc">Euro</span><span class="o">(</span><span class="n">value</span><span class="k">:</span> <span class="kt">Double</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">Amount</span>
</pre></div></div></div>
<div class="paragraph"><p>they must do so in the file in which <span class="monospaced">Amount</span> is declared.</p></div>
<div class="paragraph"><p>When a class is sealed, all of its subclasses are known at compile time,
enabling the compiler to check pattern clauses for completeness. It is a
good idea for all case classes to extend a sealed class or trait.</p></div>
</div>
<div class="sect2">
<h3 id="_lab_pattern_matching_2">Lab: Pattern Matching 2</h3>
<div class="paragraph"><p>Open <span class="monospaced">labs/src/main/scala/com/newcircle/patterns/PatternMatch2.scala</span>. Let&#8217;s
take a look at it for a moment:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">package</span> <span class="nn">com.newcircle.patterns</span>

<span class="k">object</span> <span class="nc">PatternMatch2</span> <span class="o">{</span>

  <span class="k">sealed</span> <span class="k">abstract</span> <span class="k">class</span> <span class="nc">TreeNode</span>
  <span class="k">case</span> <span class="k">class</span> <span class="nc">ParentNode</span><span class="o">(</span><span class="k">val</span> <span class="n">value</span><span class="k">:</span> <span class="kt">Any</span><span class="o">,</span>
                        <span class="k">val</span> <span class="n">left</span><span class="k">:</span> <span class="kt">TreeNode</span><span class="o">,</span>
                        <span class="k">val</span> <span class="n">right</span><span class="k">:</span> <span class="kt">TreeNode</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">TreeNode</span>
  <span class="k">case</span> <span class="k">class</span> <span class="nc">LeafNode</span><span class="o">(</span><span class="k">val</span> <span class="n">value</span><span class="k">:</span> <span class="kt">Any</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">TreeNode</span>

  <span class="k">def</span> <span class="n">sumLeaves</span><span class="o">(</span><span class="n">root</span><span class="k">:</span> <span class="kt">TreeNode</span><span class="o">)</span><span class="k">:</span> <span class="kt">Int</span> <span class="o">=</span> <span class="o">{</span>
    <span class="mi">0</span> <span class="c1">// Replace this</span>
  <span class="o">}</span>

<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>The case classes model a binary tree, with two kinds of nodes:</p></div>
<div class="ulist"><ul>
<li>
<p>
<span class="monospaced">ParentNode</span>: A node with a value (of any type) and exactly two children
</p>
</li>
<li>
<p>
<span class="monospaced">LeafNode</span>: A node with only a value (of any type)
</p>
</li>
</ul></div>
<div class="paragraph"><p><span class="monospaced">sumLeaves</span> must walk a tree (recursively), finding all leaf nodes that
contain integer values, summing them up.</p></div>
<div class="paragraph"><p>To test your solution, run this tester in SBT:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>&gt; test-only com.newcircle.tests.patterns.PatternMatch2Spec</pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_simulating_enumerations">Simulating Enumerations</h3>
<div class="paragraph"><p>Case classes let you simulate enumerated types in Scala.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">sealed</span> <span class="k">abstract</span> <span class="k">class</span> <span class="nc">TrafficLightColor</span>
<span class="k">case</span> <span class="k">object</span> <span class="nc">Red</span> <span class="k">extends</span> <span class="nc">TrafficLightColor</span>
<span class="k">case</span> <span class="k">object</span> <span class="nc">Yellow</span> <span class="k">extends</span> <span class="nc">TrafficLightColor</span>
<span class="k">case</span> <span class="k">object</span> <span class="nc">Green</span> <span class="k">extends</span> <span class="nc">TrafficLightColor</span>

<span class="n">color</span> <span class="k">match</span> <span class="o">{</span>
  <span class="k">case</span> <span class="nc">Red</span>    <span class="k">=&gt;</span> <span class="s">&quot;stop&quot;</span>
  <span class="k">case</span> <span class="nc">Yellow</span> <span class="k">=&gt;</span> <span class="s">&quot;hurry up&quot;</span>
  <span class="k">case</span> <span class="nc">Green</span>  <span class="k">=&gt;</span> <span class="s">&quot;go&quot;</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>Note that the superclass was declared as <span class="monospaced">sealed</span>, enabling the compiler to
check that the match clause is complete.</p></div>
<div class="paragraph"><p>If you find this a bit heavyweight, you may prefer using the <span class="monospaced">Enumeration</span>
helper class.</p></div>
</div>
<div class="sect2">
<h3 id="_the_option_type">The Option Type</h3>
<div class="paragraph"><p>The <span class="monospaced">Option</span> type in the standard library uses case classes to express
values that might or might not be present. The case subclass <span class="monospaced">Some</span> wraps a
value, for example <span class="monospaced">Some("Fred")</span>. The case object <span class="monospaced">None</span> indicates that
there is no value.</p></div>
<div class="paragraph"><p>This is less ambiguous than using an empty string and safer than using
<span class="monospaced">null</span> for a missing value.</p></div>
<div class="paragraph"><p><span class="monospaced">Option</span> is a generic type. For example, <span class="monospaced">Some("Fred")</span> has type
<span class="monospaced">Option[String]</span>.</p></div>
<div class="paragraph"><p>The <span class="monospaced">get</span> method of the <span class="monospaced">Map</span> class returns an <span class="monospaced">Option</span>. If there is no
value for a given key, get returns <span class="monospaced">None</span>. Otherwise, it wraps the value
inside <span class="monospaced">Some</span>.</p></div>
<div class="paragraph"><p>You can use pattern matching to analyze such a value.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="n">scores</span><span class="o">.</span><span class="n">get</span><span class="o">(</span><span class="s">&quot;Alice&quot;</span><span class="o">)</span> <span class="k">match</span> <span class="o">{</span>
  <span class="k">case</span> <span class="nc">Some</span><span class="o">(</span><span class="n">score</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="n">println</span><span class="o">(</span><span class="n">score</span><span class="o">)</span>
  <span class="k">case</span> <span class="nc">None</span> <span class="k">=&gt;</span> <span class="n">println</span><span class="o">(</span><span class="s">&quot;No score&quot;</span><span class="o">)</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>However, that&#8217;s both tedious and non-idiomatic.</p></div>
<div class="paragraph"><p>Alternatively, you can use the <span class="monospaced">isEmpty</span> and <span class="monospaced">get</span>:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">val</span> <span class="n">alicesScore</span> <span class="k">=</span> <span class="n">scores</span><span class="o">.</span><span class="n">get</span><span class="o">(</span><span class="s">&quot;Alice&quot;</span><span class="o">)</span>
<span class="k">if</span> <span class="o">(</span><span class="n">alicesScore</span><span class="o">.</span><span class="n">isEmpty</span><span class="o">)</span> <span class="n">println</span><span class="o">(</span><span class="s">&quot;No score&quot;</span><span class="o">)</span>
<span class="k">else</span> <span class="n">println</span><span class="o">(</span><span class="n">alicesScore</span><span class="o">.</span><span class="n">get</span><span class="o">)</span>
</pre></div></div></div>
<div class="paragraph"><p>That’s also too. It is far better, and more idiomatic, to use the <span class="monospaced">getOrElse</span>
method:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="n">println</span><span class="o">(</span><span class="n">alicesScore</span><span class="o">.</span><span class="n">getOrElse</span><span class="o">(</span><span class="s">&quot;No score&quot;</span><span class="o">))</span>
</pre></div></div></div>
<div class="paragraph"><p>If <span class="monospaced">alicesScore</span> is <span class="monospaced">None</span>, then <span class="monospaced">getOrElse</span> returns "No Score". In fact,
this is such a common situation that the <span class="monospaced">Map</span> class also provides a
<span class="monospaced">getOrElse</span>:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="n">println</span><span class="o">(</span><span class="n">scores</span><span class="o">.</span><span class="n">getOrElse</span><span class="o">(</span><span class="s">&quot;Alice&quot;</span><span class="o">,</span> <span class="s">&quot;No score&quot;</span><span class="o">))</span>
</pre></div></div></div>
<div class="paragraph"><p>If you want to skip a <span class="monospaced">None</span> value, use a <span class="monospaced">for</span> comprehension:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">for</span> <span class="o">(</span><span class="n">score</span> <span class="k">&lt;-</span> <span class="n">scores</span><span class="o">.</span><span class="n">get</span><span class="o">(</span><span class="s">&quot;Alice&quot;</span><span class="o">))</span> <span class="n">println</span><span class="o">(</span><span class="n">score</span><span class="o">)</span>
</pre></div></div></div>
<div class="paragraph"><p>If the <span class="monospaced">get</span> method returns <span class="monospaced">None</span>, nothing happens. If it is a <span class="monospaced">Some</span>,
then score is bound to its contents.</p></div>
<div class="sect3">
<h4 id="_options_as_collections_of_0_or_1">Options as Collections of 0 or 1</h4>
<div class="paragraph"><p>You can also consider an <span class="monospaced">Option</span> to be a collection that is either empty
or has one element, and use methods such as <span class="monospaced">map</span>, <span class="monospaced">foreach</span>, or <span class="monospaced">filter</span>.
For example:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="n">scores</span><span class="o">.</span><span class="n">get</span><span class="o">(</span><span class="s">&quot;Alice&quot;</span><span class="o">).</span><span class="n">foreach</span><span class="o">(</span><span class="n">println</span> <span class="k">_</span><span class="o">)</span>
</pre></div></div></div>
<div class="paragraph"><p>prints the score or does nothing if get returns <span class="monospaced">None</span>.</p></div>
<div class="paragraph"><p>You can also map an <span class="monospaced">Option</span>. Consider the following:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">val</span> <span class="n">oi1</span><span class="k">:</span> <span class="kt">Option</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Some</span><span class="o">(</span><span class="mi">100</span><span class="o">)</span>
<span class="k">val</span> <span class="n">oi2</span><span class="k">:</span> <span class="kt">Option</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="k">=</span> <span class="nc">None</span>

<span class="k">val</span> <span class="n">os1</span> <span class="k">=</span> <span class="n">oi1</span><span class="o">.</span><span class="n">map</span> <span class="o">{</span> <span class="k">_</span><span class="o">.</span><span class="n">toString</span> <span class="o">}</span> <span class="c1">// yields Some(&quot;100&quot;), type Option[String]</span>
<span class="k">val</span> <span class="n">os2</span> <span class="k">=</span> <span class="n">oi2</span><span class="o">.</span><span class="n">map</span> <span class="o">{</span> <span class="k">_</span><span class="o">.</span><span class="n">toString</span> <span class="o">}</span> <span class="c1">// yields None, type Option[String]</span>
</pre></div></div></div>
</div>
</div>
<div class="sect2">
<h3 id="_lab_sum_a_list_of_options">Lab: Sum a list of Options</h3>
<div class="paragraph"><p>Open <span class="monospaced">labs/src/main/scala/com/newcircle/patterns/SumList.scala</span>. Implement
the <span class="monospaced">sum</span> function. That function takes a list of <span class="monospaced">Option[Int]</span> objects. Sum
all the integer values, ignoring any <span class="monospaced">None</span> values.</p></div>
<div class="paragraph"><p><strong>Do not use pattern matching.</strong></p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="title">Hint</div>
<div class="paragraph"><p>What does this line do? Try it in the REPL.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="nc">List</span><span class="o">(</span><span class="nc">Some</span><span class="o">(</span><span class="s">&quot;abc&quot;</span><span class="o">),</span> <span class="nc">None</span><span class="o">,</span> <span class="nc">Some</span><span class="o">(</span><span class="s">&quot;def&quot;</span><span class="o">)).</span><span class="n">flatMap</span><span class="o">(</span><span class="n">opt</span> <span class="k">=&gt;</span> <span class="n">opt</span><span class="o">)</span>
</pre></div></div></div>
</td>
</tr></table>
</div>
<div class="paragraph"><p>To test your solution, run this tester in SBT:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>&gt; test-only com.newcircle.tests.patterns.SumListSpec</pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_partial_functions">Partial Functions</h3>
<div class="paragraph"><p>A set of case clauses enclosed in braces is a <em>partial function</em>, a
function which may not be defined for all inputs. It is an instance of a
class <span class="monospaced">PartialFunction[A, B]</span>. (<span class="monospaced">A</span> is the parameter type, <span class="monospaced">B</span> the return
type.)</p></div>
<div class="paragraph"><p>That class has two methods: <span class="monospaced">apply</span>, which computes the function value from
the matching pattern, and <span class="monospaced">isDefinedAt</span>, which returns <span class="monospaced">true</span> if the input
matches at least one of the patterns.</p></div>
<div class="paragraph"><p>For example:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">val</span> <span class="n">f</span><span class="k">:</span> <span class="kt">PartialFunction</span><span class="o">[</span><span class="kt">Char</span>, <span class="kt">Int</span><span class="o">]</span> <span class="k">=</span> <span class="o">{</span>
  <span class="k">case</span> <span class="sc">&#39;+&#39;</span> <span class="k">=&gt;</span> <span class="mi">1</span>
  <span class="k">case</span> <span class="sc">&#39;-&#39;</span> <span class="k">=&gt;</span> <span class="o">-</span><span class="mi">1</span>
<span class="o">}</span>

<span class="n">f</span><span class="o">(</span><span class="sc">&#39;-&#39;</span><span class="o">)</span>             <span class="c1">// Calls f.apply(&#39;-&#39;), returns -1</span>
<span class="n">f</span><span class="o">.</span><span class="n">isDefinedAt</span><span class="o">(</span><span class="sc">&#39;0&#39;</span><span class="o">)</span> <span class="c1">// false</span>
<span class="n">f</span><span class="o">(</span><span class="sc">&#39;0&#39;</span><span class="o">)</span>             <span class="c1">// Throws MatchError</span>
</pre></div></div></div>
<div class="paragraph"><p>Some methods accept a <span class="monospaced">PartialFunction</span> as a parameter. For example, the
<span class="monospaced">collect</span> method of the <span class="monospaced">GenTraversable</span> trait applies a partial function
to all elements where it is defined, and returns a sequence of the results.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="s">&quot;-3 + 4&quot;</span><span class="o">.</span><span class="n">collect</span> <span class="o">{</span>
  <span class="k">case</span> <span class="sc">&#39;+&#39;</span> <span class="k">=&gt;</span> <span class="mi">1</span>
  <span class="k">case</span> <span class="sc">&#39;-&#39;</span> <span class="k">=&gt;</span> <span class="o">-</span><span class="mi">1</span>
<span class="o">}</span>
<span class="c1">// yields Vector(-1, 1)</span>
</pre></div></div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">The partial function expression must be in a context where the
compiler can infer the return type. This is the case when you assign it to
a typed variable, or pass it to an argument.</td>
</tr></table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="lesson-17-type-parameters">Type Parameters</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_lesson_objectives_15">Lesson Objectives</h3>
<div class="paragraph"><p>In Scala, you can use type parameters to implement classes and functions
that work with multiple types. For example, an <span class="monospaced">Array[T]</span> stores elements
of an arbitrary type <span class="monospaced">T</span>.</p></div>
<div class="paragraph"><p>The basic idea is very simple, but the details can get tricky. Sometimes,
you need to place restrictions on the type. For example, to sort elements,
<span class="monospaced">T</span> must provide an ordering. Furthermore, if the parameter type varies,
what should happen with the parameterized type? For example, can you pass
an <span class="monospaced">Array[String]</span> to a function that expects an <span class="monospaced">Array[Any]</span>?</p></div>
<div class="paragraph"><p>In Scala, you specify how your types should vary depending on their
parameters.</p></div>
</div>
<div class="sect2">
<h3 id="_summary_14">Summary</h3>
<div class="ulist"><ul>
<li>
<p>
Classes, traits, methods, and functions can have type parameters.
</p>
</li>
<li>
<p>
Place the type parameters after the name, enclosed in square brackets.
</p>
</li>
<li>
<p>
Type bounds have the form <span class="monospaced">T &lt;: UpperBound</span>, <span class="monospaced">T &gt;: LowerBound</span>,
  <span class="monospaced">T &lt;% ViewBound</span>, <span class="monospaced">T : ContextBound</span>.
</p>
</li>
<li>
<p>
You can restrict a method with a type constraint such as
  <span class="monospaced">(implicit ev: T &lt;:&lt; UpperBound)</span>.
</p>
</li>
<li>
<p>
Use <span class="monospaced">+T</span> (covariance) to indicate that a generic type’s subtype
  relationship is in the same direction as the parameter <span class="monospaced">T</span>, or <span class="monospaced">-T</span>
  (contravariance) to indicate the reverse direction.
</p>
</li>
<li>
<p>
Covariance is appropriate for parameters that denote outputs, such as
  elements in an immutable collection.
</p>
</li>
<li>
<p>
Contravariance is appropriate for parameters that denote inputs, such as
  function arguments.
</p>
</li>
</ul></div>
</div>
<div class="sect2">
<h3 id="_generic_classes">Generic Classes</h3>
<div class="paragraph"><p>As in Java or C++, classes and traits can have type parameters. In Scala,
you use square brackets for type parameters, for example:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Pair</span><span class="o">[</span><span class="kt">T</span>, <span class="kt">S</span><span class="o">](</span><span class="k">val</span> <span class="n">first</span><span class="k">:</span> <span class="kt">T</span><span class="o">,</span> <span class="k">val</span> <span class="n">second</span><span class="k">:</span> <span class="kt">S</span><span class="o">)</span>
</pre></div></div></div>
<div class="paragraph"><p>This defines a class with two type parameters <span class="monospaced">T</span> and <span class="monospaced">S</span>. You use the type
parameters in the class definition to define the types of variables, method
parameters, and return values.</p></div>
<div class="paragraph"><p>A class with one or more type parameters is <em>generic</em>. If you substitute
actual types for the type parameters, you get an ordinary class, such as
<span class="monospaced">Pair[Int, String]</span>.</p></div>
<div class="paragraph"><p>Scala attempts to infer the actual types from the construction parameters:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">val</span> <span class="n">p</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">Pair</span><span class="o">(</span><span class="mi">42</span><span class="o">,</span> <span class="s">&quot;String&quot;</span><span class="o">)</span> <span class="c1">// It&#39;s a Pair[Int, String]</span>
</pre></div></div></div>
<div class="paragraph"><p>That&#8217;s a <em>highly</em> useful feature.</p></div>
<div class="paragraph"><p>You can also specify the types yourself:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">val</span> <span class="n">p2</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">Pair</span><span class="o">[</span><span class="kt">Any</span>, <span class="kt">Any</span><span class="o">](</span><span class="mi">42</span><span class="o">,</span> <span class="s">&quot;String&quot;</span><span class="o">)</span>
</pre></div></div></div>
</div>
<div class="sect2">
<h3 id="_generic_functions">Generic Functions</h3>
<div class="paragraph"><p>Functions and methods can also have type parameters:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">def</span> <span class="n">getMiddle</span><span class="o">[</span><span class="kt">T</span><span class="o">](</span><span class="n">a</span><span class="k">:</span> <span class="kt">Array</span><span class="o">[</span><span class="kt">T</span><span class="o">])</span> <span class="k">=</span> <span class="n">a</span><span class="o">(</span><span class="n">a</span><span class="o">.</span><span class="n">length</span> <span class="o">/</span> <span class="mi">2</span><span class="o">)</span>
</pre></div></div></div>
<div class="paragraph"><p>As with generic classes, you place the type parameter after the name.</p></div>
<div class="paragraph"><p>Scala infers the actual types from the arguments in the call.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="n">getMiddle</span><span class="o">(</span><span class="nc">Array</span><span class="o">(</span><span class="s">&quot;Mary&quot;</span><span class="o">,</span> <span class="s">&quot;had&quot;</span><span class="o">,</span> <span class="s">&quot;a&quot;</span><span class="o">,</span> <span class="s">&quot;little&quot;</span><span class="o">,</span> <span class="s">&quot;lamb&quot;</span><span class="o">))</span> <span class="c1">// Calls getMiddle[String]</span>
</pre></div></div></div>
<div class="paragraph"><p>If you need to, you can specify the type:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">val</span> <span class="n">f</span> <span class="k">=</span> <span class="n">getMiddle</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">_</span> <span class="c1">// The function, saved in f</span>
</pre></div></div></div>
</div>
<div class="sect2">
<h3 id="_bounds_for_type_variables">Bounds for Type Variables</h3>
<div class="sect3">
<h4 id="_upper_bounds">Upper Bounds</h4>
<div class="paragraph"><p>Sometimes, you need to place restrictions on type variables. Consider a
<span class="monospaced">Pair</span> type where both components have the same type, like this:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Pair</span><span class="o">[</span><span class="kt">T</span><span class="o">](</span><span class="k">val</span> <span class="n">first</span><span class="k">:</span> <span class="kt">T</span><span class="o">,</span> <span class="k">val</span> <span class="n">second</span><span class="k">:</span> <span class="kt">T</span><span class="o">)</span>
</pre></div></div></div>
<div class="paragraph"><p>Now we want to add a method that produces the smaller value:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Pair</span><span class="o">[</span><span class="kt">T</span><span class="o">](</span><span class="k">val</span> <span class="n">first</span><span class="k">:</span> <span class="kt">T</span><span class="o">,</span> <span class="k">val</span> <span class="n">second</span><span class="k">:</span> <span class="kt">T</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">def</span> <span class="n">smaller</span> <span class="k">=</span> <span class="k">if</span> <span class="o">(</span><span class="n">first</span><span class="o">.</span><span class="n">compareTo</span><span class="o">(</span><span class="n">second</span><span class="o">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="o">)</span> <span class="n">first</span> <span class="k">else</span> <span class="n">second</span> <span class="c1">// Error</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>There&#8217;s a problem here: We don’t know if <span class="monospaced">first</span> has a <span class="monospaced">compareTo</span> method.
To solve this, we can add an upper type bound:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Pair</span><span class="o">[</span><span class="kt">T</span> <span class="k">&lt;:</span> <span class="kt">Comparable</span><span class="o">[</span><span class="kt">T</span><span class="o">]](</span><span class="k">val</span> <span class="n">first</span><span class="k">:</span> <span class="kt">T</span><span class="o">,</span> <span class="k">val</span> <span class="n">second</span><span class="k">:</span> <span class="kt">T</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">def</span> <span class="n">smaller</span> <span class="k">=</span> <span class="k">if</span> <span class="o">(</span><span class="n">first</span><span class="o">.</span><span class="n">compareTo</span><span class="o">(</span><span class="n">second</span><span class="o">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="o">)</span> <span class="n">first</span> <span class="k">else</span> <span class="n">second</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p><span class="monospaced">T &lt;: Comparable[T]</span> means: <span class="monospaced">T</span> must be a subtype of <span class="monospaced">Comparable[T]</span>.</p></div>
<div class="paragraph"><p>Now we can instantiate <span class="monospaced">Pair[String]</span> but not
<span class="monospaced">Pair[java.io.File]</span>, since <span class="monospaced">String</span> is a subtype of <span class="monospaced">Comparable[String]</span>
but <span class="monospaced">File</span> does not implement <span class="monospaced">Comparable[File]</span>. For example:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">val</span> <span class="n">p</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">Pair</span><span class="o">(</span><span class="s">&quot;Moe&quot;</span><span class="o">,</span> <span class="s">&quot;Curley&quot;</span><span class="o">)</span>
<span class="n">println</span><span class="o">(</span><span class="n">p</span><span class="o">.</span><span class="n">smaller</span><span class="o">)</span> <span class="c1">// Prints &quot;Curley&quot;</span>
</pre></div></div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Caution</div>
</td>
<td class="content">There&#8217;s more to it than this, as you&#8217;ll see shortly.</td>
</tr></table>
</div>
</div>
<div class="sect3">
<h4 id="_lower_bounds">Lower Bounds</h4>
<div class="paragraph"><p>You can also specify a lower bound for a type.</p></div>
<div class="paragraph"><p>Suppose we want to define a method that replaces the first component of a
pair with another value. Our pairs are immutable, so we need to return a
new pair. Here is a first attempt:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Pair</span><span class="o">[</span><span class="kt">T</span><span class="o">](</span><span class="k">val</span> <span class="n">first</span><span class="k">:</span> <span class="kt">T</span><span class="o">,</span> <span class="k">val</span> <span class="n">second</span><span class="k">:</span> <span class="kt">T</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">def</span> <span class="n">replaceFirst</span><span class="o">(</span><span class="n">newFirst</span><span class="k">:</span> <span class="kt">T</span><span class="o">)</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">Pair</span><span class="o">[</span><span class="kt">T</span><span class="o">](</span><span class="n">newFirst</span><span class="o">,</span> <span class="n">second</span><span class="o">)</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>But we can do better than that.</p></div>
<div class="paragraph"><p>Suppose we have a <span class="monospaced">Pair[Student]</span>. It should be possible to replace the
first component with a <span class="monospaced">Person</span>. Of course, then the result must be a
<span class="monospaced">Pair[Person]</span>. In general, the replacement type must be a supertype of the
pair’s component type.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">def</span> <span class="n">replaceFirst</span><span class="o">[</span><span class="kt">R</span> <span class="k">&gt;:</span> <span class="kt">T</span><span class="o">](</span><span class="n">newFirst</span><span class="k">:</span> <span class="kt">R</span><span class="o">)</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">Pair</span><span class="o">[</span><span class="kt">R</span><span class="o">](</span><span class="n">newFirst</span><span class="o">,</span> <span class="n">second</span><span class="o">)</span>
</pre></div></div></div>
<div class="paragraph"><p>Here, I included the type parameter in the returned pair for greater
clarity. You can also write</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">def</span> <span class="n">replaceFirst</span><span class="o">[</span><span class="kt">R</span> <span class="k">&gt;:</span> <span class="kt">T</span><span class="o">](</span><span class="n">newFirst</span><span class="k">:</span> <span class="kt">R</span><span class="o">)</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">Pair</span><span class="o">(</span><span class="n">newFirst</span><span class="o">,</span> <span class="n">second</span><span class="o">)</span>
</pre></div></div></div>
<div class="paragraph"><p>Then the return type is correctly inferred as new Pair[R].</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Caution</div>
</td>
<td class="content">
<div class="paragraph"><p>If you omit the lower bound,</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">def</span> <span class="n">replaceFirst</span><span class="o">[</span><span class="kt">R</span><span class="o">](</span><span class="n">newFirst</span><span class="k">:</span> <span class="kt">R</span><span class="o">)</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">Pair</span><span class="o">(</span><span class="n">newFirst</span><span class="o">,</span> <span class="n">second</span><span class="o">)</span>
</pre></div></div></div>
<div class="paragraph"><p>the method will compile, but it will return a <span class="monospaced">Pair[Any]</span>.</p></div>
</td>
</tr></table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_view_bounds">View Bounds</h3>
<div class="paragraph"><p>In the preceding section, we had an example of an upper bound:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Pair</span><span class="o">[</span><span class="kt">T</span> <span class="k">&lt;:</span> <span class="kt">Comparable</span><span class="o">[</span><span class="kt">T</span><span class="o">]]</span>
</pre></div></div></div>
<div class="paragraph"><p>Unfortunately, if you try constructing a new Pair(4, 2), the compiler
complains that <span class="monospaced">Int</span> is not a subtype of <span class="monospaced">Comparable[Int]</span>. Unlike the
<span class="monospaced">java.lang.Integer</span> wrapper type, the Scala <span class="monospaced">Int</span> type does not implement
<span class="monospaced">Comparable</span>. However, <span class="monospaced">RichInt</span> <em>does</em> implement <span class="monospaced">Comparable[Int]</span>, and
there is an implicit conversion from <span class="monospaced">Int</span> to <span class="monospaced">RichInt</span>.</p></div>
<div class="paragraph"><p>The solution is to use a <em>view bound</em> like this:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Pair</span><span class="o">[</span><span class="kt">T</span> <span class="k">&lt;%</span> <span class="kt">Comparable</span><span class="o">[</span><span class="kt">T</span><span class="o">]]</span>
</pre></div></div></div>
<div class="paragraph"><p>The <span class="monospaced">&lt;%</span> relation means: Some <span class="monospaced">T</span> can be converted to a <span class="monospaced">Comparable[T]</span>
through an implicit conversion.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph"><p>It is nicer to use the <span class="monospaced">Ordered</span> trait which adds relational operators to
<span class="monospaced">Comparable</span>:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Pair</span><span class="o">[</span><span class="kt">T</span> <span class="k">&lt;%</span> <span class="kt">Ordered</span><span class="o">[</span><span class="kt">T</span><span class="o">]](</span><span class="k">val</span> <span class="n">first</span><span class="k">:</span> <span class="kt">T</span><span class="o">,</span> <span class="k">val</span> <span class="n">second</span><span class="k">:</span> <span class="kt">T</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">def</span> <span class="n">smaller</span> <span class="k">=</span> <span class="k">if</span> <span class="o">(</span><span class="n">first</span> <span class="o">&lt;</span> <span class="n">second</span><span class="o">)</span> <span class="n">first</span> <span class="k">else</span> <span class="n">second</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>I didn’t do that in the preceding section because <span class="monospaced">java.lang.String</span>
implements <span class="monospaced">Comparable[String]</span> but not <span class="monospaced">Ordered[String]</span>. With a view
bound, this isn’t a problem. Strings have an implicit conversion to
<span class="monospaced">RichString</span>, which is a subtype of <span class="monospaced">Ordered[String]</span>.</p></div>
</td>
</tr></table>
</div>
</div>
<div class="sect2">
<h3 id="_context_bounds">Context Bounds</h3>
<div class="paragraph"><p>A view bound <span class="monospaced">T &lt;% V</span> requires the existence of an implicit conversion from
<span class="monospaced">T</span> to <span class="monospaced">V</span>. A context bound has the form <span class="monospaced">T : M</span>, where <span class="monospaced">M</span> is another
generic type. It requires that there is an "implicit value" of type <span class="monospaced">M[T]</span>.
(We discuss implicit values in detail later.)</p></div>
<div class="paragraph"><p>For example:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Pair</span><span class="o">[</span><span class="kt">T</span> <span class="kt">:</span> <span class="kt">Ordering</span><span class="o">]</span>
</pre></div></div></div>
<div class="paragraph"><p>requires that there is an implicit value of type <span class="monospaced">Ordering[T]</span>. That
implicit value can then be used in the methods of the class. When you
declare a method that uses the implicit value, you have to add an "implicit
parameter." Here is an example:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Pair</span><span class="o">[</span><span class="kt">T</span> <span class="kt">:</span> <span class="kt">Ordering</span><span class="o">](</span><span class="k">val</span> <span class="n">first</span><span class="k">:</span> <span class="kt">T</span><span class="o">,</span> <span class="k">val</span> <span class="n">second</span><span class="k">:</span> <span class="kt">T</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">def</span> <span class="n">smaller</span><span class="o">(</span><span class="k">implicit</span> <span class="n">ord</span><span class="k">:</span> <span class="kt">Ordering</span><span class="o">[</span><span class="kt">T</span><span class="o">])</span> <span class="k">=</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">ord</span><span class="o">.</span><span class="n">compare</span><span class="o">(</span><span class="n">first</span><span class="o">,</span> <span class="n">second</span><span class="o">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="o">)</span> <span class="n">first</span> <span class="k">else</span> <span class="n">second</span>
<span class="o">}</span>
</pre></div></div></div>
</div>
<div class="sect2">
<h3 id="_the_manifest_context_bound">The Manifest Context Bound</h3>
<div class="paragraph"><p>As we saw in our first pattern matching lab, to instantiate a generic
<span class="monospaced">Array[T]</span>, one needs a <span class="monospaced">Manifest[T]</span> object. This is required for
primitive type arrays to work correctly.</p></div>
<div class="paragraph"><p>For example, if <span class="monospaced">T</span> is <span class="monospaced">Int</span>, you want an <span class="monospaced">int[]</span> array in the virtual
machine. In Scala, <span class="monospaced">Array</span> is a library class that doesn’t get special
treatment from the compiler. If you write a generic function that
constructs a generic array, you need to help it out and pass that manifest
object. Since it’s an implicit parameter of the constructor, you can use a
context bound, like this:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">def</span> <span class="n">makePair</span><span class="o">[</span><span class="kt">T</span> <span class="kt">:</span> <span class="kt">Manifest</span><span class="o">](</span><span class="n">first</span><span class="k">:</span> <span class="kt">T</span><span class="o">,</span> <span class="n">second</span><span class="k">:</span> <span class="kt">T</span><span class="o">)</span> <span class="k">=</span> <span class="o">{</span>
  <span class="k">val</span> <span class="n">r</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">Array</span><span class="o">[</span><span class="kt">T</span><span class="o">](</span><span class="mi">2</span><span class="o">);</span> <span class="n">r</span><span class="o">(</span><span class="mi">0</span><span class="o">)</span> <span class="k">=</span> <span class="n">first</span><span class="o">;</span> <span class="n">r</span><span class="o">(</span><span class="mi">1</span><span class="o">)</span> <span class="k">=</span> <span class="n">second</span><span class="o">;</span> <span class="n">r</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>If you call <span class="monospaced">makePair(4, 9)</span>, the compiler locates the implicit
<span class="monospaced">Manifest[Int]</span> and actually calls <span class="monospaced">makePair(4, 9)(intManifest)</span>. Then the
method calls <span class="monospaced">new Array(2)(intManifest)</span>, which returns a primitive array
<span class="monospaced">int[2]</span>.</p></div>
<div class="paragraph"><p>Why all this complexity? In the virtual machine, generic types are erased.
There is only a single <span class="monospaced">makePair</span> method that needs to work for all types
<span class="monospaced">T</span>.</p></div>
</div>
<div class="sect2">
<h3 id="_multiple_bounds">Multiple Bounds</h3>
<div class="paragraph"><p>A type variable can have both an upper and a lower bound. The syntax is
this:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="n">T</span> <span class="k">&lt;:</span> <span class="nc">Lower</span> <span class="k">&gt;:</span> <span class="nc">Lower</span>
</pre></div></div></div>
<div class="paragraph"><p>You can’t have multiple upper or lower bounds. However, you can still
require that a type implements multiple traits, like this:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="n">T</span> <span class="k">&lt;:</span> <span class="nc">Comparable</span><span class="o">[</span><span class="kt">T</span><span class="o">]</span> <span class="k">with</span> <span class="nc">Serializable</span> <span class="k">with</span> <span class="nc">Cloneable</span>
</pre></div></div></div>
<div class="paragraph"><p>You can have more than one view bound:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="n">T</span> <span class="k">&lt;%</span> <span class="nc">Comparable</span><span class="o">[</span><span class="kt">T</span><span class="o">]</span> <span class="k">&lt;%</span> <span class="nc">String</span>
</pre></div></div></div>
<div class="paragraph"><p>You can also have more than one context bound:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="n">T</span> <span class="k">:</span> <span class="kt">Ordering</span> <span class="kt">:</span> <span class="kt">Manifest</span>
</pre></div></div></div>
</div>
<div class="sect2">
<h3 id="_type_constraints">Type Constraints</h3>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">This stuff&#8217;s a little hairy. Buckle up&#8230;</td>
</tr></table>
</div>
<div class="paragraph"><p>Type constraints give you <em>another</em> way of restricting types. There are
three relationships that you can use:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>T =:= U   // type `T` equal to type `U`
T &lt;:&lt; U   // type `T` is a subtype of `U`
T &lt;%&lt; U   // type `T` is view-convertible to `U`</pre>
</div></div>
<div class="paragraph"><p>To use such a constraint, you add an <em>implicit evidence parameter</em> like
this:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Pair</span><span class="o">[</span><span class="kt">T</span><span class="o">](</span><span class="k">val</span> <span class="n">first</span><span class="k">:</span> <span class="kt">T</span><span class="o">,</span> <span class="k">val</span> <span class="n">second</span><span class="k">:</span> <span class="kt">T</span><span class="o">)(</span><span class="k">implicit</span> <span class="n">ev</span><span class="k">:</span> <span class="kt">T</span> <span class="k">&lt;:</span><span class="kt">&lt;</span> <span class="kt">Comparable</span><span class="o">[</span><span class="kt">T</span><span class="o">])</span>
</pre></div></div></div>
<div class="paragraph"><p>In the example above, there is no advantage to using a type constraint over
a type bound class <span class="monospaced">Pair[T &lt;: Comparable[T]]</span>.</p></div>
<div class="paragraph"><p>However, type constraints are useful in some specialized circumstances.</p></div>
</div>
<div class="sect2">
<h3 id="_type_constraint_case_restricting_aspects_of_a_generic_class">Type Constraint Case: Restricting aspects of a generic class</h3>
<div class="paragraph"><p>Type constraints let you supply a method in a generic class that can be
used only under certain conditions. Here is an example:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Pair</span><span class="o">[</span><span class="kt">T</span><span class="o">](</span><span class="k">val</span> <span class="n">first</span><span class="k">:</span> <span class="kt">T</span><span class="o">,</span> <span class="k">val</span> <span class="n">second</span><span class="k">:</span> <span class="kt">T</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">def</span> <span class="n">smaller</span><span class="o">(</span><span class="k">implicit</span> <span class="n">ev</span><span class="k">:</span> <span class="kt">T</span> <span class="k">&lt;:</span><span class="kt">&lt;</span> <span class="kt">Ordered</span><span class="o">[</span><span class="kt">T</span><span class="o">])</span> <span class="k">=</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">first</span> <span class="o">&lt;</span> <span class="n">second</span><span class="o">)</span> <span class="n">first</span> <span class="k">else</span> <span class="n">second</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>You can form a <span class="monospaced">Pair[File]</span>, even though <span class="monospaced">File</span> is not ordered. You will
get an error only if you invoke the <span class="monospaced">smaller</span> method.</p></div>
<div class="paragraph"><p>Another example is the <span class="monospaced">orNull</span> method in the Option class:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">val</span> <span class="n">friends</span> <span class="k">=</span> <span class="nc">Map</span><span class="o">(</span><span class="s">&quot;Fred&quot;</span> <span class="o">-&gt;</span> <span class="s">&quot;Barney&quot;</span><span class="o">,</span> <span class="o">...)</span>
<span class="k">val</span> <span class="n">friendOpt</span> <span class="k">=</span> <span class="n">friends</span><span class="o">.</span><span class="n">get</span><span class="o">(</span><span class="s">&quot;Wilma&quot;</span><span class="o">)</span> <span class="c1">// An Option[String]</span>
<span class="k">val</span> <span class="n">friendOrNull</span> <span class="k">=</span> <span class="n">friendOpt</span><span class="o">.</span><span class="n">orNull</span> <span class="c1">// A String or null</span>
</pre></div></div></div>
<div class="paragraph"><p>The <span class="monospaced">orNull</span> method can be useful when working with Java code where it is
common to encode missing values as <span class="monospaced">null</span>. But it can’t be applied to value
types such as <span class="monospaced">Int</span> that don’t have <span class="monospaced">null</span> as a valid value. Because
<span class="monospaced">orNull</span> is implemented using a constraint <span class="monospaced">Null &lt;:&lt; A</span>, you can still
instantiate <span class="monospaced">Option[Int]</span>, as long as you stay away from <span class="monospaced">orNull</span> for those
instances.</p></div>
</div>
<div class="sect2">
<h3 id="_type_constraint_case_improving_type_inference">Type Constraint Case: Improving type inference</h3>
<div class="paragraph"><p>Another use of type constraints is for improving type inference. Consider</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">def</span> <span class="n">firstLast</span><span class="o">[</span><span class="kt">A</span>, <span class="kt">C</span> <span class="k">&lt;:</span> <span class="kt">Iterable</span><span class="o">[</span><span class="kt">A</span><span class="o">]](</span><span class="n">it</span><span class="k">:</span> <span class="kt">C</span><span class="o">)</span> <span class="k">=</span> <span class="o">(</span><span class="n">it</span><span class="o">.</span><span class="n">head</span><span class="o">,</span> <span class="n">it</span><span class="o">.</span><span class="n">last</span><span class="o">)</span>
</pre></div></div></div>
<div class="paragraph"><p>When you call</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="n">firstLast</span><span class="o">(</span><span class="nc">List</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">))</span>
</pre></div></div></div>
<div class="paragraph"><p>you get a message that the inferred type arguments <span class="monospaced">[Nothing, List[Int]]</span>
don’t conform to <span class="monospaced">[A, C &lt;: Iterable[A]]</span>.</p></div>
<div class="paragraph"><p>Why <span class="monospaced">Nothing</span>? The type inferencer cannot figure out what <span class="monospaced">A</span> is from looking
at <span class="monospaced">List(1, 2, 3)</span>, because it matches <span class="monospaced">A</span> and <span class="monospaced">C</span> in a single step. To help it
along, first match <span class="monospaced">C</span> and then <span class="monospaced">A</span>:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">def</span> <span class="n">firstLast</span><span class="o">[</span><span class="kt">A</span>, <span class="kt">C</span><span class="o">](</span><span class="n">it</span><span class="k">:</span> <span class="kt">C</span><span class="o">)(</span><span class="k">implicit</span> <span class="n">ev</span><span class="k">:</span> <span class="kt">C</span> <span class="k">&lt;:</span><span class="kt">&lt;</span> <span class="kt">Iterable</span><span class="o">[</span><span class="kt">A</span><span class="o">])</span> <span class="k">=</span>
  <span class="o">(</span><span class="n">it</span><span class="o">.</span><span class="n">head</span><span class="o">,</span> <span class="n">it</span><span class="o">.</span><span class="n">last</span><span class="o">)</span>
</pre></div></div></div>
</div>
<div class="sect2">
<h3 id="_covariance">Covariance</h3>
<div class="paragraph"><p>Suppose we have a function that does something with a <span class="monospaced">Pair[Person]</span>:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">def</span> <span class="n">makeFriends</span><span class="o">(</span><span class="n">p</span><span class="k">:</span> <span class="kt">Pair</span><span class="o">[</span><span class="kt">Person</span><span class="o">])</span>
</pre></div></div></div>
<div class="paragraph"><p>If <span class="monospaced">Student</span> is a subclass of <span class="monospaced">Person</span>, can I call <span class="monospaced">makeFriend</span> with a
<span class="monospaced">Pair[Student]</span>?</p></div>
<div class="paragraph"><p>By default, this is an error. Even though <span class="monospaced">Student</span> is a subtype of
<span class="monospaced">Person</span>, there is no relationship between <span class="monospaced">Pair[Student]</span> and
<span class="monospaced">Pair[Person]</span>.</p></div>
<div class="paragraph"><p>If you want such a relationship, you have to indicate it when you define
the <span class="monospaced">Pair</span> class:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Pair</span><span class="o">[</span><span class="kt">+T</span><span class="o">](</span><span class="k">val</span> <span class="n">first</span><span class="k">:</span> <span class="kt">T</span><span class="o">,</span> <span class="k">val</span> <span class="n">second</span><span class="k">:</span> <span class="kt">T</span><span class="o">)</span>
</pre></div></div></div>
<div class="paragraph"><p>The <span class="monospaced">+</span> means that the type is <em>covariant</em> in <span class="monospaced">T</span>: It varies in the same
direction. Since <span class="monospaced">Student</span> is a subtype of <span class="monospaced">Person</span>, a <span class="monospaced">Pair[Student]</span> is
now a subtype of <span class="monospaced">Pair[Person]</span>.</p></div>
</div>
<div class="sect2">
<h3 id="_contravariance">Contravariance</h3>
<div class="paragraph"><p>It is also possible to have variance in the other direction. Consider a
generic type <span class="monospaced">Friend[T]</span>, which denotes someone who is willing to befriend
anyone of type <span class="monospaced">T</span>.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">trait</span> <span class="nc">Friend</span><span class="o">[</span><span class="kt">-T</span><span class="o">]</span> <span class="o">{</span>
  <span class="k">def</span> <span class="n">befriend</span><span class="o">(</span><span class="n">someone</span><span class="k">:</span> <span class="kt">T</span><span class="o">)</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>Now suppose you have a function</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">def</span> <span class="n">makeFriendWith</span><span class="o">(</span><span class="n">s</span><span class="k">:</span> <span class="kt">Student</span><span class="o">,</span> <span class="n">f</span><span class="k">:</span> <span class="kt">Friend</span><span class="o">[</span><span class="kt">Student</span><span class="o">])</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="o">{</span> <span class="n">f</span><span class="o">.</span><span class="n">befriend</span><span class="o">(</span><span class="n">s</span><span class="o">)</span> <span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>Can you call it with a <span class="monospaced">Friend[Person]</span>? That is, if you have</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Person</span> <span class="k">extends</span> <span class="nc">Friend</span><span class="o">[</span><span class="kt">Person</span><span class="o">]</span>
<span class="k">class</span> <span class="nc">Student</span> <span class="k">extends</span> <span class="nc">Person</span>
<span class="k">val</span> <span class="n">susan</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">Student</span>
<span class="k">val</span> <span class="n">fred</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">Person</span>
</pre></div></div></div>
<div class="paragraph"><p>will the call <span class="monospaced">makeFriendWith(susan, fred)</span> succeed? It seems like it should.
If Fred is willing to befriend any person, he’ll surely like to be friends
with Susan.</p></div>
<div class="paragraph"><p>Note that the type varies in the <em>opposite</em> direction of the subtype
relationship.</p></div>
<div class="paragraph"><p><span class="monospaced">Student</span> is a subtype of <span class="monospaced">Person</span>, but <span class="monospaced">Friend[Student]</span> is a supertype of
<span class="monospaced">Friend[Person]</span>. In that case, you declare the type parameter to be
contravariant:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">trait</span> <span class="nc">Friend</span><span class="o">[</span><span class="kt">-T</span><span class="o">]</span> <span class="o">{</span>
  <span class="k">def</span> <span class="n">befriend</span><span class="o">(</span><span class="n">someone</span><span class="k">:</span> <span class="kt">T</span><span class="o">)</span><span class="k">:</span> <span class="kt">Unit</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>You can have both variance types in a single generic type. For example,
single-argument functions have the type <span class="monospaced">Function1[-A, +R]</span>. To see why
these are the appropriate variances, consider a function</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">def</span> <span class="n">friends</span><span class="o">(</span><span class="n">students</span><span class="k">:</span> <span class="kt">Array</span><span class="o">[</span><span class="kt">Student</span><span class="o">],</span> <span class="n">find</span><span class="k">:</span> <span class="kt">Function1</span><span class="o">[</span><span class="kt">Student</span>, <span class="kt">Person</span><span class="o">])</span> <span class="k">=</span>
  <span class="c1">// You can write the second parameter as find: Student =&gt; Person</span>
  <span class="k">for</span> <span class="o">(</span><span class="n">s</span> <span class="k">&lt;-</span> <span class="n">students</span><span class="o">)</span> <span class="k">yield</span> <span class="n">find</span><span class="o">(</span><span class="n">s</span><span class="o">)</span>
</pre></div></div></div>
<div class="paragraph"><p>Suppose you have a function</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">def</span> <span class="n">findStudent</span><span class="o">(</span><span class="n">p</span><span class="k">:</span> <span class="kt">Person</span><span class="o">)</span><span class="k">:</span> <span class="kt">Student</span>
</pre></div></div></div>
<div class="paragraph"><p>Can you call <span class="monospaced">friends</span> with that function? Of course you can. It’s willing to
take any <span class="monospaced">Person</span>, so surely it will take a <span class="monospaced">Student</span>. It yields <span class="monospaced">Student</span>
results, which can be put into an <span class="monospaced">Array[Person]</span>.</p></div>
</div>
<div class="sect2">
<h3 id="_co_and_contravariant_positions">Co- and Contravariant Positions</h3>
<div class="paragraph"><p>We just saw that functions are contravariant in their arguments and
covariant in their results.</p></div>
<div class="paragraph"><p><strong>Principle: Generally, it makes sense to use contravariance for the values
an object <em>consumes</em>, and covariance for the values it <em>produces</em>.</strong></p></div>
<div class="paragraph"><p>If an object does both, then the type should be left invariant. This is
generally the case for mutable data structures.</p></div>
<div class="paragraph"><p>For example, in Scala, arrays are invariant. You can’t convert an
<span class="monospaced">Array[Student]</span> to an <span class="monospaced">Array[Person]</span> or the other way around. This would
not be safe. Consider the following:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">val</span> <span class="n">students</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">Array</span><span class="o">[</span><span class="kt">Student</span><span class="o">](</span><span class="n">length</span><span class="o">)</span>
<span class="k">val</span> <span class="n">people</span><span class="k">:</span> <span class="kt">Array</span><span class="o">[</span><span class="kt">Person</span><span class="o">]</span> <span class="k">=</span> <span class="n">students</span> <span class="c1">// Not legal, but suppose it was . . .</span>
<span class="n">people</span><span class="o">(</span><span class="mi">0</span><span class="o">)</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">Person</span><span class="o">(</span><span class="s">&quot;Fred&quot;</span><span class="o">)</span> <span class="c1">// Oh no! Now students(0) isn&#39;t a Student</span>
</pre></div></div></div>
<div class="paragraph"><p>Conversely,</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">val</span> <span class="n">people</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">Array</span><span class="o">[</span><span class="kt">Person</span><span class="o">](</span><span class="n">length</span><span class="o">)</span> <span class="k">val</span> <span class="n">students</span><span class="k">:</span> <span class="kt">Array</span><span class="o">[</span><span class="kt">Student</span><span class="o">]</span> <span class="k">=</span>
<span class="n">people</span> <span class="c1">// Not legal, but suppose it was . . . people(0) = new</span>
<span class="nc">Person</span><span class="o">(</span><span class="s">&quot;Fred&quot;</span><span class="o">)</span> <span class="c1">// Oh no! Now students(0) isn&#39;t a Student</span>
</pre></div></div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">In Java, it is possible to convert a <span class="monospaced">Student[]</span> array to a
<span class="monospaced">Person[]</span> array, but if you try to add a nonstudent into such an array, an
<span class="monospaced">ArrayStoreException</span> is thrown. In Scala, the <em>compiler</em> rejects programs
that could cause type errors. You don&#8217;t have to wait until runtime to find
out.</td>
</tr></table>
</div>
<div class="paragraph"><p>There are a few more nuances to covariance and contravariance. Please see
section 17.10 in <em>Scala for the Impatient</em> for all the gory details.</p></div>
</div>
<div class="sect2">
<h3 id="_objects_can_t_be_generic">Objects Can’t Be Generic</h3>
<div class="paragraph"><p>It is not possible to add type parameters to objects. Consider, for
example, immutable lists. A list with element type <span class="monospaced">T</span> is either empty, or it
is a node with a head of type <span class="monospaced">T</span> and a tail of type <span class="monospaced">List[T]</span>.</p></div>
<div class="paragraph"><p>Let&#8217;s use a slightly simplified version of the Scala <span class="monospaced">List</span> API:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">abstract</span> <span class="k">class</span> <span class="nc">List</span><span class="o">[</span><span class="kt">+T</span><span class="o">]</span> <span class="o">{</span>
  <span class="k">def</span> <span class="n">isEmpty</span><span class="k">:</span> <span class="kt">Boolean</span> <span class="kt">def</span> <span class="kt">head:</span> <span class="kt">T</span> <span class="kt">def</span> <span class="kt">tail:</span> <span class="kt">List</span><span class="o">[</span><span class="kt">T</span><span class="o">]</span>
<span class="o">}</span>

<span class="k">class</span> <span class="nc">Node</span><span class="o">[</span><span class="kt">T</span><span class="o">](</span><span class="k">val</span> <span class="n">head</span><span class="k">:</span> <span class="kt">T</span><span class="o">,</span> <span class="k">val</span> <span class="n">tail</span><span class="k">:</span> <span class="kt">List</span><span class="o">[</span><span class="kt">T</span><span class="o">])</span> <span class="k">extends</span> <span class="nc">List</span><span class="o">[</span><span class="kt">T</span><span class="o">]</span> <span class="o">{</span>
  <span class="k">def</span> <span class="n">isEmpty</span> <span class="k">=</span> <span class="kc">false</span>
<span class="o">}</span>

<span class="k">class</span> <span class="nc">Empty</span><span class="o">[</span><span class="kt">T</span><span class="o">]</span> <span class="nc">extends</span> <span class="nc">List</span><span class="o">[</span><span class="kt">T</span><span class="o">]</span> <span class="o">{</span>
  <span class="k">def</span> <span class="n">isEmpty</span> <span class="k">=</span> <span class="kc">true</span>
  <span class="k">def</span> <span class="n">head</span> <span class="k">=</span> <span class="k">throw</span> <span class="k">new</span> <span class="nc">UnsupportedOperationException</span>
  <span class="k">def</span> <span class="n">tail</span> <span class="k">=</span> <span class="k">throw</span> <span class="k">new</span> <span class="nc">UnsupportedOperationException</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>It seems silly to define <span class="monospaced">Empty</span> as a class. It has no state. But you can’t
simply turn it into an object:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">object</span> <span class="nc">Empty</span><span class="o">[</span><span class="kt">T</span><span class="o">]</span> <span class="nc">extends</span> <span class="nc">List</span><span class="o">[</span><span class="kt">T</span><span class="o">]</span> <span class="c1">// Error</span>
</pre></div></div></div>
<div class="paragraph"><p>You can’t add a parameterized type to an object. In this case, a remedy is
to inherit <span class="monospaced">List[Nothing]</span>:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">object</span> <span class="nc">Empty</span> <span class="k">extends</span> <span class="nc">List</span><span class="o">[</span><span class="kt">Nothing</span><span class="o">]</span>
</pre></div></div></div>
<div class="paragraph"><p>Recall that the <span class="monospaced">Nothing</span> type is a subtype of all types. Thus, when we
make a one-element list</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">val</span> <span class="n">lst</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">Node</span><span class="o">(</span><span class="mi">42</span><span class="o">,</span> <span class="nc">Empty</span><span class="o">)</span>
</pre></div></div></div>
<div class="paragraph"><p>type checking is successful. Due to covariance, a <span class="monospaced">List[Nothing]</span> is
convertible into a <span class="monospaced">List[Int]</span>, and the <span class="monospaced">Node[Int]</span> constructor can be
invoked.</p></div>
</div>
<div class="sect2">
<h3 id="_wildcards">Wildcards</h3>
<div class="paragraph"><p>In Java, all generic types are invariant. However, you can vary the types
where you use them, using wildcards. For example, a method</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="kt">void</span> <span class="nf">makeFriends</span><span class="o">(</span><span class="n">List</span><span class="o">&lt;?</span> <span class="kd">extends</span> <span class="n">Person</span><span class="o">&gt;</span> <span class="n">people</span><span class="o">)</span> <span class="c1">// This is Java</span>
</pre></div></div></div>
<div class="paragraph"><p>can be called with a <span class="monospaced">List&lt;Student&gt;</span>.</p></div>
<div class="paragraph"><p>You can use wildcards in Scala too. They look like this:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">def</span> <span class="n">process</span><span class="o">(</span><span class="n">people</span><span class="k">:</span> <span class="kt">java.util.List</span><span class="o">[</span><span class="k">_</span> <span class="k">&lt;:</span> <span class="kt">Person</span><span class="o">])</span> <span class="c1">// This is Scala</span>
</pre></div></div></div>
<div class="paragraph"><p>In Scala, you don’t need the wildcard for a covariant <span class="monospaced">Pair</span> class. But
suppose <span class="monospaced">Pair</span> is invariant:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Pair</span><span class="o">[</span><span class="kt">T</span><span class="o">](</span><span class="k">var</span> <span class="n">first</span><span class="k">:</span> <span class="kt">T</span><span class="o">,</span> <span class="k">var</span> <span class="n">second</span><span class="k">:</span> <span class="kt">T</span><span class="o">)</span>
</pre></div></div></div>
<div class="paragraph"><p>Then you can define</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">def</span> <span class="n">makeFriends</span><span class="o">(</span><span class="n">p</span><span class="k">:</span> <span class="kt">Pair</span><span class="o">[</span><span class="k">_</span> <span class="k">&lt;:</span> <span class="kt">Person</span><span class="o">])</span> <span class="c1">// OK to call with a Pair[Student]</span>
</pre></div></div></div>
<div class="paragraph"><p>You can also use wildcards for contravariance:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">import</span> <span class="nn">java.util.Comparator</span>
<span class="k">def</span> <span class="n">min</span><span class="o">[</span><span class="kt">T</span><span class="o">](</span><span class="n">p</span><span class="k">:</span> <span class="kt">Pair</span><span class="o">[</span><span class="kt">T</span><span class="o">])(</span><span class="n">comp</span><span class="k">:</span> <span class="kt">Comparator</span><span class="o">[</span><span class="k">_</span> <span class="k">&gt;:</span> <span class="kt">T</span><span class="o">])</span>
</pre></div></div></div>
<div class="paragraph"><p>Wildcards are "syntactic sugar" for existential types, which we will
discuss in detail in the next lesson.</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="lesson-18-advanced-types">Advanced Types</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_lesson_objectives_16">Lesson Objectives</h3>
<div class="paragraph"><p>In this lesson, wee will see all the types that Scala has to offer,
including some of the more technical ones. We end with a discussion of self
types and dependency injection.</p></div>
</div>
<div class="sect2">
<h3 id="_summary_15">Summary</h3>
<div class="ulist"><ul>
<li>
<p>
Singleton types are useful for method chaining and methods with object
  parameters.
</p>
</li>
<li>
<p>
A type alias gives a short name for a type.
</p>
</li>
<li>
<p>
Structural types are equivalent to "duck typing."
</p>
</li>
<li>
<p>
Use a self type declaration to indicate that a trait requires another
  type.
</p>
</li>
<li>
<p>
The "cake pattern" uses self types to implement a dependency injection
  mechanism.
</p>
</li>
<li>
<p>
An abstract type must be made concrete in a subclass.
</p>
</li>
<li>
<p>
A higher-kinded type has a type parameter that is itself a parameterized type.
</p>
</li>
</ul></div>
</div>
<div class="sect2">
<h3 id="_singleton_types">Singleton Types</h3>
<div class="paragraph"><p>Given any reference v, you can form the type v.type, which has two values: v and null. This sounds like a curious type, but it has a couple of useful applications.</p></div>
<div class="paragraph"><p>First, consider a method that returns this so you can chain method calls:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Document</span> <span class="o">{</span>
  <span class="k">def</span> <span class="n">setTitle</span><span class="o">(</span><span class="n">title</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span> <span class="k">=</span> <span class="o">{</span> <span class="o">...;</span> <span class="k">this</span> <span class="o">}</span>
  <span class="k">def</span> <span class="n">setAuthor</span><span class="o">(</span><span class="n">author</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span> <span class="k">=</span> <span class="o">{</span> <span class="o">...;</span> <span class="k">this</span> <span class="o">}</span>
  <span class="o">...</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>You can then call</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="n">article</span><span class="o">.</span><span class="n">setTitle</span><span class="o">(</span><span class="s">&quot;Whatever Floats Your Boat&quot;</span><span class="o">).</span><span class="n">setAuthor</span><span class="o">(</span><span class="s">&quot;Cay Horstmann&quot;</span><span class="o">)</span>
</pre></div></div></div>
<div class="paragraph"><p>However, if you have a subclass, there is a problem:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Book</span> <span class="k">extends</span> <span class="nc">Document</span> <span class="o">{</span>
  <span class="k">def</span> <span class="n">addChapter</span><span class="o">(</span><span class="n">chapter</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span> <span class="k">=</span> <span class="o">{</span> <span class="o">...;</span> <span class="k">this</span> <span class="o">}</span>
  <span class="o">...</span>
<span class="o">}</span>

<span class="k">val</span> <span class="n">book</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">Book</span><span class="o">()</span>
<span class="n">book</span><span class="o">.</span><span class="n">setTitle</span><span class="o">(</span><span class="s">&quot;Scala for the Impatient&quot;</span><span class="o">).</span><span class="n">addChapter</span><span class="o">(</span><span class="n">chapter1</span><span class="o">)</span> <span class="c1">// Error</span>
</pre></div></div></div>
<div class="paragraph"><p>Since the <span class="monospaced">setTitle</span> method returns <span class="monospaced">this</span>, Scala infers the return type as
<span class="monospaced">Document</span>. But <span class="monospaced">Document</span> doesn’t have an <span class="monospaced">addChapter</span> method.</p></div>
<div class="paragraph"><p>The remedy is to declare the return type of <span class="monospaced">setTitle</span> as <span class="monospaced">this.type</span>:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">def</span> <span class="n">setTitle</span><span class="o">(</span><span class="n">title</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span><span class="k">:</span> <span class="kt">this.</span><span class="k">type</span> <span class="o">=</span> <span class="o">{</span> <span class="o">...;</span> <span class="k">this</span> <span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>Now the return type of book.setTitle("&#8230;") is <span class="monospaced">Book.type</span>, and since <span class="monospaced">Book</span>
has an <span class="monospaced">addChapter</span> method, the chaining works.</p></div>
</div>
<div class="sect2">
<h3 id="_type_aliases">Type Aliases</h3>
<div class="paragraph"><p>You can create a simple alias for a complicated type with the <span class="monospaced">type</span>
keyword, like this:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Book</span> <span class="o">{</span>
  <span class="k">import</span> <span class="nn">scala.collection.mutable._</span>
  <span class="k">type</span> <span class="kt">Index</span> <span class="o">=</span> <span class="nc">HashMap</span><span class="o">[</span><span class="kt">String</span>, <span class="o">(</span><span class="kt">Int</span>, <span class="kt">Int</span><span class="o">)]</span>
  <span class="o">...</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>Then you can refer to more readable <span class="monospaced">Book.Index</span> instead of the cumbersome
type <span class="monospaced">scala.collection.mutable.HashMap[String, (Int, Int)]</span>.</p></div>
<div class="paragraph"><p>A type alias must be nested <em>inside</em> a class or object. It cannot appear at
the top level of a Scala file.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">The <span class="monospaced">type</span> keyword has other uses, which will see shortly.</td>
</tr></table>
</div>
</div>
<div class="sect2">
<h3 id="_structural_types">Structural Types</h3>
<div class="paragraph"><p>A "structural type" is a specification of abstract methods, fields, and
types that a conforming type should possess. For example, this method has a
structural type parameter:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">def</span> <span class="n">appendLines</span><span class="o">(</span><span class="n">target</span><span class="k">:</span> <span class="o">{</span> <span class="kt">def</span> <span class="kt">append</span><span class="o">(</span><span class="kt">str:</span> <span class="kt">String</span><span class="o">)</span><span class="kt">:</span> <span class="kt">Any</span> <span class="o">},</span>
                <span class="n">lines</span><span class="k">:</span>  <span class="kt">Iterable</span><span class="o">[</span><span class="kt">String</span><span class="o">])</span> <span class="o">{</span>
  <span class="k">for</span> <span class="o">(</span><span class="n">l</span> <span class="k">&lt;-</span> <span class="n">lines</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">target</span><span class="o">.</span><span class="n">append</span><span class="o">(</span><span class="n">l</span><span class="o">)</span>
    <span class="n">target</span><span class="o">.</span><span class="n">append</span><span class="o">(</span><span class="s">&quot;\n&quot;</span><span class="o">)</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>You can call the <span class="monospaced">appendLines</span> method with an instance of <em>any</em> class that
has an <em>append</em> method taking a string.</p></div>
<div class="paragraph"><p>This is more flexible than defining a <span class="monospaced">Appendable</span> trait, because you might
not always be able to add that trait to the classes you are using.</p></div>
<div class="paragraph"><p>Under the hood, Scala uses reflection to make the calls to
<span class="monospaced">target.append(...)</span>. Structural typing gives you a safe and convenient way
of making such calls.</p></div>
<div class="paragraph"><p>However, a reflective call is <em>much</em> more expensive than a regular method
call. For that reason, you should only use structural typing when you model
common behavior from classes that cannot share a trait.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">Structural types are similar to "duck typing" in dynamically typed
programming languages such as JavaScript or Ruby. In those languages,
variables have no type. When you write <span class="monospaced">obj.quack()</span>, the runtime figures
out whether the particular object to which <span class="monospaced">obj</span> refers at this point has a
<span class="monospaced">quack</span> method. In other words, you don’t have to declare obj as a <span class="monospaced">Duck</span> as
long as it walks and quacks like one.</td>
</tr></table>
</div>
</div>
<div class="sect2">
<h3 id="_compound_types">Compound Types</h3>
<div class="paragraph"><p>A compound type has the form</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>T1 with T2 with T3 ...</pre>
</div></div>
<div class="paragraph"><p>where <span class="monospaced">T1</span>, <span class="monospaced">T2</span>, <span class="monospaced">T3</span>, and so on are types. In order to belong to the
<em>compound</em> type, a value must belong to all of the <em>individual</em> types.</p></div>
<div class="paragraph"><p>Such a type is also called an <em>intersection type</em>.</p></div>
<div class="paragraph"><p>You can use a compound type to manipulate values that must provide multiple
traits. For example,</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">val</span> <span class="n">image</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">ArrayBuffer</span><span class="o">[</span><span class="kt">java.awt.Shape</span> <span class="kt">with</span> <span class="kt">java.io.Serializable</span><span class="o">]</span>
</pre></div></div></div>
<div class="paragraph"><p>You can draw the image object as</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">for</span> <span class="o">(</span><span class="n">s</span> <span class="k">&lt;-</span> <span class="n">image</span><span class="o">)</span> <span class="n">graphics</span><span class="o">.</span><span class="n">draw</span><span class="o">(</span><span class="n">s</span><span class="o">)</span>
</pre></div></div></div>
<div class="paragraph"><p>You can serialize the <span class="monospaced">image</span> object because you know that all elements are
serializable.</p></div>
<div class="paragraph"><p>Of course, you can only add elements that are both shapes and serializable
objects:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">val</span> <span class="n">rect</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">Rectangle</span><span class="o">(</span><span class="mi">5</span><span class="o">,</span> <span class="mi">10</span><span class="o">,</span> <span class="mi">20</span><span class="o">,</span> <span class="mi">30</span><span class="o">)</span>
<span class="n">image</span> <span class="o">+=</span> <span class="n">rect</span>           <span class="c1">// OK: Rectangle is Serializable</span>
<span class="n">image</span> <span class="o">+=</span> <span class="k">new</span> <span class="nc">Area</span><span class="o">(</span><span class="n">rect</span><span class="o">)</span> <span class="c1">// Error: Area is a Shape but not Serializable</span>
</pre></div></div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph"><p>When you have a declaration</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">trait</span> <span class="nc">ImageShape</span> <span class="k">extends</span> <span class="nc">Shape</span> <span class="k">with</span> <span class="nc">Serializable</span>
</pre></div></div></div>
<div class="paragraph"><p>this means that <span class="monospaced">ImageShape</span> extends the intersection type
<span class="monospaced">Shape with Serializable</span>.</p></div>
</td>
</tr></table>
</div>
</div>
<div class="sect2">
<h3 id="_compound_types_and_structural_types">Compound Types and Structural Types</h3>
<div class="paragraph"><p>You can add a structural type declaration to a simple or compound type. For
example:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="nc">Shape</span> <span class="k">with</span> <span class="nc">Serializable</span> <span class="o">{</span> <span class="k">def</span> <span class="n">contains</span><span class="o">(</span><span class="n">p</span><span class="k">:</span> <span class="kt">Point</span><span class="o">)</span><span class="k">:</span> <span class="kt">Boolean</span> <span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>An instance of this type must:</p></div>
<div class="ulist"><ul>
<li>
<p>
be a subtype of <span class="monospaced">Shape</span>
</p>
</li>
<li>
<p>
be a <span class="monospaced">Serializable</span>
</p>
</li>
<li>
<p>
have a <span class="monospaced">contains</span> method with that takes a <span class="monospaced">Point</span> parameter
</p>
</li>
</ul></div>
</div>
<div class="sect2">
<h3 id="_self_types_2">Self Types</h3>
<div class="paragraph"><p>In Chapter 10, you saw how a trait can require that it is mixed into a
class that extends another type. You define the trait with a self type
declaration:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">this:</span> <span class="kt">Type</span> <span class="o">=&gt;</span>
</pre></div></div></div>
<div class="paragraph"><p>Such a trait can only be mixed into a subclass of the given type. In the
following example, the <span class="monospaced">LoggedException</span> trait can only be mixed into a
class that extends <span class="monospaced">Exception</span>:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">trait</span> <span class="nc">Logged</span> <span class="o">{</span>
  <span class="k">def</span> <span class="n">log</span><span class="o">(</span><span class="n">msg</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span>
<span class="o">}</span>

<span class="k">trait</span> <span class="nc">LoggedException</span> <span class="k">extends</span> <span class="nc">Logged</span> <span class="o">{</span>
  <span class="k">this:</span> <span class="kt">Exception</span> <span class="o">=&gt;</span>
    <span class="k">def</span> <span class="n">log</span><span class="o">()</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="o">{</span> <span class="n">log</span><span class="o">(</span><span class="n">getMessage</span><span class="o">())</span> <span class="o">}</span>
      <span class="c1">// OK to call getMessage because this is an Exception</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>If you try to mix the trait into a class that doesn’t conform to the self
type, an error occurs:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">val</span> <span class="n">f</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">JFrame</span> <span class="k">with</span> <span class="nc">LoggedException</span>
<span class="c1">// Error: JFrame isn&#39;t a subtype of Exception, the self type of LoggedException</span>
</pre></div></div></div>
<div class="paragraph"><p>If you want to require multiple types, use a compound type:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">this:</span> <span class="kt">T</span> <span class="kt">with</span> <span class="kt">U</span> <span class="kt">with</span> <span class="kt">...</span> <span class="o">=&gt;</span>
</pre></div></div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph"><p>You can combine the self type syntax with the "alias for enclosing this"
syntax. If you give a name other than <span class="monospaced">this</span> to the variable, then it can
be used in subtypes by that name. For example:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">trait</span> <span class="nc">Group</span> <span class="o">{</span>
  <span class="n">outer</span><span class="k">:</span> <span class="kt">Network</span> <span class="o">=&gt;</span>
    <span class="k">class</span> <span class="nc">Member</span> <span class="o">{</span>
     <span class="o">...</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>The <span class="monospaced">Group</span> trait requires that it is added to a subtype of <span class="monospaced">Network</span>, and
inside <span class="monospaced">Member</span>, you can refer to <span class="monospaced">Group.this</span> as <span class="monospaced">outer</span>.</p></div>
<div class="paragraph"><p>This syntax seems to have grown organically over time; unfortunately, it
introduces a <em>lot</em> confusion.</p></div>
</td>
</tr></table>
</div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Caution</div>
</td>
<td class="content">
<div class="paragraph"><p>Self types do not automatically inherit. If you define</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">trait</span> <span class="nc">ManagedException</span> <span class="k">extends</span> <span class="nc">LoggedException</span> <span class="o">{</span> <span class="o">...</span> <span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>you get an error that <span class="monospaced">ManagedException</span> doesn’t supply <span class="monospaced">Exception</span>. In this
situation, you need to repeat the self type:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">trait</span> <span class="nc">ManagedException</span> <span class="k">extends</span> <span class="nc">LoggedException</span> <span class="o">{</span>
  <span class="k">this:</span> <span class="kt">Exception</span> <span class="o">=&gt;</span>
    <span class="o">...</span>
<span class="o">}</span>
</pre></div></div></div>
</td>
</tr></table>
</div>
</div>
<div class="sect2">
<h3 id="_dependency_injection">Dependency Injection</h3>
<div class="paragraph"><p>When building a large system out of components, with different
implementations for each component, one needs to assemble the component
choices.</p></div>
<div class="paragraph"><p>For example, there may be a mock database and a real database, or
console logging and file logging. A particular implementation may want the
real database and console logging for running an experiment, or the mock
database and file logging for running an automated test script.</p></div>
<div class="paragraph"><p>Usually, there is some dependency among the components. For example, the
data access component may require logging.</p></div>
<div class="paragraph"><p>Java has several tools that allow programmers to express dependencies
through frameworks such as Spring or module systems such as OSGi. Each
component describes on which other component interfaces it depends.
References to actual component implementations are "injected" when the
application is assembled.</p></div>
<div class="paragraph"><p>In Scala, you can achieve a simple form of dependency injection with traits
and self types.</p></div>
<div class="paragraph"><p>For logging, suppose we have a trait</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">trait</span> <span class="nc">Logger</span> <span class="o">{</span> <span class="k">def</span> <span class="n">log</span><span class="o">(</span><span class="n">msg</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span> <span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>with implementations <span class="monospaced">ConsoleLogger</span> and <span class="monospaced">FileLogger</span>.</p></div>
<div class="paragraph"><p>The user authentication trait has a logging dependency to log
authentication failures:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">trait</span> <span class="nc">Auth</span> <span class="o">{</span>
  <span class="k">this:</span> <span class="kt">Logger</span> <span class="o">=&gt;</span>
     <span class="k">def</span> <span class="n">login</span><span class="o">(</span><span class="n">id</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">password</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span><span class="k">:</span> <span class="kt">Boolean</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>The application logic depends on both:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">trait</span> <span class="nc">App</span> <span class="o">{</span>
  <span class="k">this:</span> <span class="kt">Logger</span> <span class="kt">with</span> <span class="kt">Auth</span> <span class="o">=&gt;</span>
    <span class="o">...</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>Now we can assemble an application as</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">object</span> <span class="nc">MyApp</span> <span class="k">extends</span> <span class="nc">App</span> <span class="k">with</span> <span class="nc">FileLogger</span><span class="o">(</span><span class="s">&quot;test.log&quot;</span><span class="o">)</span> <span class="k">with</span> <span class="nc">MockAuth</span><span class="o">(</span><span class="s">&quot;users.txt&quot;</span><span class="o">)</span>
</pre></div></div></div>
<div class="paragraph"><p>It’s a bit awkward to use trait composition in this way. After all, an
application isn’t an authenticator and a file logger. It has these
components, and it is more natural to use instance variables for the
components than to glue them all into one huge type.</p></div>
<div class="sect3">
<h4 id="_dependency_injection_with_the_cake_pattern">Dependency Injection with the Cake Pattern</h4>
<div class="paragraph"><p>A better design is given by the <em>cake pattern</em>. In this pattern, you supply
a component trait for each service that contains</p></div>
<div class="ulist"><ul>
<li>
<p>
Any dependent components, expressed as self types
</p>
</li>
<li>
<p>
A trait describing the service interface
</p>
</li>
<li>
<p>
An abstract <span class="monospaced">val</span> that will be instantiated with an instance of the service
</p>
</li>
<li>
<p>
Optionally, implementations of the service interface
</p>
</li>
</ul></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">trait</span> <span class="nc">LoggerComponent</span> <span class="o">{</span>
  <span class="k">trait</span> <span class="nc">Logger</span> <span class="o">{</span> <span class="o">...</span> <span class="o">}</span>
  <span class="k">val</span> <span class="n">logger</span><span class="k">:</span> <span class="kt">Logger</span>
  <span class="k">class</span> <span class="nc">FileLogger</span><span class="o">(</span><span class="n">file</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">Logger</span> <span class="o">{</span> <span class="o">...</span> <span class="o">}</span>
  <span class="o">...</span>
<span class="o">}</span>

<span class="k">trait</span> <span class="nc">AuthComponent</span> <span class="o">{</span>
  <span class="k">this:</span> <span class="kt">LoggerComponent</span> <span class="o">=&gt;</span> <span class="c1">// Gives access to logger</span>

  <span class="k">trait</span> <span class="nc">Auth</span> <span class="o">{</span> <span class="o">...</span> <span class="o">}</span>
  <span class="k">val</span> <span class="n">auth</span><span class="k">:</span> <span class="kt">Auth</span>
  <span class="k">class</span> <span class="nc">MockAuth</span><span class="o">(</span><span class="n">file</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">Auth</span> <span class="o">{</span> <span class="o">...</span> <span class="o">}</span>
  <span class="o">...</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>Note the use of the self type to indicate that the authentication component
requires the logger component.</p></div>
<div class="paragraph"><p>Now the component configuration can happen in one central place:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">object</span> <span class="nc">AppComponents</span> <span class="k">extends</span> <span class="nc">LoggerComponent</span> <span class="k">with</span> <span class="nc">AuthComponent</span> <span class="o">{</span>
  <span class="k">val</span> <span class="n">logger</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">FileLogger</span><span class="o">(</span><span class="s">&quot;test.log&quot;</span><span class="o">)</span>
  <span class="k">val</span> <span class="n">auth</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">MockAuth</span><span class="o">(</span><span class="s">&quot;users.txt&quot;</span><span class="o">)</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>Either approach is better than component wiring in an XML file because the
compiler can verify that the module dependencies are satisfied.</p></div>
</div>
</div>
<div class="sect2">
<h3 id="_abstract_types">Abstract Types</h3>
<div class="paragraph"><p>A class or trait can define an abstract type that is made concrete in a
subclass. For example:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">trait</span> <span class="nc">Reader</span> <span class="o">{</span>
  <span class="k">type</span> <span class="kt">Contents</span>
  <span class="k">def</span> <span class="n">read</span><span class="o">(</span><span class="n">fileName</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span><span class="k">:</span> <span class="kt">Contents</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>Here, the type <span class="monospaced">Contents</span> is abstract. A concrete subclass needs to specify
the type:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">class</span> <span class="nc">StringReader</span> <span class="k">extends</span> <span class="nc">Reader</span> <span class="o">{</span>
  <span class="k">type</span> <span class="kt">Contents</span> <span class="o">=</span> <span class="nc">String</span>
  <span class="k">def</span> <span class="n">read</span><span class="o">(</span><span class="n">fileName</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span> <span class="k">=</span> <span class="nc">Source</span><span class="o">.</span><span class="n">fromFile</span><span class="o">(</span><span class="n">fileName</span><span class="o">,</span> <span class="s">&quot;UTF-8&quot;</span><span class="o">).</span><span class="n">mkString</span>
<span class="o">}</span>

<span class="k">class</span> <span class="nc">ImageReader</span> <span class="k">extends</span> <span class="nc">Reader</span> <span class="o">{</span>
  <span class="k">type</span> <span class="kt">Contents</span> <span class="o">=</span> <span class="nc">BufferedImage</span>
  <span class="k">def</span> <span class="n">read</span><span class="o">(</span><span class="n">fileName</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span> <span class="k">=</span> <span class="nc">ImageIO</span><span class="o">.</span><span class="n">read</span><span class="o">(</span><span class="k">new</span> <span class="nc">File</span><span class="o">(</span><span class="n">fileName</span><span class="o">))</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>The same effect could be achieved with a type parameter:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">trait</span> <span class="nc">Reader</span><span class="o">[</span><span class="kt">C</span><span class="o">]</span> <span class="o">{</span>
  <span class="k">def</span> <span class="n">read</span><span class="o">(</span><span class="n">fileName</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span><span class="k">:</span> <span class="kt">C</span>
<span class="o">}</span>

<span class="k">class</span> <span class="nc">StringReader</span> <span class="k">extends</span> <span class="nc">Reader</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="o">{</span>
  <span class="k">def</span> <span class="n">read</span><span class="o">(</span><span class="n">fileName</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span> <span class="k">=</span> <span class="nc">Source</span><span class="o">.</span><span class="n">fromFile</span><span class="o">(</span><span class="n">fileName</span><span class="o">,</span> <span class="s">&quot;UTF-8&quot;</span><span class="o">).</span><span class="n">mkString</span>
<span class="o">}</span>

<span class="k">class</span> <span class="nc">ImageReader</span> <span class="k">extends</span> <span class="nc">Reader</span><span class="o">[</span><span class="kt">BufferedImage</span><span class="o">]</span> <span class="o">{</span>
  <span class="k">def</span> <span class="n">read</span><span class="o">(</span><span class="n">fileName</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span> <span class="k">=</span> <span class="nc">ImageIO</span><span class="o">.</span><span class="n">read</span><span class="o">(</span><span class="k">new</span> <span class="nc">File</span><span class="o">(</span><span class="n">fileName</span><span class="o">))</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>Which is better? In Scala, the rule of thumb is:</p></div>
<div class="ulist"><ul>
<li>
<p>
Use type parameters when the types are supplied as the class is
  instantiated. For example, when you construct a <span class="monospaced">HashMap[String, Int]</span>, you
  want control over the types.
</p>
</li>
<li>
<p>
Use abstract types when the types are expected to be supplied in a
  subclass. That is the case in our <span class="monospaced">Reader</span> example.
</p>
</li>
</ul></div>
<div class="paragraph"><p>Nothing bad will happen if you specify type parameters as you form a
subclass. But abstract types can work better when there are many type
dependencies. They allow you to avoid long lists of type parameters.
For example:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">trait</span> <span class="nc">Reader</span> <span class="o">{</span>
  <span class="k">type</span> <span class="kt">In</span>
  <span class="k">type</span> <span class="kt">Contents</span>
  <span class="k">def</span> <span class="n">read</span><span class="o">(</span><span class="n">in</span><span class="k">:</span> <span class="kt">In</span><span class="o">)</span><span class="k">:</span> <span class="kt">Contents</span>
<span class="o">}</span>

<span class="k">class</span> <span class="nc">ImageReader</span> <span class="k">extends</span> <span class="nc">Reader</span> <span class="o">{</span>
  <span class="k">type</span> <span class="kt">In</span> <span class="o">=</span> <span class="nc">File</span>
  <span class="k">type</span> <span class="kt">Contents</span> <span class="o">=</span> <span class="nc">BufferedImage</span>
  <span class="k">def</span> <span class="n">read</span><span class="o">(</span><span class="n">file</span><span class="k">:</span> <span class="kt">In</span><span class="o">)</span> <span class="k">=</span> <span class="nc">ImageIO</span><span class="o">.</span><span class="n">read</span><span class="o">(</span><span class="n">file</span><span class="o">)</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>With type parameters, we&#8217;d express <span class="monospaced">ImageReader</span> as:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">class</span> <span class="nc">ImageReader</span> <span class="k">extends</span> <span class="nc">Reader</span><span class="o">[</span><span class="kt">File</span>, <span class="kt">BufferedImage</span><span class="o">]</span>
</pre></div></div></div>
<div class="paragraph"><p>That’s still fine, but this technique doesn’t scale very well in more
complex situations.</p></div>
<div class="paragraph"><p>Abstract types can have type bounds, just like type parameters. For
example:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">trait</span> <span class="nc">Listener</span> <span class="o">{</span>
  <span class="k">type</span> <span class="kt">Event</span> <span class="k">&lt;:</span> <span class="kt">java.util.EventObject</span>
  <span class="o">...</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>A subclass must provide a compatible type, for example:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">trait</span> <span class="nc">ActionListener</span> <span class="k">extends</span> <span class="nc">Listener</span> <span class="o">{</span>
  <span class="k">type</span> <span class="kt">Event</span> <span class="o">=</span> <span class="n">java</span><span class="o">.</span><span class="n">awt</span><span class="o">.</span><span class="n">event</span><span class="o">.</span><span class="nc">ActionEvent</span> <span class="c1">// OK, it&#39;s a subtype</span>
<span class="o">}</span>
</pre></div></div></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="lesson-21-implicits">Implicits</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_lesson_objectives_17">Lesson Objectives</h3>
<div class="paragraph"><p>Implicit conversions and implicit parameters are Scala’s power tools that
do useful work behind the scenes. In this chapter, you will learn how
implicit conversions can be used to enrich existing classes, and how
implicit objects are summoned automatically to carry out conversions or
other tasks. With implicits, you can provide elegant libraries that hide
tedious details from library users.</p></div>
</div>
<div class="sect2">
<h3 id="_summary_16">Summary</h3>
<div class="ulist"><ul>
<li>
<p>
Implicit conversions are used to convert between types.
</p>
</li>
<li>
<p>
You must import implicit conversions so that they are in scope as single
  identifiers.
</p>
</li>
<li>
<p>
An implicit parameter list requests objects of a given type. They can be
  obtained from implicit objects that are defined as single identifiers in
  scope, or from the companion object of the desired type.
</p>
</li>
<li>
<p>
If an implicit parameter is a single-argument function, it is also used
  as an implicit conversion.
</p>
</li>
<li>
<p>
A context bound of a type parameter requires the existence of an implicit
  object of the given type.
</p>
</li>
<li>
<p>
If it is possible to locate an implicit object, this can serve as
  evidence that a type conversion is valid.
</p>
</li>
</ul></div>
</div>
<div class="sect2">
<h3 id="_implicit_conversions">Implicit Conversions</h3>
<div class="paragraph"><p>An implicit conversion function is a function with a single parameter that
is declared with the <span class="monospaced">implicit</span> keyword. As the name suggests, such a
function is automatically applied to convert values from one type to
another.</p></div>
<div class="paragraph"><p>Here is a simple example. We want to convert integers <em>n</em> to fractions
<em>n / 1</em>.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">implicit</span> <span class="k">def</span> <span class="n">int2Fraction</span><span class="o">(</span><span class="n">n</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span> <span class="k">=</span> <span class="nc">Fraction</span><span class="o">(</span><span class="n">n</span><span class="o">,</span> <span class="mi">1</span><span class="o">)</span>
</pre></div></div></div>
<div class="paragraph"><p>Now we can evaluate</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">val</span> <span class="n">result</span> <span class="k">=</span> <span class="mi">3</span> <span class="o">*</span> <span class="nc">Fraction</span><span class="o">(</span><span class="mi">4</span><span class="o">,</span> <span class="mi">5</span><span class="o">)</span> <span class="c1">// Calls int2Fraction(3)</span>
</pre></div></div></div>
<div class="paragraph"><p>The implicit conversion function turns the integer 3 into a <span class="monospaced">Fraction</span>
object. That object is then multiplied by <span class="monospaced">Fraction(4, 5)</span>.</p></div>
<div class="paragraph"><p>You can give any name to the conversion function. Since you don’t call it
explicitly, you may be tempted to use something short such as <span class="monospaced">i2f</span>. But,
as we will see in shortly, sometimes it is useful to import a single
conversion function. Thus, most people stick with something like
<span class="monospaced">sourceType2TargetType</span>.</p></div>
<div class="paragraph"><p>Scala is not the first language that allows the programmer to provide
automatic conversions. However, Scala gives programmers a great deal of
control over when to apply these conversions. In the following sections, we
will discuss exactly when the conversions happen, and how you can fine-tune
the process.</p></div>
</div>
<div class="sect2">
<h3 id="_using_implicits_for_enriching_existing_libraries">Using Implicits for Enriching Existing Libraries</h3>
<div class="paragraph"><p>Did you ever wish that a class had a method that its creator failed to
provide? For example, wouldn’t it be nice if the <span class="monospaced">java.io.File</span> class had a
read method for reading a file:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">val</span> <span class="n">contents</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">File</span><span class="o">(</span><span class="s">&quot;README&quot;</span><span class="o">).</span><span class="n">read</span>
</pre></div></div></div>
<div class="paragraph"><p>As a Java programmer, you <em>could</em> create your own subclass of <span class="monospaced">File</span>,
supplying that method. But what about <span class="monospaced">final</span> classes, like <span class="monospaced">String</span>?</p></div>
<div class="paragraph"><p>In Scala, you can define an enriched type that provides what you want:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">class</span> <span class="nc">RichFile</span><span class="o">(</span><span class="k">val</span> <span class="n">from</span><span class="k">:</span> <span class="kt">File</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">def</span> <span class="n">read</span> <span class="k">=</span> <span class="nc">Source</span><span class="o">.</span><span class="n">fromFile</span><span class="o">(</span><span class="n">from</span><span class="o">.</span><span class="n">getPath</span><span class="o">).</span><span class="n">mkString</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>Then, provide an implicit conversion to that type:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">implicit</span> <span class="k">def</span> <span class="n">file2RichFile</span><span class="o">(</span><span class="n">from</span><span class="k">:</span> <span class="kt">File</span><span class="o">)</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">RichFile</span><span class="o">(</span><span class="n">from</span><span class="o">)</span>
</pre></div></div></div>
<div class="paragraph"><p>Now you can call read on a <span class="monospaced">File</span> object. It is implicitly converted to a
<span class="monospaced">RichFile</span>.</p></div>
<div class="paragraph"><p>Scala 2.10 added <em>implicit classes</em>, which combine the enrichment class and
the conversion function. As noted at
<a href="http://docs.scala-lang.org/overviews/core/implicit-classes.html">http://docs.scala-lang.org/overviews/core/implicit-classes.html</a>, "An
implicit class is a class marked with the <em>implicit</em> keyword. This keyword
makes the class’ primary constructor available for implicit conversions
when the class is in scope."</p></div>
<div class="paragraph"><p>Thus, if you&#8217;re using Scala 2.10 or better, you can simplify the above example
as:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">implicit</span> <span class="k">class</span> <span class="nc">RichFile</span><span class="o">(</span><span class="k">val</span> <span class="n">from</span><span class="k">:</span> <span class="kt">File</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">def</span> <span class="n">read</span> <span class="k">=</span> <span class="nc">Source</span><span class="o">.</span><span class="n">fromFile</span><span class="o">(</span><span class="n">from</span><span class="o">.</span><span class="n">getPath</span><span class="o">).</span><span class="n">mkString</span>
<span class="o">}</span>
</pre></div></div></div>
</div>
<div class="sect2">
<h3 id="_importing_implicits">Importing Implicits</h3>
<div class="paragraph"><p>Scala will consider the following implicit conversion functions:</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Implicit functions in the companion object of the source or target type
</p>
</li>
<li>
<p>
Implicit functions that are in scope as a single identifier
</p>
</li>
</ol></div>
<div class="paragraph"><p>For example, consider the <span class="monospaced">int2Fraction</span> function. We can place it into the
<span class="monospaced">Fraction</span> companion object, and it will be available for converting
fractions.</p></div>
<div class="paragraph"><p>Alternatively, let’s suppose we put it inside a <span class="monospaced">FractionConversions</span>
object, which we define in the <span class="monospaced">com.horstmann.impatient</span> package. If you
want to use the conversion, import the <span class="monospaced">FractionConversions</span> object, like
this:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">import</span> <span class="nn">com.horstmann.impatient.FractionConversions._</span>
</pre></div></div></div>
<div class="paragraph"><p>The following import would not be sufficient:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">import</span> <span class="nn">com.horstmann.impatient.FractionConversions</span>
</pre></div></div></div>
<div class="paragraph"><p>This statement imports the <span class="monospaced">FractionConversions</span> object, and the
<span class="monospaced">int2Fraction</span> method would be available as
<span class="monospaced">FractionConversions.int2Fraction</span> to anyone who wants to call it
explicitly. But if the function is not available as <span class="monospaced">int2Fraction</span> (if the
implicit definition is <em>not in scope</em>), without qualification, the compiler
won’t use it.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">In the REPL, type <span class="monospaced">:implicits</span> to see all implicits that have been
imported from a source other than <span class="monospaced">Predef</span>, or <span class="monospaced">:implicits -v</span> to see <em>all</em>
implicits.</td>
</tr></table>
</div>
<div class="paragraph"><p>You can localize the import to minimize unintended conversions. For example,</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">object</span> <span class="nc">Main</span> <span class="k">extends</span> <span class="nc">App</span> <span class="o">{</span>
  <span class="k">import</span> <span class="nn">com.horstmann.impatient.FractionConversions._</span>
  <span class="k">val</span> <span class="n">result</span> <span class="k">=</span> <span class="mi">3</span> <span class="o">*</span> <span class="nc">Fraction</span><span class="o">(</span><span class="mi">4</span><span class="o">,</span> <span class="mi">5</span><span class="o">)</span> <span class="c1">// Uses imported conversion</span>
  <span class="n">println</span><span class="o">(</span><span class="n">result</span><span class="o">)</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>You can even select the specific conversions that you want. Suppose you
have a second conversion</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">object</span> <span class="nc">FractionConversions</span> <span class="o">{</span>
  <span class="o">...</span>
  <span class="k">implicit</span> <span class="k">def</span> <span class="n">fraction2Double</span><span class="o">(</span><span class="n">f</span><span class="k">:</span> <span class="kt">Fraction</span><span class="o">)</span> <span class="k">=</span> <span class="n">f</span><span class="o">.</span><span class="n">num</span> <span class="o">*</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">f</span><span class="o">.</span><span class="n">den</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>If you prefer this conversion over <span class="monospaced">int2Fraction</span>, you can import just that
converter:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">import</span> <span class="nn">com.horstmann.impatient.FractionConversions.fraction2Double</span>
<span class="k">val</span> <span class="n">result</span> <span class="k">=</span> <span class="mi">3</span> <span class="o">*</span> <span class="nc">Fraction</span><span class="o">(</span><span class="mi">4</span><span class="o">,</span> <span class="mi">5</span><span class="o">)</span> <span class="c1">// result is 2.4</span>
</pre></div></div></div>
<div class="paragraph"><p>You can also exclude a specific conversion if it causes you trouble:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">import</span> <span class="nn">com.horstmann.impatient.FractionConversions.</span><span class="o">{</span><span class="n">fraction2Double</span> <span class="k">=&gt;</span> <span class="k">_</span><span class="o">,</span> <span class="k">_</span><span class="o">}</span>
<span class="c1">// Imports everything but fraction2Double</span>
</pre></div></div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">If you want to find out why the compiler doesn’t use an implicit
conversion that you think it should use, try using it explicitly, for
example by calling <span class="monospaced">fraction2Double(3) * Fraction(4, 5)</span>. You may get an
error message that shows the problem.</td>
</tr></table>
</div>
</div>
<div class="sect2">
<h3 id="_lab_your_own_rich_int">Lab: Your Own Rich Int</h3>
<div class="paragraph"><p>Open <span class="monospaced">labs/src/main/scala/com/newcircle/implicits/PlusPercent.scala</span>.</p></div>
<div class="paragraph"><p>Your job is to create a <span class="monospaced">MyRichInt</span> class to which <span class="monospaced">Int</span> can be implicitly
converted, as long as the caller imports
<span class="monospaced">com.newcircle.implicits.PlusPercent._</span></p></div>
<div class="paragraph"><p>Your <span class="monospaced">MyRichInt</span> class must provide a <span class="monospaced">+%</span> operator that adds the specified
percentage to the integer on which it&#8217;s called. For example:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">import</span> <span class="nn">com.newcircle.implicits.PlusPercent._</span>

<span class="n">println</span><span class="o">(</span><span class="mi">120</span> <span class="o">+%</span> <span class="mi">10</span><span class="o">)</span> <span class="c1">// prints 132</span>
<span class="n">println</span><span class="o">(</span><span class="mi">99</span> <span class="o">+%</span> <span class="o">-</span><span class="mi">3</span><span class="o">)</span>  <span class="c1">// prints 97 (99 - (3 percent of 99))</span>
</pre></div></div></div>
<div class="paragraph"><p>To test your solution, run the predefined tester in SBT:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>&gt; test-only com.newcircle.tests.implicits.PlusPercentSpec</pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_rules_for_implicit_conversions">Rules for Implicit Conversions</h3>
<div class="paragraph"><p>Implicit conversions are considered in three distinct situations:</p></div>
<div class="ulist"><ul>
<li>
<p>
If the type of an expression differs from the expected type:
</p>
</li>
</ul></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="n">sqrt</span><span class="o">(</span><span class="nc">Fraction</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">4</span><span class="o">))</span>
  <span class="c1">// Calls fraction2Double since sqrt expects a Double</span>
</pre></div></div></div>
<div class="ulist"><ul>
<li>
<p>
If an object accesses a nonexistent member:
</p>
</li>
</ul></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">new</span> <span class="nc">File</span><span class="o">(</span><span class="s">&quot;README&quot;</span><span class="o">).</span><span class="n">read</span>
<span class="c1">// Calls file2RichFile since File has no read method</span>
</pre></div></div></div>
<div class="ulist"><ul>
<li>
<p>
If an object invokes a method whose parameters don’t match the given
  arguments:
</p>
</li>
</ul></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="mi">3</span> <span class="o">*</span> <span class="nc">Fraction</span><span class="o">(</span><span class="mi">4</span><span class="o">,</span> <span class="mi">5</span><span class="o">)</span>
<span class="c1">// Calls int2Fraction since the * method of Int doesn&#39;t accept a Fraction</span>
</pre></div></div></div>
<div class="paragraph"><p>On the other hand, there are three situations when an implicit conversion
is not attempted:</p></div>
<div class="ulist"><ul>
<li>
<p>
No implicit conversion is used if the code compiles without it. For
  example, if <span class="monospaced">a * b</span> compiles, the compiler won’t try <span class="monospaced">a * convert(b)</span> or
  <span class="monospaced">convert(a) * b</span>.
</p>
</li>
<li>
<p>
The compiler will never attempt multiple conversions, such as
  <span class="monospaced">convert1(convert2(a)) * b</span>.
</p>
</li>
<li>
<p>
Ambiguous conversions are an error. For example, if both
  <span class="monospaced">convert1(a) * b</span> and <span class="monospaced">convert2(a) * b</span> are valid, the compiler
  will report an error.
</p>
</li>
</ul></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph"><p>If you want to find out which implicit conversion the compiler uses,
compile your program as</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>scalac -Xprint:typer MyProg.scala</pre>
</div></div>
<div class="paragraph"><p>You will see the source after implicit conversions have been added.</p></div>
</td>
</tr></table>
</div>
</div>
<div class="sect2">
<h3 id="_implicit_parameters">Implicit Parameters</h3>
<div class="paragraph"><p>A function or method can have an implicit parameter list. In that case, the
compiler will look for default values to supply with the function call.
Here is a simple example:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">case</span> <span class="k">class</span> <span class="nc">Delimiters</span><span class="o">(</span><span class="n">left</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">right</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span>

<span class="k">def</span> <span class="n">quote</span><span class="o">(</span><span class="n">what</span><span class="k">:</span> <span class="kt">String</span><span class="o">)(</span><span class="k">implicit</span> <span class="n">delims</span><span class="k">:</span> <span class="kt">Delimiters</span><span class="o">)</span> <span class="k">=</span>
  <span class="n">delims</span><span class="o">.</span><span class="n">left</span> <span class="o">+</span> <span class="n">what</span> <span class="o">+</span> <span class="n">delims</span><span class="o">.</span><span class="n">right</span>
</pre></div></div></div>
<div class="paragraph"><p>You can call the <span class="monospaced">quote</span> method with an explicit <span class="monospaced">Delimiters</span> object, like
this:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="n">quote</span><span class="o">(</span><span class="s">&quot;Bonjour le monde&quot;</span><span class="o">)(</span><span class="nc">Delimiters</span><span class="o">(</span><span class="s">&quot;«&quot;</span><span class="o">,</span> <span class="s">&quot;»&quot;</span><span class="o">))</span> <span class="c1">// Returns «Bonjour le monde»</span>
</pre></div></div></div>
<div class="paragraph"><p>(Note that there are two argument lists. This function is "curried".)</p></div>
<div class="paragraph"><p>You can also omit the implicit parameter list:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="n">quote</span><span class="o">(</span><span class="s">&quot;Bonjour le monde&quot;</span><span class="o">)</span>
</pre></div></div></div>
<div class="paragraph"><p>In that case, the compiler will look for an implicit value of type
<span class="monospaced">Delimiters</span>. This must be a value that is declared as <span class="monospaced">implicit</span>. The
compiler looks for such an object in two places:</p></div>
<div class="ulist"><ul>
<li>
<p>
Among all <span class="monospaced">val</span> and <span class="monospaced">def</span> of the desired type that are in scope as a
  single identifier.
</p>
</li>
<li>
<p>
In the companion object of a type that is associated with the desired
  type. Associated types include the desired type itself, and, if it is a
  parameterized type, its type parameters.
</p>
</li>
</ul></div>
<div class="paragraph"><p>In our example, it is useful to make an object, such as</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">object</span> <span class="nc">FrenchPunctuation</span> <span class="o">{</span>
  <span class="k">implicit</span> <span class="k">val</span> <span class="n">quoteDelimiters</span> <span class="k">=</span> <span class="nc">Delimiters</span><span class="o">(</span><span class="s">&quot;«&quot;</span><span class="o">,</span> <span class="s">&quot;»&quot;</span><span class="o">)</span>
  <span class="o">...</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>Then one imports all values from the object:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">import</span> <span class="nn">FrenchPunctuation._</span>
</pre></div></div></div>
<div class="paragraph"><p>or just the specific value:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">import</span> <span class="nn">FrenchPunctuation.quoteDelimiters</span>
</pre></div></div></div>
<div class="paragraph"><p>Now the French delimiters are supplied implicitly to the <span class="monospaced">quote</span> function.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph"><p>There can only be one implicit value for a given data type. Thus, it is not
a good idea to use implicit parameters of common types. For example,</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">def</span> <span class="n">quote</span><span class="o">(</span><span class="n">what</span><span class="k">:</span> <span class="kt">String</span><span class="o">)(</span><span class="k">implicit</span> <span class="n">left</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">right</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span> <span class="c1">// No!</span>
</pre></div></div></div>
<div class="paragraph"><p>would not work. You cannot supply two implicit strings.</p></div>
</td>
</tr></table>
</div>
</div>
<div class="sect2">
<h3 id="_implicit_conversions_with_implicit_parameters">Implicit Conversions with Implicit Parameters</h3>
<div class="paragraph"><p>An implicit function parameter is also usable as an implicit conversion. To
understand the significance, consider first this simple generic function:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">def</span> <span class="n">smaller</span><span class="o">[</span><span class="kt">T</span><span class="o">](</span><span class="n">a</span><span class="k">:</span> <span class="kt">T</span><span class="o">,</span> <span class="n">b</span><span class="k">:</span> <span class="kt">T</span><span class="o">)</span> <span class="k">=</span> <span class="k">if</span> <span class="o">(</span><span class="n">a</span> <span class="o">&lt;</span> <span class="n">b</span><span class="o">)</span> <span class="n">a</span> <span class="k">else</span> <span class="n">b</span> <span class="c1">// Not quite</span>
</pre></div></div></div>
<div class="paragraph"><p>That doesn’t actually work. The compiler won’t accept the function because
it doesn’t know that <span class="monospaced">a</span> and <span class="monospaced">b</span> belong to a type with a <span class="monospaced">&lt;</span> operator.</p></div>
<div class="paragraph"><p>We can supply a conversion function for that purpose:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">def</span> <span class="n">smaller</span><span class="o">[</span><span class="kt">T</span><span class="o">](</span><span class="n">a</span><span class="k">:</span> <span class="kt">T</span><span class="o">,</span> <span class="n">b</span><span class="k">:</span> <span class="kt">T</span><span class="o">)(</span><span class="k">implicit</span> <span class="n">order</span><span class="k">:</span> <span class="kt">T</span> <span class="o">=&gt;</span> <span class="nc">Ordered</span><span class="o">[</span><span class="kt">T</span><span class="o">])</span> <span class="k">=</span> <span class="o">{</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">order</span><span class="o">(</span><span class="n">a</span><span class="o">)</span> <span class="o">&lt;</span> <span class="n">b</span><span class="o">)</span> <span class="n">a</span> <span class="k">else</span> <span class="n">b</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>Since the <span class="monospaced">Ordered[T]</span> trait has a <span class="monospaced">&lt;</span> operator that consumes a <span class="monospaced">T</span>, this version is correct.</p></div>
<div class="paragraph"><p>As it happens, this is such a common situation that the Predef object
defines implicit values of type <span class="monospaced">T =&gt; Ordered[T]</span> for a large number of
types, including all types that already implement <span class="monospaced">Ordered[T]</span> or
<span class="monospaced">Comparable[T]</span>. Thus, no imports are required for the following two statements:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="n">smaller</span><span class="o">(</span><span class="mi">40</span><span class="o">,</span> <span class="mi">2</span><span class="o">)</span>
<span class="n">smaller</span><span class="o">(</span><span class="s">&quot;Hello&quot;</span><span class="o">,</span> <span class="s">&quot;World&quot;</span><span class="o">)</span>
</pre></div></div></div>
<div class="paragraph"><p>If you want to call</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="n">smaller</span><span class="o">(</span><span class="nc">Fraction</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">7</span><span class="o">),</span> <span class="nc">Fraction</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span> <span class="mi">9</span><span class="o">))</span>
</pre></div></div></div>
<div class="paragraph"><p>then you need to define a function <span class="monospaced">Fraction =&gt; Ordered[Fraction]</span> and
either supply it in the call or make it available as an <span class="monospaced">implicit val</span>.</p></div>
<div class="paragraph"><p>Here, finally, is the point. Look again at</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">def</span> <span class="n">smaller</span><span class="o">[</span><span class="kt">T</span><span class="o">](</span><span class="n">a</span><span class="k">:</span> <span class="kt">T</span><span class="o">,</span> <span class="n">b</span><span class="k">:</span> <span class="kt">T</span><span class="o">)(</span><span class="k">implicit</span> <span class="n">order</span><span class="k">:</span> <span class="kt">T</span> <span class="o">=&gt;</span> <span class="nc">Ordered</span><span class="o">[</span><span class="kt">T</span><span class="o">])</span>
</pre></div></div></div>
<div class="paragraph"><p>Note that <span class="monospaced">order</span> is a function with a single parameter, is tagged
<span class="monospaced">implicit</span>, and has a name that is a single identifier. Therefore, it is an
implicit conversion, in addition to being an implicit parameter. So, we can
omit the call to order in the body of the function:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">def</span> <span class="n">smaller</span><span class="o">[</span><span class="kt">T</span><span class="o">](</span><span class="n">a</span><span class="k">:</span> <span class="kt">T</span><span class="o">,</span> <span class="n">b</span><span class="k">:</span> <span class="kt">T</span><span class="o">)(</span><span class="k">implicit</span> <span class="n">order</span><span class="k">:</span> <span class="kt">T</span> <span class="o">=&gt;</span> <span class="nc">Ordered</span><span class="o">[</span><span class="kt">T</span><span class="o">])</span> <span class="k">=</span> <span class="o">{</span>
  <span class="k">if</span> <span class="o">(</span><span class="n">a</span> <span class="o">&lt;</span> <span class="n">b</span><span class="o">)</span> <span class="n">a</span> <span class="k">else</span> <span class="n">b</span> <span class="c1">// Calls order(a) &lt; b if a doesn&#39;t have a &lt; operator</span>
<span class="o">}</span>
</pre></div></div></div>
</div>
<div class="sect2">
<h3 id="_context_bounds_2">Context Bounds</h3>
<div class="paragraph"><p>A type parameter can have a context bound of the form <span class="monospaced">T : M</span>, where <span class="monospaced">M</span> is
another generic type. It requires that there is an implicit value of type
<span class="monospaced">M[T]</span> in scope.</p></div>
<div class="paragraph"><p>For example:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Pair</span><span class="o">[</span><span class="kt">T</span> <span class="kt">:</span> <span class="kt">Ordering</span><span class="o">]</span>
</pre></div></div></div>
<div class="paragraph"><p>requires that there is an implicit value of type <span class="monospaced">Ordering[T]</span>. That
implicit value can then be used in the methods of the class. Consider this
example:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Pair</span><span class="o">[</span><span class="kt">T</span> <span class="kt">:</span> <span class="kt">Ordering</span><span class="o">](</span><span class="k">val</span> <span class="n">first</span><span class="k">:</span> <span class="kt">T</span><span class="o">,</span> <span class="k">val</span> <span class="n">second</span><span class="k">:</span> <span class="kt">T</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">def</span> <span class="n">smaller</span><span class="o">(</span><span class="k">implicit</span> <span class="n">ord</span><span class="k">:</span> <span class="kt">Ordering</span><span class="o">[</span><span class="kt">T</span><span class="o">])</span> <span class="k">=</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">ord</span><span class="o">.</span><span class="n">compare</span><span class="o">(</span><span class="n">first</span><span class="o">,</span> <span class="n">second</span><span class="o">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="o">)</span> <span class="n">first</span> <span class="k">else</span> <span class="n">second</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>If we form a new <span class="monospaced">Pair(40, 2)</span>, then the compiler infers that we want a
<span class="monospaced">Pair[Int]</span>. Since there is an implicit value of type <span class="monospaced">Ordering[Int]</span> in
the <span class="monospaced">Predef</span> scope, <span class="monospaced">Int</span> fulfills the context bound. That ordering becomes
a field of the class, and it is passed to the methods that need it.</p></div>
<div class="paragraph"><p>If you prefer, you can retrieve the ordering with the <span class="monospaced">implicitly</span> method in
the <span class="monospaced">Predef</span> class:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Pair</span><span class="o">[</span><span class="kt">T</span> <span class="kt">:</span> <span class="kt">Ordering</span><span class="o">](</span><span class="k">val</span> <span class="n">first</span><span class="k">:</span> <span class="kt">T</span><span class="o">,</span> <span class="k">val</span> <span class="n">second</span><span class="k">:</span> <span class="kt">T</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">def</span> <span class="n">smaller</span> <span class="k">=</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">implicitly</span><span class="o">[</span><span class="kt">Ordering</span><span class="o">[</span><span class="kt">T</span><span class="o">]].</span><span class="n">compare</span><span class="o">(</span><span class="n">first</span><span class="o">,</span> <span class="n">second</span><span class="o">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="o">)</span> <span class="n">first</span> <span class="k">else</span> <span class="n">second</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>The <span class="monospaced">implicitly</span> function is defined as follows in <span class="monospaced">Predef.scala</span>:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">def</span> <span class="n">implicitly</span><span class="o">[</span><span class="kt">T</span><span class="o">](</span><span class="k">implicit</span> <span class="n">e</span><span class="k">:</span> <span class="kt">T</span><span class="o">)</span> <span class="k">=</span> <span class="n">e</span>
<span class="c1">// For summoning implicit values from the nether world</span>
</pre></div></div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">The comment is apt: The implicit objects live in the "nether world"
and are invisibly added to methods.</td>
</tr></table>
</div>
<div class="paragraph"><p>Alternatively, you can take advantage of the fact that the <span class="monospaced">Ordered</span> trait
defines an implicit conversion from <span class="monospaced">Ordering</span> to <span class="monospaced">Ordered</span>. If you import that
conversion, you can use relational operators:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Pair</span><span class="o">[</span><span class="kt">T</span> <span class="kt">:</span> <span class="kt">Ordering</span><span class="o">](</span><span class="k">val</span> <span class="n">first</span><span class="k">:</span> <span class="kt">T</span><span class="o">,</span> <span class="k">val</span> <span class="n">second</span><span class="k">:</span> <span class="kt">T</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">def</span> <span class="n">smaller</span> <span class="k">=</span> <span class="o">{</span>
    <span class="k">import</span> <span class="nn">Ordered._</span><span class="o">;</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">first</span> <span class="o">&lt;</span> <span class="n">second</span><span class="o">)</span> <span class="n">first</span> <span class="k">else</span> <span class="n">second</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div></div></div>
<div class="paragraph"><p>These are just minor variations; the important point is that you can
instantiate <span class="monospaced">Pair[T]</span> whenever there is an implicit value of type
<span class="monospaced">Ordering[T]</span>. For example, if you want a <span class="monospaced">Pair[Point]</span>, arrange for an
implicit <span class="monospaced">Ordering[Point]</span> value:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">implicit</span> <span class="k">object</span> <span class="nc">PointOrdering</span> <span class="k">extends</span> <span class="nc">Ordering</span><span class="o">[</span><span class="kt">Point</span><span class="o">]</span> <span class="o">{</span>
  <span class="k">def</span> <span class="n">compare</span><span class="o">(</span><span class="n">a</span><span class="k">:</span> <span class="kt">Point</span><span class="o">,</span> <span class="n">b</span><span class="k">:</span> <span class="kt">Point</span><span class="o">)</span> <span class="k">=</span> <span class="o">...</span>
<span class="o">}</span>
</pre></div></div></div>
</div>
<div class="sect2">
<h3 id="_the_span_class_monospaced_implicitnotfound_span_annotation">The <span class="monospaced">@implicitNotFound</span> Annotation</h3>
<div class="paragraph"><p>The <span class="monospaced">@implicitNotFound</span> annotation raises an error message when the
compiler cannot construct an implicit parameter of the annotated type. The
intent is to give a useful error message to the programmer. For example,
the <span class="monospaced">&lt;:&lt;</span> class is annotated as</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="nd">@implicitNotFound</span><span class="o">(</span><span class="n">msg</span> <span class="k">=</span> <span class="s">&quot;Cannot prove that ${From} &lt;:&lt; ${To}.&quot;</span><span class="o">)</span>
<span class="k">abstract</span> <span class="k">class</span> <span class="nc">&lt;:&lt;</span><span class="o">[</span><span class="kt">-From</span>, <span class="kt">+To</span><span class="o">]</span> <span class="nc">extends</span> <span class="nc">Function1</span><span class="o">[</span><span class="kt">From</span>, <span class="kt">To</span><span class="o">]</span>
</pre></div></div></div>
<div class="paragraph"><p>Thus, if you call:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="n">firstLast</span><span class="o">[</span><span class="kt">String</span>, <span class="kt">List</span><span class="o">[</span><span class="kt">Int</span><span class="o">]](</span><span class="nc">List</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">))</span>
</pre></div></div></div>
<div class="paragraph"><p>then the error message is</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="nc">Cannot</span> <span class="n">prove</span> <span class="n">that</span> <span class="nc">List</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="o">&lt;:&lt;</span> <span class="nc">Iterable</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span>
</pre></div></div></div>
<div class="paragraph"><p>That is more likely to give the programmer a hint than the default</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="nc">Could</span> <span class="n">not</span> <span class="n">find</span> <span class="k">implicit</span> <span class="n">value</span> <span class="k">for</span> <span class="n">parameter</span> <span class="n">ev</span><span class="k">:</span> <span class="k">&lt;:</span><span class="kt">:&lt;</span><span class="o">[</span><span class="kt">List</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span>,<span class="kt">Iterable</span><span class="o">[</span><span class="kt">String</span><span class="o">]]</span>
</pre></div></div></div>
<div class="paragraph"><p>Note that <span class="monospaced">${From}</span> and <span class="monospaced">${To}</span> in the error message are replaced with the
type parameters <span class="monospaced">From</span> and <span class="monospaced">To</span> of the annotated class.</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="more-resources">Additional Resources</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_books_and_videos">Books and Videos</h3>
<div class="sect3">
<h4 id="_books">Books</h4>
<div class="ulist"><ul>
<li>
<p>
<em>Scala for the Impatient</em>, by Cay S. Horstmann
  <a href="http://www.informit.com/store/scala-for-the-impatient-9780321774095">http://www.informit.com/store/scala-for-the-impatient-9780321774095</a>
</p>
</li>
<li>
<p>
<em>Programming Scala: Scalability = Functional Programming + Objects</em>, by
  Dean Wampler and Alex Payne
  <a href="http://shop.oreilly.com/product/9780596155964.do">http://shop.oreilly.com/product/9780596155964.do</a>
</p>
</li>
<li>
<p>
<em>Scala in Depth</em>, by Joshua D. Suereth
  <a href="http://www.manning.com/suereth/">http://www.manning.com/suereth/</a>
</p>
</li>
<li>
<p>
<em>Programming in Scala, 2nd Edition</em>, by Martin Odersky, Lex Spoon,
  and Bill Venners
  <a href="http://www.artima.com/shop/programming_in_scala_2ed">http://www.artima.com/shop/programming_in_scala_2ed</a>
</p>
</li>
<li>
<p>
<em>Scala Puzzlers</em>, by Andrew Phillips and Nermin Šerifović
  <a href="http://www.artima.com/shop/scala_puzzlers">http://www.artima.com/shop/scala_puzzlers</a>
</p>
</li>
</ul></div>
</div>
<div class="sect3">
<h4 id="_videos">Videos</h4>
<div class="ulist"><ul>
<li>
<p>
<em>An Introduction to Pattern Matching in Scala</em> (Brian Clapper)
  <a href="https://newcircle.com/s/post/1696/an_Introduction_to_pattern_matching_in_scala_brian_clapper_tutorial">https://newcircle.com/s/post/1696/an_Introduction_to_pattern_matching_in_scala_brian_clapper_tutorial</a>
</p>
</li>
</ul></div>
</div>
</div>
<div class="sect2">
<h3 id="_web_sites">Web sites</h3>
<div class="ulist"><ul>
<li>
<p>
Primary Scala documentation web site:
  <a href="http://www.scala-lang.org/documentation/">http://www.scala-lang.org/documentation/</a>
</p>
</li>
<li>
<p>
ScalaTest: <a href="http://scalatest.org/">http://scalatest.org/</a>
</p>
</li>
</ul></div>
</div>
<div class="sect2">
<h3 id="_online_courses">Online Courses</h3>
<div class="ulist"><ul>
<li>
<p>
Martin Odersky&#8217;s well-regarded Coursera course (runs periodically):
  <a href="https://www.coursera.org/course/progfun">https://www.coursera.org/course/progfun</a>
</p>
</li>
</ul></div>
</div>
</div>
</div>
</div>
<div id="footnotes"><hr></div>
<div id="footer">
<div id="footer-text">
Version 1.1<br>
Last updated 2015-12-16 17:23:58 EST
</div>
</div>
</body>
</html>
